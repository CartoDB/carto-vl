/*!
 * CARTO VL js https://carto.com/
 * Version: 1.4.4
 * 
 */!function(e){var t={};function __webpack_require__(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,__webpack_require__),n.l=!0,n.exports}__webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,r){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(__webpack_require__.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)__webpack_require__.d(r,n,function(t){return e[t]}.bind(null,n));return r},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=41)}([function(e,t){e.exports=function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function _getPrototypeOf(t){return e.exports=_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(t)}e.exports=_getPrototypeOf},function(e,t){function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}},function(e,t,r){var n=r(9),a=r(34);e.exports=function _possibleConstructorReturn(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?a(e):t}},function(e,t,r){var n=r(13);e.exports=function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}},function(e,t,r){var n=r(26),a=r(27),o=r(28);e.exports=function _slicedToArray(e,t){return n(e)||a(e,t)||o()}},function(e,t,r){e.exports=r(29)},function(e,t){function asyncGeneratorStep(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}e.exports=function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function _next(e){asyncGeneratorStep(o,n,a,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(o,n,a,_next,_throw,"throw",e)}_next(void 0)})}}},function(e,t,r){var n=r(38),a=r(39),o=r(40);e.exports=function _toConsumableArray(e){return n(e)||a(e)||o()}},function(e,t){function _typeof2(e){return(_typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof2(e){return typeof e}:function _typeof2(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(t){return"function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?e.exports=_typeof=function _typeof(e){return _typeof2(e)}:e.exports=_typeof=function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)},_typeof(t)}e.exports=_typeof},function(e,t,r){r(1);var n=r(37);function _get(t,r,a){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=_get=Reflect.get:e.exports=_get=function _get(e,t,r){var a=n(e,t);if(a){var o=Object.getOwnPropertyDescriptor(a,t);return o.get?o.get.call(r):o.value}},_get(t,r,a||t)}e.exports=_get},function(e,t,r){e.exports.VectorTile=r(31),e.exports.VectorTileFeature=r(15),e.exports.VectorTileLayer=r(14)},function(e,t,r){"use strict";e.exports=Pbf;var n=r(33);function Pbf(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Pbf.Varint=0,Pbf.Fixed64=1,Pbf.Bytes=2,Pbf.Fixed32=5;function readPackedEnd(e){return e.type===Pbf.Bytes?e.readVarint()+e.pos:e.pos+1}function toNum(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function makeRoomForExtraLength(e,t,r){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.ceil(Math.log(t)/(7*Math.LN2));r.realloc(n);for(var a=r.pos-1;a>=e;a--)r.buf[a+n]=r.buf[a]}function writePackedVarint(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function writePackedSVarint(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function writePackedFloat(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function writePackedDouble(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function writePackedBoolean(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function writePackedFixed32(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function writePackedSFixed32(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function writePackedFixed64(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function writePackedSFixed64(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function readUInt32(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function writeInt32(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function readInt32(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}Pbf.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),a=n>>3,o=this.pos;this.type=7&n,e(a,t,this),this.pos===o&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=readUInt32(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=readInt32(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=readUInt32(this.buf,this.pos)+4294967296*readUInt32(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=readUInt32(this.buf,this.pos)+4294967296*readInt32(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,n=this.buf;return t=127&(r=n[this.pos++]),r<128?t:(t|=(127&(r=n[this.pos++]))<<7,r<128?t:(t|=(127&(r=n[this.pos++]))<<14,r<128?t:(t|=(127&(r=n[this.pos++]))<<21,r<128?t:function readVarintRemainder(e,t,r){var n,a,o=r.buf;if(a=o[r.pos++],n=(112&a)>>4,a<128)return toNum(e,n,t);if(a=o[r.pos++],n|=(127&a)<<3,a<128)return toNum(e,n,t);if(a=o[r.pos++],n|=(127&a)<<10,a<128)return toNum(e,n,t);if(a=o[r.pos++],n|=(127&a)<<17,a<128)return toNum(e,n,t);if(a=o[r.pos++],n|=(127&a)<<24,a<128)return toNum(e,n,t);if(a=o[r.pos++],n|=(1&a)<<31,a<128)return toNum(e,n,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=n[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=function readUtf8(e,t,r){var n="",a=t;for(;a<r;){var o,i,u,s=e[a],c=null,f=s>239?4:s>223?3:s>191?2:1;if(a+f>r)break;1===f?s<128&&(c=s):2===f?128==(192&(o=e[a+1]))&&(c=(31&s)<<6|63&o)<=127&&(c=null):3===f?(o=e[a+1],i=e[a+2],128==(192&o)&&128==(192&i)&&((c=(15&s)<<12|(63&o)<<6|63&i)<=2047||c>=55296&&c<=57343)&&(c=null)):4===f&&(o=e[a+1],i=e[a+2],u=e[a+3],128==(192&o)&&128==(192&i)&&128==(192&u)&&((c=(15&s)<<18|(63&o)<<12|(63&i)<<6|63&u)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,f=1):c>65535&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),a+=f}return n}(this.buf,this.pos,e);return this.pos=e,t},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){var r=readPackedEnd(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Pbf.Varint)for(;this.buf[this.pos++]>127;);else if(t===Pbf.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Pbf.Fixed32)this.pos+=4;else{if(t!==Pbf.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),writeInt32(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),writeInt32(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),writeInt32(this.buf,-1&e,this.pos),writeInt32(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),writeInt32(this.buf,-1&e,this.pos),writeInt32(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function writeBigVarint(e,t){var r,n;e>=0?(r=e%4294967296|0,n=e/4294967296|0):(n=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,n=n+1|0));if(e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function writeBigVarintLow(e,t,r){r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos]=127&e}(r,0,t),function writeBigVarintHigh(e,t){var r=(7&e)<<4;if(t.buf[t.pos++]|=r|((e>>>=3)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;t.buf[t.pos++]=127&e}(n,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function writeUtf8(e,t,r){for(var n,a,o=0;o<t.length;o++){if((n=t.charCodeAt(o))>55295&&n<57344){if(!a){n>56319||o+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):a=n;continue}if(n<56320){e[r++]=239,e[r++]=191,e[r++]=189,a=n;continue}n=a-55296<<10|n-56320|65536,a=null}else a&&(e[r++]=239,e[r++]=191,e[r++]=189,a=null);n<128?e[r++]=n:(n<2048?e[r++]=n>>6|192:(n<65536?e[r++]=n>>12|224:(e[r++]=n>>18|240,e[r++]=n>>12&63|128),e[r++]=n>>6&63|128),e[r++]=63&n|128)}return r}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&makeRoomForExtraLength(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),n.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),n.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var n=this.pos-r;n>=128&&makeRoomForExtraLength(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,r){this.writeTag(e,Pbf.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){this.writeMessage(e,writePackedVarint,t)},writePackedSVarint:function(e,t){this.writeMessage(e,writePackedSVarint,t)},writePackedBoolean:function(e,t){this.writeMessage(e,writePackedBoolean,t)},writePackedFloat:function(e,t){this.writeMessage(e,writePackedFloat,t)},writePackedDouble:function(e,t){this.writeMessage(e,writePackedDouble,t)},writePackedFixed32:function(e,t){this.writeMessage(e,writePackedFixed32,t)},writePackedSFixed32:function(e,t){this.writeMessage(e,writePackedSFixed32,t)},writePackedFixed64:function(e,t){this.writeMessage(e,writePackedFixed64,t)},writePackedSFixed64:function(e,t){this.writeMessage(e,writePackedSFixed64,t)},writeBytesField:function(e,t){this.writeTag(e,Pbf.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Pbf.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Pbf.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Pbf.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Pbf.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Pbf.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Pbf.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Pbf.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Pbf.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Pbf.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}}},function(e,t){function _setPrototypeOf(t,r){return e.exports=_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e},_setPrototypeOf(t,r)}e.exports=_setPrototypeOf},function(e,t,r){"use strict";var n=r(15);function VectorTileLayer(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(readLayer,this,t),this.length=this._features.length}function readLayer(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function readValueMessage(e){var t=null,r=e.readVarint()+e.pos;for(;e.pos<r;){var n=e.readVarint()>>3;t=1===n?e.readString():2===n?e.readFloat():3===n?e.readDouble():4===n?e.readVarint64():5===n?e.readVarint():6===n?e.readSVarint():7===n?e.readBoolean():null}return t}(r))}e.exports=VectorTileLayer,VectorTileLayer.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,t,this.extent,this._keys,this._values)}},function(e,t,r){"use strict";var n=r(32);function VectorTileFeature(e,t,r,n,a){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=a,e.readFields(readFeature,this,t)}function readFeature(e,t,r){1==e?t.id=r.readVarint():2==e?function readTag(e,t){var r=e.readVarint()+e.pos;for(;e.pos<r;){var n=t._keys[e.readVarint()],a=t._values[e.readVarint()];t.properties[n]=a}}(r,t):3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos)}function signedArea(e){for(var t,r,n=0,a=0,o=e.length,i=o-1;a<o;i=a++)t=e[a],n+=((r=e[i]).x-t.x)*(t.y+r.y);return n}e.exports=VectorTileFeature,VectorTileFeature.types=["Unknown","Point","LineString","Polygon"],VectorTileFeature.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,a=1,o=0,i=0,u=0,s=[];e.pos<r;){if(o<=0){var c=e.readVarint();a=7&c,o=c>>3}if(o--,1===a||2===a)i+=e.readSVarint(),u+=e.readSVarint(),1===a&&(t&&s.push(t),t=[]),t.push(new n(i,u));else{if(7!==a)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&s.push(t),s},VectorTileFeature.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,n=0,a=0,o=0,i=1/0,u=-1/0,s=1/0,c=-1/0;e.pos<t;){if(n<=0){var f=e.readVarint();r=7&f,n=f>>3}if(n--,1===r||2===r)a+=e.readSVarint(),o+=e.readSVarint(),a<i&&(i=a),a>u&&(u=a),o<s&&(s=o),o>c&&(c=o);else if(7!==r)throw new Error("unknown command "+r)}return[i,s,u,c]},VectorTileFeature.prototype.toGeoJSON=function(e,t,r){var n,a,o=this.extent*Math.pow(2,r),i=this.extent*e,u=this.extent*t,s=this.loadGeometry(),c=VectorTileFeature.types[this.type];function project(e){for(var t=0;t<e.length;t++){var r=e[t],n=180-360*(r.y+u)/o;e[t]=[360*(r.x+i)/o-180,360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90]}}switch(this.type){case 1:var f=[];for(n=0;n<s.length;n++)f[n]=s[n][0];project(s=f);break;case 2:for(n=0;n<s.length;n++)project(s[n]);break;case 3:for(s=function classifyRings(e){var t=e.length;if(t<=1)return[e];for(var r,n,a=[],o=0;o<t;o++){var i=signedArea(e[o]);0!==i&&(void 0===n&&(n=i<0),n===i<0?(r&&a.push(r),r=[e[o]]):r.push(e[o]))}r&&a.push(r);return a}(s),n=0;n<s.length;n++)for(a=0;a<s[n].length;a++)project(s[n][a])}1===s.length?s=s[0]:c="Multi"+c;var l={type:"Feature",geometry:{type:c,coordinates:s},properties:this.properties};return"id"in this&&(l.id=this.id),l}},function(e,t,r){var n=r(1),a=r(13),o=r(35),i=r(36);function _wrapNativeSuper(t){var r="function"==typeof Map?new Map:void 0;return e.exports=_wrapNativeSuper=function _wrapNativeSuper(e){if(null===e||!o(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,Wrapper)}function Wrapper(){return i(e,arguments,n(this).constructor)}return Wrapper.prototype=Object.create(e.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),a(Wrapper,e)},_wrapNativeSuper(t)}e.exports=_wrapNativeSuper},function(e,t,r){"use strict";function earcut(e,t,r){r=r||2;var n,a,o,i,u,s,c,f=t&&t.length,l=f?t[0]*r:e.length,h=linkedList(e,0,l,r,!0),d=[];if(!h)return d;if(f&&(h=function eliminateHoles(e,t,r,n){var a,o,i,u,s,c=[];for(a=0,o=t.length;a<o;a++)i=t[a]*n,u=a<o-1?t[a+1]*n:e.length,(s=linkedList(e,i,u,n,!1))===s.next&&(s.steiner=!0),c.push(getLeftmost(s));for(c.sort(compareX),a=0;a<c.length;a++)eliminateHole(c[a],r),r=filterPoints(r,r.next);return r}(e,t,h,r)),e.length>80*r){n=o=e[0],a=i=e[1];for(var p=r;p<l;p+=r)u=e[p],s=e[p+1],u<n&&(n=u),s<a&&(a=s),u>o&&(o=u),s>i&&(i=s);c=0!==(c=Math.max(o-n,i-a))?1/c:0}return earcutLinked(h,d,r,n,a,c),d}function linkedList(e,t,r,n,a){var o,i;if(a===signedArea(e,t,r,n)>0)for(o=t;o<r;o+=n)i=insertNode(o,e[o],e[o+1],i);else for(o=r-n;o>=t;o-=n)i=insertNode(o,e[o],e[o+1],i);return i&&equals(i,i.next)&&(removeNode(i),i=i.next),i}function filterPoints(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!equals(n,n.next)&&0!==area(n.prev,n,n.next))n=n.next;else{if(removeNode(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function earcutLinked(e,t,r,n,a,o,i){if(e){!i&&o&&function indexCurve(e,t,r,n){var a=e;do{null===a.z&&(a.z=zOrder(a.x,a.y,t,r,n)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next}while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,function sortLinked(e){var t,r,n,a,o,i,u,s,c=1;do{for(r=e,e=null,o=null,i=0;r;){for(i++,n=r,u=0,t=0;t<c&&(u++,n=n.nextZ);t++);for(s=c;u>0||s>0&&n;)0!==u&&(0===s||!n||r.z<=n.z)?(a=r,r=r.nextZ,u--):(a=n,n=n.nextZ,s--),o?o.nextZ=a:e=a,a.prevZ=o,o=a;r=n}o.nextZ=null,c*=2}while(i>1);return e}(a)}(e,n,a,o);for(var u,s,c=e;e.prev!==e.next;)if(u=e.prev,s=e.next,o?isEarHashed(e,n,a,o):isEar(e))t.push(u.i/r),t.push(e.i/r),t.push(s.i/r),removeNode(e),e=s.next,c=s.next;else if((e=s)===c){i?1===i?earcutLinked(e=cureLocalIntersections(e,t,r),t,r,n,a,o,2):2===i&&splitEarcut(e,t,r,n,a,o):earcutLinked(filterPoints(e),t,r,n,a,o,1);break}}}function isEar(e){var t=e.prev,r=e,n=e.next;if(area(t,r,n)>=0)return!1;for(var a=e.next.next;a!==e.prev;){if(pointInTriangle(t.x,t.y,r.x,r.y,n.x,n.y,a.x,a.y)&&area(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function isEarHashed(e,t,r,n){var a=e.prev,o=e,i=e.next;if(area(a,o,i)>=0)return!1;for(var u=a.x<o.x?a.x<i.x?a.x:i.x:o.x<i.x?o.x:i.x,s=a.y<o.y?a.y<i.y?a.y:i.y:o.y<i.y?o.y:i.y,c=a.x>o.x?a.x>i.x?a.x:i.x:o.x>i.x?o.x:i.x,f=a.y>o.y?a.y>i.y?a.y:i.y:o.y>i.y?o.y:i.y,l=zOrder(u,s,t,r,n),h=zOrder(c,f,t,r,n),d=e.prevZ,p=e.nextZ;d&&d.z>=l&&p&&p.z<=h;){if(d!==e.prev&&d!==e.next&&pointInTriangle(a.x,a.y,o.x,o.y,i.x,i.y,d.x,d.y)&&area(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,p!==e.prev&&p!==e.next&&pointInTriangle(a.x,a.y,o.x,o.y,i.x,i.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;d&&d.z>=l;){if(d!==e.prev&&d!==e.next&&pointInTriangle(a.x,a.y,o.x,o.y,i.x,i.y,d.x,d.y)&&area(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=h;){if(p!==e.prev&&p!==e.next&&pointInTriangle(a.x,a.y,o.x,o.y,i.x,i.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function cureLocalIntersections(e,t,r){var n=e;do{var a=n.prev,o=n.next.next;!equals(a,o)&&intersects(a,n,n.next,o)&&locallyInside(a,o)&&locallyInside(o,a)&&(t.push(a.i/r),t.push(n.i/r),t.push(o.i/r),removeNode(n),removeNode(n.next),n=e=o),n=n.next}while(n!==e);return n}function splitEarcut(e,t,r,n,a,o){var i=e;do{for(var u=i.next.next;u!==i.prev;){if(i.i!==u.i&&isValidDiagonal(i,u)){var s=splitPolygon(i,u);return i=filterPoints(i,i.next),s=filterPoints(s,s.next),earcutLinked(i,t,r,n,a,o),void earcutLinked(s,t,r,n,a,o)}u=u.next}i=i.next}while(i!==e)}function compareX(e,t){return e.x-t.x}function eliminateHole(e,t){if(t=function findHoleBridge(e,t){var r,n=t,a=e.x,o=e.y,i=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var u=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=a&&u>i){if(i=u,u===a){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(a===i)return r.prev;var s,c=r,f=r.x,l=r.y,h=1/0;n=r.next;for(;n!==c;)a>=n.x&&n.x>=f&&a!==n.x&&pointInTriangle(o<l?a:i,o,f,l,o<l?i:a,o,n.x,n.y)&&((s=Math.abs(o-n.y)/(a-n.x))<h||s===h&&n.x>r.x)&&locallyInside(n,e)&&(r=n,h=s),n=n.next;return r}(e,t)){var r=splitPolygon(t,e);filterPoints(r,r.next)}}function zOrder(e,t,r,n,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*a)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*a)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function getLeftmost(e){var t=e,r=e;do{t.x<r.x&&(r=t),t=t.next}while(t!==e);return r}function pointInTriangle(e,t,r,n,a,o,i,u){return(a-i)*(t-u)-(e-i)*(o-u)>=0&&(e-i)*(n-u)-(r-i)*(t-u)>=0&&(r-i)*(o-u)-(a-i)*(n-u)>=0}function isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function intersectsPolygon(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&intersects(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&locallyInside(e,t)&&locallyInside(t,e)&&function middleInside(e,t){var r=e,n=!1,a=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&a<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)}function area(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function equals(e,t){return e.x===t.x&&e.y===t.y}function intersects(e,t,r,n){return!!(equals(e,t)&&equals(r,n)||equals(e,n)&&equals(r,t))||area(e,t,r)>0!=area(e,t,n)>0&&area(r,n,e)>0!=area(r,n,t)>0}function locallyInside(e,t){return area(e.prev,e,e.next)<0?area(e,t,e.next)>=0&&area(e,e.prev,t)>=0:area(e,t,e.prev)<0||area(e,e.next,t)<0}function splitPolygon(e,t){var r=new Node(e.i,e.x,e.y),n=new Node(t.i,t.x,t.y),a=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=a,a.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function insertNode(e,t,r,n){var a=new Node(e,t,r);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(e,t,r,n){for(var a=0,o=t,i=r-n;o<r;o+=n)a+=(e[i]-e[o])*(e[o+1]+e[i+1]),i=o;return a}e.exports=earcut,e.exports.default=earcut,earcut.deviation=function(e,t,r,n){var a=t&&t.length,o=a?t[0]*r:e.length,i=Math.abs(signedArea(e,0,o,r));if(a)for(var u=0,s=t.length;u<s;u++){var c=t[u]*r,f=u<s-1?t[u+1]*r:e.length;i-=Math.abs(signedArea(e,c,f,r))}var l=0;for(u=0;u<n.length;u+=3){var h=n[u]*r,d=n[u+1]*r,p=n[u+2]*r;l+=Math.abs((e[h]-e[p])*(e[d+1]-e[h+1])-(e[h]-e[d])*(e[p+1]-e[h+1]))}return 0===i&&0===l?0:Math.abs((l-i)/i)},earcut.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,a=0;a<e.length;a++){for(var o=0;o<e[a].length;o++)for(var i=0;i<t;i++)r.vertices.push(e[a][o][i]);a>0&&(n+=e[a-1].length,r.holes.push(n))}return r}},function(e,t){!function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(256),n=0;n<e.length;n++)r[e.charCodeAt(n)]=n;t.encode=function(t){var r,n=new Uint8Array(t),a=n.length,o="";for(r=0;r<a;r+=3)o+=e[n[r]>>2],o+=e[(3&n[r])<<4|n[r+1]>>4],o+=e[(15&n[r+1])<<2|n[r+2]>>6],o+=e[63&n[r+2]];return a%3==2?o=o.substring(0,o.length-1)+"=":a%3==1&&(o=o.substring(0,o.length-2)+"=="),o},t.decode=function(e){var t,n,a,o,i,u=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(u--,"="===e[e.length-2]&&u--);var f=new ArrayBuffer(u),l=new Uint8Array(f);for(t=0;t<s;t+=4)n=r[e.charCodeAt(t)],a=r[e.charCodeAt(t+1)],o=r[e.charCodeAt(t+2)],i=r[e.charCodeAt(t+3)],l[c++]=n<<2|a>>4,l[c++]=(15&a)<<4|o>>2,l[c++]=(3&o)<<6|63&i;return f}}()},,,,,,,,function(e,t){e.exports=function _arrayWithHoles(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function _iterableToArrayLimit(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}},function(e,t){e.exports=function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,r){var n=function(){return this||"object"==typeof self&&self}()||Function("return this")(),a=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,o=a&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=r(30),a)n.regeneratorRuntime=o;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var r,n=Object.prototype,a=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag",c="object"==typeof e,f=t.regeneratorRuntime;if(f)c&&(e.exports=f);else{(f=t.regeneratorRuntime=c?e.exports:{}).wrap=wrap;var l="suspendedStart",h="suspendedYield",d="executing",p="completed",y={},v={};v[i]=function(){return this};var m=Object.getPrototypeOf,g=m&&m(m(values([])));g&&g!==n&&a.call(g,i)&&(v=g);var x=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(v);GeneratorFunction.prototype=x.constructor=GeneratorFunctionPrototype,GeneratorFunctionPrototype.constructor=GeneratorFunction,GeneratorFunctionPrototype[s]=GeneratorFunction.displayName="GeneratorFunction",f.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},f.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(x),e},f.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),AsyncIterator.prototype[u]=function(){return this},f.AsyncIterator=AsyncIterator,f.async=function(e,t,r,n){var a=new AsyncIterator(wrap(e,t,r,n));return f.isGeneratorFunction(t)?a:a.next().then(function(e){return e.done?e.value:a.next()})},defineIteratorMethods(x),x[s]="Generator",x[i]=function(){return this},x.toString=function(){return"[object Generator]"},f.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function next(){for(;t.length;){var r=t.pop();if(r in e)return next.value=r,next.done=!1,next}return next.done=!0,next}},f.values=values,Context.prototype={constructor:Context,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(resetTryEntry),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function handle(n,a){return i.type="throw",i.arg=e,t.next=n,a&&(t.method="next",t.arg=r),!!a}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],i=o.completion;if("root"===o.tryLoc)return handle("end");if(o.tryLoc<=this.prev){var u=a.call(o,"catchLoc"),s=a.call(o,"finallyLoc");if(u&&s){if(this.prev<o.catchLoc)return handle(o.catchLoc,!0);if(this.prev<o.finallyLoc)return handle(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return handle(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return handle(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;resetTryEntry(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:values(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),y}}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,o=Object.create(a.prototype),i=new Context(n||[]);return o._invoke=function makeInvokeMethod(e,t,r){var n=l;return function invoke(a,o){if(n===d)throw new Error("Generator is already running");if(n===p){if("throw"===a)throw o;return doneResult()}for(r.method=a,r.arg=o;;){var i=r.delegate;if(i){var u=maybeInvokeDelegate(i,r);if(u){if(u===y)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=d;var s=tryCatch(e,t,r);if("normal"===s.type){if(n=r.done?p:h,s.arg===y)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n=p,r.method="throw",r.arg=s.arg)}}}(e,r,i),o}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}function defineIteratorMethods(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function AsyncIterator(e){var t;this._invoke=function enqueue(r,n){function callInvokeWithMethodAndArg(){return new Promise(function(t,o){!function invoke(t,r,n,o){var i=tryCatch(e[t],e,r);if("throw"!==i.type){var u=i.arg,s=u.value;return s&&"object"==typeof s&&a.call(s,"__await")?Promise.resolve(s.__await).then(function(e){invoke("next",e,n,o)},function(e){invoke("throw",e,n,o)}):Promise.resolve(s).then(function(e){u.value=e,n(u)},function(e){return invoke("throw",e,n,o)})}o(i.arg)}(r,n,t,o)})}return t=t?t.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(e,t){var n=e.iterator[t.method];if(n===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=r,maybeInvokeDelegate(e,t),"throw"===t.method))return y;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return y}var a=tryCatch(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,y;var o=a.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,y):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,y)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function next(){for(;++n<e.length;)if(a.call(e,n))return next.value=e[n],next.done=!1,next;return next.value=r,next.done=!0,next};return o.next=o}}return{next:doneResult}}function doneResult(){return{value:r,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t,r){"use strict";var n=r(14);function readTile(e,t,r){if(3===e){var a=new n(r,r.readVarint()+r.pos);a.length&&(t[a.name]=a)}}e.exports=function VectorTile(e,t){this.layers=e.readFields(readTile,{},t)}},function(e,t,r){"use strict";function Point(e,t){this.x=e,this.y=t}e.exports=Point,Point.prototype={clone:function(){return new Point(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,r=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=t*this.x-r*this.y,a=r*this.x+t*this.y;return this.x=n,this.y=a,this},_rotateAround:function(e,t){var r=Math.cos(e),n=Math.sin(e),a=t.x+r*(this.x-t.x)-n*(this.y-t.y),o=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=a,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Point.convert=function(e){return e instanceof Point?e:Array.isArray(e)?new Point(e[0],e[1]):e}},function(e,t){t.read=function(e,t,r,n,a){var o,i,u=8*a-n-1,s=(1<<u)-1,c=s>>1,f=-7,l=r?a-1:0,h=r?-1:1,d=e[t+l];for(l+=h,o=d&(1<<-f)-1,d>>=-f,f+=u;f>0;o=256*o+e[t+l],l+=h,f-=8);for(i=o&(1<<-f)-1,o>>=-f,f+=n;f>0;i=256*i+e[t+l],l+=h,f-=8);if(0===o)o=1-c;else{if(o===s)return i?NaN:1/0*(d?-1:1);i+=Math.pow(2,n),o-=c}return(d?-1:1)*i*Math.pow(2,o-n)},t.write=function(e,t,r,n,a,o){var i,u,s,c=8*o-a-1,f=(1<<c)-1,l=f>>1,h=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,p=n?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(u=isNaN(t)?1:0,i=f):(i=Math.floor(Math.log(t)/Math.LN2),t*(s=Math.pow(2,-i))<1&&(i--,s*=2),(t+=i+l>=1?h/s:h*Math.pow(2,1-l))*s>=2&&(i++,s/=2),i+l>=f?(u=0,i=f):i+l>=1?(u=(t*s-1)*Math.pow(2,a),i+=l):(u=t*Math.pow(2,l-1)*Math.pow(2,a),i=0));a>=8;e[r+d]=255&u,d+=p,u/=256,a-=8);for(i=i<<a|u,c+=a;c>0;e[r+d]=255&i,d+=p,i/=256,c-=8);e[r+d-p]|=128*y}},function(e,t){e.exports=function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){e.exports=function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}},function(e,t,r){var n=r(13);function _construct(t,r,a){return!function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?e.exports=_construct=function _construct(e,t,r){var a=[null];a.push.apply(a,t);var o=new(Function.bind.apply(e,a));return r&&n(o,r.prototype),o}:e.exports=_construct=Reflect.construct,_construct.apply(null,arguments)}e.exports=_construct},function(e,t,r){var n=r(1);e.exports=function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=n(e)););return e}},function(e,t){e.exports=function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}},function(e,t){e.exports=function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"create",function(){return create}),r.d(n,"clone",function(){return clone}),r.d(n,"copy",function(){return copy}),r.d(n,"fromValues",function(){return fromValues}),r.d(n,"set",function(){return set}),r.d(n,"identity",function(){return identity}),r.d(n,"transpose",function(){return transpose}),r.d(n,"invert",function(){return invert}),r.d(n,"adjoint",function(){return adjoint}),r.d(n,"determinant",function(){return determinant}),r.d(n,"multiply",function(){return multiply}),r.d(n,"translate",function(){return translate}),r.d(n,"scale",function(){return mat4_scale}),r.d(n,"rotate",function(){return rotate}),r.d(n,"rotateX",function(){return rotateX}),r.d(n,"rotateY",function(){return rotateY}),r.d(n,"rotateZ",function(){return rotateZ}),r.d(n,"fromTranslation",function(){return fromTranslation}),r.d(n,"fromScaling",function(){return fromScaling}),r.d(n,"fromRotation",function(){return fromRotation}),r.d(n,"fromXRotation",function(){return fromXRotation}),r.d(n,"fromYRotation",function(){return fromYRotation}),r.d(n,"fromZRotation",function(){return fromZRotation}),r.d(n,"fromRotationTranslation",function(){return fromRotationTranslation}),r.d(n,"fromQuat2",function(){return fromQuat2}),r.d(n,"getTranslation",function(){return getTranslation}),r.d(n,"getScaling",function(){return getScaling}),r.d(n,"getRotation",function(){return getRotation}),r.d(n,"fromRotationTranslationScale",function(){return fromRotationTranslationScale}),r.d(n,"fromRotationTranslationScaleOrigin",function(){return fromRotationTranslationScaleOrigin}),r.d(n,"fromQuat",function(){return fromQuat}),r.d(n,"frustum",function(){return frustum}),r.d(n,"perspective",function(){return perspective}),r.d(n,"perspectiveFromFieldOfView",function(){return perspectiveFromFieldOfView}),r.d(n,"ortho",function(){return ortho}),r.d(n,"lookAt",function(){return lookAt}),r.d(n,"targetTo",function(){return targetTo}),r.d(n,"str",function(){return str}),r.d(n,"frob",function(){return frob}),r.d(n,"add",function(){return add}),r.d(n,"subtract",function(){return subtract}),r.d(n,"multiplyScalar",function(){return multiplyScalar}),r.d(n,"multiplyScalarAndAdd",function(){return multiplyScalarAndAdd}),r.d(n,"exactEquals",function(){return exactEquals}),r.d(n,"equals",function(){return mat4_equals}),r.d(n,"mul",function(){return b}),r.d(n,"sub",function(){return M});var a={};r.r(a),r.d(a,"create",function(){return vec4_create}),r.d(a,"clone",function(){return vec4_clone}),r.d(a,"fromValues",function(){return vec4_fromValues}),r.d(a,"copy",function(){return vec4_copy}),r.d(a,"set",function(){return vec4_set}),r.d(a,"add",function(){return vec4_add}),r.d(a,"subtract",function(){return vec4_subtract}),r.d(a,"multiply",function(){return vec4_multiply}),r.d(a,"divide",function(){return divide}),r.d(a,"ceil",function(){return ceil}),r.d(a,"floor",function(){return floor}),r.d(a,"min",function(){return vec4_min}),r.d(a,"max",function(){return vec4_max}),r.d(a,"round",function(){return round}),r.d(a,"scale",function(){return vec4_scale}),r.d(a,"scaleAndAdd",function(){return scaleAndAdd}),r.d(a,"distance",function(){return distance}),r.d(a,"squaredDistance",function(){return squaredDistance}),r.d(a,"length",function(){return vec4_length}),r.d(a,"squaredLength",function(){return squaredLength}),r.d(a,"negate",function(){return negate}),r.d(a,"inverse",function(){return inverse}),r.d(a,"normalize",function(){return normalize}),r.d(a,"dot",function(){return dot}),r.d(a,"lerp",function(){return lerp}),r.d(a,"random",function(){return random}),r.d(a,"transformMat4",function(){return transformMat4}),r.d(a,"transformQuat",function(){return transformQuat}),r.d(a,"str",function(){return vec4_str}),r.d(a,"exactEquals",function(){return vec4_exactEquals}),r.d(a,"equals",function(){return vec4_equals}),r.d(a,"sub",function(){return T}),r.d(a,"mul",function(){return P}),r.d(a,"div",function(){return k}),r.d(a,"dist",function(){return I}),r.d(a,"sqrDist",function(){return F}),r.d(a,"len",function(){return N}),r.d(a,"sqrLen",function(){return C}),r.d(a,"forEach",function(){return E});var o=r(5),i=r.n(o),u=r(6),s=r.n(u),c=r(7),f=r.n(c),l=r(0),h=r.n(l),d=r(2),p=r.n(d),y=r(11),v=r(12);function getRsysFromTile(e,t,r){return{center:{x:(e+.5)/Math.pow(2,r)*2-1,y:2*(1-(t+.5)/Math.pow(2,r))-1},scale:1/Math.pow(2,r)}}var m=r(8),g=r.n(m),x=1e-6,_="undefined"!=typeof Float32Array?Float32Array:Array,w=Math.random;Math.PI;function create(){var e=new _(16);return _!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function clone(e){var t=new _(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function copy(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function fromValues(e,t,r,n,a,o,i,u,s,c,f,l,h,d,p,y){var v=new _(16);return v[0]=e,v[1]=t,v[2]=r,v[3]=n,v[4]=a,v[5]=o,v[6]=i,v[7]=u,v[8]=s,v[9]=c,v[10]=f,v[11]=l,v[12]=h,v[13]=d,v[14]=p,v[15]=y,v}function set(e,t,r,n,a,o,i,u,s,c,f,l,h,d,p,y,v){return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e[4]=o,e[5]=i,e[6]=u,e[7]=s,e[8]=c,e[9]=f,e[10]=l,e[11]=h,e[12]=d,e[13]=p,e[14]=y,e[15]=v,e}function identity(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function transpose(e,t){if(e===t){var r=t[1],n=t[2],a=t[3],o=t[6],i=t[7],u=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=o,e[11]=t[14],e[12]=a,e[13]=i,e[14]=u}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function invert(e,t){var r=t[0],n=t[1],a=t[2],o=t[3],i=t[4],u=t[5],s=t[6],c=t[7],f=t[8],l=t[9],h=t[10],d=t[11],p=t[12],y=t[13],v=t[14],m=t[15],g=r*u-n*i,x=r*s-a*i,_=r*c-o*i,w=n*s-a*u,b=n*c-o*u,M=a*c-o*s,T=f*y-l*p,P=f*v-h*p,k=f*m-d*p,I=l*v-h*y,F=l*m-d*y,N=h*m-d*v,C=g*N-x*F+_*I+w*k-b*P+M*T;return C?(C=1/C,e[0]=(u*N-s*F+c*I)*C,e[1]=(a*F-n*N-o*I)*C,e[2]=(y*M-v*b+m*w)*C,e[3]=(h*b-l*M-d*w)*C,e[4]=(s*k-i*N-c*P)*C,e[5]=(r*N-a*k+o*P)*C,e[6]=(v*_-p*M-m*x)*C,e[7]=(f*M-h*_+d*x)*C,e[8]=(i*F-u*k+c*T)*C,e[9]=(n*k-r*F-o*T)*C,e[10]=(p*b-y*_+m*g)*C,e[11]=(l*_-f*b-d*g)*C,e[12]=(u*P-i*I-s*T)*C,e[13]=(r*I-n*P+a*T)*C,e[14]=(y*x-p*w-v*g)*C,e[15]=(f*w-l*x+h*g)*C,e):null}function adjoint(e,t){var r=t[0],n=t[1],a=t[2],o=t[3],i=t[4],u=t[5],s=t[6],c=t[7],f=t[8],l=t[9],h=t[10],d=t[11],p=t[12],y=t[13],v=t[14],m=t[15];return e[0]=u*(h*m-d*v)-l*(s*m-c*v)+y*(s*d-c*h),e[1]=-(n*(h*m-d*v)-l*(a*m-o*v)+y*(a*d-o*h)),e[2]=n*(s*m-c*v)-u*(a*m-o*v)+y*(a*c-o*s),e[3]=-(n*(s*d-c*h)-u*(a*d-o*h)+l*(a*c-o*s)),e[4]=-(i*(h*m-d*v)-f*(s*m-c*v)+p*(s*d-c*h)),e[5]=r*(h*m-d*v)-f*(a*m-o*v)+p*(a*d-o*h),e[6]=-(r*(s*m-c*v)-i*(a*m-o*v)+p*(a*c-o*s)),e[7]=r*(s*d-c*h)-i*(a*d-o*h)+f*(a*c-o*s),e[8]=i*(l*m-d*y)-f*(u*m-c*y)+p*(u*d-c*l),e[9]=-(r*(l*m-d*y)-f*(n*m-o*y)+p*(n*d-o*l)),e[10]=r*(u*m-c*y)-i*(n*m-o*y)+p*(n*c-o*u),e[11]=-(r*(u*d-c*l)-i*(n*d-o*l)+f*(n*c-o*u)),e[12]=-(i*(l*v-h*y)-f*(u*v-s*y)+p*(u*h-s*l)),e[13]=r*(l*v-h*y)-f*(n*v-a*y)+p*(n*h-a*l),e[14]=-(r*(u*v-s*y)-i*(n*v-a*y)+p*(n*s-a*u)),e[15]=r*(u*h-s*l)-i*(n*h-a*l)+f*(n*s-a*u),e}function determinant(e){var t=e[0],r=e[1],n=e[2],a=e[3],o=e[4],i=e[5],u=e[6],s=e[7],c=e[8],f=e[9],l=e[10],h=e[11],d=e[12],p=e[13],y=e[14],v=e[15];return(t*i-r*o)*(l*v-h*y)-(t*u-n*o)*(f*v-h*p)+(t*s-a*o)*(f*y-l*p)+(r*u-n*i)*(c*v-h*d)-(r*s-a*i)*(c*y-l*d)+(n*s-a*u)*(c*p-f*d)}function multiply(e,t,r){var n=t[0],a=t[1],o=t[2],i=t[3],u=t[4],s=t[5],c=t[6],f=t[7],l=t[8],h=t[9],d=t[10],p=t[11],y=t[12],v=t[13],m=t[14],g=t[15],x=r[0],_=r[1],w=r[2],b=r[3];return e[0]=x*n+_*u+w*l+b*y,e[1]=x*a+_*s+w*h+b*v,e[2]=x*o+_*c+w*d+b*m,e[3]=x*i+_*f+w*p+b*g,x=r[4],_=r[5],w=r[6],b=r[7],e[4]=x*n+_*u+w*l+b*y,e[5]=x*a+_*s+w*h+b*v,e[6]=x*o+_*c+w*d+b*m,e[7]=x*i+_*f+w*p+b*g,x=r[8],_=r[9],w=r[10],b=r[11],e[8]=x*n+_*u+w*l+b*y,e[9]=x*a+_*s+w*h+b*v,e[10]=x*o+_*c+w*d+b*m,e[11]=x*i+_*f+w*p+b*g,x=r[12],_=r[13],w=r[14],b=r[15],e[12]=x*n+_*u+w*l+b*y,e[13]=x*a+_*s+w*h+b*v,e[14]=x*o+_*c+w*d+b*m,e[15]=x*i+_*f+w*p+b*g,e}function translate(e,t,r){var n=r[0],a=r[1],o=r[2],i=void 0,u=void 0,s=void 0,c=void 0,f=void 0,l=void 0,h=void 0,d=void 0,p=void 0,y=void 0,v=void 0,m=void 0;return t===e?(e[12]=t[0]*n+t[4]*a+t[8]*o+t[12],e[13]=t[1]*n+t[5]*a+t[9]*o+t[13],e[14]=t[2]*n+t[6]*a+t[10]*o+t[14],e[15]=t[3]*n+t[7]*a+t[11]*o+t[15]):(i=t[0],u=t[1],s=t[2],c=t[3],f=t[4],l=t[5],h=t[6],d=t[7],p=t[8],y=t[9],v=t[10],m=t[11],e[0]=i,e[1]=u,e[2]=s,e[3]=c,e[4]=f,e[5]=l,e[6]=h,e[7]=d,e[8]=p,e[9]=y,e[10]=v,e[11]=m,e[12]=i*n+f*a+p*o+t[12],e[13]=u*n+l*a+y*o+t[13],e[14]=s*n+h*a+v*o+t[14],e[15]=c*n+d*a+m*o+t[15]),e}function mat4_scale(e,t,r){var n=r[0],a=r[1],o=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function rotate(e,t,r,n){var a,o,i,u,s,c,f,l,h,d,p,y,v,m,g,_,w,b,M,T,P,k,I,F,N=n[0],C=n[1],E=n[2],V=Math.sqrt(N*N+C*C+E*E);return V<x?null:(N*=V=1/V,C*=V,E*=V,a=Math.sin(r),i=1-(o=Math.cos(r)),u=t[0],s=t[1],c=t[2],f=t[3],l=t[4],h=t[5],d=t[6],p=t[7],y=t[8],v=t[9],m=t[10],g=t[11],_=N*N*i+o,w=C*N*i+E*a,b=E*N*i-C*a,M=N*C*i-E*a,T=C*C*i+o,P=E*C*i+N*a,k=N*E*i+C*a,I=C*E*i-N*a,F=E*E*i+o,e[0]=u*_+l*w+y*b,e[1]=s*_+h*w+v*b,e[2]=c*_+d*w+m*b,e[3]=f*_+p*w+g*b,e[4]=u*M+l*T+y*P,e[5]=s*M+h*T+v*P,e[6]=c*M+d*T+m*P,e[7]=f*M+p*T+g*P,e[8]=u*k+l*I+y*F,e[9]=s*k+h*I+v*F,e[10]=c*k+d*I+m*F,e[11]=f*k+p*I+g*F,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function rotateX(e,t,r){var n=Math.sin(r),a=Math.cos(r),o=t[4],i=t[5],u=t[6],s=t[7],c=t[8],f=t[9],l=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*a+c*n,e[5]=i*a+f*n,e[6]=u*a+l*n,e[7]=s*a+h*n,e[8]=c*a-o*n,e[9]=f*a-i*n,e[10]=l*a-u*n,e[11]=h*a-s*n,e}function rotateY(e,t,r){var n=Math.sin(r),a=Math.cos(r),o=t[0],i=t[1],u=t[2],s=t[3],c=t[8],f=t[9],l=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*a-c*n,e[1]=i*a-f*n,e[2]=u*a-l*n,e[3]=s*a-h*n,e[8]=o*n+c*a,e[9]=i*n+f*a,e[10]=u*n+l*a,e[11]=s*n+h*a,e}function rotateZ(e,t,r){var n=Math.sin(r),a=Math.cos(r),o=t[0],i=t[1],u=t[2],s=t[3],c=t[4],f=t[5],l=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*a+c*n,e[1]=i*a+f*n,e[2]=u*a+l*n,e[3]=s*a+h*n,e[4]=c*a-o*n,e[5]=f*a-i*n,e[6]=l*a-u*n,e[7]=h*a-s*n,e}function fromTranslation(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function fromScaling(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromRotation(e,t,r){var n,a,o,i=r[0],u=r[1],s=r[2],c=Math.sqrt(i*i+u*u+s*s);return c<x?null:(i*=c=1/c,u*=c,s*=c,n=Math.sin(t),o=1-(a=Math.cos(t)),e[0]=i*i*o+a,e[1]=u*i*o+s*n,e[2]=s*i*o-u*n,e[3]=0,e[4]=i*u*o-s*n,e[5]=u*u*o+a,e[6]=s*u*o+i*n,e[7]=0,e[8]=i*s*o+u*n,e[9]=u*s*o-i*n,e[10]=s*s*o+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function fromXRotation(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromYRotation(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromZRotation(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromRotationTranslation(e,t,r){var n=t[0],a=t[1],o=t[2],i=t[3],u=n+n,s=a+a,c=o+o,f=n*u,l=n*s,h=n*c,d=a*s,p=a*c,y=o*c,v=i*u,m=i*s,g=i*c;return e[0]=1-(d+y),e[1]=l+g,e[2]=h-m,e[3]=0,e[4]=l-g,e[5]=1-(f+y),e[6]=p+v,e[7]=0,e[8]=h+m,e[9]=p-v,e[10]=1-(f+d),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function fromQuat2(e,t){var r=new _(3),n=-t[0],a=-t[1],o=-t[2],i=t[3],u=t[4],s=t[5],c=t[6],f=t[7],l=n*n+a*a+o*o+i*i;return l>0?(r[0]=2*(u*i+f*n+s*o-c*a)/l,r[1]=2*(s*i+f*a+c*n-u*o)/l,r[2]=2*(c*i+f*o+u*a-s*n)/l):(r[0]=2*(u*i+f*n+s*o-c*a),r[1]=2*(s*i+f*a+c*n-u*o),r[2]=2*(c*i+f*o+u*a-s*n)),fromRotationTranslation(e,t,r),e}function getTranslation(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function getScaling(e,t){var r=t[0],n=t[1],a=t[2],o=t[4],i=t[5],u=t[6],s=t[8],c=t[9],f=t[10];return e[0]=Math.sqrt(r*r+n*n+a*a),e[1]=Math.sqrt(o*o+i*i+u*u),e[2]=Math.sqrt(s*s+c*c+f*f),e}function getRotation(e,t){var r=t[0]+t[5]+t[10],n=0;return r>0?(n=2*Math.sqrt(r+1),e[3]=.25*n,e[0]=(t[6]-t[9])/n,e[1]=(t[8]-t[2])/n,e[2]=(t[1]-t[4])/n):t[0]>t[5]&&t[0]>t[10]?(n=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/n,e[0]=.25*n,e[1]=(t[1]+t[4])/n,e[2]=(t[8]+t[2])/n):t[5]>t[10]?(n=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/n,e[0]=(t[1]+t[4])/n,e[1]=.25*n,e[2]=(t[6]+t[9])/n):(n=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/n,e[0]=(t[8]+t[2])/n,e[1]=(t[6]+t[9])/n,e[2]=.25*n),e}function fromRotationTranslationScale(e,t,r,n){var a=t[0],o=t[1],i=t[2],u=t[3],s=a+a,c=o+o,f=i+i,l=a*s,h=a*c,d=a*f,p=o*c,y=o*f,v=i*f,m=u*s,g=u*c,x=u*f,_=n[0],w=n[1],b=n[2];return e[0]=(1-(p+v))*_,e[1]=(h+x)*_,e[2]=(d-g)*_,e[3]=0,e[4]=(h-x)*w,e[5]=(1-(l+v))*w,e[6]=(y+m)*w,e[7]=0,e[8]=(d+g)*b,e[9]=(y-m)*b,e[10]=(1-(l+p))*b,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function fromRotationTranslationScaleOrigin(e,t,r,n,a){var o=t[0],i=t[1],u=t[2],s=t[3],c=o+o,f=i+i,l=u+u,h=o*c,d=o*f,p=o*l,y=i*f,v=i*l,m=u*l,g=s*c,x=s*f,_=s*l,w=n[0],b=n[1],M=n[2],T=a[0],P=a[1],k=a[2],I=(1-(y+m))*w,F=(d+_)*w,N=(p-x)*w,C=(d-_)*b,E=(1-(h+m))*b,V=(v+g)*b,S=(p+x)*M,A=(v-g)*M,D=(1-(h+y))*M;return e[0]=I,e[1]=F,e[2]=N,e[3]=0,e[4]=C,e[5]=E,e[6]=V,e[7]=0,e[8]=S,e[9]=A,e[10]=D,e[11]=0,e[12]=r[0]+T-(I*T+C*P+S*k),e[13]=r[1]+P-(F*T+E*P+A*k),e[14]=r[2]+k-(N*T+V*P+D*k),e[15]=1,e}function fromQuat(e,t){var r=t[0],n=t[1],a=t[2],o=t[3],i=r+r,u=n+n,s=a+a,c=r*i,f=n*i,l=n*u,h=a*i,d=a*u,p=a*s,y=o*i,v=o*u,m=o*s;return e[0]=1-l-p,e[1]=f+m,e[2]=h-v,e[3]=0,e[4]=f-m,e[5]=1-c-p,e[6]=d+y,e[7]=0,e[8]=h+v,e[9]=d-y,e[10]=1-c-l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function frustum(e,t,r,n,a,o,i){var u=1/(r-t),s=1/(a-n),c=1/(o-i);return e[0]=2*o*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*s,e[6]=0,e[7]=0,e[8]=(r+t)*u,e[9]=(a+n)*s,e[10]=(i+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=i*o*2*c,e[15]=0,e}function perspective(e,t,r,n,a){var o=1/Math.tan(t/2),i=void 0;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(i=1/(n-a),e[10]=(a+n)*i,e[14]=2*a*n*i):(e[10]=-1,e[14]=-2*n),e}function perspectiveFromFieldOfView(e,t,r,n){var a=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),i=Math.tan(t.leftDegrees*Math.PI/180),u=Math.tan(t.rightDegrees*Math.PI/180),s=2/(i+u),c=2/(a+o);return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(i-u)*s*.5,e[9]=(a-o)*c*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function ortho(e,t,r,n,a,o,i){var u=1/(t-r),s=1/(n-a),c=1/(o-i);return e[0]=-2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*u,e[13]=(a+n)*s,e[14]=(i+o)*c,e[15]=1,e}function lookAt(e,t,r,n){var a=void 0,o=void 0,i=void 0,u=void 0,s=void 0,c=void 0,f=void 0,l=void 0,h=void 0,d=void 0,p=t[0],y=t[1],v=t[2],m=n[0],g=n[1],_=n[2],w=r[0],b=r[1],M=r[2];return Math.abs(p-w)<x&&Math.abs(y-b)<x&&Math.abs(v-M)<x?identity(e):(f=p-w,l=y-b,h=v-M,a=g*(h*=d=1/Math.sqrt(f*f+l*l+h*h))-_*(l*=d),o=_*(f*=d)-m*h,i=m*l-g*f,(d=Math.sqrt(a*a+o*o+i*i))?(a*=d=1/d,o*=d,i*=d):(a=0,o=0,i=0),u=l*i-h*o,s=h*a-f*i,c=f*o-l*a,(d=Math.sqrt(u*u+s*s+c*c))?(u*=d=1/d,s*=d,c*=d):(u=0,s=0,c=0),e[0]=a,e[1]=u,e[2]=f,e[3]=0,e[4]=o,e[5]=s,e[6]=l,e[7]=0,e[8]=i,e[9]=c,e[10]=h,e[11]=0,e[12]=-(a*p+o*y+i*v),e[13]=-(u*p+s*y+c*v),e[14]=-(f*p+l*y+h*v),e[15]=1,e)}function targetTo(e,t,r,n){var a=t[0],o=t[1],i=t[2],u=n[0],s=n[1],c=n[2],f=a-r[0],l=o-r[1],h=i-r[2],d=f*f+l*l+h*h;d>0&&(f*=d=1/Math.sqrt(d),l*=d,h*=d);var p=s*h-c*l,y=c*f-u*h,v=u*l-s*f;return(d=p*p+y*y+v*v)>0&&(p*=d=1/Math.sqrt(d),y*=d,v*=d),e[0]=p,e[1]=y,e[2]=v,e[3]=0,e[4]=l*v-h*y,e[5]=h*p-f*v,e[6]=f*y-l*p,e[7]=0,e[8]=f,e[9]=l,e[10]=h,e[11]=0,e[12]=a,e[13]=o,e[14]=i,e[15]=1,e}function str(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function frob(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))}function add(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function subtract(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function multiplyScalar(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function multiplyScalarAndAdd(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function exactEquals(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function mat4_equals(e,t){var r=e[0],n=e[1],a=e[2],o=e[3],i=e[4],u=e[5],s=e[6],c=e[7],f=e[8],l=e[9],h=e[10],d=e[11],p=e[12],y=e[13],v=e[14],m=e[15],g=t[0],_=t[1],w=t[2],b=t[3],M=t[4],T=t[5],P=t[6],k=t[7],I=t[8],F=t[9],N=t[10],C=t[11],E=t[12],V=t[13],S=t[14],A=t[15];return Math.abs(r-g)<=x*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(n-_)<=x*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(a-w)<=x*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(o-b)<=x*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(i-M)<=x*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(u-T)<=x*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(s-P)<=x*Math.max(1,Math.abs(s),Math.abs(P))&&Math.abs(c-k)<=x*Math.max(1,Math.abs(c),Math.abs(k))&&Math.abs(f-I)<=x*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(l-F)<=x*Math.max(1,Math.abs(l),Math.abs(F))&&Math.abs(h-N)<=x*Math.max(1,Math.abs(h),Math.abs(N))&&Math.abs(d-C)<=x*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(p-E)<=x*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(y-V)<=x*Math.max(1,Math.abs(y),Math.abs(V))&&Math.abs(v-S)<=x*Math.max(1,Math.abs(v),Math.abs(S))&&Math.abs(m-A)<=x*Math.max(1,Math.abs(m),Math.abs(A))}var b=multiply,M=subtract;function vec4_create(){var e=new _(4);return _!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function vec4_clone(e){var t=new _(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function vec4_fromValues(e,t,r,n){var a=new _(4);return a[0]=e,a[1]=t,a[2]=r,a[3]=n,a}function vec4_copy(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function vec4_set(e,t,r,n,a){return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e}function vec4_add(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function vec4_subtract(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function vec4_multiply(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function divide(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function ceil(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function floor(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function vec4_min(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function vec4_max(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function round(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function vec4_scale(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function scaleAndAdd(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e}function distance(e,t){var r=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2],o=t[3]-e[3];return Math.sqrt(r*r+n*n+a*a+o*o)}function squaredDistance(e,t){var r=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2],o=t[3]-e[3];return r*r+n*n+a*a+o*o}function vec4_length(e){var t=e[0],r=e[1],n=e[2],a=e[3];return Math.sqrt(t*t+r*r+n*n+a*a)}function squaredLength(e){var t=e[0],r=e[1],n=e[2],a=e[3];return t*t+r*r+n*n+a*a}function negate(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function inverse(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function normalize(e,t){var r=t[0],n=t[1],a=t[2],o=t[3],i=r*r+n*n+a*a+o*o;return i>0&&(i=1/Math.sqrt(i),e[0]=r*i,e[1]=n*i,e[2]=a*i,e[3]=o*i),e}function dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function lerp(e,t,r,n){var a=t[0],o=t[1],i=t[2],u=t[3];return e[0]=a+n*(r[0]-a),e[1]=o+n*(r[1]-o),e[2]=i+n*(r[2]-i),e[3]=u+n*(r[3]-u),e}function random(e,t){var r,n,a,o,i,u;t=t||1;do{i=(r=2*w()-1)*r+(n=2*w()-1)*n}while(i>=1);do{u=(a=2*w()-1)*a+(o=2*w()-1)*o}while(u>=1);var s=Math.sqrt((1-i)/u);return e[0]=t*r,e[1]=t*n,e[2]=t*a*s,e[3]=t*o*s,e}function transformMat4(e,t,r){var n=t[0],a=t[1],o=t[2],i=t[3];return e[0]=r[0]*n+r[4]*a+r[8]*o+r[12]*i,e[1]=r[1]*n+r[5]*a+r[9]*o+r[13]*i,e[2]=r[2]*n+r[6]*a+r[10]*o+r[14]*i,e[3]=r[3]*n+r[7]*a+r[11]*o+r[15]*i,e}function transformQuat(e,t,r){var n=t[0],a=t[1],o=t[2],i=r[0],u=r[1],s=r[2],c=r[3],f=c*n+u*o-s*a,l=c*a+s*n-i*o,h=c*o+i*a-u*n,d=-i*n-u*a-s*o;return e[0]=f*c+d*-i+l*-s-h*-u,e[1]=l*c+d*-u+h*-i-f*-s,e[2]=h*c+d*-s+f*-u-l*-i,e[3]=t[3],e}function vec4_str(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function vec4_exactEquals(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function vec4_equals(e,t){var r=e[0],n=e[1],a=e[2],o=e[3],i=t[0],u=t[1],s=t[2],c=t[3];return Math.abs(r-i)<=x*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-u)<=x*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(a-s)<=x*Math.max(1,Math.abs(a),Math.abs(s))&&Math.abs(o-c)<=x*Math.max(1,Math.abs(o),Math.abs(c))}var T=vec4_subtract,P=vec4_multiply,k=divide,I=distance,F=squaredDistance,N=vec4_length,C=squaredLength,E=function(){var e=vec4_create();return function(t,r,n,a,o,i){var u=void 0,s=void 0;for(r||(r=4),n||(n=0),s=a?Math.min(a*r+n,t.length):t.length,u=n;u<s;u+=r)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],e[3]=t[u+3],o(e,e,i),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];return t}}(),V=function average(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length},S=r(3),A=r.n(S),D=r(1),O=r.n(D),L=r(4),R=r.n(L),B=r(16),q=function(e){function CartoError(e){var t;if(h()(this,CartoError),!e)throw Error("Invalid CartoError, a message is mandatory");if(!e.message)throw Error("Invalid CartoError, a message is mandatory");if(!e.type)throw Error("Invalid CartoError, a type is mandatory");return(t=A()(this,O()(CartoError).call(this,"".concat(e.type," ").concat(e.message)))).name="CartoError",t.type=e.type,t.originalError=e,t}return R()(CartoError,e),CartoError}(r.n(B)()(Error)),W=function(e){function CartoValidationError(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:G.DEFAULT;return h()(this,CartoValidationError),(t=A()(this,O()(CartoValidationError).call(this,{message:e,type:r}))).name="CartoValidationError",t}return R()(CartoValidationError,e),CartoValidationError}(q),G={DEFAULT:"[Error]",MISSING_REQUIRED:"[Missing required property]",INCORRECT_TYPE:"[Property with an incorrect type]",INCORRECT_VALUE:"[Incorrect value]",TOO_MANY_ARGS:"[Too many arguments]",NOT_ENOUGH_ARGS:"[Not enough arguments]",WRONG_NUMBER_ARGS:"[Wrong number of arguments]"},j={UNKNOWN:"unknown",POINT:"point",LINE:"line",POLYGON:"polygon"};function geometry_sub(e,t){var r=i()(e,2),n=r[0],a=r[1],o=i()(t,2);return[n-o[0],a-o[1]]}function geometry_dot(e,t){var r=i()(e,2),n=r[0],a=r[1],o=i()(t,2);return n*o[0]+a*o[1]}function perpendicular(e){var t=i()(e,2),r=t[0];return[-t[1],r]}function getLineNormal(e,t){var r=function geometry_normalize(e,t){var r=Math.hypot(e,t);return[e/r,t/r]}(e[0]-t[0],e[1]-t[1]);return[-r[1],r[0]]}function getJoinNormal(e,t){var r=[e[1],-e[0]],n=[-t[1],t[0]],a=n[0]*r[1]-n[1]*r[0],o=n[0]*r[0]+n[1]*r[1],i=Math.abs(a);return{turnLeft:a>0,joinNormal:!(i<.866&&o>.5)&&neg([(r[0]+n[0])/i,(r[1]+n[1])/i])}}function neg(e){return[-e[0],-e[1]]}function halfPlaneSign(e,t,r){return(e.x-r.x)*(t.y-r.y)-(t.x-r.x)*(e.y-r.y)}function equalPoints(e,t){return e.x===t.x&&e.y===t.y}function computeCentroids(e,t){switch(t){case j.POINT:return function _computeCentroidsForPoints(e){for(var t=[],r=0;r<e.vertices.length/6;r++){var n=6*r,a=n+6,o=e.vertices.slice(n,a),u=i()(o,6),s=u[4],c=u[5];t.push({x:s,y:c})}return t}(e);case j.LINE:case j.POLYGON:return function _computeCentroidsForLinesOrPolygons(e,t){var r=[],n=0;return e.breakpoints.forEach(function(a){var o=e.vertices.slice(n,a),u=null;u=t===j.LINE?function _centroidForLines(e){for(var t=[],r=[],n=0;n<e.length/6;n++){var a=6*n,o=a+6,u=e.slice(a,o),s=i()(u,6),c=s[0],f=s[1],l=s[2],h=s[3],d=s[4],p=s[5],y=c===l&&f===h,v=l===d&&h===p;if(!y||!v){var m=[c,f],g=y?[d,p]:[l,h];t.push(m[0]),t.push(g[0]),r.push(m[1]),r.push(g[1])}}return{x:V(t),y:V(r)}}(o):function _centroidForPolygons(e){for(var t=[],r=[],n=[],a=0;a<e.length/6;a++){var o=6*a,u=o+6,s=e.slice(o,u),c=i()(s,6),f=c[0],l=c[1],h=c[2],d=c[3],p=c[4],y=c[5],v=[[f,l],[h,d],[p,y]],m=triangleArea(v);if(m>0){var g=V([f,h,p]),x=V([l,d,y]);t.push(g*m),r.push(x*m),n.push(m)}}var _=_sumArray(n);return{x:_sumArray(t)/_,y:_sumArray(r)/_}}(o),r.push(u),n=a}),r}(e,t);default:throw new W("Invalid type argument, decoded geometry must have a point, line or polygon type.",G.INCORRECT_VALUE)}}function _sumArray(e){return e.reduce(function(e,t){return e+t},0)}function triangleArea(e){var t=i()(e[0],2),r=t[0],n=t[1],a=i()(e[1],2),o=a[0],u=a[1],s=i()(e[2],2),c=s[0],f=s[1];return Math.abs((r-c)*(u-n)-(r-o)*(f-n))/2}function _updateAABBForGeometry(e,t,r){switch(r){case j.LINE:return function _updateAABBLine(e,t){for(var r=e,n=e.length,a=0;a<n;a+=2)t.minx=Math.min(t.minx,r[a+0]),t.miny=Math.min(t.miny,r[a+1]),t.maxx=Math.max(t.maxx,r[a+0]),t.maxy=Math.max(t.maxy,r[a+1]);return t}(e,t);case j.POLYGON:return function _updateAABBPolygon(e,t){for(var r=[e.flat,e.holes[0]||e.flat.length/2],n=r[0],a=r[1],o=0;o<a;o++)t.minx=Math.min(t.minx,n[2*o+0]),t.miny=Math.min(t.miny,n[2*o+1]),t.maxx=Math.max(t.maxx,n[2*o+0]),t.maxy=Math.max(t.maxy,n[2*o+1]);return t}(e,t)}}var z={intersect:function geometry_intersect(e,t,r,n){var a=e,o=r,i=geometry_sub(t,e),u=geometry_sub(n,r),s=perpendicular(i),c=perpendicular(u),f=geometry_dot(geometry_sub(o,a),c)/geometry_dot(i,c),l=geometry_dot(geometry_sub(a,o),s)/geometry_dot(u,s);if(f>=0&&f<=1&&l>=0&&l<=1)return[a[0]+f*i[0],a[1]+f*i[1]]},sub:geometry_sub,dot:geometry_dot,perpendicular:perpendicular,getLineNormal:getLineNormal,getJoinNormal:getJoinNormal,neg:neg,halfPlaneSign:halfPlaneSign,pointInTriangle:function pointInTriangle(e,t,r,n){if(equalPoints(t,r)||equalPoints(r,n)||equalPoints(n,t))return!1;var a=halfPlaneSign(e,t,r)<0,o=halfPlaneSign(e,r,n)<0,i=halfPlaneSign(e,n,t)<0;return a===o&&o===i},equalPoints:equalPoints,pointInCircle:function pointInCircle(e,t,r){var n=e.x-t.x,a=e.y-t.y;return n*n+a*a<=r*r},pointInRectangle:function pointInRectangle(e,t){if(null===t)return!1;var r=e.x.toFixed(2),n=e.y.toFixed(2);return t.minx<=r&&r<=t.maxx&&t.miny<=n&&n<=t.maxy}},Z=function Polygon(){h()(this,Polygon),this.flat=[],this.holes=[],this.clipped=[],this.clippedType=[]};function decodeLines(e,t){var r=[];return e.map(function(e){var n=[];e.map(function(e){n.push([2*e.x/t-1,2*(1-e.y/t)-1])}),r.push.apply(r,g()(function clipLine(e){var t=[],r=[];function clipType(e){for(var t=0,r=0;r<Y;r++)t|=U[r].inside(e)?0:1<<r;return t}function intersect(e,t,r){for(var n=0;n<Y;n++){var a=1<<n;if(r&a){var o=U[n].intersect(e,t);return r=clipType(o)&~a,[o,r]}}}for(var n=e[0],a=clipType(n),o=1;o<e.length;++o){for(var u=e[o],s=clipType(u),c=s,f=u;;){if(!(a|s)){var l,h;if((l=t).push.apply(l,g()(n)),s!==c)(h=t).push.apply(h,g()(u)),o<e.length-1&&(r.push(t),t=[]);else if(o===e.length-1){var d;(d=t).push.apply(d,g()(u))}break}if(a&s)break;if(a){var p=intersect(n,u,a),y=i()(p,2);n=y[0],a=y[1]}else{var v=intersect(n,u,s),m=i()(v,2);u=m[0],s=m[1]}}n=f,a=c}(t=function _removeDuplicatedVerticesOnLine(e){for(var t,r,n=[],a=0;a<e.length;a+=2){var o=e[a],i=e[a+1];o===t&&i===r||(n.push(o,i),t=o,r=i)}return n}(t)).length>0&&r.push(t);return r}(n)))}),r}function decodePolygons(e,t){var r,n=null,a=[];return e.forEach(function(e){var o=function signedPolygonArea(e){for(var t=0,r=0;r<e.length;r++){var n=(r+1)%e.length;t+=e[r].x*e[n].y,t-=e[n].x*e[r].y}return t/2}(e);if(0!==o){void 0===r&&(r=o>0);var i=r?o>0:o<0,u=function _getPreClippedVertices(e,t){return e.map(function(e){var r=e.x,n=e.y;return[r=2*r/t-1,n=2*(1-n/t)-1]})}(e,t);i&&(n&&a.push(n),n=new Z),n=function clipPolygon(e,t,r){for(var n={},a=function _loop(t){for(var r=[],a={},o=function setClippedType(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,o=0;t>=0&&(o=n[t]||0),r>=0&&(o|=1<<r),o&&(a[e]=o)},i=0;i<e.length-1;i++){var u=e[i],s=e[i+1],c=U[t].inside(u),f=U[t].inside(s);if(c&&f)o(r.length,i+1),r.push(s);else if(c){var l=U[t].intersect(u,s);o(r.length,i+1,t),r.push(l)}else if(f){var h=U[t].intersect(u,s);o(r.length,i,t),r.push(h),o(r.length,i+1),r.push(s)}}r.length&&(a[0]&&(a[r.length]=a[0]),r.push(r[0])),e=r,n=a},o=0;o<Y;o++)a(o);e.length>=4&&(r&&t.holes.push(t.flat.length/2),e.forEach(function(e){t.flat.push(e[0],e[1])}),Object.keys(n).forEach(function(e){t.clipped.push(2*Number(e)),t.clippedType.push(n[e])}));return t}(u,n,!i)}}),n&&a.push(n),a}var U=[{inside:function inside(e){return e[0]<=1},intersect:function intersect(e,t){return z.intersect(e,t,[1,-100],[1,100])}},{inside:function inside(e){return e[1]<=1},intersect:function intersect(e,t){return z.intersect(e,t,[-100,1],[100,1])}},{inside:function inside(e){return e[0]>=-1},intersect:function intersect(e,t){return z.intersect(e,t,[-1,-100],[-1,100])}},{inside:function inside(e){return e[1]>=-1},intersect:function intersect(e,t){return z.intersect(e,t,[-100,-1],[100,-1])}}],Y=U.length;var Q=function(e){function CartoRuntimeError(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H.DEFAULT;return h()(this,CartoRuntimeError),(t=A()(this,O()(CartoRuntimeError).call(this,{message:e,type:r}))).name="CartoRuntimeError",t}return R()(CartoRuntimeError,e),CartoRuntimeError}(q),H={DEFAULT:"[Error]",NOT_SUPPORTED:"[Not supported]",WEB_GL:"[WebGL]",MVT:"[MVT]"},$=function(){function BaseCodec(e,t){h()(this,BaseCodec),e&&t&&(this._baseName=e.baseName(t))}return p()(BaseCodec,[{key:"isRange",value:function isRange(){return!1}},{key:"isIdentity",value:function isIdentity(){return!1}},{key:"sourceToInternal",value:function sourceToInternal(e,t){return t}},{key:"internalToExternal",value:function internalToExternal(e,t){return t}},{key:"externalToSource",value:function externalToSource(e,t){return t}},{key:"sourceToExternal",value:function sourceToExternal(e,t){return this.internalToExternal(e,this.sourceToInternal(e,t))}},{key:"externalToInternal",value:function externalToInternal(e,t){return this.sourceToInternal(e,this.externalToSource(e,t))}},{key:"inlineInternalMatch",value:function inlineInternalMatch(e,t){return"".concat(e)}}]),BaseCodec}(),J=function(e){function IdentityCodec(){return h()(this,IdentityCodec),A()(this,O()(IdentityCodec).apply(this,arguments))}return R()(IdentityCodec,e),p()(IdentityCodec,[{key:"isIdentity",value:function isIdentity(){return!0}},{key:"sourceToInternal",value:function sourceToInternal(e,t){return t}},{key:"internalToExternal",value:function internalToExternal(e,t){return t}},{key:"sourceToExternal",value:function sourceToExternal(e,t){return t}},{key:"externalToSource",value:function externalToSource(e,t){return t}},{key:"externalToInternal",value:function externalToInternal(e,t){return t}}]),IdentityCodec}($),X=4096,K="cartodb_id",ee=function(){function Metadata(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{properties:{}},r=t.properties,n=t.featureCount,a=t.sample,o=t.geomType,i=t.isAggregated,u=t.idProperty,s=t.extent;h()(this,Metadata),this.properties=r,this.featureCount=n,this.sample=a,this.geomType=o,this.isAggregated=i,this.idProperty=u||K,this.properties.hasOwnProperty(this.idProperty)||(this.properties[this.idProperty]={type:"number"}),this.categoryToID=new Map,this.IDToCategory=new Map,this.numCategories=0,this.extent=s||X,Object.values(r).map(function(t){t.categories=t.categories||[],t.categories.map(function(r){return e.categorizeString(t,r.name,!0)})}),this.propertyKeys=Object.keys(r)}return p()(Metadata,[{key:"setCodecs",value:function setCodecs(){throw new Q('You must call "setCodecs" once you have determined the proper subclass')}},{key:"categorizeString",value:function categorizeString(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===t&&(t=null),this.categoryToID.has(t))return this.categoryToID.get(t);r||null===t||this.properties[e].categories.push({name:t,frequency:Number.NaN});var n=null===t?-(1<<24):this.numCategories;return this.categoryToID.set(t,n),this.IDToCategory.set(n,t),this.numCategories++,n}},{key:"decodedProperties",value:function decodedProperties(e){return[e]}},{key:"baseName",value:function baseName(e){return e}},{key:"sourcePropertyName",value:function sourcePropertyName(e){return e}},{key:"stats",value:function stats(e){return this.properties[e]}},{key:"codec",value:function codec(e){var t=this.baseName(e);return this.properties[t]&&this.properties[t].codec?this.properties[t].codec:new J}}]),Metadata}(),te=r(9),re=r.n(te),ne=r(10),ae=r.n(ne),oe=function(e){function NumberCodec(){return h()(this,NumberCodec),A()(this,O()(NumberCodec).apply(this,arguments))}return R()(NumberCodec,e),p()(NumberCodec,[{key:"sourceToInternal",value:function sourceToInternal(e,t){return(isNaN(t)||null==t)&&(t=-(1<<24)),t}},{key:"internalToExternal",value:function internalToExternal(e,t){return t===-(1<<24)&&(t=null),t}},{key:"externalToInternal",value:function externalToInternal(e,t){return null===t&&(t=-(1<<24)),t}}]),NumberCodec}(J),ie=function(e){function MVTNumberCodec(){return h()(this,MVTNumberCodec),A()(this,O()(MVTNumberCodec).apply(this,arguments))}return R()(MVTNumberCodec,e),p()(MVTNumberCodec,[{key:"sourceToInternal",value:function sourceToInternal(e,t){var r=re()(t);if(null!==t&&"undefined"!==r&&"number"!==r)throw new Q("MVT decoding error. Metadata property '".concat(this._baseName,"' is of type 'number' but the MVT tile contained a feature property of type '").concat(r,"': '").concat(t,"'"),H.MVT);return ae()(O()(MVTNumberCodec.prototype),"sourceToInternal",this).call(this,e,t)}}]),MVTNumberCodec}(oe),ue=function(e){function CategoryCodec(){return h()(this,CategoryCodec),A()(this,O()(CategoryCodec).apply(this,arguments))}return R()(CategoryCodec,e),p()(CategoryCodec,[{key:"sourceToInternal",value:function sourceToInternal(e,t){return e.categorizeString(this._baseName,t)}},{key:"internalToExternal",value:function internalToExternal(e,t){return e.IDToCategory.get(t)}},{key:"sourceToExternal",value:function sourceToExternal(e,t){return t}},{key:"externalToSource",value:function externalToSource(e,t){return t}}]),CategoryCodec}($),se=function(e){function MVTCategoryCodec(){return h()(this,MVTCategoryCodec),A()(this,O()(MVTCategoryCodec).apply(this,arguments))}return R()(MVTCategoryCodec,e),p()(MVTCategoryCodec,[{key:"sourceToInternal",value:function sourceToInternal(e,t){var r=re()(t);if(null!==t&&"undefined"!==r&&"string"!==r)throw new Q("MVT decoding error. Metadata property '".concat(this._baseName,"' is of type 'category' but the MVT tile contained a feature property of type '").concat(r,"': '").concat(t,"'"),H.MVT);return ae()(O()(MVTCategoryCodec.prototype),"sourceToInternal",this).call(this,e,t)}}]),MVTCategoryCodec}(ue);var ce=function(e){function MVTMetadata(){return h()(this,MVTMetadata),A()(this,O()(MVTMetadata).apply(this,arguments))}return R()(MVTMetadata,e),p()(MVTMetadata,[{key:"setCodecs",value:function setCodecs(){var e=this;Object.keys(this.properties).forEach(function(t){var r=e.properties[t],n=r.type;"geometry"!==n&&(r.codec=function MVTCodecFactory(e,t,r){switch(t){case"number":return new ie(e,r);case"category":return new se(e,r);default:throw new Q("MVT decoding error. Feature property value of type '".concat(t,"' cannot be decoded."),H.MVT)}}(e,n,t))})}}]),MVTMetadata}(ee);function addLineString(e,t,r,n,a){var o,i,u,s,c;if(e.length>=4){o=[e[0],e[1]];for(var f=2;f<=e.length;f+=2)if(i=[e[f],e[f+1]],o[0]!==i[0]||o[1]!==i[1]){f+=2;break}for(u=getLineNormal(o,i);f<=e.length;f+=2){c=!(a&&a(f));var l=void 0;if(f<=e.length-2?l=[e[f],e[f+1]]:n&&(l=[e[2],e[3]]),!c||o[0]===i[0]&&o[1]===i[1]||(t.vertices[r]=o[0],t.normals[r++]=-u[0],t.vertices[r]=o[1],t.normals[r++]=-u[1],t.vertices[r]=o[0],t.normals[r++]=u[0],t.vertices[r]=o[1],t.normals[r++]=u[1],t.vertices[r]=i[0],t.normals[r++]=u[0],t.vertices[r]=i[1],t.normals[r++]=u[1],t.vertices[r]=o[0],t.normals[r++]=-u[0],t.vertices[r]=o[1],t.normals[r++]=-u[1],t.vertices[r]=i[0],t.normals[r++]=u[0],t.vertices[r]=i[1],t.normals[r++]=u[1],t.vertices[r]=i[0],t.normals[r++]=-u[0],t.vertices[r]=i[1],t.normals[r++]=-u[1]),!l||l[0]===i[0]&&l[1]===i[1])s=u;else if(s=getLineNormal(i,l),c){var h=getJoinNormal(u,s),d=h.turnLeft,p=h.joinNormal,y=d?u:neg(s),v=d?s:neg(u);t.vertices[r]=i[0],t.normals[r++]=0,t.vertices[r]=i[1],t.normals[r++]=n?1e-37:0,t.vertices[r]=i[0],t.normals[r++]=y[0],t.vertices[r]=i[1],t.normals[r++]=y[1],t.vertices[r]=i[0],t.normals[r++]=v[0],t.vertices[r]=i[1],t.normals[r++]=v[1],p&&(t.vertices[r]=i[0],t.normals[r++]=p[0],t.vertices[r]=i[1],t.normals[r++]=p[1],t.vertices[r]=i[0],t.normals[r++]=v[0],t.vertices[r]=i[1],t.normals[r++]=v[1],t.vertices[r]=i[0],t.normals[r++]=y[0],t.vertices[r]=i[1],t.normals[r++]=y[1])}o=i,i=l,u=s}}return r}function resizeBuffer(e,t){var r=new Float32Array(t);return r.set(e),r}var fe=24,le=0,he={vertices:new Float32Array(1048576),normals:new Float32Array(1048576)};function resizeBuffers(e){var t=le+e;if(t>he.vertices.length){var r=2*t;he.vertices=resizeBuffer(he.vertices,r),he.normals=resizeBuffer(he.normals,r)}}var de=r(17),pe=2,ye=24,ve=0,me={vertices:new Float32Array(2097152),normals:new Float32Array(2097152)};function polygonDecoder_resizeBuffers(e){var t=ve+e;if(t>me.vertices.length){var r=2*t;me.vertices=resizeBuffer(me.vertices,r),me.normals=resizeBuffer(me.normals,r)}}function addVertex(e,t){me.vertices[ve]=e[t],me.normals[ve++]=0,me.vertices[ve]=e[t+1],me.normals[ve++]=0}function isClipped(e,t,r){return!!(e.clipped.includes(t)&&e.clipped.includes(r)&&e.clippedType[e.clipped.indexOf(t)]&e.clippedType[e.clipped.indexOf(r)])}function decodeGeom(e,t){switch(e){case j.POINT:return function decodePoint(e){return{verticesArrayBuffer:e,vertices:new Float32Array(e),breakpoints:[]}}(t);case j.LINE:return function decodeLine(e){var t=[],r=new Map;le=0;for(var n=0;n<e.length;n++){for(var a=e[n],o=0;o<a.length;o++)resizeBuffers(fe*a[o].length),le=addLineString(a[o],he,le);r.set(t.length,0===t.length?{start:0,end:le}:{start:r.get(t.length-1).end,end:le}),t.push(le)}for(var i=new ArrayBuffer(4*le),u=new ArrayBuffer(4*le),s=new Float32Array(i),c=new Float32Array(u),f=0;f<le;f++)s[f]=he.vertices[f],c[f]=he.normals[f];return{vertices:s,normals:c,verticesArrayBuffer:i,normalsArrayBuffer:u,featureIDToVertexIndex:r,breakpoints:t}}(t);case j.POLYGON:return function decodePolygon(e){var t=[],r=new Map;ve=0;for(var n=0;n<e.length;n++){for(var a=e[n],o=function _loop(e){var t=a[e],r=de(t.flat,t.holes);polygonDecoder_resizeBuffers(pe*r.length+ye*t.flat.length);for(var n=0;n<r.length;n++)addVertex(t.flat,2*r[n]);ve=addLineString(t.flat,me,ve,!0,function(e){return t.holes.includes((e-2)/2)||isClipped(t,e-4,e-2)})},i=0;i<a.length;i++)o(i);r.set(t.length,0===t.length?{start:0,end:ve}:{start:r.get(t.length-1).end,end:ve}),t.push(ve)}for(var u=new ArrayBuffer(4*ve),s=new ArrayBuffer(4*ve),c=new Float32Array(u),f=new Float32Array(s),l=0;l<ve;l++)c[l]=me.vertices[l],f[l]=me.normals[l];return{vertices:c,normals:f,verticesArrayBuffer:u,normalsArrayBuffer:s,featureIDToVertexIndex:r,breakpoints:t}}(t);default:throw new Q("Unimplemented geometry type: '".concat(e,"'."),H.NOT_SUPPORTED)}}var ge=function DummyDataframe(e){var t=e.active,r=e.center,n=e.properties,a=e.propertiesArrayBuffer,o=e.scale,i=e.type,u=e.geom,s=e.size,c=e.metadata,f=e.x,l=e.y,d=e.z;h()(this,DummyDataframe),this.active=t,this.center=r,this.properties=n,this.propertiesArrayBuffer=a,this.scale=o,this.type=i,this.decodedGeom=decodeGeom(i,u),this.numVertex=i===j.POINT?3*s:this.decodedGeom.vertices.length/2,this.numFeatures=i===j.POINT?s:this.decodedGeom.breakpoints.length||this.numVertex,this.propertyTex=[],this.metadata=c,this.propertyCount=0,this.x=f,this.y=l,this.z=d,this._aabb=function computeAABB(e,t){switch(t){case j.POINT:return[];case j.LINE:case j.POLYGON:for(var r=[],n=0;n<e.length;n++){for(var a=e[n],o={minx:Number.POSITIVE_INFINITY,miny:Number.POSITIVE_INFINITY,maxx:Number.NEGATIVE_INFINITY,maxy:Number.NEGATIVE_INFINITY},i=0;i<a.length;i++)o=_updateAABBForGeometry(a[i],o,t);o.minx===Number.POSITIVE_INFINITY&&(o=null),r.push(o)}return r}}(u,i),this._centroids=computeCentroids(this.decodedGeom,i),this.t1=[.1,.1,.1,.1],this.t2=[.1,.1,.1,.1],this.t3=[.1,.1,.1,.1],this.t4=[.1,.1,.1,.1]},xe=1,_e=2,we=3,be={1:j.POINT,2:j.LINE,3:j.POLYGON},Me=function(){function MVTWorker(){h()(this,MVTWorker)}return p()(MVTWorker,[{key:"onmessage",value:function onmessage(e){this.processEvent(e).then(function(e){var t=[];e.dataframe.empty||(t.push(e.dataframe.propertiesArrayBuffer),t.push(e.dataframe.decodedGeom.verticesArrayBuffer),e.dataframe.decodedGeom.normalsArrayBuffer&&t.push(e.dataframe.decodedGeom.normalsArrayBuffer)),postMessage(e,t)})}},{key:"processEvent",value:function(){var e=f()(s.a.mark(function _callee(e){var t,r;return s.a.wrap(function _callee$(n){for(;;)switch(n.prev=n.next){case 0:return(t=e.data).metadata&&(this.castMetadata(t.metadata),this.metadata=t.metadata),n.next=4,this._requestDataframe(t.x,t.y,t.z,t.url,t.layerID,this.metadata);case 4:return r=n.sent,n.abrupt("return",{mID:t.mID,dataframe:r});case 6:case"end":return n.stop()}},_callee,this)}));return function processEvent(t){return e.apply(this,arguments)}}()},{key:"castMetadata",value:function castMetadata(e){Object.setPrototypeOf(e,ce.prototype),e.setCodecs()}},{key:"_requestDataframe",value:function(){var e=f()(s.a.mark(function _callee2(e,t,r,n,a,o){var i,u;return s.a.wrap(function _callee2$(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,fetch(n);case 2:return i=s.sent,s.next=5,this.urlToDataframeTransformer(i,e,t,r,a,o);case 5:return u=s.sent,s.abrupt("return",u);case 7:case"end":return s.stop()}},_callee2,this)}));return function _requestDataframe(t,r,n,a,o,i){return e.apply(this,arguments)}}()},{key:"urlToDataframeTransformer",value:function(){var e=f()(s.a.mark(function _callee3(e,t,r,n,a,o){var i,u,c,f,l,h,d,p,m,g,x;return s.a.wrap(function _callee3$(s){for(;;)switch(s.prev=s.next){case 0:return i=o.extent,s.next=3,e.arrayBuffer();case 3:if(0!==(u=s.sent).byteLength&&"null"!==e){s.next=6;break}return s.abrupt("return",{empty:!0});case 6:if(c=new y.VectorTile(new v(u)),!(Object.keys(c.layers).length>1)||a){s.next=9;break}throw new W("LayerID parameter wasn't specified and the MVT tile contains multiple layers: ".concat(JSON.stringify(Object.keys(c.layers)),"."),G.MISSING_REQUIRED);case 9:if(f=c.layers[a||Object.keys(c.layers)[0]]){s.next=12;break}return s.abrupt("return",{empty:!0});case 12:return l=this._decodeMVTLayer(f,o,i),h=l.geometries,d=l.properties,p=l.propertiesArrayBuffer,m=l.numFeatures,g=getRsysFromTile(t,r,n),x=this._generateDataFrame(g,h,d,p,m,o.geomType,o),s.abrupt("return",x);case 16:case"end":return s.stop()}},_callee3,this)}));return function urlToDataframeTransformer(t,r,n,a,o,i){return e.apply(this,arguments)}}()},{key:"_decodeMVTLayer",value:function _decodeMVTLayer(e,t,r){if(!e.length)return{properties:[],geometries:{},propertiesArrayBuffer:[],numFeatures:0};switch(t.geomType||(t.geomType=this._autoDiscoverType(e)),t.geomType){case j.POINT:var n=new ArrayBuffer(2*e.length*3*4);return this._decode(e,t,r,n);case j.LINE:return this._decode(e,t,r,[],decodeLines);case j.POLYGON:return this._decode(e,t,r,[],decodePolygons);default:throw new W("MVT: invalid geometry type '".concat(t.geomType,"'"),G.INCORRECT_TYPE)}}},{key:"_autoDiscoverType",value:function _autoDiscoverType(e){var t=e.feature(0).type;switch(t){case xe:return j.POINT;case _e:return j.LINE;case we:return j.POLYGON;default:throw new W("MVT: invalid geometry type '".concat(t,"'"),G.INCORRECT_TYPE)}}},{key:"_decode",value:function _decode(e,t,r,n,a){var o,i=0;n&&(o=new Float32Array(n));for(var u=this._initializePropertyArrays(t,e.length),s=u.properties,c=u.propertiesArrayBuffer,f=this._scalarPropertyCodecs(t),l=this._rangePropertyCodecs(t),h=0;h<e.length;h++){var d=e.feature(h);this._checkType(d,t.geomType);var p=d.loadGeometry();if(a){var y=a(p,r);n.push(y)}else{var v=2*p[0][0].x/r-1,m=2*(1-p[0][0].y/r)-1;if(v<-1||v>=1||m<-1||m>=1)continue;o[6*i+0]=v,o[6*i+1]=m,o[6*i+2]=v,o[6*i+3]=m,o[6*i+4]=v,o[6*i+5]=m}if(void 0===d.properties[t.idProperty])throw new Q("MVT feature with undefined idProperty '".concat(t.idProperty,"'"),H.MVT);this._decodeProperties(t,f,l,s,d,i),i++}return{properties:s,propertiesArrayBuffer:c,geometries:n,numFeatures:i}}},{key:"_checkType",value:function _checkType(e,t){var r=e.type,n=be[r];if(n!==t)throw new Q("MVT: mixed geometry types in the same layer. Layer has type: ".concat(t," but feature was ").concat(n),H.MVT)}},{key:"_initializePropertyArrays",value:function _initializePropertyArrays(e,t){var r=this._getPropertyNamesFrom(e),n=this._getPropertiesFor(r,t);return{propertyNames:r,properties:n.properties,propertiesArrayBuffer:n.propertiesArrayBuffer}}},{key:"_getSourcePropertyNamesFrom",value:function _getSourcePropertyNamesFrom(e){return e.propertyKeys.filter(function(t){return"geometry"!==e.properties[e.baseName(t)].type})}},{key:"_getPropertyNamesFrom",value:function _getPropertyNamesFrom(e){var t=[];return this._getSourcePropertyNamesFrom(e).forEach(function(r){e.decodedProperties(r).forEach(function(e){t.push(e)})}),t}},{key:"_getPropertiesFor",value:function _getPropertiesFor(e,t){for(var r={},n=1024*Math.ceil(t/1024),a=new ArrayBuffer(4*n*e.length),o=a,i=0;i<e.length;i++){r[e[i]]=new Float32Array(a,4*i*n,n)}return{properties:r,propertiesArrayBuffer:o}}},{key:"_scalarPropertyCodecs",value:function _scalarPropertyCodecs(e){return this._getSourcePropertyNamesFrom(e).map(function(t){return[t,e.codec(t)]}).filter(function(e){var t=i()(e,2);t[0];return!t[1].isRange()})}},{key:"_rangePropertyCodecs",value:function _rangePropertyCodecs(e){return this._getSourcePropertyNamesFrom(e).map(function(t){return[t,e.decodedProperties(t),e.codec(t)]}).filter(function(e){var t=i()(e,3);t[0],t[1];return t[2].isRange()})}},{key:"_decodeProperties",value:function _decodeProperties(e,t,r,n,a,o){for(var u=t.length,s=0;s<u;s++){var c=i()(t[s],2),f=c[0],l=c[1],h=a.properties[f];n[f][o]=l.sourceToInternal(e,h)}u=r.length;for(var d=0;d<u;d++){var p=i()(r[d],3),y=(f=p[0],i()(p[1],2)),v=y[0],m=y[1],g=(l=p[2],a.properties[f]),x=l.sourceToInternal(e,g),_=i()(x,2),w=_[0],b=_[1];n[v][o]=w,n[m][o]=b}}},{key:"_generateDataFrame",value:function _generateDataFrame(e,t,r,n,a,o,i){return new ge({active:!1,center:e.center,geom:t,properties:r,propertiesArrayBuffer:n,scale:e.scale,size:a,type:o,metadata:i})}}]),MVTWorker}(),Te=r(18),Pe=function(){function BQClient(e){h()(this,BQClient),this._projectId=e.projectId,this._datasetId=e.datasetId,this._tableId=e.tableId,this._token=e.token}return p()(BQClient,[{key:"fetchTiles",value:function(){var e=f()(s.a.mark(function _callee(e){var t,r,n,a,o,i,u,c,f,l,h=this;return s.a.wrap(function _callee$(s){for(;;)switch(s.prev=s.next){case 0:return t=e.map(function(e){return h._tileFilter(e)}).join(" OR "),r="SELECT z,x,y,mvt FROM `".concat(this._datasetId,".").concat(this._tableId,"` WHERE ").concat(t),s.next=4,this.query(r);case 4:if(n=s.sent,a=[],n)for(o=0;o<n.length;o++)(i=n[o]).f&&4===i.f.length&&(u=parseInt(i.f[0].v),c=parseInt(i.f[1].v),f=parseInt(i.f[2].v),l=i.f[3].v,a.push({z:u,x:c,y:f,buffer:Object(Te.decode)(l)}));return s.abrupt("return",a);case 8:case"end":return s.stop()}},_callee,this)}));return function fetchTiles(t){return e.apply(this,arguments)}}()},{key:"query",value:function(){var e=f()(s.a.mark(function _callee2(e){var t,r;return s.a.wrap(function _callee2$(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,fetch("".concat("https://bigquery.googleapis.com/bigquery/v2","/projects/").concat(this._projectId,"/queries"),{method:"POST",headers:{Authorization:"Bearer ".concat(this._token),"Content-Type":"application/json"},body:JSON.stringify({kind:"bigquery#queryRequest",query:e,useLegacySql:!1})});case 2:return t=n.sent,n.next=5,t.json();case 5:return r=n.sent,n.abrupt("return",r&&r.rows);case 7:case"end":return n.stop()}},_callee2,this)}));return function query(t){return e.apply(this,arguments)}}()},{key:"_tileFilter",value:function _tileFilter(e){return"(z = ".concat(e.z," AND x = ").concat(e.x," AND y = ").concat(e.y,")")}}]),BQClient}(),ke=1,Ie=2,Fe=3,Ne={1:j.POINT,2:j.LINE,3:j.POLYGON},Ce=function(){function BQMVTWorker(){h()(this,BQMVTWorker)}return p()(BQMVTWorker,[{key:"onmessage",value:function onmessage(e){this.processEvent(e).then(postMessage)}},{key:"processEvent",value:function(){var e=f()(s.a.mark(function _callee(e){var t,r;return s.a.wrap(function _callee$(n){for(;;)switch(n.prev=n.next){case 0:return(t=e.data).metadata&&(this.castMetadata(t.metadata),this.metadata=t.metadata),n.next=4,this._requestDataframes(t.tiles,t.bqSource,t.layerID,this.metadata);case 4:return r=n.sent,n.abrupt("return",{mID:t.mID,dataframes:r});case 6:case"end":return n.stop()}},_callee,this)}));return function processEvent(t){return e.apply(this,arguments)}}()},{key:"castMetadata",value:function castMetadata(e){Object.setPrototypeOf(e,ce.prototype),e.setCodecs()}},{key:"_requestDataframes",value:function(){var e=f()(s.a.mark(function _callee2(e,t,r,n){var a,o,i,u,c,f=this;return s.a.wrap(function _callee2$(l){for(;;)switch(l.prev=l.next){case 0:return a=[],o=new Pe(t),l.next=4,o.fetchTiles(e);case 4:i=l.sent,u=s.a.mark(function _loop(t){var o,u,c;return s.a.wrap(function _loop$(s){for(;;)switch(s.prev=s.next){case 0:if(o=e[t],!(u=i&&i.find(function(e){return e.x===o.x&&e.y===o.y&&e.z===o.z}))){s.next=9;break}return s.next=5,f.responseToDataframeTransformer(u,r,n);case 5:c=s.sent,a.push(c),s.next=10;break;case 9:a.push({x:o.x,y:o.y,z:o.z,empty:!0});case 10:case"end":return s.stop()}},_loop,this)}),c=0;case 7:if(!(c<e.length)){l.next=12;break}return l.delegateYield(u(c),"t0",9);case 9:c++,l.next=7;break;case 12:return l.abrupt("return",a);case 13:case"end":return l.stop()}},_callee2,this)}));return function _requestDataframes(t,r,n,a){return e.apply(this,arguments)}}()},{key:"responseToDataframeTransformer",value:function(){var e=f()(s.a.mark(function _callee3(e,t,r){var n,a,o,i,u,c,f,l,h,d,p,m,g;return s.a.wrap(function _callee3$(s){for(;;)switch(s.prev=s.next){case 0:if(n=e.x,a=e.y,o=e.z,i=e.buffer,u=r.extent,0!==i.byteLength){s.next=4;break}return s.abrupt("return",{x:n,y:a,z:o,empty:!0});case 4:if(c=new y.VectorTile(new v(i)),!(Object.keys(c.layers).length>1)||t){s.next=7;break}throw new W("LayerID parameter wasn't specified and the MVT tile contains multiple layers: ".concat(JSON.stringify(Object.keys(c.layers)),"."),G.MISSING_REQUIRED);case 7:if(f=c.layers[t||Object.keys(c.layers)[0]]){s.next=10;break}return s.abrupt("return",{empty:!0});case 10:return l=this._decodeMVTLayer(f,r,u),h=l.geometries,d=l.properties,p=l.propertiesArrayBuffer,m=l.numFeatures,g=getRsysFromTile(n,a,o),s.abrupt("return",this._generateDataFrame(g,h,d,p,m,r.geomType,r,n,a,o));case 13:case"end":return s.stop()}},_callee3,this)}));return function responseToDataframeTransformer(t,r,n){return e.apply(this,arguments)}}()},{key:"_decodeMVTLayer",value:function _decodeMVTLayer(e,t,r){if(!e.length)return{properties:[],geometries:{},propertiesArrayBuffer:[],numFeatures:0};switch(t.geomType||(t.geomType=this._autoDiscoverType(e)),t.geomType){case j.POINT:var n=new ArrayBuffer(2*e.length*3*4);return this._decode(e,t,r,n);case j.LINE:return this._decode(e,t,r,[],decodeLines);case j.POLYGON:return this._decode(e,t,r,[],decodePolygons);default:throw new W("MVT: invalid geometry type '".concat(t.geomType,"'"),G.INCORRECT_TYPE)}}},{key:"_autoDiscoverType",value:function _autoDiscoverType(e){var t=e.feature(0).type;switch(t){case ke:return j.POINT;case Ie:return j.LINE;case Fe:return j.POLYGON;default:throw new W("MVT: invalid geometry type '".concat(t,"'"),G.INCORRECT_TYPE)}}},{key:"_decode",value:function _decode(e,t,r,n,a){var o,i=0;n&&(o=new Float32Array(n));for(var u=this._initializePropertyArrays(t,e.length),s=u.properties,c=u.propertiesArrayBuffer,f=this._scalarPropertyCodecs(t),l=this._rangePropertyCodecs(t),h=0;h<e.length;h++){var d=e.feature(h);this._checkType(d,t.geomType);var p=d.loadGeometry();if(a){var y=a(p,r);n.push(y)}else{var v=2*p[0][0].x/r-1,m=2*(1-p[0][0].y/r)-1;if(v<-1||v>=1||m<-1||m>=1)continue;o[6*i+0]=v,o[6*i+1]=m,o[6*i+2]=v,o[6*i+3]=m,o[6*i+4]=v,o[6*i+5]=m}if(void 0===d.properties[t.idProperty])throw new Q("MVT feature with undefined idProperty '".concat(t.idProperty,"'"),H.MVT);this._decodeProperties(t,f,l,s,d,i),i++}return{properties:s,propertiesArrayBuffer:c,geometries:n,numFeatures:i}}},{key:"_checkType",value:function _checkType(e,t){var r=e.type,n=Ne[r];if(n!==t)throw new Q("MVT: mixed geometry types in the same layer. Layer has type: ".concat(t," but feature was ").concat(n),H.MVT)}},{key:"_initializePropertyArrays",value:function _initializePropertyArrays(e,t){var r=this._getPropertyNamesFrom(e),n=this._getPropertiesFor(r,t);return{propertyNames:r,properties:n.properties,propertiesArrayBuffer:n.propertiesArrayBuffer}}},{key:"_getSourcePropertyNamesFrom",value:function _getSourcePropertyNamesFrom(e){return e.propertyKeys.filter(function(t){return"geometry"!==e.properties[e.baseName(t)].type})}},{key:"_getPropertyNamesFrom",value:function _getPropertyNamesFrom(e){var t=[];return this._getSourcePropertyNamesFrom(e).forEach(function(r){e.decodedProperties(r).forEach(function(e){t.push(e)})}),t}},{key:"_getPropertiesFor",value:function _getPropertiesFor(e,t){for(var r={},n=1024*Math.ceil(t/1024),a=new ArrayBuffer(4*n*e.length),o=a,i=0;i<e.length;i++){r[e[i]]=new Float32Array(a,4*i*n,n)}return{properties:r,propertiesArrayBuffer:o}}},{key:"_scalarPropertyCodecs",value:function _scalarPropertyCodecs(e){return this._getSourcePropertyNamesFrom(e).map(function(t){return[t,e.codec(t)]}).filter(function(e){var t=i()(e,2);t[0];return!t[1].isRange()})}},{key:"_rangePropertyCodecs",value:function _rangePropertyCodecs(e){return this._getSourcePropertyNamesFrom(e).map(function(t){return[t,e.decodedProperties(t),e.codec(t)]}).filter(function(e){var t=i()(e,3);t[0],t[1];return t[2].isRange()})}},{key:"_decodeProperties",value:function _decodeProperties(e,t,r,n,a,o){for(var u=t.length,s=0;s<u;s++){var c=i()(t[s],2),f=c[0],l=c[1],h=a.properties[f];n[f][o]=l.sourceToInternal(e,h)}u=r.length;for(var d=0;d<u;d++){var p=i()(r[d],3),y=(f=p[0],i()(p[1],2)),v=y[0],m=y[1],g=(l=p[2],a.properties[f]),x=l.sourceToInternal(e,g),_=i()(x,2),w=_[0],b=_[1];n[v][o]=w,n[m][o]=b}}},{key:"_generateDataFrame",value:function _generateDataFrame(e,t,r,n,a,o,i,u,s,c){return new ge({active:!1,center:e.center,geom:t,properties:r,propertiesArrayBuffer:n,scale:e.scale,size:a,type:o,metadata:i,x:u,y:s,z:c})}}]),BQMVTWorker}(),Ee=["year","month","day","hour","minute","second"],Ve=[1,1,1,0,0,0],Se=0,Ae=1,De=2,Oe=3,Le=4,Re=5,Be=864e5,qe=36e5,We=6e4,Ge=1e3;function startLevel(e){for(var t=Ee.length-1;t>0&&e[Ee[t]]===Ve[t];)--t;return t}function pad(e,t){return e.toString().padStart(t,"0")}function parsedValue(e){var t=msToDate(e);return{year:t.getUTCFullYear(),month:t.getUTCMonth()+1,day:t.getUTCDate(),hour:t.getUTCHours(),minute:t.getUTCMinutes(),second:t.getUTCSeconds()}}function invalidPeriod(e,t){throw new Error("Invalid period of ".concat(t," between ").concat(e.v1," and ").concat(e.v2))}function yearWeek(e,t){var r=function isoDow(e,t,r){var n=new Date(e,t-1,r).getDay();return 0===n?7:n}(e,1,1),n=r>4?9-r:2-r;return Math.abs(t-n)%7!=0?[]:t<n?yearWeek(e-1,t+=Math.round((Date.UTC(e,0,1)-Date.UTC(e-1,0,1))/Be)):Date.UTC(e,0,1)+(t-1+3)*Be>=Date.UTC(e+1,0,1)?yearWeek(e+1,t-=Math.round((Date.UTC(e+1,0,1)-Date.UTC(e,0,1))/Be)):[e,1+Math.round((t-n)/7)]}function periodISO(e,t){var r=parsedValue(e),n=parsedValue(t),a=startLevel(r),o=startLevel(n),u={v1:e,v2:t,t1:r,t2:n};return Math.max(a,o)===Se?function yearsPeriod(e){var t=e.t2.year-e.t1.year;return 1e3===t&&(e.t1.year-1)%1e3==0?"M".concat(1+(e.t1.year-1)/1e3):100===t&&(e.t1.year-1)%100==0?"C".concat(1+(e.t1.year-1)/100):10===t&&e.t1.year%10==0?"D".concat(e.t1.year/10):1===t?pad(e.t1.year,4):void invalidPeriod("".concat(t," years"))}(u):Math.max(a,o)===Ae?function monthsPeriod(e){var t=12*e.t2.year+e.t2.month-12*e.t1.year-e.t1.month;return 6===t&&(e.t1.month-1)%6==0?"".concat(pad(e.t1.year,4),"S").concat(1+(e.t1.month-1)/6):4===t?"".concat(pad(e.t1.year,4),"t").concat(1+(e.t1.month-1)/4):3===t?"".concat(pad(e.t1.year,4),"-Q").concat(1+(e.t1.month-1)/3):1===t?"".concat(pad(e.t1.year,4),"-").concat(pad(e.t1.month,2)):void invalidPeriod("".concat(t," months"))}(u):Math.max(a,o)===De?function daysPeriod(e){var t=Math.round((e.v2-e.v1)/Be);if(1===t)return"".concat(pad(e.t1.year,4),"-").concat(pad(e.t1.month,2),"-").concat(pad(e.t1.day,2));if(7===t){var r=e.t1.year,n=Date.UTC(r,0,1),a=yearWeek(r,1+Math.round((e.v1-n)/Be)),o=i()(a,2),u=o[0],s=o[1];if(u&&s)return"".concat(pad(u,4),"-W").concat(pad(s,2));invalidPeriod("7 days")}else invalidPeriod("".concat(t," days"))}(u):Math.max(a,o)===Oe?function hoursPeriod(e){var t=Math.round((e.v2-e.v1)/qe);if(1===t)return"".concat(pad(e.t1.year,4),"-").concat(pad(e.t1.month,2),"-").concat(pad(e.t1.day,2),"T").concat(pad(e.t1.hour,2));invalidPeriod("".concat(t," hours"))}(u):Math.max(a,o)===Le?function minutesPeriod(e){var t=Math.round((e.v2-e.v1)/We);if(1===t)return"".concat(pad(e.t1.year,4),"-").concat(pad(e.t1.month,2),"-").concat(pad(e.t1.day,2),"T").concat(pad(e.t1.hour,2),":").concat(pad(e.t1.minute,2));invalidPeriod("".concat(t," minutes"))}(u):Math.max(a,o)===Re?function secondsPeriod(e){var t=Math.round((e.v2-e.v1)/Ge);if(1===t)return"".concat(pad(e.t1.year,4),"-").concat(pad(e.t1.month,2),"-").concat(pad(e.t1.day,2),"T").concat(pad(e.t1.hour,2),":").concat(pad(e.t1.minute,2),":").concat(pad(e.t1.second,2));invalidPeriod("".concat(t," seconds"))}(u):void invalidPeriod(u,"fractional seconds")}var je=function(e){function CartoParsingError(e){var t;h()(this,CartoParsingError);return(t=A()(this,O()(CartoParsingError).call(this,{message:e,type:"[Error]"}))).name="CartoParsingError",t}return R()(CartoParsingError,e),CartoParsingError}(q),ze=function(){function IsoParser(e){h()(this,IsoParser),this._format=e}return p()(IsoParser,[{key:"check",value:function check(e){return e.match(this._format)}}]),IsoParser}();function fieldDefault(e,t){return void 0===e?t:Number(e)}function dateFields(e){return{year:fieldDefault(e.year,1),month:fieldDefault(e.month,1),day:fieldDefault(e.day,1),hour:fieldDefault(e.hour,0),minute:fieldDefault(e.minute,0),second:fieldDefault(e.second,0)}}function fieldsFromMatch(e){return dateFields({year:e[1],month:e[2],day:e[3],hour:e[4],minute:e[5],second:e[6]})}var Ze=function(e){function YMDHMSParser(){return h()(this,YMDHMSParser),A()(this,O()(YMDHMSParser).call(this,/^(\d\d\d\d)(?:\-?(\d\d)(?:\-?(\d\d)(?:[T\s]?(\d\d)(?:\:(\d\d)(?:\:(\d\d))?)?)?)?)?$/))}return R()(YMDHMSParser,e),p()(YMDHMSParser,[{key:"parse",value:function parse(e){var t=this.check(e)||[],r=t.slice(),n=[1,2,3,4,5,6].find(function(e){return void 0===r[e]})||7;return 1===n?r[1]=2:r[n-1]=Number(r[n-1])+1,[fieldsFromMatch(t),fieldsFromMatch(r)]}}]),YMDHMSParser}(ze),Ue=function(e){function MillenniumParser(){return h()(this,MillenniumParser),A()(this,O()(MillenniumParser).call(this,/^M(\d+)$/))}return R()(MillenniumParser,e),p()(MillenniumParser,[{key:"parse",value:function parse(e){var t=this.check(e),r=Number(t[1]),n=function year(e){return 1e3*(e-1)+1};return[dateFields({year:n(r)}),dateFields({year:n(r+1)})]}}]),MillenniumParser}(ze),Ye=function(e){function CenturyParser(){return h()(this,CenturyParser),A()(this,O()(CenturyParser).call(this,/^C(\d+)$/))}return R()(CenturyParser,e),p()(CenturyParser,[{key:"parse",value:function parse(e){var t=this.check(e),r=Number(t[1]),n=function year(e){return 100*(e-1)+1};return[dateFields({year:n(r)}),dateFields({year:n(r+1)})]}}]),CenturyParser}(ze),Qe=function(e){function DecadeParser(){return h()(this,DecadeParser),A()(this,O()(DecadeParser).call(this,/^D(\d+)$/))}return R()(DecadeParser,e),p()(DecadeParser,[{key:"parse",value:function parse(e){var t=this.check(e),r=Number(t[1]),n=function year(e){return 10*e};return[dateFields({year:n(r)}),dateFields({year:n(r+1)})]}}]),DecadeParser}(ze),He=function(e){function SemesterParser(){return h()(this,SemesterParser),A()(this,O()(SemesterParser).call(this,/^(\d\d\d\d)S(\d)$/))}return R()(SemesterParser,e),p()(SemesterParser,[{key:"parse",value:function parse(e){var t=this.check(e),r=Number(t[1]),n=Number(t[2]),a=function month(e){return 6*(e-1)+1};return[dateFields({year:r,month:a(n)}),dateFields({year:r,month:a(n+1)})]}}]),SemesterParser}(ze),$e=function(e){function TrimesterParser(){return h()(this,TrimesterParser),A()(this,O()(TrimesterParser).call(this,/^(\d\d\d\d)t(\d)$/))}return R()(TrimesterParser,e),p()(TrimesterParser,[{key:"parse",value:function parse(e){var t=this.check(e),r=Number(t[1]),n=Number(t[2]),a=function month(e){return 4*(e-1)+1};return[dateFields({year:r,month:a(n)}),dateFields({year:r,month:a(n+1)})]}}]),TrimesterParser}(ze),Je=function(e){function QuarterParser(){return h()(this,QuarterParser),A()(this,O()(QuarterParser).call(this,/^(\d\d\d\d)\-?Q(\d)$/))}return R()(QuarterParser,e),p()(QuarterParser,[{key:"parse",value:function parse(e){var t=this.check(e),r=Number(t[1]),n=Number(t[2]),a=function month(e){return 3*(e-1)+1};return[dateFields({year:r,month:a(n)}),dateFields({year:r,month:a(n+1)})]}}]),QuarterParser}(ze);function startOfIsoWeek(e,t){var r=function parseISO_isoDow(e,t,r){var n=new Date(e,t-1,r).getDay();return 0===n?7:n}(e,1,1);return function addDays(e,t){var r=new Date(e.valueOf());return r.setDate(r.getDate()+t),r}(new Date(e,0,r>4?9-r:2-r),7*(t-1))}var Xe=function(e){function WeekParser(){return h()(this,WeekParser),A()(this,O()(WeekParser).call(this,/^(\d\d\d\d)\-?W(\d\d)$/))}return R()(WeekParser,e),p()(WeekParser,[{key:"parse",value:function parse(e){var t=this.check(e),r=Number(t[1]),n=Number(t[2]),a=startOfIsoWeek(r,n),o=startOfIsoWeek(r,n+1),i=function fields(e){return{year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()}};return[dateFields(i(a)),dateFields(i(o))]}}]),WeekParser}(ze),Ke=[new Ue,new Ye,new Qe,new He,new $e,new Je,new Xe,new Ze];function parseISO(e){var t=function findParser(e){return Ke.find(function(t){return t.check(e)})}(e=e||"");if(!t)throw new je("No date parser found for ".concat(e));return t.parse(e)}var et=function(){function TimeZoneDate(e,t){h()(this,TimeZoneDate),this._value=e,this._date=msToDate(e),this._timeZone=t}return p()(TimeZoneDate,[{key:"year",get:function get(){return this._date.getUTCFullYear()}},{key:"month",get:function get(){return this._date.getUTCMonth()+1}},{key:"day",get:function get(){return this._date.getUTCDate()}},{key:"hour",get:function get(){return this._date.getUTCHours()}},{key:"minute",get:function get(){return this._date.getUTCMinutes()}},{key:"second",get:function get(){return this._date.getUTCSeconds()}},{key:"text",get:function get(){return periodISO(this._date.getTime(),this._date.getTime()+1e3)}},{key:"timeZone",get:function get(){return this._timeZone}}],[{key:"fromValue",value:function fromValue(e,t){return new TimeZoneDate(e,t)}},{key:"from",value:function from(e,t,r,n,a,o,i){return this.fromValue(Date.UTC(e,(t||1)-1,r,n,a,o),i)}}]),TimeZoneDate}(),tt=function(){function TimeRange(e,t,r,n){if(h()(this,TimeRange),this._startValue=r,this._endValue=n,r&&n)this._iso=periodISO(r,n);else if(!r&&!n&&t){var a=function _startEndTimeValues(e){return parseISO(e).map(_timeValue)}(t);this._iso=t,this._startValue=a[0],this._endValue=a[1]}this._timeZone=e}return p()(TimeRange,[{key:"timeZone",get:function get(){return this._timeZone}},{key:"iso",get:function get(){return this._iso}},{key:"startValue",get:function get(){return this._startValue}},{key:"endValue",get:function get(){return this._endValue}},{key:"startDate",get:function get(){return et.fromValue(this._startValue,this._timeZone)}},{key:"endDate",get:function get(){return et.fromValue(this._endValue,this._timeZone)}}]),TimeRange}();function _timeValue(e){return Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second)}Math.PI;var rt=6378137;Math.PI;function msToDate(e){return new Date(e)}function castTimeRange(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return void 0===e||function isTimeRange(e){return e instanceof tt}(e)?e&&t?util_timeRange({iso:e._iso,timeZone:t}):e:"string"==typeof e?util_timeRange({iso:e,timeZone:t}):void 0}function util_timeRange(e){var t=e.start,r=e.end,n=e.iso,a=e.timeZone;return new tt(a,n,t,r)}var nt=function(e){function WindshaftDateCodec(e,t){var r;h()(this,WindshaftDateCodec),r=A()(this,O()(WindshaftDateCodec).call(this,e,t));var n=e.stats(t).min;return r._min_ms=1e3*n,r._min_date=msToDate(r._min_ms),r}return R()(WindshaftDateCodec,e),p()(WindshaftDateCodec,[{key:"sourceToInternal",value:function sourceToInternal(e,t){return msToDate(1e3*t)-this._min_date}},{key:"internalToExternal",value:function internalToExternal(e,t){var r=t;return msToDate(r+=this._min_ms)}},{key:"externalToSource",value:function externalToSource(e,t){return t.getTime()/1e3}},{key:"sourceToExternal",value:function sourceToExternal(e,t){return function asDate(e){if(e instanceof Date)return e;return msToDate(1e3*e)}(t)}},{key:"inlineInternalMatch",value:function inlineInternalMatch(e,t){var r=t._min_ms-this._min_ms;return"(".concat(e,"-").concat(r.toFixed(20),")")}}]),WindshaftDateCodec}($);var at=function(e){function TimeRangeCodec(e,t){var r;h()(this,TimeRangeCodec),r=A()(this,O()(TimeRangeCodec).call(this,e,t));var n=e.stats(t),a=n.min,o=n.grouping&&n.grouping.timezone,i=util_timeRange({timeZone:o,iso:a});return r._min=i.startValue/1e3,r._timeZone=o,r}return R()(TimeRangeCodec,e),p()(TimeRangeCodec,[{key:"isRange",value:function isRange(){return!0}},{key:"sourceToInternal",value:function sourceToInternal(e,t){var r=this,n=util_timeRange({iso:t});return[n.startValue/1e3,n.endValue/1e3].map(function(e){return e-r._min})}},{key:"internalToExternal",value:function internalToExternal(e,t){var r=i()(t,2),n=r[0],a=r[1];return util_timeRange({start:1e3*(n+this._min),end:1e3*(a+this._min),timeZone:this._timeZone})}},{key:"externalToSource",value:function externalToSource(e,t){return castTimeRange(t,this._timeZone)._iso}},{key:"sourceToExternal",value:function sourceToExternal(e,t){return util_timeRange({iso:t,timeZone:this._timeZone})}},{key:"inlineInternalMatch",value:function inlineInternalMatch(e,t){var r=t._min.getTime()-this._min.getTime();return"(".concat(e,"-").concat(r.toFixed(20),")")}}]),TimeRangeCodec}($),ot=function(e){function CartoMapsAPIError(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:it.DEFAULT;return h()(this,CartoMapsAPIError),(t=A()(this,O()(CartoMapsAPIError).call(this,{message:e,type:r}))).name="CartoMapsAPIError",t}return R()(CartoMapsAPIError,e),CartoMapsAPIError}(q),it={DEFAULT:"[Error]",SQL:"[SQL]",NOT_SUPPORTED:"[Not supported]",SECURITY:"[Security]"};var ut=function(e){function WindshaftMetadata(){var e,t;h()(this,WindshaftMetadata);for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return(t=A()(this,(e=O()(WindshaftMetadata)).call.apply(e,[this].concat(n)))).propertyKeys=[],t.baseNames={},Object.keys(t.properties).forEach(function(e){var r=t.properties[e];r.aggregations?Object.values(r.aggregations).forEach(function(r){t._addProperty(e,r)}):r.dimension?r.dimension.range?(r.dimension.range.forEach(function(r){t._addProperty(e,r,!1)}),t._addProperty(e,r.dimension.propertyName)):t._addProperty(e,r.dimension.propertyName):t._addProperty(e,e)}),t}return R()(WindshaftMetadata,e),p()(WindshaftMetadata,[{key:"_addProperty",value:function _addProperty(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.baseNames[t]=e,r&&this.propertyKeys.push(t)}},{key:"_dimensionInfo",value:function _dimensionInfo(e){var t=this.baseName(e)||e,r=this.properties[t],n=null;t!==e&&t!==e&&r.dimension&&(n=r.dimension);var a=r.type,o=n?function dimensionBaseType(e){return e.type}(n):a;return{baseName:t,column:r,dimension:n,dataframeType:n?function dimensionType(e,t){if(e.range)return"date";return e.type}(n):o,baseType:a,sourceType:o}}},{key:"baseName",value:function baseName(e){return this.baseNames[e]}},{key:"decodedProperties",value:function decodedProperties(e){var t=this._dimensionInfo(e).dimension;return t&&t.grouping&&t.range?t.range:ae()(O()(WindshaftMetadata.prototype),"decodedProperties",this).call(this,e)}},{key:"stats",value:function stats(e){var t=this._dimensionInfo(e).dimension;return t&&t.grouping?t:ae()(O()(WindshaftMetadata.prototype),"stats",this).call(this,e)}},{key:"setCodecs",value:function setCodecs(){!function setMetadataCodecs(e){Object.keys(e.properties).forEach(function(t){var r=e.properties[t],n=r.type;if("geometry"!==n){var a=r.dimension?r.dimension.type:null,o=a?r.dimension.propertyName:t,i="category"===a&&r.dimension.range?"timerange":a;r.codec=function windshaftCodecFactory(e,t,r){switch(t){case"number":return new oe(e,r);case"category":return new ue(e,r);case"date":return new nt(e,r);case"timerange":return new at(e,r);default:throw new ot("Windshaft MVT decoding error. Feature property value of type '".concat(t,"' cannot be decoded."),it.NOT_SUPPORTED)}}(e,i||n,o||t)}})}(this)}},{key:"sourcePropertyName",value:function sourcePropertyName(e){var t=this.baseName(e),r=this.properties[t].dimension;return r&&r.range?r.propertyName:e}}]),WindshaftMetadata}(ce);var st=function(e){function WindshaftWorker(){return h()(this,WindshaftWorker),A()(this,O()(WindshaftWorker).apply(this,arguments))}return R()(WindshaftWorker,e),p()(WindshaftWorker,[{key:"castMetadata",value:function castMetadata(e){Object.setPrototypeOf(e,ut.prototype),e.setCodecs()}}]),WindshaftWorker}(Me);const ct={MVT:new Me,BQMVT:new Ce,windshaft:new st};onmessage=function(e){return ct[e.data.workerName].onmessage(e)}}]);