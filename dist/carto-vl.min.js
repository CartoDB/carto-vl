/*!
 * CARTO VL js https://carto.com/
 * Version: 1.4.6
 * 
 */
!function webpackUniversalModuleDefinition(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.carto=t():e.carto=t()}(window,function(){return function(e){var t={};function __webpack_require__(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,__webpack_require__),n.l=!0,n.exports}return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,r){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(__webpack_require__.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)__webpack_require__.d(r,n,function(t){return e[t]}.bind(null,n));return r},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=88)}([function(e,t){function _getPrototypeOf(t){return e.exports=_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(t)}e.exports=_getPrototypeOf},function(e,t){e.exports=function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}},function(e,t,r){var n=r(13),a=r(12);e.exports=function _possibleConstructorReturn(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?a(e):t}},function(e,t,r){var n=r(24);e.exports=function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}},function(e,t,r){r(0);var n=r(30);function _get(t,r,a){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=_get=Reflect.get:e.exports=_get=function _get(e,t,r){var a=n(e,t);if(a){var i=Object.getOwnPropertyDescriptor(a,t);return i.get?i.get.call(r):i.value}},_get(t,r,a||t)}e.exports=_get},function(e,t,r){var n=r(24);function _construct(t,r,a){return!function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?e.exports=_construct=function _construct(e,t,r){var a=[null];a.push.apply(a,t);var i=new(Function.bind.apply(e,a));return r&&n(i,r.prototype),i}:e.exports=_construct=Reflect.construct,_construct.apply(null,arguments)}e.exports=_construct},function(e,t,r){e.exports=r(67)},function(e,t,r){var n=r(62),a=r(27),i=r(63);e.exports=function _toConsumableArray(e){return n(e)||a(e)||i()}},function(e,t){function asyncGeneratorStep(e,t,r,n,a,i,o){try{var s=e[i](o),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,a)}e.exports=function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var i=e.apply(t,r);function _next(e){asyncGeneratorStep(i,n,a,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(i,n,a,_next,_throw,"throw",e)}_next(void 0)})}}},function(e,t,r){var n=r(28),a=r(65),i=r(29);e.exports=function _slicedToArray(e,t){return n(e)||a(e,t)||i()}},function(e,t,r){!function(r){"use strict";var n=function(e,t){var r=new Error(e+" at character "+t);throw r.index=t,r.description=e,r},a=!0,i={"-":a,"!":a,"~":a,"+":a},o={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},s={$:a,_:a},u=function(e){var t,r=0;for(var n in e)(t=n.length)>r&&e.hasOwnProperty(n)&&(r=t);return r},c=u(i),l=u(o),f={true:!0,false:!1,null:null},h=function(e){return o[e]||0},d=function(e,t,r){return{type:"||"===e||"&&"===e?"LogicalExpression":"BinaryExpression",operator:e,left:t,right:r}},p=function(e){return e>=48&&e<=57},m=function(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!o[String.fromCharCode(e)]||s.hasOwnProperty(String.fromCharCode(e))},_=function(e){return e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e>=128&&!o[String.fromCharCode(e)]||s.hasOwnProperty(String.fromCharCode(e))},v=function(e){for(var t,r,a=0,s=e.charAt,u=e.charCodeAt,v=function(t){return s.call(e,t)},y=function(t){return u.call(e,t)},g=e.length,b=function(){for(var e=y(a);32===e||9===e||10===e||13===e;)e=y(++a)},x=function(){var e,t,r=k();return b(),63!==y(a)?r:(a++,(e=x())||n("Expected expression",a),b(),58===y(a)?(a++,(t=x())||n("Expected expression",a),{type:"ConditionalExpression",test:r,consequent:e,alternate:t}):void n("Expected :",a))},w=function(){b();for(var t=e.substr(a,l),r=t.length;r>0;){if(o.hasOwnProperty(t)&&(!m(y(a))||a+t.length<e.length&&!_(y(a+t.length))))return a+=r,t;t=t.substr(0,--r)}return!1},k=function(){var e,t,r,i,o,s,u,c,l;if(s=T(),!(t=w()))return s;for(o={value:t,prec:h(t)},(u=T())||n("Expected expression after "+t,a),i=[s,o,u];(t=w())&&0!==(r=h(t));){for(o={value:t,prec:r},l=t;i.length>2&&r<=i[i.length-2].prec;)u=i.pop(),t=i.pop().value,s=i.pop(),e=d(t,s,u),i.push(e);(e=T())||n("Expected expression after "+l,a),i.push(o,e)}for(e=i[c=i.length-1];c>1;)e=d(i[c-1].value,i[c-2],e),c-=2;return e},T=function(){var t,r,n;if(b(),t=y(a),p(t)||46===t)return C();if(39===t||34===t)return E();if(91===t)return P();for(n=(r=e.substr(a,c)).length;n>0;){if(i.hasOwnProperty(r)&&(!m(y(a))||a+r.length<e.length&&!_(y(a+r.length))))return a+=n,{type:"UnaryExpression",operator:r,argument:T(),prefix:!0};r=r.substr(0,--n)}return!(!m(t)&&40!==t)&&S()},C=function(){for(var e,t,r="";p(y(a));)r+=v(a++);if(46===y(a))for(r+=v(a++);p(y(a));)r+=v(a++);if("e"===(e=v(a))||"E"===e){for(r+=v(a++),"+"!==(e=v(a))&&"-"!==e||(r+=v(a++));p(y(a));)r+=v(a++);p(y(a-1))||n("Expected exponent ("+r+v(a)+")",a)}return t=y(a),m(t)?n("Variable names cannot start with a number ("+r+v(a)+")",a):46===t&&n("Unexpected period",a),{type:"Literal",value:parseFloat(r),raw:r}},E=function(){for(var e,t="",r=v(a++),i=!1;a<g;){if((e=v(a++))===r){i=!0;break}if("\\"===e)switch(e=v(a++)){case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=e}else t+=e}return i||n('Unclosed quote after "'+t+'"',a),{type:"Literal",value:t,raw:r+t+r}},M=function(){var t,r=y(a),i=a;for(m(r)?a++:n("Unexpected "+v(a),a);a<g&&(r=y(a),_(r));)a++;return t=e.slice(i,a),f.hasOwnProperty(t)?{type:"Literal",value:f[t],raw:t}:"this"===t?{type:"ThisExpression"}:{type:"Identifier",name:t}},A=function(e){for(var t,r,i=[],o=!1,s=0;a<g;){if(b(),(t=y(a))===e){o=!0,a++,41===e&&s&&s>=i.length&&n("Unexpected token "+String.fromCharCode(e),a);break}if(44===t){if(a++,++s!==i.length)if(41===e)n("Unexpected token ,",a);else if(93===e)for(var u=i.length;u<s;u++)i.push(null)}else(r=x())&&"Compound"!==r.type||n("Expected comma",a),i.push(r)}return o||n("Expected "+String.fromCharCode(e),a),i},S=function(){var e,t;for(t=40===(e=y(a))?I():M(),b(),e=y(a);46===e||91===e||40===e;)a++,46===e?(b(),t={type:"MemberExpression",computed:!1,object:t,property:M()}):91===e?(t={type:"MemberExpression",computed:!0,object:t,property:x()},b(),93!==(e=y(a))&&n("Unclosed [",a),a++):40===e&&(t={type:"CallExpression",arguments:A(41),callee:t}),b(),e=y(a);return t},I=function(){a++;var e=x();if(b(),41===y(a))return a++,e;n("Unclosed (",a)},P=function(){return a++,{type:"ArrayExpression",elements:A(93)}},D=[];a<g;)59===(t=y(a))||44===t?a++:(r=x())?D.push(r):a<g&&n('Unexpected "'+v(a)+'"',a);return 1===D.length?D[0]:{type:"Compound",body:D}};v.version="0.3.4",v.toString=function(){return"JavaScript Expression Parser (JSEP) v"+v.version},v.addUnaryOp=function(e){return c=Math.max(e.length,c),i[e]=a,this},v.addBinaryOp=function(e,t){return l=Math.max(e.length,l),o[e]=t,this},v.addIdentifierChar=function(e){return s[e]=a,this},v.addLiteral=function(e,t){return f[e]=t,this},v.removeUnaryOp=function(e){return delete i[e],e.length===c&&(c=u(i)),this},v.removeAllUnaryOps=function(){return i={},c=0,this},v.removeIdentifierChar=function(e){return delete s[e],this},v.removeBinaryOp=function(e){return delete o[e],e.length===l&&(l=u(o)),this},v.removeAllBinaryOps=function(){return o={},l=0,this},v.removeLiteral=function(e){return delete f[e],this},v.removeAllLiterals=function(){return f={},this},void 0!==e&&e.exports?t=e.exports=v:t.parse=v}()},function(e,t){e.exports=function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){function _typeof2(e){return(_typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof2(e){return typeof e}:function _typeof2(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(t){return"function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?e.exports=_typeof=function _typeof(e){return _typeof2(e)}:e.exports=_typeof=function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)},_typeof(t)}e.exports=_typeof},function(e,t,r){var n=r(16);e.exports=function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),a.forEach(function(t){n(e,t,r[t])})}return e}},function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function _has(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)_has(r,n)&&(e[n]=r[n])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,r,n,a){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),a);else for(var i=0;i<n;i++)e[a+i]=t[r+i]},flattenChunks:function(e){var t,r,n,a,i,o;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(o=new Uint8Array(n),a=0,t=0,r=e.length;t<r;t++)i=e[t],o.set(i,a),a+=i.length;return o}},i={arraySet:function(e,t,r,n,a){for(var i=0;i<n;i++)e[a+i]=t[r+i]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,i))},t.setTyped(n)},function(e,t){e.exports=function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},function(e,t,r){r(0);var n=r(30),a=r(16);function set(e,t,r,i){return(set="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function set(e,t,r,i){var o,s=n(e,t);if(s){if((o=Object.getOwnPropertyDescriptor(s,t)).set)return o.set.call(i,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(i,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(i,t,o)}else a(i,t,r);return!0})(e,t,r,i)}e.exports=function _set(e,t,r,n,a){if(!set(e,t,r,n||e)&&a)throw new Error("failed to set property");return r}},function(e){e.exports={a:"1.4.6"}},function(e,t){e.exports='#ifndef CIELAB_TO_SRGBA\n#define CIELAB_TO_SRGBA\n\nconst mat3 XYZ_2_RGB = (mat3(\n    3.2404542,-1.5371385,-0.4985314,\n    -0.9692660, 1.8760108, 0.0415560,\n    0.0556434,-0.2040259, 1.0572252\n));\nconst float SRGB_GAMMA = 1.0 / 2.2;\n\nvec3 rgb_to_srgb_approx(vec3 rgb) {\n    return pow(rgb, vec3(SRGB_GAMMA));\n}\n\nfloat f1(float t){\n    const float sigma = 6./29.;\n    if (t>sigma){\n        return t*t*t;\n    }else{\n        return 3.*sigma*sigma*(t-4./29.);\n    }\n}\n\nvec3 cielabtoxyz(vec3 c) {\n    const float xn = 95.047/100.;\n    const float yn = 100./100.;\n    const float zn = 108.883/100.;\n    return vec3(xn*f1((c.x+16.)/116.  + c.y/500. ),\n                yn*f1((c.x+16.)/116.),\n                zn*f1((c.x+16.)/116.  - c.z/200. )\n            );\n}\n\nvec3 xyztorgb(vec3 c){\n    return c * XYZ_2_RGB;\n}\n\nvec3 xyztosrgb(vec3 c) { // FIXME naming\n    return rgb_to_srgb_approx(xyztorgb(c));\n}\n\nvec4 cielabToSRGBA(vec4 cielab){\n    return vec4(xyztosrgb(cielabtoxyz(\n        vec3(\n            clamp(cielab.r, 0., 100.),\n            clamp(cielab.g, -128., 128.),\n            clamp(cielab.b, -128., 128.)\n        )\n    )), cielab.a);\n}\n#endif\n\n\n#ifndef SRGBA_TO_CIELAB\n#define SRGBA_TO_CIELAB\nvec4 sRGBToXYZ (vec4 srgba);\nvec4 sRGBToLinearRGB (vec4 srgba);\nfloat inverseGammaCorrection(float t);\nvec4 XYZToCieLab (vec4 xyza);\nfloat XYZToCieLabAux(float t);\n\nvec4 sRGBAToCieLAB(vec4 srgba){\n    return XYZToCieLab(sRGBToXYZ(srgba));\n}\n\n// Convert sRGB to CIE XYZ with the D65 white point\nvec4 sRGBToXYZ (vec4 srgba) {\n    // Poynton, "Frequently Asked Questions About Color," page 10\n    // Wikipedia: http://en.wikipedia.org/wiki/SRGB\n    // Wikipedia: http://en.wikipedia.org/wiki/CIE_1931_color_space\n    vec4 rgba = sRGBToLinearRGB(srgba);\n    return vec4(\n        (0.4123955889674142161 * rgba.r + 0.3575834307637148171 * rgba.g + 0.1804926473817015735 * rgba.b),\n        (0.2125862307855955516 * rgba.r + 0.7151703037034108499 * rgba.g + 0.07220049864333622685 * rgba.b),\n        (0.01929721549174694484 * rgba.r + 0.1191838645808485318 * rgba.g + 0.9504971251315797660 * rgba.b),\n        rgba.a\n    );\n}\n\nvec4 sRGBToLinearRGB (vec4 srgba) {\n    // http://en.wikipedia.org/wiki/SRGB\n    return vec4(\n        inverseGammaCorrection(srgba.r),\n        inverseGammaCorrection(srgba.g),\n        inverseGammaCorrection(srgba.b),\n        srgba.a\n    );\n}\n\nfloat inverseGammaCorrection(float t) {\n    return t <= 0.0404482362771076 ? t / 12.92 : pow((t + 0.055) / 1.055, 2.4);\n}\n\n\nfloat WHITEPOINT_D65_X = 0.950456;\nfloat WHITEPOINT_D65_Y = 1.0;\nfloat WHITEPOINT_D65_Z = 1.088754;\n\n// Convert CIE XYZ to CIE L*a*b* (CIELAB) with the D65 white point\nvec4 XYZToCieLab (vec4 xyza) {\n    // Wikipedia: http://en.wikipedia.org/wiki/Lab_color_space\n\n    float xn = WHITEPOINT_D65_X;\n    float yn = WHITEPOINT_D65_Y;\n    float zn = WHITEPOINT_D65_Z;\n\n    return vec4(\n        116. * XYZToCieLabAux(xyza.y / yn) - 16.,\n        500. * (XYZToCieLabAux(xyza.x / xn) - XYZToCieLabAux(xyza.y / yn)),\n        200. * (XYZToCieLabAux(xyza.y / yn) - XYZToCieLabAux(xyza.z / zn)),\n        xyza.a\n    );\n}\n\nfloat XYZToCieLabAux(float t) {\n    return t >= 8.85645167903563082e-3\n            ? pow(t, 0.333333333333333) : (841.0 / 108.0) * t + 4.0 / 29.0;\n}\n\n#endif\n'},function(e,t,r){"use strict";e.exports=LRUCache;var n,a=r(72),i=r(74),o=r(78),s=(n="function"==typeof Symbol?function(e){return Symbol(e)}:function(e){return"_"+e})("max"),u=n("length"),c=n("lengthCalculator"),l=n("allowStale"),f=n("maxAge"),h=n("dispose"),d=n("noDisposeOnSet"),p=n("lruList"),m=n("cache");function naiveLength(){return 1}function LRUCache(e){if(!(this instanceof LRUCache))return new LRUCache(e);"number"==typeof e&&(e={max:e}),e||(e={});var t=this[s]=e.max;(!t||"number"!=typeof t||t<=0)&&(this[s]=1/0);var r=e.length||naiveLength;"function"!=typeof r&&(r=naiveLength),this[c]=r,this[l]=e.stale||!1,this[f]=e.maxAge||0,this[h]=e.dispose,this[d]=e.noDisposeOnSet||!1,this.reset()}function forEachStep(e,t,r,n){var a=r.value;isStale(e,a)&&(del(e,r),e[l]||(a=void 0)),a&&t.call(n,a.value,a.key,e)}function get(e,t,r){var n=e[m].get(t);if(n){var a=n.value;isStale(e,a)?(del(e,n),e[l]||(a=void 0)):r&&e[p].unshiftNode(n),a&&(a=a.value)}return a}function isStale(e,t){if(!t||!t.maxAge&&!e[f])return!1;var r=Date.now()-t.now;return t.maxAge?r>t.maxAge:e[f]&&r>e[f]}function trim(e){if(e[u]>e[s])for(var t=e[p].tail;e[u]>e[s]&&null!==t;){var r=t.prev;del(e,t),t=r}}function del(e,t){if(t){var r=t.value;e[h]&&e[h](r.key,r.value),e[u]-=r.length,e[m].delete(r.key),e[p].removeNode(t)}}Object.defineProperty(LRUCache.prototype,"max",{set:function(e){(!e||"number"!=typeof e||e<=0)&&(e=1/0),this[s]=e,trim(this)},get:function(){return this[s]},enumerable:!0}),Object.defineProperty(LRUCache.prototype,"allowStale",{set:function(e){this[l]=!!e},get:function(){return this[l]},enumerable:!0}),Object.defineProperty(LRUCache.prototype,"maxAge",{set:function(e){(!e||"number"!=typeof e||e<0)&&(e=0),this[f]=e,trim(this)},get:function(){return this[f]},enumerable:!0}),Object.defineProperty(LRUCache.prototype,"lengthCalculator",{set:function(e){"function"!=typeof e&&(e=naiveLength),e!==this[c]&&(this[c]=e,this[u]=0,this[p].forEach(function(e){e.length=this[c](e.value,e.key),this[u]+=e.length},this)),trim(this)},get:function(){return this[c]},enumerable:!0}),Object.defineProperty(LRUCache.prototype,"length",{get:function(){return this[u]},enumerable:!0}),Object.defineProperty(LRUCache.prototype,"itemCount",{get:function(){return this[p].length},enumerable:!0}),LRUCache.prototype.rforEach=function(e,t){t=t||this;for(var r=this[p].tail;null!==r;){var n=r.prev;forEachStep(this,e,r,t),r=n}},LRUCache.prototype.forEach=function(e,t){t=t||this;for(var r=this[p].head;null!==r;){var n=r.next;forEachStep(this,e,r,t),r=n}},LRUCache.prototype.keys=function(){return this[p].toArray().map(function(e){return e.key},this)},LRUCache.prototype.values=function(){return this[p].toArray().map(function(e){return e.value},this)},LRUCache.prototype.reset=function(){this[h]&&this[p]&&this[p].length&&this[p].forEach(function(e){this[h](e.key,e.value)},this),this[m]=new a,this[p]=new o,this[u]=0},LRUCache.prototype.dump=function(){return this[p].map(function(e){if(!isStale(this,e))return{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}},this).toArray().filter(function(e){return e})},LRUCache.prototype.dumpLru=function(){return this[p]},LRUCache.prototype.inspect=function(e,t){var r="LRUCache {",n=!1;this[l]&&(r+="\n  allowStale: true",n=!0);var a=this[s];a&&a!==1/0&&(n&&(r+=","),r+="\n  max: "+i.inspect(a,t),n=!0);var o=this[f];o&&(n&&(r+=","),r+="\n  maxAge: "+i.inspect(o,t),n=!0);var h=this[c];h&&h!==naiveLength&&(n&&(r+=","),r+="\n  length: "+i.inspect(this[u],t),n=!0);var d=!1;return this[p].forEach(function(e){d?r+=",\n  ":(n&&(r+=",\n"),d=!0,r+="\n  ");var a=i.inspect(e.key).split("\n").join("\n  "),s={value:e.value};e.maxAge!==o&&(s.maxAge=e.maxAge),h!==naiveLength&&(s.length=e.length),isStale(this,e)&&(s.stale=!0),s=i.inspect(s,t).split("\n").join("\n  "),r+=a+" => "+s}),(d||n)&&(r+="\n"),r+="}"},LRUCache.prototype.set=function(e,t,r){var n=(r=r||this[f])?Date.now():0,a=this[c](t,e);if(this[m].has(e)){if(a>this[s])return del(this,this[m].get(e)),!1;var i=this[m].get(e).value;return this[h]&&(this[d]||this[h](e,i.value)),i.now=n,i.maxAge=r,i.value=t,this[u]+=a-i.length,i.length=a,this.get(e),trim(this),!0}var o=new function Entry(e,t,r,n,a){this.key=e,this.value=t,this.length=r,this.now=n,this.maxAge=a||0}(e,t,a,n,r);return o.length>this[s]?(this[h]&&this[h](e,t),!1):(this[u]+=o.length,this[p].unshift(o),this[m].set(e,this[p].head),trim(this),!0)},LRUCache.prototype.has=function(e){return!!this[m].has(e)&&!isStale(this,this[m].get(e).value)},LRUCache.prototype.get=function(e){return get(this,e,!0)},LRUCache.prototype.peek=function(e){return get(this,e,!1)},LRUCache.prototype.pop=function(){var e=this[p].tail;return e?(del(this,e),e.value):null},LRUCache.prototype.del=function(e){del(this,this[m].get(e))},LRUCache.prototype.load=function(e){this.reset();for(var t=Date.now(),r=e.length-1;r>=0;r--){var n=e[r],a=n.e||0;if(0===a)this.set(n.k,n.v);else{var i=a-t;i>0&&this.set(n.k,n.v,i)}}},LRUCache.prototype.prune=function(){var e=this;this[m].forEach(function(t,r){get(e,r,!1)})}},function(e,t,r){e.exports=function(){return r(79)('/*!\n * CARTO VL js https://carto.com/\n * Version: 1.4.6\n * \n */!function(e){var t={};function __webpack_require__(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,__webpack_require__),n.l=!0,n.exports}__webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,r){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(__webpack_require__.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)__webpack_require__.d(r,n,function(t){return e[t]}.bind(null,n));return r},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=57)}([function(e,t){e.exports=function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}},function(e,t){function _getPrototypeOf(t){return e.exports=_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(t)}e.exports=_getPrototypeOf},function(e,t,r){e.exports=r(37)},function(e,t,r){var n=r(10),a=r(42);e.exports=function _possibleConstructorReturn(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?a(e):t}},function(e,t,r){var n=r(14);e.exports=function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}},function(e,t,r){var n=r(34),a=r(35),i=r(36);e.exports=function _slicedToArray(e,t){return n(e)||a(e,t)||i()}},function(e,t){function asyncGeneratorStep(e,t,r,n,a,i,o){try{var s=e[i](o),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,a)}e.exports=function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var i=e.apply(t,r);function _next(e){asyncGeneratorStep(i,n,a,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(i,n,a,_next,_throw,"throw",e)}_next(void 0)})}}},function(e,t,r){var n=r(46),a=r(47),i=r(48);e.exports=function _toConsumableArray(e){return n(e)||a(e)||i()}},function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function _has(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)_has(r,n)&&(e[n]=r[n])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,r,n,a){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),a);else for(var i=0;i<n;i++)e[a+i]=t[r+i]},flattenChunks:function(e){var t,r,n,a,i,o;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(o=new Uint8Array(n),a=0,t=0,r=e.length;t<r;t++)i=e[t],o.set(i,a),a+=i.length;return o}},i={arraySet:function(e,t,r,n,a){for(var i=0;i<n;i++)e[a+i]=t[r+i]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,i))},t.setTyped(n)},function(e,t){function _typeof2(e){return(_typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof2(e){return typeof e}:function _typeof2(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(t){return"function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?e.exports=_typeof=function _typeof(e){return _typeof2(e)}:e.exports=_typeof=function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)},_typeof(t)}e.exports=_typeof},function(e,t,r){r(2);var n=r(45);function _get(t,r,a){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=_get=Reflect.get:e.exports=_get=function _get(e,t,r){var a=n(e,t);if(a){var i=Object.getOwnPropertyDescriptor(a,t);return i.get?i.get.call(r):i.value}},_get(t,r,a||t)}e.exports=_get},function(e,t,r){e.exports.VectorTile=r(39),e.exports.VectorTileFeature=r(17),e.exports.VectorTileLayer=r(16)},function(e,t,r){"use strict";e.exports=Pbf;var n=r(41);function Pbf(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Pbf.Varint=0,Pbf.Fixed64=1,Pbf.Bytes=2,Pbf.Fixed32=5;function readPackedEnd(e){return e.type===Pbf.Bytes?e.readVarint()+e.pos:e.pos+1}function toNum(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function makeRoomForExtraLength(e,t,r){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.ceil(Math.log(t)/(7*Math.LN2));r.realloc(n);for(var a=r.pos-1;a>=e;a--)r.buf[a+n]=r.buf[a]}function writePackedVarint(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function writePackedSVarint(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function writePackedFloat(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function writePackedDouble(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function writePackedBoolean(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function writePackedFixed32(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function writePackedSFixed32(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function writePackedFixed64(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function writePackedSFixed64(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function readUInt32(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function writeInt32(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function readInt32(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}Pbf.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),a=n>>3,i=this.pos;this.type=7&n,e(a,t,this),this.pos===i&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=readUInt32(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=readInt32(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=readUInt32(this.buf,this.pos)+4294967296*readUInt32(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=readUInt32(this.buf,this.pos)+4294967296*readInt32(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,n=this.buf;return t=127&(r=n[this.pos++]),r<128?t:(t|=(127&(r=n[this.pos++]))<<7,r<128?t:(t|=(127&(r=n[this.pos++]))<<14,r<128?t:(t|=(127&(r=n[this.pos++]))<<21,r<128?t:function readVarintRemainder(e,t,r){var n,a,i=r.buf;if(a=i[r.pos++],n=(112&a)>>4,a<128)return toNum(e,n,t);if(a=i[r.pos++],n|=(127&a)<<3,a<128)return toNum(e,n,t);if(a=i[r.pos++],n|=(127&a)<<10,a<128)return toNum(e,n,t);if(a=i[r.pos++],n|=(127&a)<<17,a<128)return toNum(e,n,t);if(a=i[r.pos++],n|=(127&a)<<24,a<128)return toNum(e,n,t);if(a=i[r.pos++],n|=(1&a)<<31,a<128)return toNum(e,n,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=n[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=function readUtf8(e,t,r){var n="",a=t;for(;a<r;){var i,o,s,u=e[a],c=null,l=u>239?4:u>223?3:u>191?2:1;if(a+l>r)break;1===l?u<128&&(c=u):2===l?128==(192&(i=e[a+1]))&&(c=(31&u)<<6|63&i)<=127&&(c=null):3===l?(i=e[a+1],o=e[a+2],128==(192&i)&&128==(192&o)&&((c=(15&u)<<12|(63&i)<<6|63&o)<=2047||c>=55296&&c<=57343)&&(c=null)):4===l&&(i=e[a+1],o=e[a+2],s=e[a+3],128==(192&i)&&128==(192&o)&&128==(192&s)&&((c=(15&u)<<18|(63&i)<<12|(63&o)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,l=1):c>65535&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),a+=l}return n}(this.buf,this.pos,e);return this.pos=e,t},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){var r=readPackedEnd(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Pbf.Varint)for(;this.buf[this.pos++]>127;);else if(t===Pbf.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Pbf.Fixed32)this.pos+=4;else{if(t!==Pbf.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),writeInt32(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),writeInt32(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),writeInt32(this.buf,-1&e,this.pos),writeInt32(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),writeInt32(this.buf,-1&e,this.pos),writeInt32(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function writeBigVarint(e,t){var r,n;e>=0?(r=e%4294967296|0,n=e/4294967296|0):(n=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,n=n+1|0));if(e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn\'t fit into 10 bytes");t.realloc(10),function writeBigVarintLow(e,t,r){r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos]=127&e}(r,0,t),function writeBigVarintHigh(e,t){var r=(7&e)<<4;if(t.buf[t.pos++]|=r|((e>>>=3)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;t.buf[t.pos++]=127&e}(n,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function writeUtf8(e,t,r){for(var n,a,i=0;i<t.length;i++){if((n=t.charCodeAt(i))>55295&&n<57344){if(!a){n>56319||i+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):a=n;continue}if(n<56320){e[r++]=239,e[r++]=191,e[r++]=189,a=n;continue}n=a-55296<<10|n-56320|65536,a=null}else a&&(e[r++]=239,e[r++]=191,e[r++]=189,a=null);n<128?e[r++]=n:(n<2048?e[r++]=n>>6|192:(n<65536?e[r++]=n>>12|224:(e[r++]=n>>18|240,e[r++]=n>>12&63|128),e[r++]=n>>6&63|128),e[r++]=63&n|128)}return r}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&makeRoomForExtraLength(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),n.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),n.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var n=this.pos-r;n>=128&&makeRoomForExtraLength(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,r){this.writeTag(e,Pbf.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){this.writeMessage(e,writePackedVarint,t)},writePackedSVarint:function(e,t){this.writeMessage(e,writePackedSVarint,t)},writePackedBoolean:function(e,t){this.writeMessage(e,writePackedBoolean,t)},writePackedFloat:function(e,t){this.writeMessage(e,writePackedFloat,t)},writePackedDouble:function(e,t){this.writeMessage(e,writePackedDouble,t)},writePackedFixed32:function(e,t){this.writeMessage(e,writePackedFixed32,t)},writePackedSFixed32:function(e,t){this.writeMessage(e,writePackedSFixed32,t)},writePackedFixed64:function(e,t){this.writeMessage(e,writePackedFixed64,t)},writePackedSFixed64:function(e,t){this.writeMessage(e,writePackedSFixed64,t)},writeBytesField:function(e,t){this.writeTag(e,Pbf.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Pbf.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Pbf.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Pbf.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Pbf.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Pbf.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Pbf.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Pbf.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Pbf.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Pbf.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}}},function(e,t){function _setPrototypeOf(t,r){return e.exports=_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e},_setPrototypeOf(t,r)}e.exports=_setPrototypeOf},function(e,t,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,r){"use strict";var n=r(17);function VectorTileLayer(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(readLayer,this,t),this.length=this._features.length}function readLayer(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function readValueMessage(e){var t=null,r=e.readVarint()+e.pos;for(;e.pos<r;){var n=e.readVarint()>>3;t=1===n?e.readString():2===n?e.readFloat():3===n?e.readDouble():4===n?e.readVarint64():5===n?e.readVarint():6===n?e.readSVarint():7===n?e.readBoolean():null}return t}(r))}e.exports=VectorTileLayer,VectorTileLayer.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,t,this.extent,this._keys,this._values)}},function(e,t,r){"use strict";var n=r(40);function VectorTileFeature(e,t,r,n,a){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=a,e.readFields(readFeature,this,t)}function readFeature(e,t,r){1==e?t.id=r.readVarint():2==e?function readTag(e,t){var r=e.readVarint()+e.pos;for(;e.pos<r;){var n=t._keys[e.readVarint()],a=t._values[e.readVarint()];t.properties[n]=a}}(r,t):3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos)}function signedArea(e){for(var t,r,n=0,a=0,i=e.length,o=i-1;a<i;o=a++)t=e[a],n+=((r=e[o]).x-t.x)*(t.y+r.y);return n}e.exports=VectorTileFeature,VectorTileFeature.types=["Unknown","Point","LineString","Polygon"],VectorTileFeature.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,a=1,i=0,o=0,s=0,u=[];e.pos<r;){if(i<=0){var c=e.readVarint();a=7&c,i=c>>3}if(i--,1===a||2===a)o+=e.readSVarint(),s+=e.readSVarint(),1===a&&(t&&u.push(t),t=[]),t.push(new n(o,s));else{if(7!==a)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&u.push(t),u},VectorTileFeature.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,n=0,a=0,i=0,o=1/0,s=-1/0,u=1/0,c=-1/0;e.pos<t;){if(n<=0){var l=e.readVarint();r=7&l,n=l>>3}if(n--,1===r||2===r)a+=e.readSVarint(),i+=e.readSVarint(),a<o&&(o=a),a>s&&(s=a),i<u&&(u=i),i>c&&(c=i);else if(7!==r)throw new Error("unknown command "+r)}return[o,u,s,c]},VectorTileFeature.prototype.toGeoJSON=function(e,t,r){var n,a,i=this.extent*Math.pow(2,r),o=this.extent*e,s=this.extent*t,u=this.loadGeometry(),c=VectorTileFeature.types[this.type];function project(e){for(var t=0;t<e.length;t++){var r=e[t],n=180-360*(r.y+s)/i;e[t]=[360*(r.x+o)/i-180,360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90]}}switch(this.type){case 1:var l=[];for(n=0;n<u.length;n++)l[n]=u[n][0];project(u=l);break;case 2:for(n=0;n<u.length;n++)project(u[n]);break;case 3:for(u=function classifyRings(e){var t=e.length;if(t<=1)return[e];for(var r,n,a=[],i=0;i<t;i++){var o=signedArea(e[i]);0!==o&&(void 0===n&&(n=o<0),n===o<0?(r&&a.push(r),r=[e[i]]):r.push(e[i]))}r&&a.push(r);return a}(u),n=0;n<u.length;n++)for(a=0;a<u[n].length;a++)project(u[n][a])}1===u.length?u=u[0]:c="Multi"+c;var f={type:"Feature",geometry:{type:c,coordinates:u},properties:this.properties};return"id"in this&&(f.id=this.id),f}},function(e,t,r){"use strict";e.exports=function adler32(e,t,r,n){for(var a=65535&e|0,i=e>>>16&65535|0,o=0;0!==r;){r-=o=r>2e3?2e3:r;do{i=i+(a=a+t[n++]|0)|0}while(--o);a%=65521,i%=65521}return a|i<<16|0}},function(e,t,r){"use strict";var n=function makeTable(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();e.exports=function crc32(e,t,r,a){var i=n,o=a+r;e^=-1;for(var s=a;s<o;s++)e=e>>>8^i[255&(e^t[s])];return-1^e}},function(e,t,r){"use strict";var n=r(9),a=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch(e){a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){i=!1}for(var o=new n.Buf8(256),s=0;s<256;s++)o[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function buf2binstring(e,t){if(t<65534&&(e.subarray&&i||!e.subarray&&a))return String.fromCharCode.apply(null,n.shrinkBuf(e,t));for(var r="",o=0;o<t;o++)r+=String.fromCharCode(e[o]);return r}o[254]=o[254]=1,t.string2buf=function(e){var t,r,a,i,o,s=e.length,u=0;for(i=0;i<s;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(a=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(a-56320),i++),u+=r<128?1:r<2048?2:r<65536?3:4;for(t=new n.Buf8(u),o=0,i=0;o<u;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(a=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(a-56320),i++),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|63&r):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},t.buf2binstring=function(e){return buf2binstring(e,e.length)},t.binstring2buf=function(e){for(var t=new n.Buf8(e.length),r=0,a=t.length;r<a;r++)t[r]=e.charCodeAt(r);return t},t.buf2string=function(e,t){var r,n,a,i,s=t||e.length,u=new Array(2*s);for(n=0,r=0;r<s;)if((a=e[r++])<128)u[n++]=a;else if((i=o[a])>4)u[n++]=65533,r+=i-1;else{for(a&=2===i?31:3===i?15:7;i>1&&r<s;)a=a<<6|63&e[r++],i--;i>1?u[n++]=65533:a<65536?u[n++]=a:(a-=65536,u[n++]=55296|a>>10&1023,u[n++]=56320|1023&a)}return buf2binstring(u,n)},t.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0?t:0===r?t:r+o[e[r]]>t?r:t}},function(e,t,r){"use strict";e.exports=function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,r){var n=r(2),a=r(14),i=r(43),o=r(44);function _wrapNativeSuper(t){var r="function"==typeof Map?new Map:void 0;return e.exports=_wrapNativeSuper=function _wrapNativeSuper(e){if(null===e||!i(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,Wrapper)}function Wrapper(){return o(e,arguments,n(this).constructor)}return Wrapper.prototype=Object.create(e.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),a(Wrapper,e)},_wrapNativeSuper(t)}e.exports=_wrapNativeSuper},function(e,t,r){"use strict";function earcut(e,t,r){r=r||2;var n,a,i,o,s,u,c,l=t&&t.length,f=l?t[0]*r:e.length,h=linkedList(e,0,f,r,!0),d=[];if(!h)return d;if(l&&(h=function eliminateHoles(e,t,r,n){var a,i,o,s,u,c=[];for(a=0,i=t.length;a<i;a++)o=t[a]*n,s=a<i-1?t[a+1]*n:e.length,(u=linkedList(e,o,s,n,!1))===u.next&&(u.steiner=!0),c.push(getLeftmost(u));for(c.sort(compareX),a=0;a<c.length;a++)eliminateHole(c[a],r),r=filterPoints(r,r.next);return r}(e,t,h,r)),e.length>80*r){n=i=e[0],a=o=e[1];for(var p=r;p<f;p+=r)s=e[p],u=e[p+1],s<n&&(n=s),u<a&&(a=u),s>i&&(i=s),u>o&&(o=u);c=0!==(c=Math.max(i-n,o-a))?1/c:0}return earcutLinked(h,d,r,n,a,c),d}function linkedList(e,t,r,n,a){var i,o;if(a===signedArea(e,t,r,n)>0)for(i=t;i<r;i+=n)o=insertNode(i,e[i],e[i+1],o);else for(i=r-n;i>=t;i-=n)o=insertNode(i,e[i],e[i+1],o);return o&&equals(o,o.next)&&(removeNode(o),o=o.next),o}function filterPoints(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!equals(n,n.next)&&0!==area(n.prev,n,n.next))n=n.next;else{if(removeNode(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function earcutLinked(e,t,r,n,a,i,o){if(e){!o&&i&&function indexCurve(e,t,r,n){var a=e;do{null===a.z&&(a.z=zOrder(a.x,a.y,t,r,n)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next}while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,function sortLinked(e){var t,r,n,a,i,o,s,u,c=1;do{for(r=e,e=null,i=null,o=0;r;){for(o++,n=r,s=0,t=0;t<c&&(s++,n=n.nextZ);t++);for(u=c;s>0||u>0&&n;)0!==s&&(0===u||!n||r.z<=n.z)?(a=r,r=r.nextZ,s--):(a=n,n=n.nextZ,u--),i?i.nextZ=a:e=a,a.prevZ=i,i=a;r=n}i.nextZ=null,c*=2}while(o>1);return e}(a)}(e,n,a,i);for(var s,u,c=e;e.prev!==e.next;)if(s=e.prev,u=e.next,i?isEarHashed(e,n,a,i):isEar(e))t.push(s.i/r),t.push(e.i/r),t.push(u.i/r),removeNode(e),e=u.next,c=u.next;else if((e=u)===c){o?1===o?earcutLinked(e=cureLocalIntersections(e,t,r),t,r,n,a,i,2):2===o&&splitEarcut(e,t,r,n,a,i):earcutLinked(filterPoints(e),t,r,n,a,i,1);break}}}function isEar(e){var t=e.prev,r=e,n=e.next;if(area(t,r,n)>=0)return!1;for(var a=e.next.next;a!==e.prev;){if(pointInTriangle(t.x,t.y,r.x,r.y,n.x,n.y,a.x,a.y)&&area(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function isEarHashed(e,t,r,n){var a=e.prev,i=e,o=e.next;if(area(a,i,o)>=0)return!1;for(var s=a.x<i.x?a.x<o.x?a.x:o.x:i.x<o.x?i.x:o.x,u=a.y<i.y?a.y<o.y?a.y:o.y:i.y<o.y?i.y:o.y,c=a.x>i.x?a.x>o.x?a.x:o.x:i.x>o.x?i.x:o.x,l=a.y>i.y?a.y>o.y?a.y:o.y:i.y>o.y?i.y:o.y,f=zOrder(s,u,t,r,n),h=zOrder(c,l,t,r,n),d=e.prevZ,p=e.nextZ;d&&d.z>=f&&p&&p.z<=h;){if(d!==e.prev&&d!==e.next&&pointInTriangle(a.x,a.y,i.x,i.y,o.x,o.y,d.x,d.y)&&area(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,p!==e.prev&&p!==e.next&&pointInTriangle(a.x,a.y,i.x,i.y,o.x,o.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;d&&d.z>=f;){if(d!==e.prev&&d!==e.next&&pointInTriangle(a.x,a.y,i.x,i.y,o.x,o.y,d.x,d.y)&&area(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=h;){if(p!==e.prev&&p!==e.next&&pointInTriangle(a.x,a.y,i.x,i.y,o.x,o.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function cureLocalIntersections(e,t,r){var n=e;do{var a=n.prev,i=n.next.next;!equals(a,i)&&intersects(a,n,n.next,i)&&locallyInside(a,i)&&locallyInside(i,a)&&(t.push(a.i/r),t.push(n.i/r),t.push(i.i/r),removeNode(n),removeNode(n.next),n=e=i),n=n.next}while(n!==e);return n}function splitEarcut(e,t,r,n,a,i){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&isValidDiagonal(o,s)){var u=splitPolygon(o,s);return o=filterPoints(o,o.next),u=filterPoints(u,u.next),earcutLinked(o,t,r,n,a,i),void earcutLinked(u,t,r,n,a,i)}s=s.next}o=o.next}while(o!==e)}function compareX(e,t){return e.x-t.x}function eliminateHole(e,t){if(t=function findHoleBridge(e,t){var r,n=t,a=e.x,i=e.y,o=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var s=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=a&&s>o){if(o=s,s===a){if(i===n.y)return n;if(i===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(a===o)return r.prev;var u,c=r,l=r.x,f=r.y,h=1/0;n=r.next;for(;n!==c;)a>=n.x&&n.x>=l&&a!==n.x&&pointInTriangle(i<f?a:o,i,l,f,i<f?o:a,i,n.x,n.y)&&((u=Math.abs(i-n.y)/(a-n.x))<h||u===h&&n.x>r.x)&&locallyInside(n,e)&&(r=n,h=u),n=n.next;return r}(e,t)){var r=splitPolygon(t,e);filterPoints(r,r.next)}}function zOrder(e,t,r,n,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*a)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*a)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function getLeftmost(e){var t=e,r=e;do{t.x<r.x&&(r=t),t=t.next}while(t!==e);return r}function pointInTriangle(e,t,r,n,a,i,o,s){return(a-o)*(t-s)-(e-o)*(i-s)>=0&&(e-o)*(n-s)-(r-o)*(t-s)>=0&&(r-o)*(i-s)-(a-o)*(n-s)>=0}function isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function intersectsPolygon(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&intersects(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&locallyInside(e,t)&&locallyInside(t,e)&&function middleInside(e,t){var r=e,n=!1,a=(e.x+t.x)/2,i=(e.y+t.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&a<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)}function area(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function equals(e,t){return e.x===t.x&&e.y===t.y}function intersects(e,t,r,n){return!!(equals(e,t)&&equals(r,n)||equals(e,n)&&equals(r,t))||area(e,t,r)>0!=area(e,t,n)>0&&area(r,n,e)>0!=area(r,n,t)>0}function locallyInside(e,t){return area(e.prev,e,e.next)<0?area(e,t,e.next)>=0&&area(e,e.prev,t)>=0:area(e,t,e.prev)<0||area(e,e.next,t)<0}function splitPolygon(e,t){var r=new Node(e.i,e.x,e.y),n=new Node(t.i,t.x,t.y),a=e.next,i=t.prev;return e.next=t,t.prev=e,r.next=a,a.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function insertNode(e,t,r,n){var a=new Node(e,t,r);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(e,t,r,n){for(var a=0,i=t,o=r-n;i<r;i+=n)a+=(e[o]-e[i])*(e[i+1]+e[o+1]),o=i;return a}e.exports=earcut,e.exports.default=earcut,earcut.deviation=function(e,t,r,n){var a=t&&t.length,i=a?t[0]*r:e.length,o=Math.abs(signedArea(e,0,i,r));if(a)for(var s=0,u=t.length;s<u;s++){var c=t[s]*r,l=s<u-1?t[s+1]*r:e.length;o-=Math.abs(signedArea(e,c,l,r))}var f=0;for(s=0;s<n.length;s+=3){var h=n[s]*r,d=n[s+1]*r,p=n[s+2]*r;f+=Math.abs((e[h]-e[p])*(e[d+1]-e[h+1])-(e[h]-e[d])*(e[p+1]-e[h+1]))}return 0===o&&0===f?0:Math.abs((f-o)/o)},earcut.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,a=0;a<e.length;a++){for(var i=0;i<e[a].length;i++)for(var o=0;o<t;o++)r.vertices.push(e[a][i][o]);a>0&&(n+=e[a-1].length,r.holes.push(n))}return r}},function(e,t){!function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(256),n=0;n<e.length;n++)r[e.charCodeAt(n)]=n;t.encode=function(t){var r,n=new Uint8Array(t),a=n.length,i="";for(r=0;r<a;r+=3)i+=e[n[r]>>2],i+=e[(3&n[r])<<4|n[r+1]>>4],i+=e[(15&n[r+1])<<2|n[r+2]>>6],i+=e[63&n[r+2]];return a%3==2?i=i.substring(0,i.length-1)+"=":a%3==1&&(i=i.substring(0,i.length-2)+"=="),i},t.decode=function(e){var t,n,a,i,o,s=.75*e.length,u=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var l=new ArrayBuffer(s),f=new Uint8Array(l);for(t=0;t<u;t+=4)n=r[e.charCodeAt(t)],a=r[e.charCodeAt(t+1)],i=r[e.charCodeAt(t+2)],o=r[e.charCodeAt(t+3)],f[c++]=n<<2|a>>4,f[c++]=(15&a)<<4|i>>2,f[c++]=(3&i)<<6|63&o;return l}}()},function(e,t,r){"use strict";var n={};(0,r(9).assign)(n,r(49),r(52),r(22)),e.exports=n},,,,,,,,function(e,t){e.exports=function _arrayWithHoles(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function _iterableToArrayLimit(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}},function(e,t){e.exports=function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,r){var n=function(){return this||"object"==typeof self&&self}()||Function("return this")(),a=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,i=a&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=r(38),a)n.regeneratorRuntime=i;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var r,n=Object.prototype,a=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag",c="object"==typeof e,l=t.regeneratorRuntime;if(l)c&&(e.exports=l);else{(l=t.regeneratorRuntime=c?e.exports:{}).wrap=wrap;var f="suspendedStart",h="suspendedYield",d="executing",p="completed",_={},y={};y[o]=function(){return this};var m=Object.getPrototypeOf,v=m&&m(m(values([])));v&&v!==n&&a.call(v,o)&&(y=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(y);GeneratorFunction.prototype=g.constructor=GeneratorFunctionPrototype,GeneratorFunctionPrototype.constructor=GeneratorFunction,GeneratorFunctionPrototype[u]=GeneratorFunction.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(g),e},l.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),AsyncIterator.prototype[s]=function(){return this},l.AsyncIterator=AsyncIterator,l.async=function(e,t,r,n){var a=new AsyncIterator(wrap(e,t,r,n));return l.isGeneratorFunction(t)?a:a.next().then(function(e){return e.done?e.value:a.next()})},defineIteratorMethods(g),g[u]="Generator",g[o]=function(){return this},g.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function next(){for(;t.length;){var r=t.pop();if(r in e)return next.value=r,next.done=!1,next}return next.done=!0,next}},l.values=values,Context.prototype={constructor:Context,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(resetTryEntry),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function handle(n,a){return o.type="throw",o.arg=e,t.next=n,a&&(t.method="next",t.arg=r),!!a}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],o=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,_):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),_},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),_}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;resetTryEntry(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:values(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),_}}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),o=new Context(n||[]);return i._invoke=function makeInvokeMethod(e,t,r){var n=f;return function invoke(a,i){if(n===d)throw new Error("Generator is already running");if(n===p){if("throw"===a)throw i;return doneResult()}for(r.method=a,r.arg=i;;){var o=r.delegate;if(o){var s=maybeInvokeDelegate(o,r);if(s){if(s===_)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===f)throw n=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=d;var u=tryCatch(e,t,r);if("normal"===u.type){if(n=r.done?p:h,u.arg===_)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=p,r.method="throw",r.arg=u.arg)}}}(e,r,o),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}function defineIteratorMethods(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function AsyncIterator(e){var t;this._invoke=function enqueue(r,n){function callInvokeWithMethodAndArg(){return new Promise(function(t,i){!function invoke(t,r,n,i){var o=tryCatch(e[t],e,r);if("throw"!==o.type){var s=o.arg,u=s.value;return u&&"object"==typeof u&&a.call(u,"__await")?Promise.resolve(u.__await).then(function(e){invoke("next",e,n,i)},function(e){invoke("throw",e,n,i)}):Promise.resolve(u).then(function(e){s.value=e,n(s)},function(e){return invoke("throw",e,n,i)})}i(o.arg)}(r,n,t,i)})}return t=t?t.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(e,t){var n=e.iterator[t.method];if(n===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=r,maybeInvokeDelegate(e,t),"throw"===t.method))return _;t.method="throw",t.arg=new TypeError("The iterator does not provide a \'throw\' method")}return _}var a=tryCatch(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,_;var i=a.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,_):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,_)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function next(){for(;++n<e.length;)if(a.call(e,n))return next.value=e[n],next.done=!1,next;return next.value=r,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:r,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t,r){"use strict";var n=r(16);function readTile(e,t,r){if(3===e){var a=new n(r,r.readVarint()+r.pos);a.length&&(t[a.name]=a)}}e.exports=function VectorTile(e,t){this.layers=e.readFields(readTile,{},t)}},function(e,t,r){"use strict";function Point(e,t){this.x=e,this.y=t}e.exports=Point,Point.prototype={clone:function(){return new Point(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,r=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=t*this.x-r*this.y,a=r*this.x+t*this.y;return this.x=n,this.y=a,this},_rotateAround:function(e,t){var r=Math.cos(e),n=Math.sin(e),a=t.x+r*(this.x-t.x)-n*(this.y-t.y),i=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=a,this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Point.convert=function(e){return e instanceof Point?e:Array.isArray(e)?new Point(e[0],e[1]):e}},function(e,t){t.read=function(e,t,r,n,a){var i,o,s=8*a-n-1,u=(1<<s)-1,c=u>>1,l=-7,f=r?a-1:0,h=r?-1:1,d=e[t+f];for(f+=h,i=d&(1<<-l)-1,d>>=-l,l+=s;l>0;i=256*i+e[t+f],f+=h,l-=8);for(o=i&(1<<-l)-1,i>>=-l,l+=n;l>0;o=256*o+e[t+f],f+=h,l-=8);if(0===i)i=1-c;else{if(i===u)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,n),i-=c}return(d?-1:1)*o*Math.pow(2,i-n)},t.write=function(e,t,r,n,a,i){var o,s,u,c=8*i-a-1,l=(1<<c)-1,f=l>>1,h=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:i-1,p=n?1:-1,_=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(o++,u/=2),o+f>=l?(s=0,o=l):o+f>=1?(s=(t*u-1)*Math.pow(2,a),o+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,a),o=0));a>=8;e[r+d]=255&s,d+=p,s/=256,a-=8);for(o=o<<a|s,c+=a;c>0;e[r+d]=255&o,d+=p,o/=256,c-=8);e[r+d-p]|=128*_}},function(e,t){e.exports=function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return e}},function(e,t){e.exports=function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}},function(e,t,r){var n=r(14);function _construct(t,r,a){return!function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?e.exports=_construct=function _construct(e,t,r){var a=[null];a.push.apply(a,t);var i=new(Function.bind.apply(e,a));return r&&n(i,r.prototype),i}:e.exports=_construct=Reflect.construct,_construct.apply(null,arguments)}e.exports=_construct},function(e,t,r){var n=r(2);e.exports=function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=n(e)););return e}},function(e,t){e.exports=function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}},function(e,t){e.exports=function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t,r){"use strict";var n=r(50),a=r(9),i=r(20),o=r(15),s=r(21),u=Object.prototype.toString,c=0,l=-1,f=0,h=8;function Deflate(e){if(!(this instanceof Deflate))return new Deflate(e);this.options=a.assign({level:l,method:h,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var r=n.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==c)throw new Error(o[r]);if(t.header&&n.deflateSetHeader(this.strm,t.header),t.dictionary){var d;if(d="string"==typeof t.dictionary?i.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=n.deflateSetDictionary(this.strm,d))!==c)throw new Error(o[r]);this._dict_set=!0}}function deflate(e,t){var r=new Deflate(t);if(r.push(e,!0),r.err)throw r.msg||o[r.err];return r.result}Deflate.prototype.push=function(e,t){var r,o,s=this.strm,l=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=i.string2buf(e):"[object ArrayBuffer]"===u.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new a.Buf8(l),s.next_out=0,s.avail_out=l),1!==(r=n.deflate(s,o))&&r!==c)return this.onEnd(r),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(i.buf2binstring(a.shrinkBuf(s.output,s.next_out))):this.onData(a.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==r);return 4===o?(r=n.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===c):2!==o||(this.onEnd(c),s.avail_out=0,!0)},Deflate.prototype.onData=function(e){this.chunks.push(e)},Deflate.prototype.onEnd=function(e){e===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=Deflate,t.deflate=deflate,t.deflateRaw=function deflateRaw(e,t){return(t=t||{}).raw=!0,deflate(e,t)},t.gzip=function gzip(e,t){return(t=t||{}).gzip=!0,deflate(e,t)}},function(e,t,r){"use strict";var n,a=r(9),i=r(51),o=r(18),s=r(19),u=r(15),c=0,l=1,f=3,h=4,d=5,p=0,_=1,y=-2,m=-3,v=-5,g=-1,b=1,x=2,w=3,k=4,M=0,T=2,P=8,z=9,I=15,S=8,E=286,N=30,C=19,F=2*E+1,A=15,D=3,O=258,V=O+D+1,R=32,B=42,L=69,Z=73,q=91,j=103,G=113,U=666,W=1,Y=2,Q=3,H=4,J=3;function err(e,t){return e.msg=u[t],t}function rank(e){return(e<<1)-(e>4?9:0)}function zero(e){for(var t=e.length;--t>=0;)e[t]=0}function flush_pending(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(a.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function flush_block_only(e,t){i._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,flush_pending(e.strm)}function put_byte(e,t){e.pending_buf[e.pending++]=t}function putShortMSB(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function read_buf(e,t,r,n){var i=e.avail_in;return i>n&&(i=n),0===i?0:(e.avail_in-=i,a.arraySet(t,e.input,e.next_in,i,r),1===e.state.wrap?e.adler=o(e.adler,t,i,r):2===e.state.wrap&&(e.adler=s(e.adler,t,i,r)),e.next_in+=i,e.total_in+=i,i)}function longest_match(e,t){var r,n,a=e.max_chain_length,i=e.strstart,o=e.prev_length,s=e.nice_match,u=e.strstart>e.w_size-V?e.strstart-(e.w_size-V):0,c=e.window,l=e.w_mask,f=e.prev,h=e.strstart+O,d=c[i+o-1],p=c[i+o];e.prev_length>=e.good_match&&(a>>=2),s>e.lookahead&&(s=e.lookahead);do{if(c[(r=t)+o]===p&&c[r+o-1]===d&&c[r]===c[i]&&c[++r]===c[i+1]){i+=2,r++;do{}while(c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&i<h);if(n=O-(h-i),i=h-O,n>o){if(e.match_start=t,o=n,n>=s)break;d=c[i+o-1],p=c[i+o]}}}while((t=f[t&l])>u&&0!=--a);return o<=e.lookahead?o:e.lookahead}function fill_window(e){var t,r,n,i,o,s=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=s+(s-V)){a.arraySet(e.window,e.window,s,s,0),e.match_start-=s,e.strstart-=s,e.block_start-=s,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=s?n-s:0}while(--r);t=r=s;do{n=e.prev[--t],e.prev[t]=n>=s?n-s:0}while(--r);i+=s}if(0===e.strm.avail_in)break;if(r=read_buf(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=r,e.lookahead+e.insert>=D)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+D-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<D)););}while(e.lookahead<V&&0!==e.strm.avail_in)}function deflate_fast(e,t){for(var r,n;;){if(e.lookahead<V){if(fill_window(e),e.lookahead<V&&t===c)return W;if(0===e.lookahead)break}if(r=0,e.lookahead>=D&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+D-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-V&&(e.match_length=longest_match(e,r)),e.match_length>=D)if(n=i._tr_tally(e,e.strstart-e.match_start,e.match_length-D),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=D){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+D-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(flush_block_only(e,!1),0===e.strm.avail_out))return W}return e.insert=e.strstart<D-1?e.strstart:D-1,t===h?(flush_block_only(e,!0),0===e.strm.avail_out?Q:H):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?W:Y}function deflate_slow(e,t){for(var r,n,a;;){if(e.lookahead<V){if(fill_window(e),e.lookahead<V&&t===c)return W;if(0===e.lookahead)break}if(r=0,e.lookahead>=D&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+D-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=D-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-V&&(e.match_length=longest_match(e,r),e.match_length<=5&&(e.strategy===b||e.match_length===D&&e.strstart-e.match_start>4096)&&(e.match_length=D-1)),e.prev_length>=D&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-D,n=i._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-D),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+D-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=D-1,e.strstart++,n&&(flush_block_only(e,!1),0===e.strm.avail_out))return W}else if(e.match_available){if((n=i._tr_tally(e,0,e.window[e.strstart-1]))&&flush_block_only(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return W}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=i._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<D-1?e.strstart:D-1,t===h?(flush_block_only(e,!0),0===e.strm.avail_out?Q:H):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?W:Y}function Config(e,t,r,n,a){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=a}function deflateResetKeep(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=T,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?B:G,e.adler=2===t.wrap?0:1,t.last_flush=c,i._tr_init(t),p):err(e,y)}function deflateReset(e){var t=deflateResetKeep(e);return t===p&&function lm_init(e){e.window_size=2*e.w_size,zero(e.head),e.max_lazy_match=n[e.level].max_lazy,e.good_match=n[e.level].good_length,e.nice_match=n[e.level].nice_length,e.max_chain_length=n[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=D-1,e.match_available=0,e.ins_h=0}(e.state),t}function deflateInit2(e,t,r,n,i,o){if(!e)return y;var s=1;if(t===g&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),i<1||i>z||r!==P||n<8||n>15||t<0||t>9||o<0||o>k)return err(e,y);8===n&&(n=9);var u=new function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=P,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*F),this.dyn_dtree=new a.Buf16(2*(2*N+1)),this.bl_tree=new a.Buf16(2*(2*C+1)),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(A+1),this.heap=new a.Buf16(2*E+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*E+1),zero(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return e.state=u,u.strm=e,u.wrap=s,u.gzhead=null,u.w_bits=n,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=i+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+D-1)/D),u.window=new a.Buf8(2*u.w_size),u.head=new a.Buf16(u.hash_size),u.prev=new a.Buf16(u.w_size),u.lit_bufsize=1<<i+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new a.Buf8(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=t,u.strategy=o,u.method=r,deflateReset(e)}n=[new Config(0,0,0,0,function deflate_stored(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(fill_window(e),0===e.lookahead&&t===c)return W;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,flush_block_only(e,!1),0===e.strm.avail_out))return W;if(e.strstart-e.block_start>=e.w_size-V&&(flush_block_only(e,!1),0===e.strm.avail_out))return W}return e.insert=0,t===h?(flush_block_only(e,!0),0===e.strm.avail_out?Q:H):(e.strstart>e.block_start&&(flush_block_only(e,!1),e.strm.avail_out),W)}),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],t.deflateInit=function deflateInit(e,t){return deflateInit2(e,t,P,I,S,M)},t.deflateInit2=deflateInit2,t.deflateReset=deflateReset,t.deflateResetKeep=deflateResetKeep,t.deflateSetHeader=function deflateSetHeader(e,t){return e&&e.state?2!==e.state.wrap?y:(e.state.gzhead=t,p):y},t.deflate=function deflate(e,t){var r,a,o,u;if(!e||!e.state||t>d||t<0)return e?err(e,y):y;if(a=e.state,!e.output||!e.input&&0!==e.avail_in||a.status===U&&t!==h)return err(e,0===e.avail_out?v:y);if(a.strm=e,r=a.last_flush,a.last_flush=t,a.status===B)if(2===a.wrap)e.adler=0,put_byte(a,31),put_byte(a,139),put_byte(a,8),a.gzhead?(put_byte(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),put_byte(a,255&a.gzhead.time),put_byte(a,a.gzhead.time>>8&255),put_byte(a,a.gzhead.time>>16&255),put_byte(a,a.gzhead.time>>24&255),put_byte(a,9===a.level?2:a.strategy>=x||a.level<2?4:0),put_byte(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(put_byte(a,255&a.gzhead.extra.length),put_byte(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=s(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=L):(put_byte(a,0),put_byte(a,0),put_byte(a,0),put_byte(a,0),put_byte(a,0),put_byte(a,9===a.level?2:a.strategy>=x||a.level<2?4:0),put_byte(a,J),a.status=G);else{var m=P+(a.w_bits-8<<4)<<8;m|=(a.strategy>=x||a.level<2?0:a.level<6?1:6===a.level?2:3)<<6,0!==a.strstart&&(m|=R),m+=31-m%31,a.status=G,putShortMSB(a,m),0!==a.strstart&&(putShortMSB(a,e.adler>>>16),putShortMSB(a,65535&e.adler)),e.adler=1}if(a.status===L)if(a.gzhead.extra){for(o=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>o&&(e.adler=s(e.adler,a.pending_buf,a.pending-o,o)),flush_pending(e),o=a.pending,a.pending!==a.pending_buf_size));)put_byte(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>o&&(e.adler=s(e.adler,a.pending_buf,a.pending-o,o)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=Z)}else a.status=Z;if(a.status===Z)if(a.gzhead.name){o=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>o&&(e.adler=s(e.adler,a.pending_buf,a.pending-o,o)),flush_pending(e),o=a.pending,a.pending===a.pending_buf_size)){u=1;break}u=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,put_byte(a,u)}while(0!==u);a.gzhead.hcrc&&a.pending>o&&(e.adler=s(e.adler,a.pending_buf,a.pending-o,o)),0===u&&(a.gzindex=0,a.status=q)}else a.status=q;if(a.status===q)if(a.gzhead.comment){o=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>o&&(e.adler=s(e.adler,a.pending_buf,a.pending-o,o)),flush_pending(e),o=a.pending,a.pending===a.pending_buf_size)){u=1;break}u=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,put_byte(a,u)}while(0!==u);a.gzhead.hcrc&&a.pending>o&&(e.adler=s(e.adler,a.pending_buf,a.pending-o,o)),0===u&&(a.status=j)}else a.status=j;if(a.status===j&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&flush_pending(e),a.pending+2<=a.pending_buf_size&&(put_byte(a,255&e.adler),put_byte(a,e.adler>>8&255),e.adler=0,a.status=G)):a.status=G),0!==a.pending){if(flush_pending(e),0===e.avail_out)return a.last_flush=-1,p}else if(0===e.avail_in&&rank(t)<=rank(r)&&t!==h)return err(e,v);if(a.status===U&&0!==e.avail_in)return err(e,v);if(0!==e.avail_in||0!==a.lookahead||t!==c&&a.status!==U){var g=a.strategy===x?function deflate_huff(e,t){for(var r;;){if(0===e.lookahead&&(fill_window(e),0===e.lookahead)){if(t===c)return W;break}if(e.match_length=0,r=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(flush_block_only(e,!1),0===e.strm.avail_out))return W}return e.insert=0,t===h?(flush_block_only(e,!0),0===e.strm.avail_out?Q:H):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?W:Y}(a,t):a.strategy===w?function deflate_rle(e,t){for(var r,n,a,o,s=e.window;;){if(e.lookahead<=O){if(fill_window(e),e.lookahead<=O&&t===c)return W;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=D&&e.strstart>0&&(n=s[a=e.strstart-1])===s[++a]&&n===s[++a]&&n===s[++a]){o=e.strstart+O;do{}while(n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&a<o);e.match_length=O-(o-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=D?(r=i._tr_tally(e,1,e.match_length-D),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(flush_block_only(e,!1),0===e.strm.avail_out))return W}return e.insert=0,t===h?(flush_block_only(e,!0),0===e.strm.avail_out?Q:H):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?W:Y}(a,t):n[a.level].func(a,t);if(g!==Q&&g!==H||(a.status=U),g===W||g===Q)return 0===e.avail_out&&(a.last_flush=-1),p;if(g===Y&&(t===l?i._tr_align(a):t!==d&&(i._tr_stored_block(a,0,0,!1),t===f&&(zero(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),flush_pending(e),0===e.avail_out))return a.last_flush=-1,p}return t!==h?p:a.wrap<=0?_:(2===a.wrap?(put_byte(a,255&e.adler),put_byte(a,e.adler>>8&255),put_byte(a,e.adler>>16&255),put_byte(a,e.adler>>24&255),put_byte(a,255&e.total_in),put_byte(a,e.total_in>>8&255),put_byte(a,e.total_in>>16&255),put_byte(a,e.total_in>>24&255)):(putShortMSB(a,e.adler>>>16),putShortMSB(a,65535&e.adler)),flush_pending(e),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?p:_)},t.deflateEnd=function deflateEnd(e){var t;return e&&e.state?(t=e.state.status)!==B&&t!==L&&t!==Z&&t!==q&&t!==j&&t!==G&&t!==U?err(e,y):(e.state=null,t===G?err(e,m):p):y},t.deflateSetDictionary=function deflateSetDictionary(e,t){var r,n,i,s,u,c,l,f,h=t.length;if(!e||!e.state)return y;if(2===(s=(r=e.state).wrap)||1===s&&r.status!==B||r.lookahead)return y;for(1===s&&(e.adler=o(e.adler,t,h,0)),r.wrap=0,h>=r.w_size&&(0===s&&(zero(r.head),r.strstart=0,r.block_start=0,r.insert=0),f=new a.Buf8(r.w_size),a.arraySet(f,t,h-r.w_size,r.w_size,0),t=f,h=r.w_size),u=e.avail_in,c=e.next_in,l=e.input,e.avail_in=h,e.next_in=0,e.input=t,fill_window(r);r.lookahead>=D;){n=r.strstart,i=r.lookahead-(D-1);do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+D-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--i);r.strstart=n,r.lookahead=D-1,fill_window(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=D-1,r.match_available=0,e.next_in=c,e.input=l,e.avail_in=u,r.wrap=s,p},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,r){"use strict";var n=r(9),a=4,i=0,o=1,s=2;function zero(e){for(var t=e.length;--t>=0;)e[t]=0}var u=0,c=1,l=2,f=29,h=256,d=h+1+f,p=30,_=19,y=2*d+1,m=15,v=16,g=7,b=256,x=16,w=17,k=18,M=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],T=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],I=new Array(2*(d+2));zero(I);var S=new Array(2*p);zero(S);var E=new Array(512);zero(E);var N=new Array(256);zero(N);var C=new Array(f);zero(C);var F,A,D,O=new Array(p);function StaticTreeDesc(e,t,r,n,a){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=a,this.has_stree=e&&e.length}function TreeDesc(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function d_code(e){return e<256?E[e]:E[256+(e>>>7)]}function put_short(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function send_bits(e,t,r){e.bi_valid>v-r?(e.bi_buf|=t<<e.bi_valid&65535,put_short(e,e.bi_buf),e.bi_buf=t>>v-e.bi_valid,e.bi_valid+=r-v):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function send_code(e,t,r){send_bits(e,r[2*t],r[2*t+1])}function bi_reverse(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function gen_codes(e,t,r){var n,a,i=new Array(m+1),o=0;for(n=1;n<=m;n++)i[n]=o=o+r[n-1]<<1;for(a=0;a<=t;a++){var s=e[2*a+1];0!==s&&(e[2*a]=bi_reverse(i[s]++,s))}}function init_block(e){var t;for(t=0;t<d;t++)e.dyn_ltree[2*t]=0;for(t=0;t<p;t++)e.dyn_dtree[2*t]=0;for(t=0;t<_;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*b]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function bi_windup(e){e.bi_valid>8?put_short(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function smaller(e,t,r,n){var a=2*t,i=2*r;return e[a]<e[i]||e[a]===e[i]&&n[t]<=n[r]}function pqdownheap(e,t,r){for(var n=e.heap[r],a=r<<1;a<=e.heap_len&&(a<e.heap_len&&smaller(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!smaller(t,n,e.heap[a],e.depth));)e.heap[r]=e.heap[a],r=a,a<<=1;e.heap[r]=n}function compress_block(e,t,r){var n,a,i,o,s=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],a=e.pending_buf[e.l_buf+s],s++,0===n?send_code(e,a,t):(send_code(e,(i=N[a])+h+1,t),0!==(o=M[i])&&send_bits(e,a-=C[i],o),send_code(e,i=d_code(--n),r),0!==(o=T[i])&&send_bits(e,n-=O[i],o))}while(s<e.last_lit);send_code(e,b,t)}function build_tree(e,t){var r,n,a,i=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,u=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=y,r=0;r<u;r++)0!==i[2*r]?(e.heap[++e.heap_len]=c=r,e.depth[r]=0):i[2*r+1]=0;for(;e.heap_len<2;)i[2*(a=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[a]=0,e.opt_len--,s&&(e.static_len-=o[2*a+1]);for(t.max_code=c,r=e.heap_len>>1;r>=1;r--)pqdownheap(e,i,r);a=u;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],pqdownheap(e,i,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,i[2*a]=i[2*r]+i[2*n],e.depth[a]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,i[2*r+1]=i[2*n+1]=a,e.heap[1]=a++,pqdownheap(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function gen_bitlen(e,t){var r,n,a,i,o,s,u=t.dyn_tree,c=t.max_code,l=t.stat_desc.static_tree,f=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,p=t.stat_desc.max_length,_=0;for(i=0;i<=m;i++)e.bl_count[i]=0;for(u[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<y;r++)(i=u[2*u[2*(n=e.heap[r])+1]+1]+1)>p&&(i=p,_++),u[2*n+1]=i,n>c||(e.bl_count[i]++,o=0,n>=d&&(o=h[n-d]),s=u[2*n],e.opt_len+=s*(i+o),f&&(e.static_len+=s*(l[2*n+1]+o)));if(0!==_){do{for(i=p-1;0===e.bl_count[i];)i--;e.bl_count[i]--,e.bl_count[i+1]+=2,e.bl_count[p]--,_-=2}while(_>0);for(i=p;0!==i;i--)for(n=e.bl_count[i];0!==n;)(a=e.heap[--r])>c||(u[2*a+1]!==i&&(e.opt_len+=(i-u[2*a+1])*u[2*a],u[2*a+1]=i),n--)}}(e,t),gen_codes(i,c,e.bl_count)}function scan_tree(e,t,r){var n,a,i=-1,o=t[1],s=0,u=7,c=4;for(0===o&&(u=138,c=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)a=o,o=t[2*(n+1)+1],++s<u&&a===o||(s<c?e.bl_tree[2*a]+=s:0!==a?(a!==i&&e.bl_tree[2*a]++,e.bl_tree[2*x]++):s<=10?e.bl_tree[2*w]++:e.bl_tree[2*k]++,s=0,i=a,0===o?(u=138,c=3):a===o?(u=6,c=3):(u=7,c=4))}function send_tree(e,t,r){var n,a,i=-1,o=t[1],s=0,u=7,c=4;for(0===o&&(u=138,c=3),n=0;n<=r;n++)if(a=o,o=t[2*(n+1)+1],!(++s<u&&a===o)){if(s<c)do{send_code(e,a,e.bl_tree)}while(0!=--s);else 0!==a?(a!==i&&(send_code(e,a,e.bl_tree),s--),send_code(e,x,e.bl_tree),send_bits(e,s-3,2)):s<=10?(send_code(e,w,e.bl_tree),send_bits(e,s-3,3)):(send_code(e,k,e.bl_tree),send_bits(e,s-11,7));s=0,i=a,0===o?(u=138,c=3):a===o?(u=6,c=3):(u=7,c=4)}}zero(O);var V=!1;function _tr_stored_block(e,t,r,a){send_bits(e,(u<<1)+(a?1:0),3),function copy_block(e,t,r,a){bi_windup(e),a&&(put_short(e,r),put_short(e,~r)),n.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}t._tr_init=function _tr_init(e){V||(function tr_static_init(){var e,t,r,n,a,i=new Array(m+1);for(r=0,n=0;n<f-1;n++)for(C[n]=r,e=0;e<1<<M[n];e++)N[r++]=n;for(N[r-1]=n,a=0,n=0;n<16;n++)for(O[n]=a,e=0;e<1<<T[n];e++)E[a++]=n;for(a>>=7;n<p;n++)for(O[n]=a<<7,e=0;e<1<<T[n]-7;e++)E[256+a++]=n;for(t=0;t<=m;t++)i[t]=0;for(e=0;e<=143;)I[2*e+1]=8,e++,i[8]++;for(;e<=255;)I[2*e+1]=9,e++,i[9]++;for(;e<=279;)I[2*e+1]=7,e++,i[7]++;for(;e<=287;)I[2*e+1]=8,e++,i[8]++;for(gen_codes(I,d+1,i),e=0;e<p;e++)S[2*e+1]=5,S[2*e]=bi_reverse(e,5);F=new StaticTreeDesc(I,M,h+1,d,m),A=new StaticTreeDesc(S,T,0,p,m),D=new StaticTreeDesc(new Array(0),P,0,_,g)}(),V=!0),e.l_desc=new TreeDesc(e.dyn_ltree,F),e.d_desc=new TreeDesc(e.dyn_dtree,A),e.bl_desc=new TreeDesc(e.bl_tree,D),e.bi_buf=0,e.bi_valid=0,init_block(e)},t._tr_stored_block=_tr_stored_block,t._tr_flush_block=function _tr_flush_block(e,t,r,n){var u,f,d=0;e.level>0?(e.strm.data_type===s&&(e.strm.data_type=function detect_data_type(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return i;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return o;for(t=32;t<h;t++)if(0!==e.dyn_ltree[2*t])return o;return i}(e)),build_tree(e,e.l_desc),build_tree(e,e.d_desc),d=function build_bl_tree(e){var t;for(scan_tree(e,e.dyn_ltree,e.l_desc.max_code),scan_tree(e,e.dyn_dtree,e.d_desc.max_code),build_tree(e,e.bl_desc),t=_-1;t>=3&&0===e.bl_tree[2*z[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),u=e.opt_len+3+7>>>3,(f=e.static_len+3+7>>>3)<=u&&(u=f)):u=f=r+5,r+4<=u&&-1!==t?_tr_stored_block(e,t,r,n):e.strategy===a||f===u?(send_bits(e,(c<<1)+(n?1:0),3),compress_block(e,I,S)):(send_bits(e,(l<<1)+(n?1:0),3),function send_all_trees(e,t,r,n){var a;for(send_bits(e,t-257,5),send_bits(e,r-1,5),send_bits(e,n-4,4),a=0;a<n;a++)send_bits(e,e.bl_tree[2*z[a]+1],3);send_tree(e,e.dyn_ltree,t-1),send_tree(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,d+1),compress_block(e,e.dyn_ltree,e.dyn_dtree)),init_block(e),n&&bi_windup(e)},t._tr_tally=function _tr_tally(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(N[r]+h+1)]++,e.dyn_dtree[2*d_code(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function _tr_align(e){send_bits(e,c<<1,3),send_code(e,b,I),function bi_flush(e){16===e.bi_valid?(put_short(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,r){"use strict";var n=r(53),a=r(9),i=r(20),o=r(22),s=r(15),u=r(21),c=r(56),l=Object.prototype.toString;function Inflate(e){if(!(this instanceof Inflate))return new Inflate(e);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var r=n.inflateInit2(this.strm,t.windowBits);if(r!==o.Z_OK)throw new Error(s[r]);if(this.header=new c,n.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=i.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=n.inflateSetDictionary(this.strm,t.dictionary))!==o.Z_OK))throw new Error(s[r])}function inflate(e,t){var r=new Inflate(t);if(r.push(e,!0),r.err)throw r.msg||s[r.err];return r.result}Inflate.prototype.push=function(e,t){var r,s,u,c,f,h=this.strm,d=this.options.chunkSize,p=this.options.dictionary,_=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?h.input=i.binstring2buf(e):"[object ArrayBuffer]"===l.call(e)?h.input=new Uint8Array(e):h.input=e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new a.Buf8(d),h.next_out=0,h.avail_out=d),(r=n.inflate(h,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&p&&(r=n.inflateSetDictionary(this.strm,p)),r===o.Z_BUF_ERROR&&!0===_&&(r=o.Z_OK,_=!1),r!==o.Z_STREAM_END&&r!==o.Z_OK)return this.onEnd(r),this.ended=!0,!1;h.next_out&&(0!==h.avail_out&&r!==o.Z_STREAM_END&&(0!==h.avail_in||s!==o.Z_FINISH&&s!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(u=i.utf8border(h.output,h.next_out),c=h.next_out-u,f=i.buf2string(h.output,u),h.next_out=c,h.avail_out=d-c,c&&a.arraySet(h.output,h.output,u,c,0),this.onData(f)):this.onData(a.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(_=!0)}while((h.avail_in>0||0===h.avail_out)&&r!==o.Z_STREAM_END);return r===o.Z_STREAM_END&&(s=o.Z_FINISH),s===o.Z_FINISH?(r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===o.Z_OK):s!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),h.avail_out=0,!0)},Inflate.prototype.onData=function(e){this.chunks.push(e)},Inflate.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=Inflate,t.inflate=inflate,t.inflateRaw=function inflateRaw(e,t){return(t=t||{}).raw=!0,inflate(e,t)},t.ungzip=inflate},function(e,t,r){"use strict";var n=r(9),a=r(18),i=r(19),o=r(54),s=r(55),u=0,c=1,l=2,f=4,h=5,d=6,p=0,_=1,y=2,m=-2,v=-3,g=-4,b=-5,x=8,w=1,k=2,M=3,T=4,P=5,z=6,I=7,S=8,E=9,N=10,C=11,F=12,A=13,D=14,O=15,V=16,R=17,B=18,L=19,Z=20,q=21,j=22,G=23,U=24,W=25,Y=26,Q=27,H=28,J=29,$=30,K=31,X=32,ee=852,te=592,re=15;function zswap32(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function inflateResetKeep(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=w,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(ee),t.distcode=t.distdyn=new n.Buf32(te),t.sane=1,t.back=-1,p):m}function inflateReset(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,inflateResetKeep(e)):m}function inflateReset2(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?m:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,inflateReset(e))):m}function inflateInit2(e,t){var r,a;return e?(a=new function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},e.state=a,a.window=null,(r=inflateReset2(e,t))!==p&&(e.state=null),r):m}var ne,ae,ie=!0;function fixedtables(e){if(ie){var t;for(ne=new n.Buf32(512),ae=new n.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(c,e.lens,0,288,ne,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(l,e.lens,0,32,ae,0,e.work,{bits:5}),ie=!1}e.lencode=ne,e.lenbits=9,e.distcode=ae,e.distbits=5}function updatewindow(e,t,r,a){var i,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new n.Buf8(o.wsize)),a>=o.wsize?(n.arraySet(o.window,t,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((i=o.wsize-o.wnext)>a&&(i=a),n.arraySet(o.window,t,r-a,i,o.wnext),(a-=i)?(n.arraySet(o.window,t,r-a,a,0),o.wnext=a,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0}t.inflateReset=inflateReset,t.inflateReset2=inflateReset2,t.inflateResetKeep=inflateResetKeep,t.inflateInit=function inflateInit(e){return inflateInit2(e,re)},t.inflateInit2=inflateInit2,t.inflate=function inflate(e,t){var r,ee,te,re,ne,ae,ie,oe,se,ue,ce,le,fe,he,de,pe,_e,ye,me,ve,ge,be,xe,we,ke=0,Me=new n.Buf8(4),Te=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return m;(r=e.state).mode===F&&(r.mode=A),ne=e.next_out,te=e.output,ie=e.avail_out,re=e.next_in,ee=e.input,ae=e.avail_in,oe=r.hold,se=r.bits,ue=ae,ce=ie,be=p;e:for(;;)switch(r.mode){case w:if(0===r.wrap){r.mode=A;break}for(;se<16;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}if(2&r.wrap&&35615===oe){r.check=0,Me[0]=255&oe,Me[1]=oe>>>8&255,r.check=i(r.check,Me,2,0),oe=0,se=0,r.mode=k;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&oe)<<8)+(oe>>8))%31){e.msg="incorrect header check",r.mode=$;break}if((15&oe)!==x){e.msg="unknown compression method",r.mode=$;break}if(se-=4,ge=8+(15&(oe>>>=4)),0===r.wbits)r.wbits=ge;else if(ge>r.wbits){e.msg="invalid window size",r.mode=$;break}r.dmax=1<<ge,e.adler=r.check=1,r.mode=512&oe?N:F,oe=0,se=0;break;case k:for(;se<16;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}if(r.flags=oe,(255&r.flags)!==x){e.msg="unknown compression method",r.mode=$;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=$;break}r.head&&(r.head.text=oe>>8&1),512&r.flags&&(Me[0]=255&oe,Me[1]=oe>>>8&255,r.check=i(r.check,Me,2,0)),oe=0,se=0,r.mode=M;case M:for(;se<32;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}r.head&&(r.head.time=oe),512&r.flags&&(Me[0]=255&oe,Me[1]=oe>>>8&255,Me[2]=oe>>>16&255,Me[3]=oe>>>24&255,r.check=i(r.check,Me,4,0)),oe=0,se=0,r.mode=T;case T:for(;se<16;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}r.head&&(r.head.xflags=255&oe,r.head.os=oe>>8),512&r.flags&&(Me[0]=255&oe,Me[1]=oe>>>8&255,r.check=i(r.check,Me,2,0)),oe=0,se=0,r.mode=P;case P:if(1024&r.flags){for(;se<16;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}r.length=oe,r.head&&(r.head.extra_len=oe),512&r.flags&&(Me[0]=255&oe,Me[1]=oe>>>8&255,r.check=i(r.check,Me,2,0)),oe=0,se=0}else r.head&&(r.head.extra=null);r.mode=z;case z:if(1024&r.flags&&((le=r.length)>ae&&(le=ae),le&&(r.head&&(ge=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,ee,re,le,ge)),512&r.flags&&(r.check=i(r.check,ee,le,re)),ae-=le,re+=le,r.length-=le),r.length))break e;r.length=0,r.mode=I;case I:if(2048&r.flags){if(0===ae)break e;le=0;do{ge=ee[re+le++],r.head&&ge&&r.length<65536&&(r.head.name+=String.fromCharCode(ge))}while(ge&&le<ae);if(512&r.flags&&(r.check=i(r.check,ee,le,re)),ae-=le,re+=le,ge)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=S;case S:if(4096&r.flags){if(0===ae)break e;le=0;do{ge=ee[re+le++],r.head&&ge&&r.length<65536&&(r.head.comment+=String.fromCharCode(ge))}while(ge&&le<ae);if(512&r.flags&&(r.check=i(r.check,ee,le,re)),ae-=le,re+=le,ge)break e}else r.head&&(r.head.comment=null);r.mode=E;case E:if(512&r.flags){for(;se<16;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}if(oe!==(65535&r.check)){e.msg="header crc mismatch",r.mode=$;break}oe=0,se=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=F;break;case N:for(;se<32;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}e.adler=r.check=zswap32(oe),oe=0,se=0,r.mode=C;case C:if(0===r.havedict)return e.next_out=ne,e.avail_out=ie,e.next_in=re,e.avail_in=ae,r.hold=oe,r.bits=se,y;e.adler=r.check=1,r.mode=F;case F:if(t===h||t===d)break e;case A:if(r.last){oe>>>=7&se,se-=7&se,r.mode=Q;break}for(;se<3;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}switch(r.last=1&oe,se-=1,3&(oe>>>=1)){case 0:r.mode=D;break;case 1:if(fixedtables(r),r.mode=Z,t===d){oe>>>=2,se-=2;break e}break;case 2:r.mode=R;break;case 3:e.msg="invalid block type",r.mode=$}oe>>>=2,se-=2;break;case D:for(oe>>>=7&se,se-=7&se;se<32;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}if((65535&oe)!=(oe>>>16^65535)){e.msg="invalid stored block lengths",r.mode=$;break}if(r.length=65535&oe,oe=0,se=0,r.mode=O,t===d)break e;case O:r.mode=V;case V:if(le=r.length){if(le>ae&&(le=ae),le>ie&&(le=ie),0===le)break e;n.arraySet(te,ee,re,le,ne),ae-=le,re+=le,ie-=le,ne+=le,r.length-=le;break}r.mode=F;break;case R:for(;se<14;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}if(r.nlen=257+(31&oe),oe>>>=5,se-=5,r.ndist=1+(31&oe),oe>>>=5,se-=5,r.ncode=4+(15&oe),oe>>>=4,se-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=$;break}r.have=0,r.mode=B;case B:for(;r.have<r.ncode;){for(;se<3;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}r.lens[Te[r.have++]]=7&oe,oe>>>=3,se-=3}for(;r.have<19;)r.lens[Te[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,xe={bits:r.lenbits},be=s(u,r.lens,0,19,r.lencode,0,r.work,xe),r.lenbits=xe.bits,be){e.msg="invalid code lengths set",r.mode=$;break}r.have=0,r.mode=L;case L:for(;r.have<r.nlen+r.ndist;){for(;pe=(ke=r.lencode[oe&(1<<r.lenbits)-1])>>>16&255,_e=65535&ke,!((de=ke>>>24)<=se);){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}if(_e<16)oe>>>=de,se-=de,r.lens[r.have++]=_e;else{if(16===_e){for(we=de+2;se<we;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}if(oe>>>=de,se-=de,0===r.have){e.msg="invalid bit length repeat",r.mode=$;break}ge=r.lens[r.have-1],le=3+(3&oe),oe>>>=2,se-=2}else if(17===_e){for(we=de+3;se<we;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}se-=de,ge=0,le=3+(7&(oe>>>=de)),oe>>>=3,se-=3}else{for(we=de+7;se<we;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}se-=de,ge=0,le=11+(127&(oe>>>=de)),oe>>>=7,se-=7}if(r.have+le>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=$;break}for(;le--;)r.lens[r.have++]=ge}}if(r.mode===$)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=$;break}if(r.lenbits=9,xe={bits:r.lenbits},be=s(c,r.lens,0,r.nlen,r.lencode,0,r.work,xe),r.lenbits=xe.bits,be){e.msg="invalid literal/lengths set",r.mode=$;break}if(r.distbits=6,r.distcode=r.distdyn,xe={bits:r.distbits},be=s(l,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,xe),r.distbits=xe.bits,be){e.msg="invalid distances set",r.mode=$;break}if(r.mode=Z,t===d)break e;case Z:r.mode=q;case q:if(ae>=6&&ie>=258){e.next_out=ne,e.avail_out=ie,e.next_in=re,e.avail_in=ae,r.hold=oe,r.bits=se,o(e,ce),ne=e.next_out,te=e.output,ie=e.avail_out,re=e.next_in,ee=e.input,ae=e.avail_in,oe=r.hold,se=r.bits,r.mode===F&&(r.back=-1);break}for(r.back=0;pe=(ke=r.lencode[oe&(1<<r.lenbits)-1])>>>16&255,_e=65535&ke,!((de=ke>>>24)<=se);){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}if(pe&&0==(240&pe)){for(ye=de,me=pe,ve=_e;pe=(ke=r.lencode[ve+((oe&(1<<ye+me)-1)>>ye)])>>>16&255,_e=65535&ke,!(ye+(de=ke>>>24)<=se);){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}oe>>>=ye,se-=ye,r.back+=ye}if(oe>>>=de,se-=de,r.back+=de,r.length=_e,0===pe){r.mode=Y;break}if(32&pe){r.back=-1,r.mode=F;break}if(64&pe){e.msg="invalid literal/length code",r.mode=$;break}r.extra=15&pe,r.mode=j;case j:if(r.extra){for(we=r.extra;se<we;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}r.length+=oe&(1<<r.extra)-1,oe>>>=r.extra,se-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=G;case G:for(;pe=(ke=r.distcode[oe&(1<<r.distbits)-1])>>>16&255,_e=65535&ke,!((de=ke>>>24)<=se);){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}if(0==(240&pe)){for(ye=de,me=pe,ve=_e;pe=(ke=r.distcode[ve+((oe&(1<<ye+me)-1)>>ye)])>>>16&255,_e=65535&ke,!(ye+(de=ke>>>24)<=se);){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}oe>>>=ye,se-=ye,r.back+=ye}if(oe>>>=de,se-=de,r.back+=de,64&pe){e.msg="invalid distance code",r.mode=$;break}r.offset=_e,r.extra=15&pe,r.mode=U;case U:if(r.extra){for(we=r.extra;se<we;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}r.offset+=oe&(1<<r.extra)-1,oe>>>=r.extra,se-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=$;break}r.mode=W;case W:if(0===ie)break e;if(le=ce-ie,r.offset>le){if((le=r.offset-le)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=$;break}le>r.wnext?(le-=r.wnext,fe=r.wsize-le):fe=r.wnext-le,le>r.length&&(le=r.length),he=r.window}else he=te,fe=ne-r.offset,le=r.length;le>ie&&(le=ie),ie-=le,r.length-=le;do{te[ne++]=he[fe++]}while(--le);0===r.length&&(r.mode=q);break;case Y:if(0===ie)break e;te[ne++]=r.length,ie--,r.mode=q;break;case Q:if(r.wrap){for(;se<32;){if(0===ae)break e;ae--,oe|=ee[re++]<<se,se+=8}if(ce-=ie,e.total_out+=ce,r.total+=ce,ce&&(e.adler=r.check=r.flags?i(r.check,te,ce,ne-ce):a(r.check,te,ce,ne-ce)),ce=ie,(r.flags?oe:zswap32(oe))!==r.check){e.msg="incorrect data check",r.mode=$;break}oe=0,se=0}r.mode=H;case H:if(r.wrap&&r.flags){for(;se<32;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}if(oe!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=$;break}oe=0,se=0}r.mode=J;case J:be=_;break e;case $:be=v;break e;case K:return g;case X:default:return m}return e.next_out=ne,e.avail_out=ie,e.next_in=re,e.avail_in=ae,r.hold=oe,r.bits=se,(r.wsize||ce!==e.avail_out&&r.mode<$&&(r.mode<Q||t!==f))&&updatewindow(e,e.output,e.next_out,ce-e.avail_out)?(r.mode=K,g):(ue-=e.avail_in,ce-=e.avail_out,e.total_in+=ue,e.total_out+=ce,r.total+=ce,r.wrap&&ce&&(e.adler=r.check=r.flags?i(r.check,te,ce,e.next_out-ce):a(r.check,te,ce,e.next_out-ce)),e.data_type=r.bits+(r.last?64:0)+(r.mode===F?128:0)+(r.mode===Z||r.mode===O?256:0),(0===ue&&0===ce||t===f)&&be===p&&(be=b),be)},t.inflateEnd=function inflateEnd(e){if(!e||!e.state)return m;var t=e.state;return t.window&&(t.window=null),e.state=null,p},t.inflateGetHeader=function inflateGetHeader(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?m:(r.head=t,t.done=!1,p):m},t.inflateSetDictionary=function inflateSetDictionary(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&r.mode!==C?m:r.mode===C&&a(1,t,n,0)!==r.check?v:updatewindow(e,t,n,n)?(r.mode=K,g):(r.havedict=1,p):m},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,r){"use strict";e.exports=function inflate_fast(e,t){var r,n,a,i,o,s,u,c,l,f,h,d,p,_,y,m,v,g,b,x,w,k,M,T,P;r=e.state,n=e.next_in,T=e.input,a=n+(e.avail_in-5),i=e.next_out,P=e.output,o=i-(t-e.avail_out),s=i+(e.avail_out-257),u=r.dmax,c=r.wsize,l=r.whave,f=r.wnext,h=r.window,d=r.hold,p=r.bits,_=r.lencode,y=r.distcode,m=(1<<r.lenbits)-1,v=(1<<r.distbits)-1;e:do{p<15&&(d+=T[n++]<<p,p+=8,d+=T[n++]<<p,p+=8),g=_[d&m];t:for(;;){if(d>>>=b=g>>>24,p-=b,0===(b=g>>>16&255))P[i++]=65535&g;else{if(!(16&b)){if(0==(64&b)){g=_[(65535&g)+(d&(1<<b)-1)];continue t}if(32&b){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}x=65535&g,(b&=15)&&(p<b&&(d+=T[n++]<<p,p+=8),x+=d&(1<<b)-1,d>>>=b,p-=b),p<15&&(d+=T[n++]<<p,p+=8,d+=T[n++]<<p,p+=8),g=y[d&v];r:for(;;){if(d>>>=b=g>>>24,p-=b,!(16&(b=g>>>16&255))){if(0==(64&b)){g=y[(65535&g)+(d&(1<<b)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(w=65535&g,p<(b&=15)&&(d+=T[n++]<<p,(p+=8)<b&&(d+=T[n++]<<p,p+=8)),(w+=d&(1<<b)-1)>u){e.msg="invalid distance too far back",r.mode=30;break e}if(d>>>=b,p-=b,w>(b=i-o)){if((b=w-b)>l&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(k=0,M=h,0===f){if(k+=c-b,b<x){x-=b;do{P[i++]=h[k++]}while(--b);k=i-w,M=P}}else if(f<b){if(k+=c+f-b,(b-=f)<x){x-=b;do{P[i++]=h[k++]}while(--b);if(k=0,f<x){x-=b=f;do{P[i++]=h[k++]}while(--b);k=i-w,M=P}}}else if(k+=f-b,b<x){x-=b;do{P[i++]=h[k++]}while(--b);k=i-w,M=P}for(;x>2;)P[i++]=M[k++],P[i++]=M[k++],P[i++]=M[k++],x-=3;x&&(P[i++]=M[k++],x>1&&(P[i++]=M[k++]))}else{k=i-w;do{P[i++]=P[k++],P[i++]=P[k++],P[i++]=P[k++],x-=3}while(x>2);x&&(P[i++]=P[k++],x>1&&(P[i++]=P[k++]))}break}}break}}while(n<a&&i<s);n-=x=p>>3,d&=(1<<(p-=x<<3))-1,e.next_in=n,e.next_out=i,e.avail_in=n<a?a-n+5:5-(n-a),e.avail_out=i<s?s-i+257:257-(i-s),r.hold=d,r.bits=p}},function(e,t,r){"use strict";var n=r(9),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function inflate_table(e,t,r,u,c,l,f,h){var d,p,_,y,m,v,g,b,x,w=h.bits,k=0,M=0,T=0,P=0,z=0,I=0,S=0,E=0,N=0,C=0,F=null,A=0,D=new n.Buf16(16),O=new n.Buf16(16),V=null,R=0;for(k=0;k<=15;k++)D[k]=0;for(M=0;M<u;M++)D[t[r+M]]++;for(z=w,P=15;P>=1&&0===D[P];P--);if(z>P&&(z=P),0===P)return c[l++]=20971520,c[l++]=20971520,h.bits=1,0;for(T=1;T<P&&0===D[T];T++);for(z<T&&(z=T),E=1,k=1;k<=15;k++)if(E<<=1,(E-=D[k])<0)return-1;if(E>0&&(0===e||1!==P))return-1;for(O[1]=0,k=1;k<15;k++)O[k+1]=O[k]+D[k];for(M=0;M<u;M++)0!==t[r+M]&&(f[O[t[r+M]]++]=M);if(0===e?(F=V=f,v=19):1===e?(F=a,A-=257,V=i,R-=257,v=256):(F=o,V=s,v=-1),C=0,M=0,k=T,m=l,I=z,S=0,_=-1,y=(N=1<<z)-1,1===e&&N>852||2===e&&N>592)return 1;for(;;){g=k-S,f[M]<v?(b=0,x=f[M]):f[M]>v?(b=V[R+f[M]],x=F[A+f[M]]):(b=96,x=0),d=1<<k-S,T=p=1<<I;do{c[m+(C>>S)+(p-=d)]=g<<24|b<<16|x|0}while(0!==p);for(d=1<<k-1;C&d;)d>>=1;if(0!==d?(C&=d-1,C+=d):C=0,M++,0==--D[k]){if(k===P)break;k=t[r+f[M]]}if(k>z&&(C&y)!==_){for(0===S&&(S=z),m+=T,E=1<<(I=k-S);I+S<P&&!((E-=D[I+S])<=0);)I++,E<<=1;if(N+=1<<I,1===e&&N>852||2===e&&N>592)return 1;c[_=C&y]=z<<24|I<<16|m-l|0}}return 0!==C&&(c[m+C]=k-S<<24|64<<16|0),h.bits=z,0}},function(e,t,r){"use strict";e.exports=function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"create",function(){return create}),r.d(n,"clone",function(){return clone}),r.d(n,"copy",function(){return copy}),r.d(n,"fromValues",function(){return fromValues}),r.d(n,"set",function(){return set}),r.d(n,"identity",function(){return identity}),r.d(n,"transpose",function(){return transpose}),r.d(n,"invert",function(){return invert}),r.d(n,"adjoint",function(){return adjoint}),r.d(n,"determinant",function(){return determinant}),r.d(n,"multiply",function(){return multiply}),r.d(n,"translate",function(){return translate}),r.d(n,"scale",function(){return mat4_scale}),r.d(n,"rotate",function(){return rotate}),r.d(n,"rotateX",function(){return rotateX}),r.d(n,"rotateY",function(){return rotateY}),r.d(n,"rotateZ",function(){return rotateZ}),r.d(n,"fromTranslation",function(){return fromTranslation}),r.d(n,"fromScaling",function(){return fromScaling}),r.d(n,"fromRotation",function(){return fromRotation}),r.d(n,"fromXRotation",function(){return fromXRotation}),r.d(n,"fromYRotation",function(){return fromYRotation}),r.d(n,"fromZRotation",function(){return fromZRotation}),r.d(n,"fromRotationTranslation",function(){return fromRotationTranslation}),r.d(n,"fromQuat2",function(){return fromQuat2}),r.d(n,"getTranslation",function(){return getTranslation}),r.d(n,"getScaling",function(){return getScaling}),r.d(n,"getRotation",function(){return getRotation}),r.d(n,"fromRotationTranslationScale",function(){return fromRotationTranslationScale}),r.d(n,"fromRotationTranslationScaleOrigin",function(){return fromRotationTranslationScaleOrigin}),r.d(n,"fromQuat",function(){return fromQuat}),r.d(n,"frustum",function(){return frustum}),r.d(n,"perspective",function(){return perspective}),r.d(n,"perspectiveFromFieldOfView",function(){return perspectiveFromFieldOfView}),r.d(n,"ortho",function(){return ortho}),r.d(n,"lookAt",function(){return lookAt}),r.d(n,"targetTo",function(){return targetTo}),r.d(n,"str",function(){return str}),r.d(n,"frob",function(){return frob}),r.d(n,"add",function(){return add}),r.d(n,"subtract",function(){return subtract}),r.d(n,"multiplyScalar",function(){return multiplyScalar}),r.d(n,"multiplyScalarAndAdd",function(){return multiplyScalarAndAdd}),r.d(n,"exactEquals",function(){return exactEquals}),r.d(n,"equals",function(){return mat4_equals}),r.d(n,"mul",function(){return M}),r.d(n,"sub",function(){return T});var a={};r.r(a),r.d(a,"create",function(){return vec4_create}),r.d(a,"clone",function(){return vec4_clone}),r.d(a,"fromValues",function(){return vec4_fromValues}),r.d(a,"copy",function(){return vec4_copy}),r.d(a,"set",function(){return vec4_set}),r.d(a,"add",function(){return vec4_add}),r.d(a,"subtract",function(){return vec4_subtract}),r.d(a,"multiply",function(){return vec4_multiply}),r.d(a,"divide",function(){return divide}),r.d(a,"ceil",function(){return ceil}),r.d(a,"floor",function(){return floor}),r.d(a,"min",function(){return vec4_min}),r.d(a,"max",function(){return vec4_max}),r.d(a,"round",function(){return round}),r.d(a,"scale",function(){return vec4_scale}),r.d(a,"scaleAndAdd",function(){return scaleAndAdd}),r.d(a,"distance",function(){return distance}),r.d(a,"squaredDistance",function(){return squaredDistance}),r.d(a,"length",function(){return vec4_length}),r.d(a,"squaredLength",function(){return squaredLength}),r.d(a,"negate",function(){return negate}),r.d(a,"inverse",function(){return inverse}),r.d(a,"normalize",function(){return normalize}),r.d(a,"dot",function(){return dot}),r.d(a,"lerp",function(){return lerp}),r.d(a,"random",function(){return random}),r.d(a,"transformMat4",function(){return transformMat4}),r.d(a,"transformQuat",function(){return transformQuat}),r.d(a,"str",function(){return vec4_str}),r.d(a,"exactEquals",function(){return vec4_exactEquals}),r.d(a,"equals",function(){return vec4_equals}),r.d(a,"sub",function(){return P}),r.d(a,"mul",function(){return I}),r.d(a,"div",function(){return S}),r.d(a,"dist",function(){return E}),r.d(a,"sqrDist",function(){return N}),r.d(a,"len",function(){return C}),r.d(a,"sqrLen",function(){return F}),r.d(a,"forEach",function(){return A});var i=r(6),o=r.n(i),s=r(3),u=r.n(s),c=r(7),l=r.n(c),f=r(0),h=r.n(f),d=r(1),p=r.n(d),_=r(12),m=r(13);function getRsysFromTile(e,t,r){return{center:{x:(e+.5)/Math.pow(2,r)*2-1,y:2*(1-(t+.5)/Math.pow(2,r))-1},scale:1/Math.pow(2,r)}}var v=r(8),g=r.n(v),b=1e-6,w="undefined"!=typeof Float32Array?Float32Array:Array,k=Math.random;Math.PI;function create(){var e=new w(16);return w!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function clone(e){var t=new w(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function copy(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function fromValues(e,t,r,n,a,i,o,s,u,c,l,f,h,d,p,_){var y=new w(16);return y[0]=e,y[1]=t,y[2]=r,y[3]=n,y[4]=a,y[5]=i,y[6]=o,y[7]=s,y[8]=u,y[9]=c,y[10]=l,y[11]=f,y[12]=h,y[13]=d,y[14]=p,y[15]=_,y}function set(e,t,r,n,a,i,o,s,u,c,l,f,h,d,p,_,y){return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e[4]=i,e[5]=o,e[6]=s,e[7]=u,e[8]=c,e[9]=l,e[10]=f,e[11]=h,e[12]=d,e[13]=p,e[14]=_,e[15]=y,e}function identity(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function transpose(e,t){if(e===t){var r=t[1],n=t[2],a=t[3],i=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=i,e[11]=t[14],e[12]=a,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function invert(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],o=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],h=t[10],d=t[11],p=t[12],_=t[13],y=t[14],m=t[15],v=r*s-n*o,g=r*u-a*o,b=r*c-i*o,x=n*u-a*s,w=n*c-i*s,k=a*c-i*u,M=l*_-f*p,T=l*y-h*p,P=l*m-d*p,z=f*y-h*_,I=f*m-d*_,S=h*m-d*y,E=v*S-g*I+b*z+x*P-w*T+k*M;return E?(E=1/E,e[0]=(s*S-u*I+c*z)*E,e[1]=(a*I-n*S-i*z)*E,e[2]=(_*k-y*w+m*x)*E,e[3]=(h*w-f*k-d*x)*E,e[4]=(u*P-o*S-c*T)*E,e[5]=(r*S-a*P+i*T)*E,e[6]=(y*b-p*k-m*g)*E,e[7]=(l*k-h*b+d*g)*E,e[8]=(o*I-s*P+c*M)*E,e[9]=(n*P-r*I-i*M)*E,e[10]=(p*w-_*b+m*v)*E,e[11]=(f*b-l*w-d*v)*E,e[12]=(s*T-o*z-u*M)*E,e[13]=(r*z-n*T+a*M)*E,e[14]=(_*g-p*x-y*v)*E,e[15]=(l*x-f*g+h*v)*E,e):null}function adjoint(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],o=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],h=t[10],d=t[11],p=t[12],_=t[13],y=t[14],m=t[15];return e[0]=s*(h*m-d*y)-f*(u*m-c*y)+_*(u*d-c*h),e[1]=-(n*(h*m-d*y)-f*(a*m-i*y)+_*(a*d-i*h)),e[2]=n*(u*m-c*y)-s*(a*m-i*y)+_*(a*c-i*u),e[3]=-(n*(u*d-c*h)-s*(a*d-i*h)+f*(a*c-i*u)),e[4]=-(o*(h*m-d*y)-l*(u*m-c*y)+p*(u*d-c*h)),e[5]=r*(h*m-d*y)-l*(a*m-i*y)+p*(a*d-i*h),e[6]=-(r*(u*m-c*y)-o*(a*m-i*y)+p*(a*c-i*u)),e[7]=r*(u*d-c*h)-o*(a*d-i*h)+l*(a*c-i*u),e[8]=o*(f*m-d*_)-l*(s*m-c*_)+p*(s*d-c*f),e[9]=-(r*(f*m-d*_)-l*(n*m-i*_)+p*(n*d-i*f)),e[10]=r*(s*m-c*_)-o*(n*m-i*_)+p*(n*c-i*s),e[11]=-(r*(s*d-c*f)-o*(n*d-i*f)+l*(n*c-i*s)),e[12]=-(o*(f*y-h*_)-l*(s*y-u*_)+p*(s*h-u*f)),e[13]=r*(f*y-h*_)-l*(n*y-a*_)+p*(n*h-a*f),e[14]=-(r*(s*y-u*_)-o*(n*y-a*_)+p*(n*u-a*s)),e[15]=r*(s*h-u*f)-o*(n*h-a*f)+l*(n*u-a*s),e}function determinant(e){var t=e[0],r=e[1],n=e[2],a=e[3],i=e[4],o=e[5],s=e[6],u=e[7],c=e[8],l=e[9],f=e[10],h=e[11],d=e[12],p=e[13],_=e[14],y=e[15];return(t*o-r*i)*(f*y-h*_)-(t*s-n*i)*(l*y-h*p)+(t*u-a*i)*(l*_-f*p)+(r*s-n*o)*(c*y-h*d)-(r*u-a*o)*(c*_-f*d)+(n*u-a*s)*(c*p-l*d)}function multiply(e,t,r){var n=t[0],a=t[1],i=t[2],o=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],h=t[9],d=t[10],p=t[11],_=t[12],y=t[13],m=t[14],v=t[15],g=r[0],b=r[1],x=r[2],w=r[3];return e[0]=g*n+b*s+x*f+w*_,e[1]=g*a+b*u+x*h+w*y,e[2]=g*i+b*c+x*d+w*m,e[3]=g*o+b*l+x*p+w*v,g=r[4],b=r[5],x=r[6],w=r[7],e[4]=g*n+b*s+x*f+w*_,e[5]=g*a+b*u+x*h+w*y,e[6]=g*i+b*c+x*d+w*m,e[7]=g*o+b*l+x*p+w*v,g=r[8],b=r[9],x=r[10],w=r[11],e[8]=g*n+b*s+x*f+w*_,e[9]=g*a+b*u+x*h+w*y,e[10]=g*i+b*c+x*d+w*m,e[11]=g*o+b*l+x*p+w*v,g=r[12],b=r[13],x=r[14],w=r[15],e[12]=g*n+b*s+x*f+w*_,e[13]=g*a+b*u+x*h+w*y,e[14]=g*i+b*c+x*d+w*m,e[15]=g*o+b*l+x*p+w*v,e}function translate(e,t,r){var n=r[0],a=r[1],i=r[2],o=void 0,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0,h=void 0,d=void 0,p=void 0,_=void 0,y=void 0,m=void 0;return t===e?(e[12]=t[0]*n+t[4]*a+t[8]*i+t[12],e[13]=t[1]*n+t[5]*a+t[9]*i+t[13],e[14]=t[2]*n+t[6]*a+t[10]*i+t[14],e[15]=t[3]*n+t[7]*a+t[11]*i+t[15]):(o=t[0],s=t[1],u=t[2],c=t[3],l=t[4],f=t[5],h=t[6],d=t[7],p=t[8],_=t[9],y=t[10],m=t[11],e[0]=o,e[1]=s,e[2]=u,e[3]=c,e[4]=l,e[5]=f,e[6]=h,e[7]=d,e[8]=p,e[9]=_,e[10]=y,e[11]=m,e[12]=o*n+l*a+p*i+t[12],e[13]=s*n+f*a+_*i+t[13],e[14]=u*n+h*a+y*i+t[14],e[15]=c*n+d*a+m*i+t[15]),e}function mat4_scale(e,t,r){var n=r[0],a=r[1],i=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function rotate(e,t,r,n){var a,i,o,s,u,c,l,f,h,d,p,_,y,m,v,g,x,w,k,M,T,P,z,I,S=n[0],E=n[1],N=n[2],C=Math.sqrt(S*S+E*E+N*N);return C<b?null:(S*=C=1/C,E*=C,N*=C,a=Math.sin(r),o=1-(i=Math.cos(r)),s=t[0],u=t[1],c=t[2],l=t[3],f=t[4],h=t[5],d=t[6],p=t[7],_=t[8],y=t[9],m=t[10],v=t[11],g=S*S*o+i,x=E*S*o+N*a,w=N*S*o-E*a,k=S*E*o-N*a,M=E*E*o+i,T=N*E*o+S*a,P=S*N*o+E*a,z=E*N*o-S*a,I=N*N*o+i,e[0]=s*g+f*x+_*w,e[1]=u*g+h*x+y*w,e[2]=c*g+d*x+m*w,e[3]=l*g+p*x+v*w,e[4]=s*k+f*M+_*T,e[5]=u*k+h*M+y*T,e[6]=c*k+d*M+m*T,e[7]=l*k+p*M+v*T,e[8]=s*P+f*z+_*I,e[9]=u*P+h*z+y*I,e[10]=c*P+d*z+m*I,e[11]=l*P+p*z+v*I,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function rotateX(e,t,r){var n=Math.sin(r),a=Math.cos(r),i=t[4],o=t[5],s=t[6],u=t[7],c=t[8],l=t[9],f=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*a+c*n,e[5]=o*a+l*n,e[6]=s*a+f*n,e[7]=u*a+h*n,e[8]=c*a-i*n,e[9]=l*a-o*n,e[10]=f*a-s*n,e[11]=h*a-u*n,e}function rotateY(e,t,r){var n=Math.sin(r),a=Math.cos(r),i=t[0],o=t[1],s=t[2],u=t[3],c=t[8],l=t[9],f=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*a-c*n,e[1]=o*a-l*n,e[2]=s*a-f*n,e[3]=u*a-h*n,e[8]=i*n+c*a,e[9]=o*n+l*a,e[10]=s*n+f*a,e[11]=u*n+h*a,e}function rotateZ(e,t,r){var n=Math.sin(r),a=Math.cos(r),i=t[0],o=t[1],s=t[2],u=t[3],c=t[4],l=t[5],f=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*a+c*n,e[1]=o*a+l*n,e[2]=s*a+f*n,e[3]=u*a+h*n,e[4]=c*a-i*n,e[5]=l*a-o*n,e[6]=f*a-s*n,e[7]=h*a-u*n,e}function fromTranslation(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function fromScaling(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromRotation(e,t,r){var n,a,i,o=r[0],s=r[1],u=r[2],c=Math.sqrt(o*o+s*s+u*u);return c<b?null:(o*=c=1/c,s*=c,u*=c,n=Math.sin(t),i=1-(a=Math.cos(t)),e[0]=o*o*i+a,e[1]=s*o*i+u*n,e[2]=u*o*i-s*n,e[3]=0,e[4]=o*s*i-u*n,e[5]=s*s*i+a,e[6]=u*s*i+o*n,e[7]=0,e[8]=o*u*i+s*n,e[9]=s*u*i-o*n,e[10]=u*u*i+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function fromXRotation(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromYRotation(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromZRotation(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromRotationTranslation(e,t,r){var n=t[0],a=t[1],i=t[2],o=t[3],s=n+n,u=a+a,c=i+i,l=n*s,f=n*u,h=n*c,d=a*u,p=a*c,_=i*c,y=o*s,m=o*u,v=o*c;return e[0]=1-(d+_),e[1]=f+v,e[2]=h-m,e[3]=0,e[4]=f-v,e[5]=1-(l+_),e[6]=p+y,e[7]=0,e[8]=h+m,e[9]=p-y,e[10]=1-(l+d),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function fromQuat2(e,t){var r=new w(3),n=-t[0],a=-t[1],i=-t[2],o=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=n*n+a*a+i*i+o*o;return f>0?(r[0]=2*(s*o+l*n+u*i-c*a)/f,r[1]=2*(u*o+l*a+c*n-s*i)/f,r[2]=2*(c*o+l*i+s*a-u*n)/f):(r[0]=2*(s*o+l*n+u*i-c*a),r[1]=2*(u*o+l*a+c*n-s*i),r[2]=2*(c*o+l*i+s*a-u*n)),fromRotationTranslation(e,t,r),e}function getTranslation(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function getScaling(e,t){var r=t[0],n=t[1],a=t[2],i=t[4],o=t[5],s=t[6],u=t[8],c=t[9],l=t[10];return e[0]=Math.sqrt(r*r+n*n+a*a),e[1]=Math.sqrt(i*i+o*o+s*s),e[2]=Math.sqrt(u*u+c*c+l*l),e}function getRotation(e,t){var r=t[0]+t[5]+t[10],n=0;return r>0?(n=2*Math.sqrt(r+1),e[3]=.25*n,e[0]=(t[6]-t[9])/n,e[1]=(t[8]-t[2])/n,e[2]=(t[1]-t[4])/n):t[0]>t[5]&&t[0]>t[10]?(n=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/n,e[0]=.25*n,e[1]=(t[1]+t[4])/n,e[2]=(t[8]+t[2])/n):t[5]>t[10]?(n=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/n,e[0]=(t[1]+t[4])/n,e[1]=.25*n,e[2]=(t[6]+t[9])/n):(n=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/n,e[0]=(t[8]+t[2])/n,e[1]=(t[6]+t[9])/n,e[2]=.25*n),e}function fromRotationTranslationScale(e,t,r,n){var a=t[0],i=t[1],o=t[2],s=t[3],u=a+a,c=i+i,l=o+o,f=a*u,h=a*c,d=a*l,p=i*c,_=i*l,y=o*l,m=s*u,v=s*c,g=s*l,b=n[0],x=n[1],w=n[2];return e[0]=(1-(p+y))*b,e[1]=(h+g)*b,e[2]=(d-v)*b,e[3]=0,e[4]=(h-g)*x,e[5]=(1-(f+y))*x,e[6]=(_+m)*x,e[7]=0,e[8]=(d+v)*w,e[9]=(_-m)*w,e[10]=(1-(f+p))*w,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function fromRotationTranslationScaleOrigin(e,t,r,n,a){var i=t[0],o=t[1],s=t[2],u=t[3],c=i+i,l=o+o,f=s+s,h=i*c,d=i*l,p=i*f,_=o*l,y=o*f,m=s*f,v=u*c,g=u*l,b=u*f,x=n[0],w=n[1],k=n[2],M=a[0],T=a[1],P=a[2],z=(1-(_+m))*x,I=(d+b)*x,S=(p-g)*x,E=(d-b)*w,N=(1-(h+m))*w,C=(y+v)*w,F=(p+g)*k,A=(y-v)*k,D=(1-(h+_))*k;return e[0]=z,e[1]=I,e[2]=S,e[3]=0,e[4]=E,e[5]=N,e[6]=C,e[7]=0,e[8]=F,e[9]=A,e[10]=D,e[11]=0,e[12]=r[0]+M-(z*M+E*T+F*P),e[13]=r[1]+T-(I*M+N*T+A*P),e[14]=r[2]+P-(S*M+C*T+D*P),e[15]=1,e}function fromQuat(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],o=r+r,s=n+n,u=a+a,c=r*o,l=n*o,f=n*s,h=a*o,d=a*s,p=a*u,_=i*o,y=i*s,m=i*u;return e[0]=1-f-p,e[1]=l+m,e[2]=h-y,e[3]=0,e[4]=l-m,e[5]=1-c-p,e[6]=d+_,e[7]=0,e[8]=h+y,e[9]=d-_,e[10]=1-c-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function frustum(e,t,r,n,a,i,o){var s=1/(r-t),u=1/(a-n),c=1/(i-o);return e[0]=2*i*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*i*u,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(a+n)*u,e[10]=(o+i)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i*2*c,e[15]=0,e}function perspective(e,t,r,n,a){var i=1/Math.tan(t/2),o=void 0;return e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(o=1/(n-a),e[10]=(a+n)*o,e[14]=2*a*n*o):(e[10]=-1,e[14]=-2*n),e}function perspectiveFromFieldOfView(e,t,r,n){var a=Math.tan(t.upDegrees*Math.PI/180),i=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(o+s),c=2/(a+i);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-s)*u*.5,e[9]=(a-i)*c*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function ortho(e,t,r,n,a,i,o){var s=1/(t-r),u=1/(n-a),c=1/(i-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*s,e[13]=(a+n)*u,e[14]=(o+i)*c,e[15]=1,e}function lookAt(e,t,r,n){var a=void 0,i=void 0,o=void 0,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0,h=void 0,d=void 0,p=t[0],_=t[1],y=t[2],m=n[0],v=n[1],g=n[2],x=r[0],w=r[1],k=r[2];return Math.abs(p-x)<b&&Math.abs(_-w)<b&&Math.abs(y-k)<b?identity(e):(l=p-x,f=_-w,h=y-k,a=v*(h*=d=1/Math.sqrt(l*l+f*f+h*h))-g*(f*=d),i=g*(l*=d)-m*h,o=m*f-v*l,(d=Math.sqrt(a*a+i*i+o*o))?(a*=d=1/d,i*=d,o*=d):(a=0,i=0,o=0),s=f*o-h*i,u=h*a-l*o,c=l*i-f*a,(d=Math.sqrt(s*s+u*u+c*c))?(s*=d=1/d,u*=d,c*=d):(s=0,u=0,c=0),e[0]=a,e[1]=s,e[2]=l,e[3]=0,e[4]=i,e[5]=u,e[6]=f,e[7]=0,e[8]=o,e[9]=c,e[10]=h,e[11]=0,e[12]=-(a*p+i*_+o*y),e[13]=-(s*p+u*_+c*y),e[14]=-(l*p+f*_+h*y),e[15]=1,e)}function targetTo(e,t,r,n){var a=t[0],i=t[1],o=t[2],s=n[0],u=n[1],c=n[2],l=a-r[0],f=i-r[1],h=o-r[2],d=l*l+f*f+h*h;d>0&&(l*=d=1/Math.sqrt(d),f*=d,h*=d);var p=u*h-c*f,_=c*l-s*h,y=s*f-u*l;return(d=p*p+_*_+y*y)>0&&(p*=d=1/Math.sqrt(d),_*=d,y*=d),e[0]=p,e[1]=_,e[2]=y,e[3]=0,e[4]=f*y-h*_,e[5]=h*p-l*y,e[6]=l*_-f*p,e[7]=0,e[8]=l,e[9]=f,e[10]=h,e[11]=0,e[12]=a,e[13]=i,e[14]=o,e[15]=1,e}function str(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function frob(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))}function add(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function subtract(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function multiplyScalar(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function multiplyScalarAndAdd(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function exactEquals(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function mat4_equals(e,t){var r=e[0],n=e[1],a=e[2],i=e[3],o=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=e[9],h=e[10],d=e[11],p=e[12],_=e[13],y=e[14],m=e[15],v=t[0],g=t[1],x=t[2],w=t[3],k=t[4],M=t[5],T=t[6],P=t[7],z=t[8],I=t[9],S=t[10],E=t[11],N=t[12],C=t[13],F=t[14],A=t[15];return Math.abs(r-v)<=b*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(n-g)<=b*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(a-x)<=b*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(i-w)<=b*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(o-k)<=b*Math.max(1,Math.abs(o),Math.abs(k))&&Math.abs(s-M)<=b*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(u-T)<=b*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(c-P)<=b*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(l-z)<=b*Math.max(1,Math.abs(l),Math.abs(z))&&Math.abs(f-I)<=b*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(h-S)<=b*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(d-E)<=b*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(p-N)<=b*Math.max(1,Math.abs(p),Math.abs(N))&&Math.abs(_-C)<=b*Math.max(1,Math.abs(_),Math.abs(C))&&Math.abs(y-F)<=b*Math.max(1,Math.abs(y),Math.abs(F))&&Math.abs(m-A)<=b*Math.max(1,Math.abs(m),Math.abs(A))}var M=multiply,T=subtract;function vec4_create(){var e=new w(4);return w!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function vec4_clone(e){var t=new w(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function vec4_fromValues(e,t,r,n){var a=new w(4);return a[0]=e,a[1]=t,a[2]=r,a[3]=n,a}function vec4_copy(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function vec4_set(e,t,r,n,a){return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e}function vec4_add(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function vec4_subtract(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function vec4_multiply(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function divide(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function ceil(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function floor(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function vec4_min(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function vec4_max(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function round(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function vec4_scale(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function scaleAndAdd(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e}function distance(e,t){var r=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2],i=t[3]-e[3];return Math.sqrt(r*r+n*n+a*a+i*i)}function squaredDistance(e,t){var r=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2],i=t[3]-e[3];return r*r+n*n+a*a+i*i}function vec4_length(e){var t=e[0],r=e[1],n=e[2],a=e[3];return Math.sqrt(t*t+r*r+n*n+a*a)}function squaredLength(e){var t=e[0],r=e[1],n=e[2],a=e[3];return t*t+r*r+n*n+a*a}function negate(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function inverse(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function normalize(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],o=r*r+n*n+a*a+i*i;return o>0&&(o=1/Math.sqrt(o),e[0]=r*o,e[1]=n*o,e[2]=a*o,e[3]=i*o),e}function dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function lerp(e,t,r,n){var a=t[0],i=t[1],o=t[2],s=t[3];return e[0]=a+n*(r[0]-a),e[1]=i+n*(r[1]-i),e[2]=o+n*(r[2]-o),e[3]=s+n*(r[3]-s),e}function random(e,t){var r,n,a,i,o,s;t=t||1;do{o=(r=2*k()-1)*r+(n=2*k()-1)*n}while(o>=1);do{s=(a=2*k()-1)*a+(i=2*k()-1)*i}while(s>=1);var u=Math.sqrt((1-o)/s);return e[0]=t*r,e[1]=t*n,e[2]=t*a*u,e[3]=t*i*u,e}function transformMat4(e,t,r){var n=t[0],a=t[1],i=t[2],o=t[3];return e[0]=r[0]*n+r[4]*a+r[8]*i+r[12]*o,e[1]=r[1]*n+r[5]*a+r[9]*i+r[13]*o,e[2]=r[2]*n+r[6]*a+r[10]*i+r[14]*o,e[3]=r[3]*n+r[7]*a+r[11]*i+r[15]*o,e}function transformQuat(e,t,r){var n=t[0],a=t[1],i=t[2],o=r[0],s=r[1],u=r[2],c=r[3],l=c*n+s*i-u*a,f=c*a+u*n-o*i,h=c*i+o*a-s*n,d=-o*n-s*a-u*i;return e[0]=l*c+d*-o+f*-u-h*-s,e[1]=f*c+d*-s+h*-o-l*-u,e[2]=h*c+d*-u+l*-s-f*-o,e[3]=t[3],e}function vec4_str(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function vec4_exactEquals(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function vec4_equals(e,t){var r=e[0],n=e[1],a=e[2],i=e[3],o=t[0],s=t[1],u=t[2],c=t[3];return Math.abs(r-o)<=b*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=b*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(a-u)<=b*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(i-c)<=b*Math.max(1,Math.abs(i),Math.abs(c))}var P=vec4_subtract,I=vec4_multiply,S=divide,E=distance,N=squaredDistance,C=vec4_length,F=squaredLength,A=function(){var e=vec4_create();return function(t,r,n,a,i,o){var s=void 0,u=void 0;for(r||(r=4),n||(n=0),u=a?Math.min(a*r+n,t.length):t.length,s=n;s<u;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],i(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}(),D=function average(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length},O=r(4),V=r.n(O),R=r(2),B=r.n(R),L=r(5),Z=r.n(L),q=r(23),j=function(e){function CartoError(e){var t;if(h()(this,CartoError),!e)throw Error("Invalid CartoError, a message is mandatory");if(!e.message)throw Error("Invalid CartoError, a message is mandatory");if(!e.type)throw Error("Invalid CartoError, a type is mandatory");return(t=V()(this,B()(CartoError).call(this,"".concat(e.type," ").concat(e.message)))).name="CartoError",t.type=e.type,t.originalError=e,t}return Z()(CartoError,e),CartoError}(r.n(q)()(Error)),G=function(e){function CartoValidationError(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U.DEFAULT;return h()(this,CartoValidationError),(t=V()(this,B()(CartoValidationError).call(this,{message:e,type:r}))).name="CartoValidationError",t}return Z()(CartoValidationError,e),CartoValidationError}(j),U={DEFAULT:"[Error]",MISSING_REQUIRED:"[Missing required property]",INCORRECT_TYPE:"[Property with an incorrect type]",INCORRECT_VALUE:"[Incorrect value]",TOO_MANY_ARGS:"[Too many arguments]",NOT_ENOUGH_ARGS:"[Not enough arguments]",WRONG_NUMBER_ARGS:"[Wrong number of arguments]"},W={UNKNOWN:"unknown",POINT:"point",LINE:"line",POLYGON:"polygon"};function geometry_sub(e,t){var r=o()(e,2),n=r[0],a=r[1],i=o()(t,2);return[n-i[0],a-i[1]]}function geometry_dot(e,t){var r=o()(e,2),n=r[0],a=r[1],i=o()(t,2);return n*i[0]+a*i[1]}function perpendicular(e){var t=o()(e,2),r=t[0];return[-t[1],r]}function getLineNormal(e,t){var r=function geometry_normalize(e,t){var r=Math.hypot(e,t);return[e/r,t/r]}(e[0]-t[0],e[1]-t[1]);return[-r[1],r[0]]}function getJoinNormal(e,t){var r=[e[1],-e[0]],n=[-t[1],t[0]],a=n[0]*r[1]-n[1]*r[0],i=n[0]*r[0]+n[1]*r[1],o=Math.abs(a);return{turnLeft:a>0,joinNormal:!(o<.866&&i>.5)&&neg([(r[0]+n[0])/o,(r[1]+n[1])/o])}}function neg(e){return[-e[0],-e[1]]}function halfPlaneSign(e,t,r){return(e.x-r.x)*(t.y-r.y)-(t.x-r.x)*(e.y-r.y)}function equalPoints(e,t){return e.x===t.x&&e.y===t.y}function computeCentroids(e,t){switch(t){case W.POINT:return function _computeCentroidsForPoints(e){for(var t=[],r=0;r<e.vertices.length/6;r++){var n=6*r,a=n+6,i=e.vertices.slice(n,a),s=o()(i,6),u=s[4],c=s[5];t.push({x:u,y:c})}return t}(e);case W.LINE:case W.POLYGON:return function _computeCentroidsForLinesOrPolygons(e,t){var r=[],n=0;return e.breakpoints.forEach(function(a){var i=e.vertices.slice(n,a),s=null;s=t===W.LINE?function _centroidForLines(e){for(var t=[],r=[],n=0;n<e.length/6;n++){var a=6*n,i=a+6,s=e.slice(a,i),u=o()(s,6),c=u[0],l=u[1],f=u[2],h=u[3],d=u[4],p=u[5],_=c===f&&l===h,y=f===d&&h===p;if(!_||!y){var m=[c,l],v=_?[d,p]:[f,h];t.push(m[0]),t.push(v[0]),r.push(m[1]),r.push(v[1])}}return{x:D(t),y:D(r)}}(i):function _centroidForPolygons(e){for(var t=[],r=[],n=[],a=0;a<e.length/6;a++){var i=6*a,s=i+6,u=e.slice(i,s),c=o()(u,6),l=c[0],f=c[1],h=c[2],d=c[3],p=c[4],_=c[5],y=[[l,f],[h,d],[p,_]],m=triangleArea(y);if(m>0){var v=D([l,h,p]),g=D([f,d,_]);t.push(v*m),r.push(g*m),n.push(m)}}var b=_sumArray(n);return{x:_sumArray(t)/b,y:_sumArray(r)/b}}(i),r.push(s),n=a}),r}(e,t);default:throw new G("Invalid type argument, decoded geometry must have a point, line or polygon type.",U.INCORRECT_VALUE)}}function _sumArray(e){return e.reduce(function(e,t){return e+t},0)}function triangleArea(e){var t=o()(e[0],2),r=t[0],n=t[1],a=o()(e[1],2),i=a[0],s=a[1],u=o()(e[2],2),c=u[0],l=u[1];return Math.abs((r-c)*(s-n)-(r-i)*(l-n))/2}function _updateAABBForGeometry(e,t,r){switch(r){case W.LINE:return function _updateAABBLine(e,t){for(var r=e,n=e.length,a=0;a<n;a+=2)t.minx=Math.min(t.minx,r[a+0]),t.miny=Math.min(t.miny,r[a+1]),t.maxx=Math.max(t.maxx,r[a+0]),t.maxy=Math.max(t.maxy,r[a+1]);return t}(e,t);case W.POLYGON:return function _updateAABBPolygon(e,t){for(var r=[e.flat,e.holes[0]||e.flat.length/2],n=r[0],a=r[1],i=0;i<a;i++)t.minx=Math.min(t.minx,n[2*i+0]),t.miny=Math.min(t.miny,n[2*i+1]),t.maxx=Math.max(t.maxx,n[2*i+0]),t.maxy=Math.max(t.maxy,n[2*i+1]);return t}(e,t)}}var Y={intersect:function geometry_intersect(e,t,r,n){var a=e,i=r,o=geometry_sub(t,e),s=geometry_sub(n,r),u=perpendicular(o),c=perpendicular(s),l=geometry_dot(geometry_sub(i,a),c)/geometry_dot(o,c),f=geometry_dot(geometry_sub(a,i),u)/geometry_dot(s,u);if(l>=0&&l<=1&&f>=0&&f<=1)return[a[0]+l*o[0],a[1]+l*o[1]]},sub:geometry_sub,dot:geometry_dot,perpendicular:perpendicular,getLineNormal:getLineNormal,getJoinNormal:getJoinNormal,neg:neg,halfPlaneSign:halfPlaneSign,pointInTriangle:function pointInTriangle(e,t,r,n){if(equalPoints(t,r)||equalPoints(r,n)||equalPoints(n,t))return!1;var a=halfPlaneSign(e,t,r)<0,i=halfPlaneSign(e,r,n)<0,o=halfPlaneSign(e,n,t)<0;return a===i&&i===o},equalPoints:equalPoints,pointInCircle:function pointInCircle(e,t,r){var n=e.x-t.x,a=e.y-t.y;return n*n+a*a<=r*r},pointInRectangle:function pointInRectangle(e,t){if(null===t)return!1;var r=e.x.toFixed(2),n=e.y.toFixed(2);return t.minx<=r&&r<=t.maxx&&t.miny<=n&&n<=t.maxy}},Q=function Polygon(){h()(this,Polygon),this.flat=[],this.holes=[],this.clipped=[],this.clippedType=[]};function decodeLines(e,t){var r=[];return e.map(function(e){var n=[];e.map(function(e){n.push([2*e.x/t-1,2*(1-e.y/t)-1])}),r.push.apply(r,g()(function clipLine(e){var t=[],r=[];function clipType(e){for(var t=0,r=0;r<J;r++)t|=H[r].inside(e)?0:1<<r;return t}function intersect(e,t,r){for(var n=0;n<J;n++){var a=1<<n;if(r&a){var i=H[n].intersect(e,t);return r=clipType(i)&~a,[i,r]}}}for(var n=e[0],a=clipType(n),i=1;i<e.length;++i){for(var s=e[i],u=clipType(s),c=u,l=s;;){if(!(a|u)){var f,h;if((f=t).push.apply(f,g()(n)),u!==c)(h=t).push.apply(h,g()(s)),i<e.length-1&&(r.push(t),t=[]);else if(i===e.length-1){var d;(d=t).push.apply(d,g()(s))}break}if(a&u)break;if(a){var p=intersect(n,s,a),_=o()(p,2);n=_[0],a=_[1]}else{var y=intersect(n,s,u),m=o()(y,2);s=m[0],u=m[1]}}n=l,a=c}(t=function _removeDuplicatedVerticesOnLine(e){for(var t,r,n=[],a=0;a<e.length;a+=2){var i=e[a],o=e[a+1];i===t&&o===r||(n.push(i,o),t=i,r=o)}return n}(t)).length>0&&r.push(t);return r}(n)))}),r}function decodePolygons(e,t){var r,n=null,a=[];return e.forEach(function(e){var i=function signedPolygonArea(e){for(var t=0,r=0;r<e.length;r++){var n=(r+1)%e.length;t+=e[r].x*e[n].y,t-=e[n].x*e[r].y}return t/2}(e);if(0!==i){void 0===r&&(r=i>0);var o=r?i>0:i<0,s=function _getPreClippedVertices(e,t){return e.map(function(e){var r=e.x,n=e.y;return[r=2*r/t-1,n=2*(1-n/t)-1]})}(e,t);o&&(n&&a.push(n),n=new Q),n=function clipPolygon(e,t,r){for(var n={},a=function _loop(t){for(var r=[],a={},i=function setClippedType(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,i=0;t>=0&&(i=n[t]||0),r>=0&&(i|=1<<r),i&&(a[e]=i)},o=0;o<e.length-1;o++){var s=e[o],u=e[o+1],c=H[t].inside(s),l=H[t].inside(u);if(c&&l)i(r.length,o+1),r.push(u);else if(c){var f=H[t].intersect(s,u);i(r.length,o+1,t),r.push(f)}else if(l){var h=H[t].intersect(s,u);i(r.length,o,t),r.push(h),i(r.length,o+1),r.push(u)}}r.length&&(a[0]&&(a[r.length]=a[0]),r.push(r[0])),e=r,n=a},i=0;i<J;i++)a(i);e.length>=4&&(r&&t.holes.push(t.flat.length/2),e.forEach(function(e){t.flat.push(e[0],e[1])}),Object.keys(n).forEach(function(e){t.clipped.push(2*Number(e)),t.clippedType.push(n[e])}));return t}(s,n,!o)}}),n&&a.push(n),a}var H=[{inside:function inside(e){return e[0]<=1},intersect:function intersect(e,t){return Y.intersect(e,t,[1,-100],[1,100])}},{inside:function inside(e){return e[1]<=1},intersect:function intersect(e,t){return Y.intersect(e,t,[-100,1],[100,1])}},{inside:function inside(e){return e[0]>=-1},intersect:function intersect(e,t){return Y.intersect(e,t,[-1,-100],[-1,100])}},{inside:function inside(e){return e[1]>=-1},intersect:function intersect(e,t){return Y.intersect(e,t,[-100,-1],[100,-1])}}],J=H.length;var $=function(e){function CartoRuntimeError(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:K.DEFAULT;return h()(this,CartoRuntimeError),(t=V()(this,B()(CartoRuntimeError).call(this,{message:e,type:r}))).name="CartoRuntimeError",t}return Z()(CartoRuntimeError,e),CartoRuntimeError}(j),K={DEFAULT:"[Error]",NOT_SUPPORTED:"[Not supported]",WEB_GL:"[WebGL]",MVT:"[MVT]"},X=function(){function BaseCodec(e,t){h()(this,BaseCodec),e&&t&&(this._baseName=e.baseName(t))}return p()(BaseCodec,[{key:"isRange",value:function isRange(){return!1}},{key:"isIdentity",value:function isIdentity(){return!1}},{key:"sourceToInternal",value:function sourceToInternal(e,t){return t}},{key:"internalToExternal",value:function internalToExternal(e,t){return t}},{key:"externalToSource",value:function externalToSource(e,t){return t}},{key:"sourceToExternal",value:function sourceToExternal(e,t){return this.internalToExternal(e,this.sourceToInternal(e,t))}},{key:"externalToInternal",value:function externalToInternal(e,t){return this.sourceToInternal(e,this.externalToSource(e,t))}},{key:"inlineInternalMatch",value:function inlineInternalMatch(e,t){return"".concat(e)}}]),BaseCodec}(),ee=function(e){function IdentityCodec(){return h()(this,IdentityCodec),V()(this,B()(IdentityCodec).apply(this,arguments))}return Z()(IdentityCodec,e),p()(IdentityCodec,[{key:"isIdentity",value:function isIdentity(){return!0}},{key:"sourceToInternal",value:function sourceToInternal(e,t){return t}},{key:"internalToExternal",value:function internalToExternal(e,t){return t}},{key:"sourceToExternal",value:function sourceToExternal(e,t){return t}},{key:"externalToSource",value:function externalToSource(e,t){return t}},{key:"externalToInternal",value:function externalToInternal(e,t){return t}}]),IdentityCodec}(X),te=4096,re="cartodb_id",ne=function(){function Metadata(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{properties:{}},r=t.properties,n=t.featureCount,a=t.sample,i=t.geomType,o=t.isAggregated,s=t.idProperty,u=t.extent;h()(this,Metadata),this.properties=r,this.featureCount=n,this.sample=a,this.geomType=i,this.isAggregated=o,this.idProperty=s||re,this.properties.hasOwnProperty(this.idProperty)||(this.properties[this.idProperty]={type:"number"}),this.categoryToID=new Map,this.IDToCategory=new Map,this.numCategories=0,this.extent=u||te,Object.values(r).map(function(t){t.categories=t.categories||[],t.categories.map(function(r){return e.categorizeString(t,r.name,!0)})}),this.propertyKeys=Object.keys(r)}return p()(Metadata,[{key:"setCodecs",value:function setCodecs(){throw new $(\'You must call "setCodecs" once you have determined the proper subclass\')}},{key:"categorizeString",value:function categorizeString(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===t&&(t=null),this.categoryToID.has(t))return this.categoryToID.get(t);r||null===t||this.properties[e].categories.push({name:t,frequency:Number.NaN});var n=null===t?-(1<<24):this.numCategories;return this.categoryToID.set(t,n),this.IDToCategory.set(n,t),this.numCategories++,n}},{key:"decodedProperties",value:function decodedProperties(e){return[e]}},{key:"baseName",value:function baseName(e){return e}},{key:"sourcePropertyName",value:function sourcePropertyName(e){return e}},{key:"stats",value:function stats(e){return this.properties[e]}},{key:"codec",value:function codec(e){var t=this.baseName(e);return this.properties[t]&&this.properties[t].codec?this.properties[t].codec:new ee}}]),Metadata}(),ae=r(10),ie=r.n(ae),oe=r(11),se=r.n(oe),ue=function(e){function NumberCodec(){return h()(this,NumberCodec),V()(this,B()(NumberCodec).apply(this,arguments))}return Z()(NumberCodec,e),p()(NumberCodec,[{key:"sourceToInternal",value:function sourceToInternal(e,t){return(isNaN(t)||null==t)&&(t=-(1<<24)),t}},{key:"internalToExternal",value:function internalToExternal(e,t){return t===-(1<<24)&&(t=null),t}},{key:"externalToInternal",value:function externalToInternal(e,t){return null===t&&(t=-(1<<24)),t}}]),NumberCodec}(ee),ce=function(e){function MVTNumberCodec(){return h()(this,MVTNumberCodec),V()(this,B()(MVTNumberCodec).apply(this,arguments))}return Z()(MVTNumberCodec,e),p()(MVTNumberCodec,[{key:"sourceToInternal",value:function sourceToInternal(e,t){var r=ie()(t);if(null!==t&&"undefined"!==r&&"number"!==r)throw new $("MVT decoding error. Metadata property \'".concat(this._baseName,"\' is of type \'number\' but the MVT tile contained a feature property of type \'").concat(r,"\': \'").concat(t,"\'"),K.MVT);return se()(B()(MVTNumberCodec.prototype),"sourceToInternal",this).call(this,e,t)}}]),MVTNumberCodec}(ue),le=function(e){function CategoryCodec(){return h()(this,CategoryCodec),V()(this,B()(CategoryCodec).apply(this,arguments))}return Z()(CategoryCodec,e),p()(CategoryCodec,[{key:"sourceToInternal",value:function sourceToInternal(e,t){return e.categorizeString(this._baseName,t)}},{key:"internalToExternal",value:function internalToExternal(e,t){return e.IDToCategory.get(t)}},{key:"sourceToExternal",value:function sourceToExternal(e,t){return t}},{key:"externalToSource",value:function externalToSource(e,t){return t}}]),CategoryCodec}(X),fe=function(e){function MVTCategoryCodec(){return h()(this,MVTCategoryCodec),V()(this,B()(MVTCategoryCodec).apply(this,arguments))}return Z()(MVTCategoryCodec,e),p()(MVTCategoryCodec,[{key:"sourceToInternal",value:function sourceToInternal(e,t){var r=ie()(t);if(null!==t&&"undefined"!==r&&"string"!==r)throw new $("MVT decoding error. Metadata property \'".concat(this._baseName,"\' is of type \'category\' but the MVT tile contained a feature property of type \'").concat(r,"\': \'").concat(t,"\'"),K.MVT);return se()(B()(MVTCategoryCodec.prototype),"sourceToInternal",this).call(this,e,t)}}]),MVTCategoryCodec}(le);var he=function(e){function MVTMetadata(){return h()(this,MVTMetadata),V()(this,B()(MVTMetadata).apply(this,arguments))}return Z()(MVTMetadata,e),p()(MVTMetadata,[{key:"setCodecs",value:function setCodecs(){var e=this;Object.keys(this.properties).forEach(function(t){var r=e.properties[t],n=r.type;"geometry"!==n&&(r.codec=function MVTCodecFactory(e,t,r){switch(t){case"number":return new ce(e,r);case"category":return new fe(e,r);default:throw new $("MVT decoding error. Feature property value of type \'".concat(t,"\' cannot be decoded."),K.MVT)}}(e,n,t))})}}]),MVTMetadata}(ne);function addLineString(e,t,r,n,a){var i,o,s,u,c;if(e.length>=4){i=[e[0],e[1]];for(var l=2;l<=e.length;l+=2)if(o=[e[l],e[l+1]],i[0]!==o[0]||i[1]!==o[1]){l+=2;break}for(s=getLineNormal(i,o);l<=e.length;l+=2){c=!(a&&a(l));var f=void 0;if(l<=e.length-2?f=[e[l],e[l+1]]:n&&(f=[e[2],e[3]]),!c||i[0]===o[0]&&i[1]===o[1]||(t.vertices[r]=i[0],t.normals[r++]=-s[0],t.vertices[r]=i[1],t.normals[r++]=-s[1],t.vertices[r]=i[0],t.normals[r++]=s[0],t.vertices[r]=i[1],t.normals[r++]=s[1],t.vertices[r]=o[0],t.normals[r++]=s[0],t.vertices[r]=o[1],t.normals[r++]=s[1],t.vertices[r]=i[0],t.normals[r++]=-s[0],t.vertices[r]=i[1],t.normals[r++]=-s[1],t.vertices[r]=o[0],t.normals[r++]=s[0],t.vertices[r]=o[1],t.normals[r++]=s[1],t.vertices[r]=o[0],t.normals[r++]=-s[0],t.vertices[r]=o[1],t.normals[r++]=-s[1]),!f||f[0]===o[0]&&f[1]===o[1])u=s;else if(u=getLineNormal(o,f),c){var h=getJoinNormal(s,u),d=h.turnLeft,p=h.joinNormal,_=d?s:neg(u),y=d?u:neg(s);t.vertices[r]=o[0],t.normals[r++]=0,t.vertices[r]=o[1],t.normals[r++]=n?1e-37:0,t.vertices[r]=o[0],t.normals[r++]=_[0],t.vertices[r]=o[1],t.normals[r++]=_[1],t.vertices[r]=o[0],t.normals[r++]=y[0],t.vertices[r]=o[1],t.normals[r++]=y[1],p&&(t.vertices[r]=o[0],t.normals[r++]=p[0],t.vertices[r]=o[1],t.normals[r++]=p[1],t.vertices[r]=o[0],t.normals[r++]=y[0],t.vertices[r]=o[1],t.normals[r++]=y[1],t.vertices[r]=o[0],t.normals[r++]=_[0],t.vertices[r]=o[1],t.normals[r++]=_[1])}i=o,o=f,s=u}}return r}function resizeBuffer(e,t){var r=new Float32Array(t);return r.set(e),r}var de=24,pe=0,_e={vertices:new Float32Array(1048576),normals:new Float32Array(1048576)};function resizeBuffers(e){var t=pe+e;if(t>_e.vertices.length){var r=2*t;_e.vertices=resizeBuffer(_e.vertices,r),_e.normals=resizeBuffer(_e.normals,r)}}var ye=r(24),me=2,ve=24,ge=0,be={vertices:new Float32Array(2097152),normals:new Float32Array(2097152)};function polygonDecoder_resizeBuffers(e){var t=ge+e;if(t>be.vertices.length){var r=2*t;be.vertices=resizeBuffer(be.vertices,r),be.normals=resizeBuffer(be.normals,r)}}function addVertex(e,t){be.vertices[ge]=e[t],be.normals[ge++]=0,be.vertices[ge]=e[t+1],be.normals[ge++]=0}function isClipped(e,t,r){return!!(e.clipped.includes(t)&&e.clipped.includes(r)&&e.clippedType[e.clipped.indexOf(t)]&e.clippedType[e.clipped.indexOf(r)])}function decodeGeom(e,t){switch(e){case W.POINT:return function decodePoint(e){return{verticesArrayBuffer:e,vertices:new Float32Array(e),breakpoints:[]}}(t);case W.LINE:return function decodeLine(e){var t=[],r=new Map;pe=0;for(var n=0;n<e.length;n++){for(var a=e[n],i=0;i<a.length;i++)resizeBuffers(de*a[i].length),pe=addLineString(a[i],_e,pe);r.set(t.length,0===t.length?{start:0,end:pe}:{start:r.get(t.length-1).end,end:pe}),t.push(pe)}for(var o=new ArrayBuffer(4*pe),s=new ArrayBuffer(4*pe),u=new Float32Array(o),c=new Float32Array(s),l=0;l<pe;l++)u[l]=_e.vertices[l],c[l]=_e.normals[l];return{vertices:u,normals:c,verticesArrayBuffer:o,normalsArrayBuffer:s,featureIDToVertexIndex:r,breakpoints:t}}(t);case W.POLYGON:return function decodePolygon(e){var t=[],r=new Map;ge=0;for(var n=0;n<e.length;n++){for(var a=e[n],i=function _loop(e){var t=a[e],r=ye(t.flat,t.holes);polygonDecoder_resizeBuffers(me*r.length+ve*t.flat.length);for(var n=0;n<r.length;n++)addVertex(t.flat,2*r[n]);ge=addLineString(t.flat,be,ge,!0,function(e){return t.holes.includes((e-2)/2)||isClipped(t,e-4,e-2)})},o=0;o<a.length;o++)i(o);r.set(t.length,0===t.length?{start:0,end:ge}:{start:r.get(t.length-1).end,end:ge}),t.push(ge)}for(var s=new ArrayBuffer(4*ge),u=new ArrayBuffer(4*ge),c=new Float32Array(s),l=new Float32Array(u),f=0;f<ge;f++)c[f]=be.vertices[f],l[f]=be.normals[f];return{vertices:c,normals:l,verticesArrayBuffer:s,normalsArrayBuffer:u,featureIDToVertexIndex:r,breakpoints:t}}(t);default:throw new $("Unimplemented geometry type: \'".concat(e,"\'."),K.NOT_SUPPORTED)}}var xe=function DummyDataframe(e){var t=e.active,r=e.center,n=e.properties,a=e.propertiesArrayBuffer,i=e.scale,o=e.type,s=e.geom,u=e.size,c=e.metadata,l=e.x,f=e.y,d=e.z;h()(this,DummyDataframe),this.active=t,this.center=r,this.properties=n,this.propertiesArrayBuffer=a,this.scale=i,this.type=o,this.decodedGeom=decodeGeom(o,s),this.numVertex=o===W.POINT?3*u:this.decodedGeom.vertices.length/2,this.numFeatures=o===W.POINT?u:this.decodedGeom.breakpoints.length||this.numVertex,this.propertyTex=[],this.metadata=c,this.propertyCount=0,this.x=l,this.y=f,this.z=d,this._aabb=function computeAABB(e,t){switch(t){case W.POINT:return[];case W.LINE:case W.POLYGON:for(var r=[],n=0;n<e.length;n++){for(var a=e[n],i={minx:Number.POSITIVE_INFINITY,miny:Number.POSITIVE_INFINITY,maxx:Number.NEGATIVE_INFINITY,maxy:Number.NEGATIVE_INFINITY},o=0;o<a.length;o++)i=_updateAABBForGeometry(a[o],i,t);i.minx===Number.POSITIVE_INFINITY&&(i=null),r.push(i)}return r}}(s,o),this._centroids=computeCentroids(this.decodedGeom,o),this.t1=[.1,.1,.1,.1],this.t2=[.1,.1,.1,.1],this.t3=[.1,.1,.1,.1],this.t4=[.1,.1,.1,.1]},we=1,ke=2,Me=3,Te={1:W.POINT,2:W.LINE,3:W.POLYGON},Pe=function(){function MVTWorker(){h()(this,MVTWorker)}return p()(MVTWorker,[{key:"onmessage",value:function onmessage(e){this.processEvent(e).then(function(e){var t=[];e.dataframe.empty||(t.push(e.dataframe.propertiesArrayBuffer),t.push(e.dataframe.decodedGeom.verticesArrayBuffer),e.dataframe.decodedGeom.normalsArrayBuffer&&t.push(e.dataframe.decodedGeom.normalsArrayBuffer)),postMessage(e,t)})}},{key:"processEvent",value:function(){var e=l()(u.a.mark(function _callee(e){var t,r;return u.a.wrap(function _callee$(n){for(;;)switch(n.prev=n.next){case 0:return(t=e.data).metadata&&(this.castMetadata(t.metadata),this.metadata=t.metadata),n.next=4,this._requestDataframe(t.x,t.y,t.z,t.url,t.layerID,this.metadata);case 4:return r=n.sent,n.abrupt("return",{mID:t.mID,dataframe:r});case 6:case"end":return n.stop()}},_callee,this)}));return function processEvent(t){return e.apply(this,arguments)}}()},{key:"castMetadata",value:function castMetadata(e){Object.setPrototypeOf(e,he.prototype),e.setCodecs()}},{key:"_requestDataframe",value:function(){var e=l()(u.a.mark(function _callee2(e,t,r,n,a,i){var o,s;return u.a.wrap(function _callee2$(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,fetch(n);case 2:return o=u.sent,u.next=5,this.urlToDataframeTransformer(o,e,t,r,a,i);case 5:return s=u.sent,u.abrupt("return",s);case 7:case"end":return u.stop()}},_callee2,this)}));return function _requestDataframe(t,r,n,a,i,o){return e.apply(this,arguments)}}()},{key:"urlToDataframeTransformer",value:function(){var e=l()(u.a.mark(function _callee3(e,t,r,n,a,i){var o,s,c,l,f,h,d,p,y,v,g;return u.a.wrap(function _callee3$(u){for(;;)switch(u.prev=u.next){case 0:return o=i.extent,u.next=3,e.arrayBuffer();case 3:if(0!==(s=u.sent).byteLength&&"null"!==e){u.next=6;break}return u.abrupt("return",{empty:!0});case 6:if(c=new _.VectorTile(new m(s)),!(Object.keys(c.layers).length>1)||a){u.next=9;break}throw new G("LayerID parameter wasn\'t specified and the MVT tile contains multiple layers: ".concat(JSON.stringify(Object.keys(c.layers)),"."),U.MISSING_REQUIRED);case 9:if(l=c.layers[a||Object.keys(c.layers)[0]]){u.next=12;break}return u.abrupt("return",{empty:!0});case 12:return f=this._decodeMVTLayer(l,i,o),h=f.geometries,d=f.properties,p=f.propertiesArrayBuffer,y=f.numFeatures,v=getRsysFromTile(t,r,n),g=this._generateDataFrame(v,h,d,p,y,i.geomType,i),u.abrupt("return",g);case 16:case"end":return u.stop()}},_callee3,this)}));return function urlToDataframeTransformer(t,r,n,a,i,o){return e.apply(this,arguments)}}()},{key:"_decodeMVTLayer",value:function _decodeMVTLayer(e,t,r){if(!e.length)return{properties:[],geometries:{},propertiesArrayBuffer:[],numFeatures:0};switch(t.geomType||(t.geomType=this._autoDiscoverType(e)),t.geomType){case W.POINT:var n=new ArrayBuffer(2*e.length*3*4);return this._decode(e,t,r,n);case W.LINE:return this._decode(e,t,r,[],decodeLines);case W.POLYGON:return this._decode(e,t,r,[],decodePolygons);default:throw new G("MVT: invalid geometry type \'".concat(t.geomType,"\'"),U.INCORRECT_TYPE)}}},{key:"_autoDiscoverType",value:function _autoDiscoverType(e){var t=e.feature(0).type;switch(t){case we:return W.POINT;case ke:return W.LINE;case Me:return W.POLYGON;default:throw new G("MVT: invalid geometry type \'".concat(t,"\'"),U.INCORRECT_TYPE)}}},{key:"_decode",value:function _decode(e,t,r,n,a){var i,o=0;n&&(i=new Float32Array(n));for(var s=this._initializePropertyArrays(t,e.length),u=s.properties,c=s.propertiesArrayBuffer,l=this._scalarPropertyCodecs(t),f=this._rangePropertyCodecs(t),h=0;h<e.length;h++){var d=e.feature(h);this._checkType(d,t.geomType);var p=d.loadGeometry();if(a){var _=a(p,r);n.push(_)}else{var y=2*p[0][0].x/r-1,m=2*(1-p[0][0].y/r)-1;if(y<-1||y>=1||m<-1||m>=1)continue;i[6*o+0]=y,i[6*o+1]=m,i[6*o+2]=y,i[6*o+3]=m,i[6*o+4]=y,i[6*o+5]=m}if(void 0===d.properties[t.idProperty])throw new $("MVT feature with undefined idProperty \'".concat(t.idProperty,"\'"),K.MVT);this._decodeProperties(t,l,f,u,d,o),o++}return{properties:u,propertiesArrayBuffer:c,geometries:n,numFeatures:o}}},{key:"_checkType",value:function _checkType(e,t){var r=e.type,n=Te[r];if(n!==t)throw new $("MVT: mixed geometry types in the same layer. Layer has type: ".concat(t," but feature was ").concat(n),K.MVT)}},{key:"_initializePropertyArrays",value:function _initializePropertyArrays(e,t){var r=this._getPropertyNamesFrom(e),n=this._getPropertiesFor(r,t);return{propertyNames:r,properties:n.properties,propertiesArrayBuffer:n.propertiesArrayBuffer}}},{key:"_getSourcePropertyNamesFrom",value:function _getSourcePropertyNamesFrom(e){return e.propertyKeys.filter(function(t){return"geometry"!==e.properties[e.baseName(t)].type})}},{key:"_getPropertyNamesFrom",value:function _getPropertyNamesFrom(e){var t=[];return this._getSourcePropertyNamesFrom(e).forEach(function(r){e.decodedProperties(r).forEach(function(e){t.push(e)})}),t}},{key:"_getPropertiesFor",value:function _getPropertiesFor(e,t){for(var r={},n=1024*Math.ceil(t/1024),a=new ArrayBuffer(4*n*e.length),i=a,o=0;o<e.length;o++){r[e[o]]=new Float32Array(a,4*o*n,n)}return{properties:r,propertiesArrayBuffer:i}}},{key:"_scalarPropertyCodecs",value:function _scalarPropertyCodecs(e){return this._getSourcePropertyNamesFrom(e).map(function(t){return[t,e.codec(t)]}).filter(function(e){var t=o()(e,2);t[0];return!t[1].isRange()})}},{key:"_rangePropertyCodecs",value:function _rangePropertyCodecs(e){return this._getSourcePropertyNamesFrom(e).map(function(t){return[t,e.decodedProperties(t),e.codec(t)]}).filter(function(e){var t=o()(e,3);t[0],t[1];return t[2].isRange()})}},{key:"_decodeProperties",value:function _decodeProperties(e,t,r,n,a,i){for(var s=t.length,u=0;u<s;u++){var c=o()(t[u],2),l=c[0],f=c[1],h=a.properties[l];n[l][i]=f.sourceToInternal(e,h)}s=r.length;for(var d=0;d<s;d++){var p=o()(r[d],3),_=(l=p[0],o()(p[1],2)),y=_[0],m=_[1],v=(f=p[2],a.properties[l]),g=f.sourceToInternal(e,v),b=o()(g,2),x=b[0],w=b[1];n[y][i]=x,n[m][i]=w}}},{key:"_generateDataFrame",value:function _generateDataFrame(e,t,r,n,a,i,o){return new xe({active:!1,center:e.center,geom:t,properties:r,propertiesArrayBuffer:n,scale:e.scale,size:a,type:i,metadata:o})}}]),MVTWorker}(),ze=["year","month","day","hour","minute","second"],Ie=[1,1,1,0,0,0],Se=0,Ee=1,Ne=2,Ce=3,Fe=4,Ae=5,De=864e5,Oe=36e5,Ve=6e4,Re=1e3;function startLevel(e){for(var t=ze.length-1;t>0&&e[ze[t]]===Ie[t];)--t;return t}function pad(e,t){return e.toString().padStart(t,"0")}function parsedValue(e){var t=msToDate(e);return{year:t.getUTCFullYear(),month:t.getUTCMonth()+1,day:t.getUTCDate(),hour:t.getUTCHours(),minute:t.getUTCMinutes(),second:t.getUTCSeconds()}}function invalidPeriod(e,t){throw new Error("Invalid period of ".concat(t," between ").concat(e.v1," and ").concat(e.v2))}function yearWeek(e,t){var r=function isoDow(e,t,r){var n=new Date(e,t-1,r).getDay();return 0===n?7:n}(e,1,1),n=r>4?9-r:2-r;return Math.abs(t-n)%7!=0?[]:t<n?yearWeek(e-1,t+=Math.round((Date.UTC(e,0,1)-Date.UTC(e-1,0,1))/De)):Date.UTC(e,0,1)+(t-1+3)*De>=Date.UTC(e+1,0,1)?yearWeek(e+1,t-=Math.round((Date.UTC(e+1,0,1)-Date.UTC(e,0,1))/De)):[e,1+Math.round((t-n)/7)]}function periodISO(e,t){var r=parsedValue(e),n=parsedValue(t),a=startLevel(r),i=startLevel(n),s={v1:e,v2:t,t1:r,t2:n};return Math.max(a,i)===Se?function yearsPeriod(e){var t=e.t2.year-e.t1.year;return 1e3===t&&(e.t1.year-1)%1e3==0?"M".concat(1+(e.t1.year-1)/1e3):100===t&&(e.t1.year-1)%100==0?"C".concat(1+(e.t1.year-1)/100):10===t&&e.t1.year%10==0?"D".concat(e.t1.year/10):1===t?pad(e.t1.year,4):void invalidPeriod("".concat(t," years"))}(s):Math.max(a,i)===Ee?function monthsPeriod(e){var t=12*e.t2.year+e.t2.month-12*e.t1.year-e.t1.month;return 6===t&&(e.t1.month-1)%6==0?"".concat(pad(e.t1.year,4),"S").concat(1+(e.t1.month-1)/6):4===t?"".concat(pad(e.t1.year,4),"t").concat(1+(e.t1.month-1)/4):3===t?"".concat(pad(e.t1.year,4),"-Q").concat(1+(e.t1.month-1)/3):1===t?"".concat(pad(e.t1.year,4),"-").concat(pad(e.t1.month,2)):void invalidPeriod("".concat(t," months"))}(s):Math.max(a,i)===Ne?function daysPeriod(e){var t=Math.round((e.v2-e.v1)/De);if(1===t)return"".concat(pad(e.t1.year,4),"-").concat(pad(e.t1.month,2),"-").concat(pad(e.t1.day,2));if(7===t){var r=e.t1.year,n=Date.UTC(r,0,1),a=yearWeek(r,1+Math.round((e.v1-n)/De)),i=o()(a,2),s=i[0],u=i[1];if(s&&u)return"".concat(pad(s,4),"-W").concat(pad(u,2));invalidPeriod("7 days")}else invalidPeriod("".concat(t," days"))}(s):Math.max(a,i)===Ce?function hoursPeriod(e){var t=Math.round((e.v2-e.v1)/Oe);if(1===t)return"".concat(pad(e.t1.year,4),"-").concat(pad(e.t1.month,2),"-").concat(pad(e.t1.day,2),"T").concat(pad(e.t1.hour,2));invalidPeriod("".concat(t," hours"))}(s):Math.max(a,i)===Fe?function minutesPeriod(e){var t=Math.round((e.v2-e.v1)/Ve);if(1===t)return"".concat(pad(e.t1.year,4),"-").concat(pad(e.t1.month,2),"-").concat(pad(e.t1.day,2),"T").concat(pad(e.t1.hour,2),":").concat(pad(e.t1.minute,2));invalidPeriod("".concat(t," minutes"))}(s):Math.max(a,i)===Ae?function secondsPeriod(e){var t=Math.round((e.v2-e.v1)/Re);if(1===t)return"".concat(pad(e.t1.year,4),"-").concat(pad(e.t1.month,2),"-").concat(pad(e.t1.day,2),"T").concat(pad(e.t1.hour,2),":").concat(pad(e.t1.minute,2),":").concat(pad(e.t1.second,2));invalidPeriod("".concat(t," seconds"))}(s):void invalidPeriod(s,"fractional seconds")}var Be=function(e){function CartoParsingError(e){var t;h()(this,CartoParsingError);return(t=V()(this,B()(CartoParsingError).call(this,{message:e,type:"[Error]"}))).name="CartoParsingError",t}return Z()(CartoParsingError,e),CartoParsingError}(j),Le=function(){function IsoParser(e){h()(this,IsoParser),this._format=e}return p()(IsoParser,[{key:"check",value:function check(e){return e.match(this._format)}}]),IsoParser}();function fieldDefault(e,t){return void 0===e?t:Number(e)}function dateFields(e){return{year:fieldDefault(e.year,1),month:fieldDefault(e.month,1),day:fieldDefault(e.day,1),hour:fieldDefault(e.hour,0),minute:fieldDefault(e.minute,0),second:fieldDefault(e.second,0)}}function fieldsFromMatch(e){return dateFields({year:e[1],month:e[2],day:e[3],hour:e[4],minute:e[5],second:e[6]})}var Ze=function(e){function YMDHMSParser(){return h()(this,YMDHMSParser),V()(this,B()(YMDHMSParser).call(this,/^(\\d\\d\\d\\d)(?:\\-?(\\d\\d)(?:\\-?(\\d\\d)(?:[T\\s]?(\\d\\d)(?:\\:(\\d\\d)(?:\\:(\\d\\d))?)?)?)?)?$/))}return Z()(YMDHMSParser,e),p()(YMDHMSParser,[{key:"parse",value:function parse(e){var t=this.check(e)||[],r=t.slice(),n=[1,2,3,4,5,6].find(function(e){return void 0===r[e]})||7;return 1===n?r[1]=2:r[n-1]=Number(r[n-1])+1,[fieldsFromMatch(t),fieldsFromMatch(r)]}}]),YMDHMSParser}(Le),qe=function(e){function MillenniumParser(){return h()(this,MillenniumParser),V()(this,B()(MillenniumParser).call(this,/^M(\\d+)$/))}return Z()(MillenniumParser,e),p()(MillenniumParser,[{key:"parse",value:function parse(e){var t=this.check(e),r=Number(t[1]),n=function year(e){return 1e3*(e-1)+1};return[dateFields({year:n(r)}),dateFields({year:n(r+1)})]}}]),MillenniumParser}(Le),je=function(e){function CenturyParser(){return h()(this,CenturyParser),V()(this,B()(CenturyParser).call(this,/^C(\\d+)$/))}return Z()(CenturyParser,e),p()(CenturyParser,[{key:"parse",value:function parse(e){var t=this.check(e),r=Number(t[1]),n=function year(e){return 100*(e-1)+1};return[dateFields({year:n(r)}),dateFields({year:n(r+1)})]}}]),CenturyParser}(Le),Ge=function(e){function DecadeParser(){return h()(this,DecadeParser),V()(this,B()(DecadeParser).call(this,/^D(\\d+)$/))}return Z()(DecadeParser,e),p()(DecadeParser,[{key:"parse",value:function parse(e){var t=this.check(e),r=Number(t[1]),n=function year(e){return 10*e};return[dateFields({year:n(r)}),dateFields({year:n(r+1)})]}}]),DecadeParser}(Le),Ue=function(e){function SemesterParser(){return h()(this,SemesterParser),V()(this,B()(SemesterParser).call(this,/^(\\d\\d\\d\\d)S(\\d)$/))}return Z()(SemesterParser,e),p()(SemesterParser,[{key:"parse",value:function parse(e){var t=this.check(e),r=Number(t[1]),n=Number(t[2]),a=function month(e){return 6*(e-1)+1};return[dateFields({year:r,month:a(n)}),dateFields({year:r,month:a(n+1)})]}}]),SemesterParser}(Le),We=function(e){function TrimesterParser(){return h()(this,TrimesterParser),V()(this,B()(TrimesterParser).call(this,/^(\\d\\d\\d\\d)t(\\d)$/))}return Z()(TrimesterParser,e),p()(TrimesterParser,[{key:"parse",value:function parse(e){var t=this.check(e),r=Number(t[1]),n=Number(t[2]),a=function month(e){return 4*(e-1)+1};return[dateFields({year:r,month:a(n)}),dateFields({year:r,month:a(n+1)})]}}]),TrimesterParser}(Le),Ye=function(e){function QuarterParser(){return h()(this,QuarterParser),V()(this,B()(QuarterParser).call(this,/^(\\d\\d\\d\\d)\\-?Q(\\d)$/))}return Z()(QuarterParser,e),p()(QuarterParser,[{key:"parse",value:function parse(e){var t=this.check(e),r=Number(t[1]),n=Number(t[2]),a=function month(e){return 3*(e-1)+1};return[dateFields({year:r,month:a(n)}),dateFields({year:r,month:a(n+1)})]}}]),QuarterParser}(Le);function startOfIsoWeek(e,t){var r=function parseISO_isoDow(e,t,r){var n=new Date(e,t-1,r).getDay();return 0===n?7:n}(e,1,1);return function addDays(e,t){var r=new Date(e.valueOf());return r.setDate(r.getDate()+t),r}(new Date(e,0,r>4?9-r:2-r),7*(t-1))}var Qe=function(e){function WeekParser(){return h()(this,WeekParser),V()(this,B()(WeekParser).call(this,/^(\\d\\d\\d\\d)\\-?W(\\d\\d)$/))}return Z()(WeekParser,e),p()(WeekParser,[{key:"parse",value:function parse(e){var t=this.check(e),r=Number(t[1]),n=Number(t[2]),a=startOfIsoWeek(r,n),i=startOfIsoWeek(r,n+1),o=function fields(e){return{year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()}};return[dateFields(o(a)),dateFields(o(i))]}}]),WeekParser}(Le),He=[new qe,new je,new Ge,new Ue,new We,new Ye,new Qe,new Ze];function parseISO(e){var t=function findParser(e){return He.find(function(t){return t.check(e)})}(e=e||"");if(!t)throw new Be("No date parser found for ".concat(e));return t.parse(e)}var Je=function(){function TimeZoneDate(e,t){h()(this,TimeZoneDate),this._value=e,this._date=msToDate(e),this._timeZone=t}return p()(TimeZoneDate,[{key:"year",get:function get(){return this._date.getUTCFullYear()}},{key:"month",get:function get(){return this._date.getUTCMonth()+1}},{key:"day",get:function get(){return this._date.getUTCDate()}},{key:"hour",get:function get(){return this._date.getUTCHours()}},{key:"minute",get:function get(){return this._date.getUTCMinutes()}},{key:"second",get:function get(){return this._date.getUTCSeconds()}},{key:"text",get:function get(){return periodISO(this._date.getTime(),this._date.getTime()+1e3)}},{key:"timeZone",get:function get(){return this._timeZone}}],[{key:"fromValue",value:function fromValue(e,t){return new TimeZoneDate(e,t)}},{key:"from",value:function from(e,t,r,n,a,i,o){return this.fromValue(Date.UTC(e,(t||1)-1,r,n,a,i),o)}}]),TimeZoneDate}(),$e=function(){function TimeRange(e,t,r,n){if(h()(this,TimeRange),this._startValue=r,this._endValue=n,r&&n)this._iso=periodISO(r,n);else if(!r&&!n&&t){var a=function _startEndTimeValues(e){return parseISO(e).map(_timeValue)}(t);this._iso=t,this._startValue=a[0],this._endValue=a[1]}this._timeZone=e}return p()(TimeRange,[{key:"timeZone",get:function get(){return this._timeZone}},{key:"iso",get:function get(){return this._iso}},{key:"startValue",get:function get(){return this._startValue}},{key:"endValue",get:function get(){return this._endValue}},{key:"startDate",get:function get(){return Je.fromValue(this._startValue,this._timeZone)}},{key:"endDate",get:function get(){return Je.fromValue(this._endValue,this._timeZone)}}]),TimeRange}();function _timeValue(e){return Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second)}Math.PI;var Ke=6378137;Math.PI;function msToDate(e){return new Date(e)}function castTimeRange(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return void 0===e||function isTimeRange(e){return e instanceof $e}(e)?e&&t?util_timeRange({iso:e._iso,timeZone:t}):e:"string"==typeof e?util_timeRange({iso:e,timeZone:t}):void 0}function util_timeRange(e){var t=e.start,r=e.end,n=e.iso,a=e.timeZone;return new $e(a,n,t,r)}var Xe=function(e){function WindshaftDateCodec(e,t){var r;h()(this,WindshaftDateCodec),r=V()(this,B()(WindshaftDateCodec).call(this,e,t));var n=e.stats(t).min;return r._min_ms=1e3*n,r._min_date=msToDate(r._min_ms),r}return Z()(WindshaftDateCodec,e),p()(WindshaftDateCodec,[{key:"sourceToInternal",value:function sourceToInternal(e,t){return msToDate(1e3*t)-this._min_date}},{key:"internalToExternal",value:function internalToExternal(e,t){var r=t;return msToDate(r+=this._min_ms)}},{key:"externalToSource",value:function externalToSource(e,t){return t.getTime()/1e3}},{key:"sourceToExternal",value:function sourceToExternal(e,t){return function asDate(e){if(e instanceof Date)return e;return msToDate(1e3*e)}(t)}},{key:"inlineInternalMatch",value:function inlineInternalMatch(e,t){var r=t._min_ms-this._min_ms;return"(".concat(e,"-").concat(r.toFixed(20),")")}}]),WindshaftDateCodec}(X);var et=function(e){function TimeRangeCodec(e,t){var r;h()(this,TimeRangeCodec),r=V()(this,B()(TimeRangeCodec).call(this,e,t));var n=e.stats(t),a=n.min,i=n.grouping&&n.grouping.timezone,o=util_timeRange({timeZone:i,iso:a});return r._min=o.startValue/1e3,r._timeZone=i,r}return Z()(TimeRangeCodec,e),p()(TimeRangeCodec,[{key:"isRange",value:function isRange(){return!0}},{key:"sourceToInternal",value:function sourceToInternal(e,t){var r=this,n=util_timeRange({iso:t});return[n.startValue/1e3,n.endValue/1e3].map(function(e){return e-r._min})}},{key:"internalToExternal",value:function internalToExternal(e,t){var r=o()(t,2),n=r[0],a=r[1];return util_timeRange({start:1e3*(n+this._min),end:1e3*(a+this._min),timeZone:this._timeZone})}},{key:"externalToSource",value:function externalToSource(e,t){return castTimeRange(t,this._timeZone)._iso}},{key:"sourceToExternal",value:function sourceToExternal(e,t){return util_timeRange({iso:t,timeZone:this._timeZone})}},{key:"inlineInternalMatch",value:function inlineInternalMatch(e,t){var r=t._min.getTime()-this._min.getTime();return"(".concat(e,"-").concat(r.toFixed(20),")")}}]),TimeRangeCodec}(X),tt=function(e){function CartoMapsAPIError(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rt.DEFAULT;return h()(this,CartoMapsAPIError),(t=V()(this,B()(CartoMapsAPIError).call(this,{message:e,type:r}))).name="CartoMapsAPIError",t}return Z()(CartoMapsAPIError,e),CartoMapsAPIError}(j),rt={DEFAULT:"[Error]",SQL:"[SQL]",NOT_SUPPORTED:"[Not supported]",SECURITY:"[Security]"};var nt=function(e){function WindshaftMetadata(){var e,t;h()(this,WindshaftMetadata);for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return(t=V()(this,(e=B()(WindshaftMetadata)).call.apply(e,[this].concat(n)))).propertyKeys=[],t.baseNames={},Object.keys(t.properties).forEach(function(e){var r=t.properties[e];r.aggregations?Object.values(r.aggregations).forEach(function(r){t._addProperty(e,r)}):r.dimension?r.dimension.range?(r.dimension.range.forEach(function(r){t._addProperty(e,r,!1)}),t._addProperty(e,r.dimension.propertyName)):t._addProperty(e,r.dimension.propertyName):t._addProperty(e,e)}),t}return Z()(WindshaftMetadata,e),p()(WindshaftMetadata,[{key:"_addProperty",value:function _addProperty(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.baseNames[t]=e,r&&this.propertyKeys.push(t)}},{key:"_dimensionInfo",value:function _dimensionInfo(e){var t=this.baseName(e)||e,r=this.properties[t],n=null;t!==e&&t!==e&&r.dimension&&(n=r.dimension);var a=r.type,i=n?function dimensionBaseType(e){return e.type}(n):a;return{baseName:t,column:r,dimension:n,dataframeType:n?function dimensionType(e,t){if(e.range)return"date";return e.type}(n):i,baseType:a,sourceType:i}}},{key:"baseName",value:function baseName(e){return this.baseNames[e]}},{key:"decodedProperties",value:function decodedProperties(e){var t=this._dimensionInfo(e).dimension;return t&&t.grouping&&t.range?t.range:se()(B()(WindshaftMetadata.prototype),"decodedProperties",this).call(this,e)}},{key:"stats",value:function stats(e){var t=this._dimensionInfo(e).dimension;return t&&t.grouping?t:se()(B()(WindshaftMetadata.prototype),"stats",this).call(this,e)}},{key:"setCodecs",value:function setCodecs(){!function setMetadataCodecs(e){Object.keys(e.properties).forEach(function(t){var r=e.properties[t],n=r.type;if("geometry"!==n){var a=r.dimension?r.dimension.type:null,i=a?r.dimension.propertyName:t,o="category"===a&&r.dimension.range?"timerange":a;r.codec=function windshaftCodecFactory(e,t,r){switch(t){case"number":return new ue(e,r);case"category":return new le(e,r);case"date":return new Xe(e,r);case"timerange":return new et(e,r);default:throw new tt("Windshaft MVT decoding error. Feature property value of type \'".concat(t,"\' cannot be decoded."),rt.NOT_SUPPORTED)}}(e,o||n,i||t)}})}(this)}},{key:"sourcePropertyName",value:function sourcePropertyName(e){var t=this.baseName(e),r=this.properties[t].dimension;return r&&r.range?r.propertyName:e}}]),WindshaftMetadata}(he);var at=function(e){function WindshaftWorker(){return h()(this,WindshaftWorker),V()(this,B()(WindshaftWorker).apply(this,arguments))}return Z()(WindshaftWorker,e),p()(WindshaftWorker,[{key:"castMetadata",value:function castMetadata(e){Object.setPrototypeOf(e,nt.prototype),e.setCodecs()}}]),WindshaftWorker}(Pe),it=function(){function BigQueryClient(e,t){h()(this,BigQueryClient),this._projectId=e,this._token=t,this._activeJobs={}}return p()(BigQueryClient,[{key:"list",value:function(){var e=l()(u.a.mark(function _callee(){return u.a.wrap(function _callee$(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetch("GET","jobs"));case 1:case"end":return e.stop()}},_callee,this)}));return function list(){return e.apply(this,arguments)}}()},{key:"insert",value:function(){var e=l()(u.a.mark(function _callee2(){return u.a.wrap(function _callee2$(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetch("POST","jobs"));case 1:case"end":return e.stop()}},_callee2,this)}));return function insert(){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=l()(u.a.mark(function _callee3(e){return u.a.wrap(function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.fetch("GET","jobs/".concat(e)));case 1:case"end":return t.stop()}},_callee3,this)}));return function get(t){return e.apply(this,arguments)}}()},{key:"cancel",value:function(){var e=l()(u.a.mark(function _callee4(e){return u.a.wrap(function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.fetch("POST","jobs/".concat(e,"/cancel")));case 1:case"end":return t.stop()}},_callee4,this)}));return function cancel(t){return e.apply(this,arguments)}}()},{key:"query",value:function(){var e=l()(u.a.mark(function _callee5(e){return u.a.wrap(function _callee5$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.fetch("POST","queries",{kind:"bigquery#queryRequest",query:e,useLegacySql:!1,timeoutMs:5e3,useQueryCache:!0}));case 1:case"end":return t.stop()}},_callee5,this)}));return function query(t){return e.apply(this,arguments)}}()},{key:"getQueryResults",value:function(){var e=l()(u.a.mark(function _callee6(e){return u.a.wrap(function _callee6$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.fetch("GET","queries/".concat(e,"?timeoutMs=").concat(5e3)));case 1:case"end":return t.stop()}},_callee6,this)}));return function getQueryResults(t){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=l()(u.a.mark(function _callee7(e){var t;return u.a.wrap(function _callee7$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.query(e);case 2:if(!(t=r.sent).error){r.next=5;break}throw Error("[".concat(t.error.status,"] ").concat(t.error.message));case 5:return r.abrupt("return",this._pollingQuery(t));case 6:case"end":return r.stop()}},_callee7,this)}));return function execute(t){return e.apply(this,arguments)}}()},{key:"_pollingQuery",value:function(){var e=l()(u.a.mark(function _callee8(e){var t=this;return u.a.wrap(function _callee8$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise(function(r,n){if(e.jobComplete)r(e);else{var a=e.jobReference.jobId;t._updateJobTime(a),t._jobTimeout(a)?t._cancelJob(a,n):t._getJobResult(a,r)}}));case 1:case"end":return r.stop()}},_callee8,this)}));return function _pollingQuery(t){return e.apply(this,arguments)}}()},{key:"_jobTimeout",value:function _jobTimeout(e){return this._activeJobs[e]>=12e4}},{key:"_updateJobTime",value:function _updateJobTime(e){e in this._activeJobs?this._activeJobs[e]+=5e3:this._activeJobs[e]=5e3}},{key:"_cancelJob",value:function(){var e=l()(u.a.mark(function _callee9(e,t){var r;return u.a.wrap(function _callee9$(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.cancel(e);case 2:r=n.sent,delete this._activeJobs[e],t(r);case 5:case"end":return n.stop()}},_callee9,this)}));return function _cancelJob(t,r){return e.apply(this,arguments)}}()},{key:"_getJobResult",value:function(){var e=l()(u.a.mark(function _callee10(e,t){var r;return u.a.wrap(function _callee10$(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getQueryResults(e);case 2:(r=n.sent).jobComplete?t(r):t(this._pollingQuery(r));case 4:case"end":return n.stop()}},_callee10,this)}));return function _getJobResult(t,r){return e.apply(this,arguments)}}()},{key:"fetch",value:function(e){function fetch(t,r,n){return e.apply(this,arguments)}return fetch.toString=function(){return e.toString()},fetch}(function(){var e=l()(u.a.mark(function _callee11(e,t,r){var n;return u.a.wrap(function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,fetch("".concat("https://bigquery.googleapis.com/bigquery/v2","/projects/").concat(this._projectId,"/").concat(t),{method:e,headers:{Authorization:"Bearer ".concat(this._token),"Content-Type":"application/json"},body:r&&JSON.stringify(r)});case 2:return n=a.sent,a.abrupt("return",n.json());case 4:case"end":return a.stop()}},_callee11,this)}));return function(t,r,n){return e.apply(this,arguments)}}())}]),BigQueryClient}(),ot=0;function gilbert2d_tile(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:x,y:y},t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;if(t<1||r<1)throw"Invalid Gilbert rectangle. Got: Width (".concat(t,"). Height: (").concat(r,")");var n={x:e.x,y:e.y,counter:0},a={x:0,y:r},i={x:t,y:0};return t>r&&(a={x:t,y:0},i={x:0,y:r}),function gilbert2d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:x,y:y},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:x,y:y},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:x,y:y},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{counter:counter,x:x,y:y},a=Math.sign(t.x),i=Math.sign(t.y),o=Math.sign(r.x),s=Math.sign(r.y),u=Math.min(e.x,e.x+t.x-a+r.x-o),c=Math.max(e.x,e.x+t.x-a+r.x-o),l=Math.min(e.y,e.y+t.y-i+r.y-s),f=Math.max(e.y,e.y+t.y-i+r.y-s);if(n.x<u||n.x>c||n.y<l||n.y>f)return n.counter+=(c-u+1)*(f-l+1),-1;var h=Math.abs(t.x+t.y),d=Math.abs(r.x+r.y);if(1==h||1==d)return n.counter+=Math.abs(e.x-n.x+(e.y-n.y)),n.counter;var p={x:Math.floor(t.x/2),y:Math.floor(t.y/2)};if(2*h>3*d){Math.abs(p.x+p.y)%2&&h>2&&(p.x+=a,p.y+=i);var _=gilbert2d({x:e.x,y:e.y},p,r,n);return-1!==_?_:gilbert2d({x:e.x+p.x,y:e.y+p.y},{x:t.x-p.x,y:t.y-p.y},r,n)}var m={x:Math.floor(r.x/2),y:Math.floor(r.y/2)};Math.abs(m.x+m.y)%2&&d>2&&(m.x+=o,m.y+=s);var v=gilbert2d({x:e.x,y:e.y},m,p,n);if(-1!==v)return v;var g=gilbert2d({x:e.x+m.x,y:e.y+m.y},t,{x:r.x-m.x,y:r.y-m.y},n);return-1!==g?g:gilbert2d({x:e.x+(t.x-a)+(m.x-o),y:e.y+(t.y-i)+(m.y-s)},{x:-m.x,y:-m.y},{x:-(t.x-p.x),y:-(t.y-p.y)},n)}({x:0,y:0},a,i,n)}var st=function(){function GilbertPartition(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{zmin:zmin,zmax:zmax,zstep:zstep},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{xmin:xmin,xmax:xmax,ymin:ymin,ymax:ymax};if(h()(this,GilbertPartition),this.partition_count=parseInt(e),this.z_range={zmin:parseInt(t.zmin),zmax:parseInt(t.zmax),zstep:parseInt(t.zstep)},this.zmax_bbox={xmin:parseInt(r.xmin),xmax:parseInt(r.xmax),ymin:parseInt(r.ymin),ymax:parseInt(r.ymax)},!e||e<1)throw"Unexpected partition count. Expected a positive integer. Got ".concat(e);if(!this.z_range)throw"Missing z_range";if(isNaN(this.z_range.zmin)||isNaN(this.z_range.zmax)||isNaN(this.z_range.zstep))throw"Invalid z_range. Both zmin, zmax and zstep need to be defined. Got ".concat(JSON.stringify(t));if(this.z_range.zmin>this.z_range.zmax||this.z_range.zmin<0||this.zstep<1)throw"Invalid z_range received. Got (".concat(JSON.stringify(t),")");if(!this.zmax_bbox)throw"Missing zmax_bbox";if(isNaN(this.zmax_bbox.xmin)||isNaN(this.zmax_bbox.xmax)||isNaN(this.zmax_bbox.ymin)||isNaN(this.zmax_bbox.ymax))throw"Invalid zmax_bbox. All xmin, xmax, ymin and ymax need to be defined. Got (".concat(JSON.stringify(r),")");if(this.zmax_bbox.xmin>this.zmax_bbox.xmax||this.zmax_bbox.xmin<0||this.zmax_bbox.ymin>this.zmax_bbox.ymax||this.zmax_bbox.ymin<0)throw"Invalid bbox received. Got (".concat(JSON.stringify(r),")")}return p()(GilbertPartition,[{key:"getPartition",value:function getPartition(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{z:0,x:0,y:0},t=this.zmax_bbox.xmin>>this.z_range.zmax-e.z,r=this.zmax_bbox.xmax>>this.z_range.zmax-e.z,n=this.zmax_bbox.ymin>>this.z_range.zmax-e.z,a=this.zmax_bbox.ymax>>this.z_range.zmax-e.z;if(e.z<this.z_range.zmin||e.z>this.z_range.zmax||e.x<t||e.x>r||e.y<n||e.y>a)return ot;var i=function partition_range_by_zoom(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{z:z,zmin:zmin,zmax:zmax,zstep:zstep};return function(){if(t.z<0||t.zmin<0||t.zmax<0||t.zstep<1||t.z<t.zmin||t.z>t.zmax||t.partition_count<1||t.z!=t.zmin&&(t.z-t.zmin)%t.zstep!=0)return{min:ot,max:ot};var r=t.zstep,n=t.zmax-t.zmin;n-=n%r;var a=t.z-t.zmin,i=a-r+1,o=e;if(0==n||1==o)return{min:1,max:o};var s,u=0;if(0==a)u=4*o/Math.pow(4,n+1),s=0;else{for(var c=i;c<=a;c++)u+=3*o/Math.pow(4,n-c+1);s=o/Math.pow(4,n-i+1)}var l=s+u;return{min:(s=Math.round(s))+1,max:Math.min(o,Math.max(Math.floor(l),s)+1)}}()}(this.partition_count,{z:e.z,zmin:this.z_range.zmin,zmax:this.z_range.zmax,zstep:this.z_range.zstep}),o=i.max-i.min+1;if(1==o)return i.min;var s=e.x-t,u=e.y-n,c=r-t+1,l=a-n+1,f=c*l,h=gilbert2d_tile({x:s,y:u},c,l);if(-1===h||h>=c*l)throw"Unexpected gilbert partition (".concat(h,") for tile ").concat(e.z,"/").concat(e.x,"/").concat(e.y," ")+"=> ".concat(s,"/").concat(u," : ").concat(c,", ").concat(l,")");return i.min+Math.floor(o*h/f)}}]),GilbertPartition}(),ut=r(25),ct=r(26),lt=null,ft=function(){function BigQueryTilesetClient(e,t){h()(this,BigQueryTilesetClient),this._client=new it(e,t)}return p()(BigQueryTilesetClient,[{key:"fetchMetadata",value:function(){var e=l()(u.a.mark(function _callee(e,t){var r,n,a,i;return u.a.wrap(function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return r="\\n            SELECT option_value FROM `".concat(e,".INFORMATION_SCHEMA.TABLE_OPTIONS` \\n            WHERE table_name=\'").concat(t,"\' AND option_name = \'description\'"),o.next=3,this._execute(r);case 3:if(n=o.sent,a={},!(n&&n.rows&&n.rows.length&&n.rows[0]&&n.rows[0].f&&n.rows[0].f.length&&n.rows[0].f[0]&&n.rows[0].f[0].v)){o.next=10;break}i=n.rows[0].f[0].v,a=JSON.parse(JSON.parse(i)),o.next=11;break;case 10:throw Error("Tileset metadata not available");case 11:return o.abrupt("return",a);case 12:case"end":return o.stop()}},_callee,this)}));return function fetchMetadata(t,r){return e.apply(this,arguments)}}()},{key:"fetchTiles",value:function(){var e=l()(u.a.mark(function _callee2(e,t,r,n){var a,i,o,s,c,l,f,h,d,p,_;return u.a.wrap(function _callee2$(u){for(;;)switch(u.prev=u.next){case 0:return lt||(a=n.carto_partition,lt=initializePartitioner(a)),i=getParentQuadkeysFromTiles(e),o=i.length?"carto_partition IN (".concat(i,")"):"TRUE",s=e.map(function(e){return tileFilter(e)}).join(" OR "),c="\\n            SELECT z, x, y, data\\n            FROM `".concat(t,".").concat(r,"`\\n            WHERE (").concat(o,") AND (").concat(s,")"),u.next=7,this._execute(c);case 7:if(l=u.sent,f=[],h=Object.assign(e,{}),!l||!l.rows){u.next=18;break}for(d=0;d<l.rows.length;d++)(p=l.rows[d]).f&&4===p.f.length&&function(){var e=parseInt(p.f[0].v),t=parseInt(p.f[1].v),r=parseInt(p.f[2].v),a="gzip"===n.compression?Object(ct.inflate)(atob(p.f[3].v)):Object(ut.decode)(p.f[3].v);f.push({z:e,x:t,y:r,buffer:a}),h=h.filter(function(n){return!(n.z===e&&n.x===t&&n.y===r)})}();if(console.log("".concat(f.length,"/").concat(l.totalRows)),!(l.totalRows>f.length)){u.next=18;break}return u.next=16,this.fetchTiles(h,t,r,n);case 16:_=u.sent,f=f.concat(_);case 18:return u.abrupt("return",f);case 19:case"end":return u.stop()}},_callee2,this)}));return function fetchTiles(t,r,n,a){return e.apply(this,arguments)}}()},{key:"_execute",value:function(){var e=l()(u.a.mark(function _callee3(e){var t,r,n;return u.a.wrap(function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return console.log(">"),t=(new Date).getTime(),a.next=4,this._client.execute(e);case 4:return r=a.sent,n=(new Date).getTime(),console.log("<",n-t),a.abrupt("return",r);case 8:case"end":return a.stop()}},_callee3,this)}));return function _execute(t){return e.apply(this,arguments)}}()}]),BigQueryTilesetClient}();function initializePartitioner(e){if(1!==e.version)throw new Error("Unknown quadkey version");var t={zmin:e.zmin,zmax:e.zmax,zstep:e.zstep},r={xmin:e.xmin,xmax:e.xmax,ymin:e.ymin,ymax:e.ymax},n=e.partitions;return new st(n,t,r)}function getParentQuadkeysFromTiles(e){var t=new Set,r=!0,n=!1,a=void 0;try{for(var i,o=e[Symbol.iterator]();!(r=(i=o.next()).done);r=!0){var s=i.value;t.add(lt.getPartition({z:s.z,x:s.x,y:s.y}))}}catch(e){n=!0,a=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw a}}return g()(t).filter(function(e){return null!==e})}function tileFilter(e){return"(z = ".concat(e.z," AND x = ").concat(e.x," AND y = ").concat(e.y,")")}var ht=1,dt=2,pt=3,_t={1:W.POINT,2:W.LINE,3:W.POLYGON},yt=function(){function BigQueryTilesetWorker(){h()(this,BigQueryTilesetWorker)}return p()(BigQueryTilesetWorker,[{key:"onmessage",value:function onmessage(e){this.processEvent(e).then(postMessage)}},{key:"processEvent",value:function(){var e=l()(u.a.mark(function _callee(e){var t,r;return u.a.wrap(function _callee$(n){for(;;)switch(n.prev=n.next){case 0:return(t=e.data).metadata&&(this.castMetadata(t.metadata),this.metadata=t.metadata),n.next=4,this._requestDataframes(t.tiles,t.tilesetData,t.tilesetMetadata,this.metadata);case 4:return r=n.sent,n.abrupt("return",{mID:t.mID,dataframes:r});case 6:case"end":return n.stop()}},_callee,this)}));return function processEvent(t){return e.apply(this,arguments)}}()},{key:"castMetadata",value:function castMetadata(e){Object.setPrototypeOf(e,he.prototype),e.setCodecs()}},{key:"_requestDataframes",value:function(){var e=l()(u.a.mark(function _callee2(e,t,r,n){var a,i,o,s=this;return u.a.wrap(function _callee2$(u){for(;;)switch(u.prev=u.next){case 0:return a=new ft(t.project,t.token),u.next=3,a.fetchTiles(e,t.dataset,t.table,r);case 3:return i=u.sent,u.next=6,Promise.all(e.map(function(e){var t=i&&i.find(function(t){return t.x===e.x&&t.y===e.y&&t.z===e.z});return t?s.responseToDataframeTransformer(t,n):{x:e.x,y:e.y,z:e.z,empty:!0}}));case 6:return o=u.sent,u.abrupt("return",o);case 8:case"end":return u.stop()}},_callee2,this)}));return function _requestDataframes(t,r,n,a){return e.apply(this,arguments)}}()},{key:"responseToDataframeTransformer",value:function responseToDataframeTransformer(e,t){var r=this,n=e.x,a=e.y,i=e.z,o=e.buffer;return new Promise(function(e){var s=t.extent;if(0===o.byteLength)return e({x:n,y:a,z:i,empty:!0});var u=new _.VectorTile(new m(o));if(Object.keys(u.layers).length>1)throw new G("LayerID parameter wasn\'t specified and the MVT tile contains multiple layers: ".concat(JSON.stringify(Object.keys(u.layers)),"."),U.MISSING_REQUIRED);var c=u.layers[Object.keys(u.layers)[0]];if(!c)return e({empty:!0});var l=r._decodeMVTLayer(c,t,s),f=l.geometries,h=l.properties,d=l.propertiesArrayBuffer,p=l.numFeatures,y=getRsysFromTile(n,a,i);e(r._generateDataFrame(y,f,h,d,p,t.geomType,t,n,a,i))})}},{key:"_decodeMVTLayer",value:function _decodeMVTLayer(e,t,r){if(!e.length)return{properties:[],geometries:{},propertiesArrayBuffer:[],numFeatures:0};switch(t.geomType||(t.geomType=this._autoDiscoverType(e)),t.geomType){case W.POINT:var n=new ArrayBuffer(2*e.length*3*4);return this._decode(e,t,r,n);case W.LINE:return this._decode(e,t,r,[],decodeLines);case W.POLYGON:return this._decode(e,t,r,[],decodePolygons);default:throw new G("MVT: invalid geometry type \'".concat(t.geomType,"\'"),U.INCORRECT_TYPE)}}},{key:"_autoDiscoverType",value:function _autoDiscoverType(e){var t=e.feature(0).type;switch(t){case ht:return W.POINT;case dt:return W.LINE;case pt:return W.POLYGON;default:throw new G("MVT: invalid geometry type \'".concat(t,"\'"),U.INCORRECT_TYPE)}}},{key:"_decode",value:function _decode(e,t,r,n,a){var i,o=0;n&&(i=new Float32Array(n));for(var s=this._initializePropertyArrays(t,e.length),u=s.properties,c=s.propertiesArrayBuffer,l=this._scalarPropertyCodecs(t),f=this._rangePropertyCodecs(t),h=0;h<e.length;h++){var d=e.feature(h);this._checkType(d,t.geomType);var p=d.loadGeometry();if(a){var _=a(p,r);n.push(_)}else{var y=2*p[0][0].x/r-1,m=2*(1-p[0][0].y/r)-1;if(y<-1||y>=1||m<-1||m>=1)continue;i[6*o+0]=y,i[6*o+1]=m,i[6*o+2]=y,i[6*o+3]=m,i[6*o+4]=y,i[6*o+5]=m}this._decodeProperties(t,l,f,u,d,o),o++}return{properties:u,propertiesArrayBuffer:c,geometries:n,numFeatures:o}}},{key:"_checkType",value:function _checkType(e,t){var r=e.type,n=_t[r];if(n!==t)throw new $("MVT: mixed geometry types in the same layer. Layer has type: ".concat(t," but feature was ").concat(n),K.MVT)}},{key:"_initializePropertyArrays",value:function _initializePropertyArrays(e,t){var r=this._getPropertyNamesFrom(e),n=this._getPropertiesFor(r,t);return{propertyNames:r,properties:n.properties,propertiesArrayBuffer:n.propertiesArrayBuffer}}},{key:"_getSourcePropertyNamesFrom",value:function _getSourcePropertyNamesFrom(e){return e.propertyKeys.filter(function(t){return"geometry"!==e.properties[e.baseName(t)].type})}},{key:"_getPropertyNamesFrom",value:function _getPropertyNamesFrom(e){var t=[];return this._getSourcePropertyNamesFrom(e).forEach(function(r){e.decodedProperties(r).forEach(function(e){t.push(e)})}),t}},{key:"_getPropertiesFor",value:function _getPropertiesFor(e,t){for(var r={},n=1024*Math.ceil(t/1024),a=new ArrayBuffer(4*n*e.length),i=a,o=0;o<e.length;o++){r[e[o]]=new Float32Array(a,4*o*n,n)}return{properties:r,propertiesArrayBuffer:i}}},{key:"_scalarPropertyCodecs",value:function _scalarPropertyCodecs(e){return this._getSourcePropertyNamesFrom(e).map(function(t){return[t,e.codec(t)]}).filter(function(e){var t=o()(e,2);t[0];return!t[1].isRange()})}},{key:"_rangePropertyCodecs",value:function _rangePropertyCodecs(e){return this._getSourcePropertyNamesFrom(e).map(function(t){return[t,e.decodedProperties(t),e.codec(t)]}).filter(function(e){var t=o()(e,3);t[0],t[1];return t[2].isRange()})}},{key:"_decodeProperties",value:function _decodeProperties(e,t,r,n,a,i){for(var s=t.length,u=0;u<s;u++){var c=o()(t[u],2),l=c[0],f=c[1],h="___id"===l?a.id:a.properties[l];n[l][i]=f.sourceToInternal(e,h)}s=r.length;for(var d=0;d<s;d++){var p=o()(r[d],3),_=(l=p[0],o()(p[1],2)),y=_[0],m=_[1],v=(f=p[2],a.properties[l]),g=f.sourceToInternal(e,v),b=o()(g,2),x=b[0],w=b[1];n[y][i]=x,n[m][i]=w}}},{key:"_generateDataFrame",value:function _generateDataFrame(e,t,r,n,a,i,o,s,u,c){return new xe({active:!1,center:e.center,geom:t,properties:r,propertiesArrayBuffer:n,scale:e.scale,size:a,type:i,metadata:o,x:s,y:u,z:c})}}]),BigQueryTilesetWorker}();const mt={MVT:new Pe,windshaft:new at,BigQueryTileset:new yt};onmessage=function(e){return mt[e.data.workerName].onmessage(e)}}]);',"/dist/carto-vl-45f09f311ae245ff235b.worker.min.js")}},function(e,t){e.exports="precision highp float;\nattribute vec2 vertex;\n\nvarying  vec2 uv;\n\nvoid main(void) {\n    uv = vertex*0.5+vec2(0.5);\n    gl_Position = vec4(vertex, 0.5, 1.);\n}\n"},function(e,t){e.exports="precision highp float;\n\nvarying vec2 uv;\n\nvec2 featureID;\n\n$propertyPreface\n$style_preface\n\nvoid main(void) {\n    featureID = abs(uv);\n    gl_FragColor = $style_inline;\n}\n"},function(e,t){function _setPrototypeOf(t,r){return e.exports=_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e},_setPrototypeOf(t,r)}e.exports=_setPrototypeOf},function(e,t,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,r){e.exports=r(69)},function(e,t){e.exports=function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function _arrayWithHoles(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,r){var n=r(0);e.exports=function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=n(e)););return e}},function(e,t){var r,n,a=e.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(r===setTimeout)return setTimeout(e,0);if((r===defaultSetTimout||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){r=defaultSetTimout}try{n="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){n=defaultClearTimeout}}();var i,o=[],s=!1,u=-1;function cleanUpNextTick(){s&&i&&(s=!1,i.length?o=i.concat(o):u=-1,o.length&&drainQueue())}function drainQueue(){if(!s){var e=runTimeout(cleanUpNextTick);s=!0;for(var t=o.length;t;){for(i=o,o=[];++u<t;)i&&i[u].run();u=-1,t=o.length}i=null,s=!1,function runClearTimeout(e){if(n===clearTimeout)return clearTimeout(e);if((n===defaultClearTimeout||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];o.push(new Item(e,t)),1!==o.length||s||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=noop,a.addListener=noop,a.once=noop,a.off=noop,a.removeListener=noop,a.removeAllListeners=noop,a.emit=noop,a.prependListener=noop,a.prependOnceListener=noop,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t,r){"use strict";e.exports=function adler32(e,t,r,n){for(var a=65535&e|0,i=e>>>16&65535|0,o=0;0!==r;){r-=o=r>2e3?2e3:r;do{i=i+(a=a+t[n++]|0)|0}while(--o);a%=65521,i%=65521}return a|i<<16|0}},function(e,t,r){"use strict";var n=function makeTable(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();e.exports=function crc32(e,t,r,a){var i=n,o=a+r;e^=-1;for(var s=a;s<o;s++)e=e>>>8^i[255&(e^t[s])];return-1^e}},function(e,t,r){"use strict";var n=r(15),a=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch(e){a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){i=!1}for(var o=new n.Buf8(256),s=0;s<256;s++)o[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function buf2binstring(e,t){if(t<65534&&(e.subarray&&i||!e.subarray&&a))return String.fromCharCode.apply(null,n.shrinkBuf(e,t));for(var r="",o=0;o<t;o++)r+=String.fromCharCode(e[o]);return r}o[254]=o[254]=1,t.string2buf=function(e){var t,r,a,i,o,s=e.length,u=0;for(i=0;i<s;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(a=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(a-56320),i++),u+=r<128?1:r<2048?2:r<65536?3:4;for(t=new n.Buf8(u),o=0,i=0;o<u;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(a=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(a-56320),i++),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|63&r):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},t.buf2binstring=function(e){return buf2binstring(e,e.length)},t.binstring2buf=function(e){for(var t=new n.Buf8(e.length),r=0,a=t.length;r<a;r++)t[r]=e.charCodeAt(r);return t},t.buf2string=function(e,t){var r,n,a,i,s=t||e.length,u=new Array(2*s);for(n=0,r=0;r<s;)if((a=e[r++])<128)u[n++]=a;else if((i=o[a])>4)u[n++]=65533,r+=i-1;else{for(a&=2===i?31:3===i?15:7;i>1&&r<s;)a=a<<6|63&e[r++],i--;i>1?u[n++]=65533:a<65536?u[n++]=a:(a-=65536,u[n++]=55296|a>>10&1023,u[n++]=56320|1023&a)}return buf2binstring(u,n)},t.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0?t:0===r?t:r+o[e[r]]>t?r:t}},function(e,t,r){"use strict";e.exports=function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,r){var n=r(0),a=r(24),i=r(64),o=r(6);function _wrapNativeSuper(t){var r="function"==typeof Map?new Map:void 0;return e.exports=_wrapNativeSuper=function _wrapNativeSuper(e){if(null===e||!i(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,Wrapper)}function Wrapper(){return o(e,arguments,n(this).constructor)}return Wrapper.prototype=Object.create(e.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),a(Wrapper,e)},_wrapNativeSuper(t)}e.exports=_wrapNativeSuper},function(e,t,r){var n=r(66);e.exports=function _objectWithoutProperties(e,t){if(null==e)return{};var r,a,i=n(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}},function(e,t,r){var n=r(28),a=r(27),i=r(29);e.exports=function _toArray(e){return n(e)||a(e)||i()}},function(e,t,r){"use strict";function lineclip(e,t,r){var n,a,i,o,s,u=e.length,c=bitCode(e[0],t),l=[];for(r||(r=[]),n=1;n<u;n++){for(a=e[n-1],o=s=bitCode(i=e[n],t);;){if(!(c|o)){l.push(a),o!==s?(l.push(i),n<u-1&&(r.push(l),l=[])):n===u-1&&l.push(i);break}if(c&o)break;c?c=bitCode(a=intersect(a,i,c,t),t):o=bitCode(i=intersect(a,i,o,t),t)}c=s}return l.length&&r.push(l),r}function intersect(e,t,r,n){return 8&r?[e[0]+(t[0]-e[0])*(n[3]-e[1])/(t[1]-e[1]),n[3]]:4&r?[e[0]+(t[0]-e[0])*(n[1]-e[1])/(t[1]-e[1]),n[1]]:2&r?[n[2],e[1]+(t[1]-e[1])*(n[2]-e[0])/(t[0]-e[0])]:1&r?[n[0],e[1]+(t[1]-e[1])*(n[0]-e[0])/(t[0]-e[0])]:null}function bitCode(e,t){var r=0;return e[0]<t[0]?r|=1:e[0]>t[2]&&(r|=2),e[1]<t[1]?r|=4:e[1]>t[3]&&(r|=8),r}e.exports=lineclip,lineclip.polyline=lineclip,lineclip.polygon=function polygonclip(e,t){var r,n,a,i,o,s,u;for(n=1;n<=8;n*=2){for(r=[],a=e[e.length-1],i=!(bitCode(a,t)&n),o=0;o<e.length;o++)s=e[o],(u=!(bitCode(s,t)&n))!==i&&r.push(intersect(a,s,n,t)),u&&r.push(s),a=s,i=u;if(!(e=r).length)break}return r}},function(e,t){e.exports="precision highp float;\nattribute vec2 vertex;\n\nvarying  vec2 uv;\n\nvoid main(void) {\n    uv = vertex*0.5+vec2(0.5);\n    gl_Position = vec4(vertex, 0.5, 1.);\n}\n"},function(e,t){e.exports="precision highp float;\n\nvarying  vec2 uv;\n\nuniform sampler2D aaTex;\n\nvoid main(void) {\n    vec4 aa = texture2D(aaTex, uv);\n    gl_FragColor = aa;\n}\n"},function(e,t){e.exports="vec2 encodeWidth(float x) {\n    if (!(x<=0. || x>=0.) ){\n        // Convert NaN widths to `0`\n        // Do not remove this, some GPUs will convert NaN floats to 1. when\n        // packing the shader output to a RGBA UNSIGNED BYTE textures\n        x = 0.;\n    }\n    float high, low;\n    x = clamp(x, 0., 1023.);\n    high = floor(x/4.);\n    low = (x-high*4.)/4.;\n    return vec2(high/255., low);\n}\n\n$width_preface\n"},function(e,t){e.exports="precision highp float;\n\nattribute vec2 vertexPosition;\nattribute vec2 featureID;\n\nuniform float orderMinWidth;\nuniform float orderMaxWidth;\nuniform float devicePixelRatio;\nuniform vec2 resolution;\nuniform mat4 matrix;\n\nuniform sampler2D colorTex;\nuniform sampler2D widthTex;\nuniform sampler2D filterTex;\n\nvarying highp vec2 featureIDVar;\nvarying highp vec4 color;\nvarying highp vec2 pointCoord;\nvarying highp float filtering;\n\nfloat decodeWidth(vec2 enc) {\n  return enc.x*(255.*4.) + 4.*enc.y;\n}\n\n$symbolPlacement_preface\n$propertyPreface\n$transform_preface\n\nvec2 transform(vec2 p){\n    return $transform_inline(2.*p)/resolution;\n}\n\n// We'll need a square inscribed in a triangle\n// The triangle will be equilateral\n// The square side length will be equal to 1\n// Each triangle edge length will be equal to 1+2*A (by definition of A)\n// The triangle height will be equal to H by definition\n// The square inscription will generate 3 smaller triangles\n// Each one of these will have an hypotenuse equal to Y\n//\n// Therefore:\n// Y*sin(60) = 1  =>  Y = 2 / sqrt(3)\n// A=Y*cos(60)    =>  A = 1 / sqrt(3)\n// tan(60) = H / (0.5 + A)   =>  H = sqrt(3)*(0.5 + 1 / sqrt(3))\n#define A (0.577350269189625)\n#define H (1.86603)\n\nvoid main(void) {\n    featureIDVar = abs(featureID);\n    color = texture2D(colorTex, abs(featureID));\n    filtering = texture2D(filterTex, abs(featureID)).a;\n\n    float size = decodeWidth(texture2D(widthTex, abs(featureID)).rg);\n\n    vec4 p =  matrix*vec4(vertexPosition, 0., 1.);\n    p/=p.w;\n\n    if (featureID.y<0.){\n        pointCoord = vec2((0.5+A)/(0.5), 0.);\n        p.xy += transform(size*vec2(0.5+A, -H/2. + (H/2. - 0.5) ));\n    }else if (featureID.x<0.){\n        pointCoord = vec2(-(0.5+A)/(0.5), 0.);\n        p.xy += transform(size*vec2(-(0.5+A), -H/2. + (H/2. - 0.5)));\n    }else{\n        pointCoord = vec2(0., H);\n        p.xy += transform(size*vec2(0., H/2. + (H/2. - 0.5)));\n    }\n    pointCoord.y = 1.-pointCoord.y;\n\n\n    p.xy += ($symbolPlacement_inline)*size/resolution;\n\n\n    vec4 noOverrideColor = vec4(1., 1., 1., 0.);\n    bool alphaButNotOverrideColor = (color.a==0. && color != noOverrideColor);\n\n    if (size==0. || alphaButNotOverrideColor || size<orderMinWidth || size>=orderMaxWidth){\n        p.x=10000.;\n    }\n\n    gl_Position  = p;\n}\n"},function(e,t){e.exports="precision highp float;\n\nvarying highp vec2 featureIDVar;\nvarying highp vec4 color;\nvarying highp vec2 pointCoord;\nvarying highp float filtering;\n\n$symbol_preface\n$propertyPreface\n\nvoid main(void) {\n    vec2 featureID = abs(featureIDVar);\n    vec2 imageUV = pointCoord;\n    imageUV.x = imageUV.x * 0.5 + 0.5;\n    vec4 symbolColor = $symbol_inline;\n    vec4 noOverrideColor = vec4(1., 1., 1., 0.);\n\n    vec4 c;\n    if (color != noOverrideColor){\n        c = color * vec4(vec3(1), symbolColor.a);\n    }else{\n        c = symbolColor;\n    }\n    c.a *= filtering;\n    if (imageUV!=clamp(imageUV, 0.,1.)){\n        c.a = 0.;\n    }\n\n    gl_FragColor = vec4(c.rgb*c.a, c.a);\n}\n"},function(e,t,r){"use strict";function earcut(e,t,r){r=r||2;var n,a,i,o,s,u,c,l=t&&t.length,f=l?t[0]*r:e.length,h=linkedList(e,0,f,r,!0),d=[];if(!h)return d;if(l&&(h=function eliminateHoles(e,t,r,n){var a,i,o,s,u,c=[];for(a=0,i=t.length;a<i;a++)o=t[a]*n,s=a<i-1?t[a+1]*n:e.length,(u=linkedList(e,o,s,n,!1))===u.next&&(u.steiner=!0),c.push(getLeftmost(u));for(c.sort(compareX),a=0;a<c.length;a++)eliminateHole(c[a],r),r=filterPoints(r,r.next);return r}(e,t,h,r)),e.length>80*r){n=i=e[0],a=o=e[1];for(var p=r;p<f;p+=r)s=e[p],u=e[p+1],s<n&&(n=s),u<a&&(a=u),s>i&&(i=s),u>o&&(o=u);c=0!==(c=Math.max(i-n,o-a))?1/c:0}return earcutLinked(h,d,r,n,a,c),d}function linkedList(e,t,r,n,a){var i,o;if(a===signedArea(e,t,r,n)>0)for(i=t;i<r;i+=n)o=insertNode(i,e[i],e[i+1],o);else for(i=r-n;i>=t;i-=n)o=insertNode(i,e[i],e[i+1],o);return o&&equals(o,o.next)&&(removeNode(o),o=o.next),o}function filterPoints(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!equals(n,n.next)&&0!==area(n.prev,n,n.next))n=n.next;else{if(removeNode(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function earcutLinked(e,t,r,n,a,i,o){if(e){!o&&i&&function indexCurve(e,t,r,n){var a=e;do{null===a.z&&(a.z=zOrder(a.x,a.y,t,r,n)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next}while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,function sortLinked(e){var t,r,n,a,i,o,s,u,c=1;do{for(r=e,e=null,i=null,o=0;r;){for(o++,n=r,s=0,t=0;t<c&&(s++,n=n.nextZ);t++);for(u=c;s>0||u>0&&n;)0!==s&&(0===u||!n||r.z<=n.z)?(a=r,r=r.nextZ,s--):(a=n,n=n.nextZ,u--),i?i.nextZ=a:e=a,a.prevZ=i,i=a;r=n}i.nextZ=null,c*=2}while(o>1);return e}(a)}(e,n,a,i);for(var s,u,c=e;e.prev!==e.next;)if(s=e.prev,u=e.next,i?isEarHashed(e,n,a,i):isEar(e))t.push(s.i/r),t.push(e.i/r),t.push(u.i/r),removeNode(e),e=u.next,c=u.next;else if((e=u)===c){o?1===o?earcutLinked(e=cureLocalIntersections(e,t,r),t,r,n,a,i,2):2===o&&splitEarcut(e,t,r,n,a,i):earcutLinked(filterPoints(e),t,r,n,a,i,1);break}}}function isEar(e){var t=e.prev,r=e,n=e.next;if(area(t,r,n)>=0)return!1;for(var a=e.next.next;a!==e.prev;){if(pointInTriangle(t.x,t.y,r.x,r.y,n.x,n.y,a.x,a.y)&&area(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function isEarHashed(e,t,r,n){var a=e.prev,i=e,o=e.next;if(area(a,i,o)>=0)return!1;for(var s=a.x<i.x?a.x<o.x?a.x:o.x:i.x<o.x?i.x:o.x,u=a.y<i.y?a.y<o.y?a.y:o.y:i.y<o.y?i.y:o.y,c=a.x>i.x?a.x>o.x?a.x:o.x:i.x>o.x?i.x:o.x,l=a.y>i.y?a.y>o.y?a.y:o.y:i.y>o.y?i.y:o.y,f=zOrder(s,u,t,r,n),h=zOrder(c,l,t,r,n),d=e.prevZ,p=e.nextZ;d&&d.z>=f&&p&&p.z<=h;){if(d!==e.prev&&d!==e.next&&pointInTriangle(a.x,a.y,i.x,i.y,o.x,o.y,d.x,d.y)&&area(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,p!==e.prev&&p!==e.next&&pointInTriangle(a.x,a.y,i.x,i.y,o.x,o.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;d&&d.z>=f;){if(d!==e.prev&&d!==e.next&&pointInTriangle(a.x,a.y,i.x,i.y,o.x,o.y,d.x,d.y)&&area(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=h;){if(p!==e.prev&&p!==e.next&&pointInTriangle(a.x,a.y,i.x,i.y,o.x,o.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function cureLocalIntersections(e,t,r){var n=e;do{var a=n.prev,i=n.next.next;!equals(a,i)&&intersects(a,n,n.next,i)&&locallyInside(a,i)&&locallyInside(i,a)&&(t.push(a.i/r),t.push(n.i/r),t.push(i.i/r),removeNode(n),removeNode(n.next),n=e=i),n=n.next}while(n!==e);return n}function splitEarcut(e,t,r,n,a,i){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&isValidDiagonal(o,s)){var u=splitPolygon(o,s);return o=filterPoints(o,o.next),u=filterPoints(u,u.next),earcutLinked(o,t,r,n,a,i),void earcutLinked(u,t,r,n,a,i)}s=s.next}o=o.next}while(o!==e)}function compareX(e,t){return e.x-t.x}function eliminateHole(e,t){if(t=function findHoleBridge(e,t){var r,n=t,a=e.x,i=e.y,o=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var s=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=a&&s>o){if(o=s,s===a){if(i===n.y)return n;if(i===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(a===o)return r.prev;var u,c=r,l=r.x,f=r.y,h=1/0;n=r.next;for(;n!==c;)a>=n.x&&n.x>=l&&a!==n.x&&pointInTriangle(i<f?a:o,i,l,f,i<f?o:a,i,n.x,n.y)&&((u=Math.abs(i-n.y)/(a-n.x))<h||u===h&&n.x>r.x)&&locallyInside(n,e)&&(r=n,h=u),n=n.next;return r}(e,t)){var r=splitPolygon(t,e);filterPoints(r,r.next)}}function zOrder(e,t,r,n,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*a)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*a)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function getLeftmost(e){var t=e,r=e;do{t.x<r.x&&(r=t),t=t.next}while(t!==e);return r}function pointInTriangle(e,t,r,n,a,i,o,s){return(a-o)*(t-s)-(e-o)*(i-s)>=0&&(e-o)*(n-s)-(r-o)*(t-s)>=0&&(r-o)*(i-s)-(a-o)*(n-s)>=0}function isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function intersectsPolygon(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&intersects(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&locallyInside(e,t)&&locallyInside(t,e)&&function middleInside(e,t){var r=e,n=!1,a=(e.x+t.x)/2,i=(e.y+t.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&a<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)}function area(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function equals(e,t){return e.x===t.x&&e.y===t.y}function intersects(e,t,r,n){return!!(equals(e,t)&&equals(r,n)||equals(e,n)&&equals(r,t))||area(e,t,r)>0!=area(e,t,n)>0&&area(r,n,e)>0!=area(r,n,t)>0}function locallyInside(e,t){return area(e.prev,e,e.next)<0?area(e,t,e.next)>=0&&area(e,e.prev,t)>=0:area(e,t,e.prev)<0||area(e,e.next,t)<0}function splitPolygon(e,t){var r=new Node(e.i,e.x,e.y),n=new Node(t.i,t.x,t.y),a=e.next,i=t.prev;return e.next=t,t.prev=e,r.next=a,a.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function insertNode(e,t,r,n){var a=new Node(e,t,r);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(e,t,r,n){for(var a=0,i=t,o=r-n;i<r;i+=n)a+=(e[o]-e[i])*(e[i+1]+e[o+1]),o=i;return a}e.exports=earcut,e.exports.default=earcut,earcut.deviation=function(e,t,r,n){var a=t&&t.length,i=a?t[0]*r:e.length,o=Math.abs(signedArea(e,0,i,r));if(a)for(var s=0,u=t.length;s<u;s++){var c=t[s]*r,l=s<u-1?t[s+1]*r:e.length;o-=Math.abs(signedArea(e,c,l,r))}var f=0;for(s=0;s<n.length;s+=3){var h=n[s]*r,d=n[s+1]*r,p=n[s+2]*r;f+=Math.abs((e[h]-e[p])*(e[d+1]-e[h+1])-(e[h]-e[d])*(e[p+1]-e[h+1]))}return 0===o&&0===f?0:Math.abs((f-o)/o)},earcut.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,a=0;a<e.length;a++){for(var i=0;i<e[a].length;i++)for(var o=0;o<t;o++)r.vertices.push(e[a][i][o]);a>0&&(n+=e[a-1].length,r.holes.push(n))}return r}},function(e,t){!function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(256),n=0;n<e.length;n++)r[e.charCodeAt(n)]=n;t.encode=function(t){var r,n=new Uint8Array(t),a=n.length,i="";for(r=0;r<a;r+=3)i+=e[n[r]>>2],i+=e[(3&n[r])<<4|n[r+1]>>4],i+=e[(15&n[r+1])<<2|n[r+2]>>6],i+=e[63&n[r+2]];return a%3==2?i=i.substring(0,i.length-1)+"=":a%3==1&&(i=i.substring(0,i.length-2)+"=="),i},t.decode=function(e){var t,n,a,i,o,s=.75*e.length,u=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var l=new ArrayBuffer(s),f=new Uint8Array(l);for(t=0;t<u;t+=4)n=r[e.charCodeAt(t)],a=r[e.charCodeAt(t+1)],i=r[e.charCodeAt(t+2)],o=r[e.charCodeAt(t+3)],f[c++]=n<<2|a>>4,f[c++]=(15&a)<<4|i>>2,f[c++]=(3&i)<<6|63&o;return l}}()},function(e,t,r){"use strict";var n={};(0,r(15).assign)(n,r(80),r(83),r(36)),e.exports=n},function(e,t){e.exports="precision highp float;\n\nattribute vec2 vertexPosition;\nattribute vec2 featureID;\n\nuniform float orderMinWidth;\nuniform float orderMaxWidth;\nuniform vec2 resolution;\nuniform mat4 matrix;\n\nuniform sampler2D colorTex;\nuniform sampler2D widthTex;\nuniform sampler2D strokeColorTex;\nuniform sampler2D strokeWidthTex;\nuniform sampler2D filterTex;\n\nvarying highp vec4 color;\nvarying highp vec4 stroke;\nvarying highp float dp;\nvarying highp float fillScale;\nvarying highp float strokeScale;\nvarying highp vec2 pointCoord;\n\nfloat decodeWidth(vec2 enc) {\n  return enc.x*(255.*4.) + 4.*enc.y;\n}\n\n$propertyPreface\n$transform_preface\n\nvec2 transform(vec2 p){\n    return $transform_inline(p*resolution*0.5)/resolution*2.;\n}\n\nvoid main(void) {\n  color = texture2D(colorTex, abs(featureID));\n  stroke = texture2D(strokeColorTex, abs(featureID));\n  float filtering = texture2D(filterTex, abs(featureID)).a;\n  color.a *= filtering;\n  stroke.a *= filtering;\n  float size = decodeWidth(texture2D(widthTex, abs(featureID)).rg);\n  float fillSize = size;\n  float strokeSize = decodeWidth(texture2D(strokeWidthTex, abs(featureID)).rg);\n  size += strokeSize;\n  fillScale = min(size / fillSize, 1.);\n  strokeScale = size / max(0.001, (fillSize - strokeSize));\n  if (fillScale == strokeScale) {\n    stroke.a = 0.;\n  }\n  dp = 1.0 / (size + 1.);\n  float sizeNormalizer = (size +1.)/size;\n\n  vec4 p =  matrix*vec4(vertexPosition, 0., 1.);\n  p/=p.w;\n  vec2 size2 = (2.*size+4.)/resolution;\n\n    if (featureID.y<0.){\n        pointCoord = vec2(0.866025, -0.5)*2.*sizeNormalizer;\n        p.xy += transform(size2*vec2(0.866025, -0.5));\n    }else if (featureID.x<0.){\n        pointCoord = vec2(-0.866025, -0.5)*2.*sizeNormalizer;\n        p.xy += transform(size2*vec2(-0.866025, -0.5));\n    }else{\n        pointCoord = vec2(0., 1.)*2.*sizeNormalizer;\n        p.xy += transform(vec2(0.,size2.y));\n    }\n\n  if (size == 0. || (stroke.a == 0. && color.a == 0.) || size < orderMinWidth || size >= orderMaxWidth) {\n    p.z = p.w*2.;\n  }\n\n  gl_Position = p;\n}\n"},function(e,t){e.exports="precision highp float;\n\nvarying lowp vec4 color;\nvarying lowp vec4 stroke;\nvarying highp float dp;\nvarying highp float fillScale;\nvarying highp float strokeScale;\nvarying highp vec2 pointCoord;\n\nfloat distanceAntialias(vec2 p){\n    // return length(p) > 1 ? 0. : 1. ; // to disable antialias\n    return 1. - smoothstep(1.-dp*1.4142, 1.+dp*1.4142, length(p));\n}\n\nvoid main(void) {\n    vec2 p = pointCoord;\n    vec4 c = color;\n\n    vec4 s = stroke;\n\n    c.a *= distanceAntialias(p*fillScale);\n    c.rgb*=c.a;\n\n    s.a *= distanceAntialias(p);\n    s.a *= 1.-distanceAntialias((strokeScale)*p);\n    s.rgb*=s.a;\n\n    c=s+(1.-s.a)*c;\n\n    gl_FragColor = c;\n}\n"},function(e,t){e.exports="// Line Vertex Shader\nprecision highp float;\n\nattribute vec2 vertexPosition;\nattribute vec2 featureID;\nattribute vec2 normal;\n\nuniform float normalScale;\nuniform vec2 resolution;\nuniform mat4 matrix;\n\nuniform sampler2D colorTex;\nuniform sampler2D widthTex;\nuniform sampler2D filterTex;\n\nvarying lowp vec4 color;\n\nfloat decodeWidth(vec2 enc) {\n  return enc.x*(255.*4.) + 4.*enc.y;\n}\n\n$propertyPreface\n$transform_preface\n\nvoid main(void) {\n    color = texture2D(colorTex, featureID);\n    float filtering = texture2D(filterTex, featureID).a;\n    color.a *= filtering;\n    color.rgb *= color.a; // premultiplied-alpha\n    float size = decodeWidth(texture2D(widthTex, featureID).rg);\n\n    // 64 is computed based on RTT_WIDTH and the depth buffer precision\n    // 64 = 2^(BUFFER_BITS)/RTT_WIDTH = 2^16/1024 = 64\n    float z = featureID.y * 63. / 64. + featureID.x / (64.);\n\n    // Set z range (-1, 1)\n    z = z * 2. - 1.;\n\n    vec2 n = normal*size*normalScale;\n    vec4 p =  matrix*vec4(vertexPosition+n, 0., 1.);\n    p/=p.w;\n\n    p.xy = $transform_inline(p.xy*resolution)/resolution;\n    if (size==0. || color.a==0.){\n        p.x=10000.;\n    }\n    p.z=z;\n    gl_Position  = p;\n}\n"},function(e,t){e.exports="precision highp float;\n\nvarying lowp vec4 color;\n\nvoid main(void) {\n    gl_FragColor = color;\n}\n"},function(e,t){e.exports="precision mediump float;\n\nattribute vec2 vertexPosition;\nattribute vec2 featureID;\nattribute vec2 normal;\n\nuniform float normalScale;\nuniform vec2 resolution;\n\nuniform sampler2D colorTex;\nuniform sampler2D strokeColorTex;\nuniform sampler2D strokeWidthTex;\nuniform sampler2D filterTex;\nuniform mat4 matrix;\n\nvarying lowp vec4 color;\n\nfloat decodeWidth(vec2 enc) {\n  return enc.x*(255.*4.) + 4.*enc.y;\n}\n\n$propertyPreface\n$transform_preface\n\nvoid main(void) {\n    // 64 is computed based on RTT_WIDTH and the depth buffer precision\n    // 64 = 2^(BUFFER_BITS)/RTT_WIDTH = 2^16/1024 = 64\n    float z = featureID.y * 63. / 64. + featureID.x / 64.;\n\n    vec4 c;\n    if (normal == vec2(0.)){\n        c = texture2D(colorTex, featureID);\n    }else{\n        z = mod(z + (z > 0.5 ? -1./64. : 1./64.), 1.);\n        c = texture2D(strokeColorTex, featureID);\n    }\n    z = 2.*z - 1.;\n    float filtering = texture2D(filterTex, featureID).a;\n    c.a *= filtering;\n    float size = decodeWidth(texture2D(strokeWidthTex, featureID).rg);\n\n    vec2 n = normal*size*normalScale;\n    vec4 p =  matrix*vec4(vertexPosition+n, 0., 1.);\n    p/=p.w;\n\n    p.xy = $transform_inline(p.xy*resolution*0.5)/resolution*2.;\n\n    if (c.a==0.){\n        p.x=10000.;\n    }\n    p.z=z;\n    color = vec4(c.rgb*c.a, c.a);\n    gl_Position  = p;\n}\n"},function(e,t){e.exports="precision lowp float;\n\nvarying lowp vec4 color;\n\nvoid main(void) {\n    gl_FragColor = color;\n}\n"},,,,,,,,function(e,t){e.exports=function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}},function(e,t){e.exports=function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t){e.exports=function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}},function(e,t){e.exports=function _iterableToArrayLimit(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}},function(e,t){e.exports=function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}},function(e,t,r){var n=function(){return this||"object"==typeof self&&self}()||Function("return this")(),a=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,i=a&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=r(68),a)n.regeneratorRuntime=i;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var r,n=Object.prototype,a=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag",c="object"==typeof e,l=t.regeneratorRuntime;if(l)c&&(e.exports=l);else{(l=t.regeneratorRuntime=c?e.exports:{}).wrap=wrap;var f="suspendedStart",h="suspendedYield",d="executing",p="completed",m={},_={};_[o]=function(){return this};var v=Object.getPrototypeOf,y=v&&v(v(values([])));y&&y!==n&&a.call(y,o)&&(_=y);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(_);GeneratorFunction.prototype=g.constructor=GeneratorFunctionPrototype,GeneratorFunctionPrototype.constructor=GeneratorFunction,GeneratorFunctionPrototype[u]=GeneratorFunction.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(g),e},l.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),AsyncIterator.prototype[s]=function(){return this},l.AsyncIterator=AsyncIterator,l.async=function(e,t,r,n){var a=new AsyncIterator(wrap(e,t,r,n));return l.isGeneratorFunction(t)?a:a.next().then(function(e){return e.done?e.value:a.next()})},defineIteratorMethods(g),g[u]="Generator",g[o]=function(){return this},g.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function next(){for(;t.length;){var r=t.pop();if(r in e)return next.value=r,next.done=!1,next}return next.done=!0,next}},l.values=values,Context.prototype={constructor:Context,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(resetTryEntry),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function handle(n,a){return o.type="throw",o.arg=e,t.next=n,a&&(t.method="next",t.arg=r),!!a}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],o=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;resetTryEntry(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:values(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),m}}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),o=new Context(n||[]);return i._invoke=function makeInvokeMethod(e,t,r){var n=f;return function invoke(a,i){if(n===d)throw new Error("Generator is already running");if(n===p){if("throw"===a)throw i;return doneResult()}for(r.method=a,r.arg=i;;){var o=r.delegate;if(o){var s=maybeInvokeDelegate(o,r);if(s){if(s===m)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===f)throw n=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=d;var u=tryCatch(e,t,r);if("normal"===u.type){if(n=r.done?p:h,u.arg===m)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=p,r.method="throw",r.arg=u.arg)}}}(e,r,o),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}function defineIteratorMethods(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function AsyncIterator(e){var t;this._invoke=function enqueue(r,n){function callInvokeWithMethodAndArg(){return new Promise(function(t,i){!function invoke(t,r,n,i){var o=tryCatch(e[t],e,r);if("throw"!==o.type){var s=o.arg,u=s.value;return u&&"object"==typeof u&&a.call(u,"__await")?Promise.resolve(u.__await).then(function(e){invoke("next",e,n,i)},function(e){invoke("throw",e,n,i)}):Promise.resolve(u).then(function(e){s.value=e,n(s)},function(e){return invoke("throw",e,n,i)})}i(o.arg)}(r,n,t,i)})}return t=t?t.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(e,t){var n=e.iterator[t.method];if(n===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=r,maybeInvokeDelegate(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var a=tryCatch(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,m;var i=a.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,m):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function next(){for(;++n<e.length;)if(a.call(e,n))return next.value=e[n],next.done=!1,next;return next.value=r,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:r,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t,r){var n,a;!function(){var i={Burg:{2:["#ffc6c4","#672044"],3:["#ffc6c4","#cc607d","#672044"],4:["#ffc6c4","#e38191","#ad466c","#672044"],5:["#ffc6c4","#ee919b","#cc607d","#9e3963","#672044"],6:["#ffc6c4","#f29ca3","#da7489","#b95073","#93345d","#672044"],7:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],tags:["quantitative"]},BurgYl:{2:["#fbe6c5","#70284a"],3:["#fbe6c5","#dc7176","#70284a"],4:["#fbe6c5","#ee8a82","#c8586c","#70284a"],5:["#fbe6c5","#f2a28a","#dc7176","#b24b65","#70284a"],6:["#fbe6c5","#f4b191","#e7807d","#d06270","#a44360","#70284a"],7:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],tags:["quantitative"]},RedOr:{2:["#f6d2a9","#b13f64"],3:["#f6d2a9","#ea8171","#b13f64"],4:["#f6d2a9","#f19c7c","#dd686c","#b13f64"],5:["#f6d2a9","#f3aa84","#ea8171","#d55d6a","#b13f64"],6:["#f6d2a9","#f4b28a","#ef9177","#e3726d","#cf5669","#b13f64"],7:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],tags:["quantitative"]},OrYel:{2:["#ecda9a","#ee4d5a"],3:["#ecda9a","#f7945d","#ee4d5a"],4:["#ecda9a","#f3ad6a","#f97b57","#ee4d5a"],5:["#ecda9a","#f1b973","#f7945d","#f86f56","#ee4d5a"],6:["#ecda9a","#f0c079","#f5a363","#f98558","#f76856","#ee4d5a"],7:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],tags:["quantitative"]},Peach:{2:["#fde0c5","#eb4a40"],3:["#fde0c5","#f59e72","#eb4a40"],4:["#fde0c5","#f8b58b","#f2855d","#eb4a40"],5:["#fde0c5","#f9c098","#f59e72","#f17854","#eb4a40"],6:["#fde0c5","#fac7a1","#f7ac80","#f38f65","#f0704f","#eb4a40"],7:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],tags:["quantitative"]},PinkYl:{2:["#fef6b5","#e15383"],3:["#fef6b5","#ffa679","#e15383"],4:["#fef6b5","#ffc285","#fa8a76","#e15383"],5:["#fef6b5","#ffd08e","#ffa679","#f67b77","#e15383"],6:["#fef6b5","#ffd795","#ffb77f","#fd9576","#f37378","#e15383"],7:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],tags:["quantitative"]},Mint:{2:["#e4f1e1","#0d585f"],3:["#e4f1e1","#63a6a0","#0d585f"],4:["#e4f1e1","#89c0b6","#448c8a","#0d585f"],5:["#E4F1E1","#9CCDC1","#63A6A0","#337F7F","#0D585F"],6:["#e4f1e1","#abd4c7","#7ab5ad","#509693","#2c7778","#0d585f"],7:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],tags:["quantitative"]},BluGrn:{2:["#c4e6c3","#1d4f60"],3:["#c4e6c3","#4da284","#1d4f60"],4:["#c4e6c3","#6dbc90","#36877a","#1d4f60"],5:["#c4e6c3","#80c799","#4da284","#2d7974","#1d4f60"],6:["#c4e6c3","#8dce9f","#5fb28b","#3e927e","#297071","#1d4f60"],7:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],tags:["quantitative"]},DarkMint:{2:["#d2fbd4","#123f5a"],3:["#d2fbd4","#559c9e","#123f5a"],4:["#d2fbd4","#7bbcb0","#3a7c89","#123f5a"],5:["#d2fbd4","#8eccb9","#559c9e","#2b6c7f","#123f5a"],6:["#d2fbd4","#9cd5be","#6cafa9","#458892","#266377","#123f5a"],7:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],tags:["quantitative"]},Emrld:{2:["#d3f2a3","#074050"],3:["#d3f2a3","#4c9b82","#074050"],4:["#d3f2a3","#6cc08b","#217a79","#074050"],5:["#d3f2a3","#82d091","#4c9b82","#19696f","#074050"],6:["#d3f2a3","#8fda94","#60b187","#35877d","#145f69","#074050"],7:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],tags:["quantitative"]},ag_GrnYl:{2:["#245668","#EDEF5D"],3:["#245668","#39AB7E","#EDEF5D"],4:["#245668","#0D8F81","#6EC574","#EDEF5D"],5:["#245668","#04817E","#39AB7E","#8BD16D","#EDEF5D"],6:["#245668","#09787C","#1D9A81","#58BB79","#9DD869","#EDEF5D"],7:["#245668","#0F7279","#0D8F81","#39AB7E","#6EC574","#A9DC67","#EDEF5D"],tags:["aggregation"]},BluYl:{2:["#f7feae","#045275"],3:["#f7feae","#46aea0","#045275"],4:["#f7feae","#7ccba2","#089099","#045275"],5:["#f7feae","#9bd8a4","#46aea0","#058092","#045275"],6:["#f7feae","#ace1a4","#68bfa1","#2a9c9c","#02778e","#045275"],7:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],tags:["quantitative"]},Teal:{2:["#d1eeea","#2a5674"],3:["#d1eeea","#68abb8","#2a5674"],4:["#d1eeea","#85c4c9","#4f90a6","#2a5674"],5:["#d1eeea","#96d0d1","#68abb8","#45829b","#2a5674"],6:["#d1eeea","#a1d7d6","#79bbc3","#599bae","#3f7994","#2a5674"],7:["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],tags:["quantitative"]},TealGrn:{2:["#b0f2bc","#257d98"],3:["#b0f2bc","#4cc8a3","#257d98"],4:["#b0f2bc","#67dba5","#38b2a3","#257d98"],5:["#b0f2bc","#77e2a8","#4cc8a3","#31a6a2","#257d98"],6:["#b0f2bc","#82e6aa","#5bd4a4","#3fbba3","#2e9ea1","#257d98"],7:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],tags:["quantitative"]},Purp:{2:["#f3e0f7","#63589f"],3:["#f3e0f7","#b998dd","#63589f"],4:["#f3e0f7","#d1afe8","#9f82ce","#63589f"],5:["#f3e0f7","#dbbaed","#b998dd","#9178c4","#63589f"],6:["#f3e0f7","#e0c2ef","#c8a5e4","#aa8bd4","#8871be","#63589f"],7:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],tags:["quantitative"]},PurpOr:{3:["#f9ddda","#ce78b3","#573b88"],4:["#f9ddda","#e597b9","#ad5fad","#573b88"],5:["#f9ddda","#eda8bd","#ce78b3","#9955a8","#573b88"],6:["#f9ddda","#f0b2c1","#dd8ab6","#bb69b0","#8c4fa4","#573b88"],7:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],tags:["quantitative"]},Sunset:{2:["#f3e79b","#5c53a5"],3:["#f3e79b","#eb7f86","#5c53a5"],4:["#f3e79b","#f8a07e","#ce6693","#5c53a5"],5:["#f3e79b","#fab27f","#eb7f86","#b95e9a","#5c53a5"],6:["#f3e79b","#fabc82","#f59280","#dc6f8e","#ab5b9e","#5c53a5"],7:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],tags:["quantitative"]},Magenta:{2:["#f3cbd3","#6c2167"],3:["#f3cbd3","#ca699d","#6c2167"],4:["#f3cbd3","#dd88ac","#b14d8e","#6c2167"],5:["#f3cbd3","#e498b4","#ca699d","#a24186","#6c2167"],6:["#f3cbd3","#e7a2b9","#d67ba5","#bc5894","#983a81","#6c2167"],7:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],tags:["quantitative"]},SunsetDark:{2:["#fcde9c","#7c1d6f"],3:["#fcde9c","#e34f6f","#7c1d6f"],4:["#fcde9c","#f0746e","#dc3977","#7c1d6f"],5:["#fcde9c","#f58670","#e34f6f","#d72d7c","#7c1d6f"],6:["#fcde9c","#f89872","#ec666d","#df4273","#c5287b","#7c1d6f"],7:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],tags:["quantitative"]},ag_Sunset:{2:["#4b2991","#edd9a3"],3:["#4b2991","#ea4f88","#edd9a3"],4:["#4b2991","#c0369d","#fa7876","#edd9a3"],5:["#4b2991","#a52fa2","#ea4f88","#fa9074","#edd9a3"],6:["#4b2991","#932da3","#d43f96","#f7667c","#f89f77","#edd9a3"],7:["#4b2991","#872ca2","#c0369d","#ea4f88","#fa7876","#f6a97a","#edd9a3"],tags:["aggregation"]},BrwnYl:{2:["#ede5cf","#541f3f"],3:["#ede5cf","#c1766f","#541f3f"],4:["#ede5cf","#d39c83","#a65461","#541f3f"],5:["#ede5cf","#daaf91","#c1766f","#95455a","#541f3f"],6:["#ede5cf","#ddba9b","#cd8c7a","#b26166","#8a3c56","#541f3f"],7:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],tags:["quantitative"]},ArmyRose:{2:["#929b4f","#db8195"],3:["#a3ad62","#fdfbe4","#df91a3"],4:["#929b4f","#d9dbaf","#f3d1ca","#db8195"],5:["#879043","#c1c68c","#fdfbe4","#ebb4b8","#d8758b"],6:["#7f883b","#b0b874","#e3e4be","#f6ddd1","#e4a0ac","#d66d85"],7:["#798234","#a3ad62","#d0d3a2","#fdfbe4","#f0c6c3","#df91a3","#d46780"],tags:["diverging"]},Fall:{2:["#3d5941","#ca562c"],3:["#3d5941","#f6edbd","#ca562c"],4:["#3d5941","#b5b991","#edbb8a","#ca562c"],5:["#3d5941","#96a07c","#f6edbd","#e6a272","#ca562c"],6:["#3d5941","#839170","#cecea2","#f1cf9e","#e19464","#ca562c"],7:["#3d5941","#778868","#b5b991","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},Geyser:{2:["#008080","#ca562c"],3:["#008080","#f6edbd","#ca562c"],4:["#008080","#b4c8a8","#edbb8a","#ca562c"],5:["#008080","#92b69e","#f6edbd","#e6a272","#ca562c"],6:["#008080","#7eab98","#ced7b1","#f1cf9e","#e19464","#ca562c"],7:["#008080","#70a494","#b4c8a8","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},Temps:{2:["#009392","#cf597e"],3:["#009392","#e9e29c","#cf597e"],4:["#009392","#9ccb86","#eeb479","#cf597e"],5:["#009392","#71be83","#e9e29c","#ed9c72","#cf597e"],6:["#009392","#52b684","#bcd48c","#edc783","#eb8d71","#cf597e"],7:["#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"],tags:["diverging"]},TealRose:{2:["#009392","#d0587e"],3:["#009392","#f1eac8","#d0587e"],4:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],5:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],6:["#009392","#72aaa1","#b1c7b3","#e5b9ad","#d98994","#d0587e"],7:["#009392","#72aaa1","#b1c7b3","#f1eac8","#e5b9ad","#d98994","#d0587e"],tags:["diverging"]},Tropic:{2:["#009B9E","#C75DAB"],3:["#009B9E","#F1F1F1","#C75DAB"],4:["#009B9E","#A7D3D4","#E4C1D9","#C75DAB"],5:["#009B9E","#7CC5C6","#F1F1F1","#DDA9CD","#C75DAB"],6:["#009B9E","#5DBCBE","#C6DFDF","#E9D4E2","#D99BC6","#C75DAB"],7:["#009B9E","#42B7B9","#A7D3D4","#F1F1F1","#E4C1D9","#D691C1","#C75DAB"],tags:["diverging"]},Earth:{2:["#A16928","#2887a1"],3:["#A16928","#edeac2","#2887a1"],4:["#A16928","#d6bd8d","#b5c8b8","#2887a1"],5:["#A16928","#caa873","#edeac2","#98b7b2","#2887a1"],6:["#A16928","#c29b64","#e0cfa2","#cbd5bc","#85adaf","#2887a1"],7:["#A16928","#bd925a","#d6bd8d","#edeac2","#b5c8b8","#79a7ac","#2887a1"],tags:["diverging"]},Antique:{2:["#855C75","#D9AF6B","#7C7C7C"],3:["#855C75","#D9AF6B","#AF6458","#7C7C7C"],4:["#855C75","#D9AF6B","#AF6458","#736F4C","#7C7C7C"],5:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#7C7C7C"],6:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#7C7C7C"],7:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#7C7C7C"],8:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#7C7C7C"],9:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#7C7C7C"],10:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#7C7C7C"],11:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#467378","#7C7C7C"],tags:["qualitative"]},Bold:{2:["#7F3C8D","#11A579","#A5AA99"],3:["#7F3C8D","#11A579","#3969AC","#A5AA99"],4:["#7F3C8D","#11A579","#3969AC","#F2B701","#A5AA99"],5:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#A5AA99"],6:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#A5AA99"],7:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#A5AA99"],8:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#A5AA99"],9:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#A5AA99"],10:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#A5AA99"],11:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#4b4b8f","#A5AA99"],tags:["qualitative"]},Pastel:{2:["#66C5CC","#F6CF71","#B3B3B3"],3:["#66C5CC","#F6CF71","#F89C74","#B3B3B3"],4:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#B3B3B3"],5:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#B3B3B3"],6:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#B3B3B3"],7:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#B3B3B3"],8:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#B3B3B3"],9:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B3B3B3"],10:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#B3B3B3"],11:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"],tags:["qualitative"]},Prism:{2:["#5F4690","#1D6996","#666666"],3:["#5F4690","#1D6996","#38A6A5","#666666"],4:["#5F4690","#1D6996","#38A6A5","#0F8554","#666666"],5:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#666666"],6:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#666666"],7:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#666666"],8:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#666666"],9:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#666666"],10:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#666666"],11:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#994E95","#666666"],tags:["qualitative"]},Safe:{2:["#88CCEE","#CC6677","#888888"],3:["#88CCEE","#CC6677","#DDCC77","#888888"],4:["#88CCEE","#CC6677","#DDCC77","#117733","#888888"],5:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#888888"],6:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#888888"],7:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#888888"],8:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#888888"],9:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#888888"],10:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#888888"],11:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#6699CC","#888888"],tags:["qualitative","colorblind"]},Vivid:{2:["#E58606","#5D69B1","#A5AA99"],3:["#E58606","#5D69B1","#52BCA3","#A5AA99"],4:["#E58606","#5D69B1","#52BCA3","#99C945","#A5AA99"],5:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#A5AA99"],6:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#A5AA99"],7:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#A5AA99"],8:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#A5AA99"],9:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#A5AA99"],10:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#A5AA99"],11:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#CC3A8E","#A5AA99"],tags:["qualitative"]}},o={Blues:{tags:["quantitative"]},BrBG:{tags:["diverging"]},Greys:{tags:["quantitative"]},PiYG:{tags:["diverging"]},PRGn:{tags:["diverging"]},Purples:{tags:["quantitative"]},RdYlGn:{tags:["diverging"]},Spectral:{tags:["diverging"]},YlOrBr:{tags:["quantitative"]},YlGn:{tags:["quantitative"]},YlGnBu:{tags:["quantitative"]},YlOrRd:{tags:["quantitative"]}},s=r(70);for(var u in s){var c=s[u],l={};for(var f in c)l[f]=c[f];u in o&&(l.tags=o[u].tags),i["cb_"+u]=l}void 0===(a="function"==typeof(n=i)?n.call(t,r,t,e):n)||(e.exports=a)}()},function(e,t,r){e.exports=r(71)},function(e,t,r){var n,a;void 0===(a="function"==typeof(n={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}})?n.call(t,r,t,e):n)||(e.exports=a)},function(e,t,r){(function(t){"pseudomap"===t.env.npm_package_name&&"test"===t.env.npm_lifecycle_script&&(t.env.TEST_PSEUDOMAP="true"),"function"!=typeof Map||t.env.TEST_PSEUDOMAP?e.exports=r(73):e.exports=Map}).call(this,r(31))},function(e,t){var r=Object.prototype.hasOwnProperty;function PseudoMap(e){if(!(this instanceof PseudoMap))throw new TypeError("Constructor PseudoMap requires 'new'");if(this.clear(),e)if(e instanceof PseudoMap||"function"==typeof Map&&e instanceof Map)e.forEach(function(e,t){this.set(t,e)},this);else{if(!Array.isArray(e))throw new TypeError("invalid argument");e.forEach(function(e){this.set(e[0],e[1])},this)}}function same(e,t){return e===t||e!=e&&t!=t}function find(e,t){for(var n=0,a="_"+t,i=a;r.call(e,i);i=a+n++)if(same(e[i].key,t))return e[i]}e.exports=PseudoMap,PseudoMap.prototype.forEach=function(e,t){t=t||this,Object.keys(this._data).forEach(function(r){"size"!==r&&e.call(t,this._data[r].value,this._data[r].key)},this)},PseudoMap.prototype.has=function(e){return!!find(this._data,e)},PseudoMap.prototype.get=function(e){var t=find(this._data,e);return t&&t.value},PseudoMap.prototype.set=function(e,t){!function set(e,t,n){for(var a=0,i="_"+t,o=i;r.call(e,o);o=i+a++)if(same(e[o].key,t))return void(e[o].value=n);e.size++,e[o]=new function Entry(e,t,r){this.key=e,this.value=t,this._index=r}(t,n,o)}(this._data,e,t)},PseudoMap.prototype.delete=function(e){var t=find(this._data,e);t&&(delete this._data[t._index],this._data.size--)},PseudoMap.prototype.clear=function(){var e=Object.create(null);e.size=0,Object.defineProperty(this,"_data",{value:e,enumerable:!1,configurable:!0,writable:!1})},Object.defineProperty(PseudoMap.prototype,"size",{get:function(){return this._data.size},set:function(e){},enumerable:!0,configurable:!0}),PseudoMap.prototype.values=PseudoMap.prototype.keys=PseudoMap.prototype.entries=function(){throw new Error("iterators are not implemented in this version")}},function(e,t,r){(function(e,n){var a=/%[sdj%]/g;t.format=function(e){if(!isString(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(inspect(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,i=n.length,o=String(e).replace(a,function(e){if("%%"===e)return"%";if(r>=i)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),s=n[r];r<i;s=n[++r])isNull(s)||!isObject(s)?o+=" "+s:o+=" "+inspect(s);return o},t.deprecate=function(r,a){if(isUndefined(e.process))return function(){return t.deprecate(r,a).apply(this,arguments)};if(!0===n.noDeprecation)return r;var i=!1;return function deprecated(){if(!i){if(n.throwDeprecation)throw new Error(a);n.traceDeprecation?console.trace(a):console.error(a),i=!0}return r.apply(this,arguments)}};var i,o={};function inspect(e,r){var n={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),isBoolean(r)?n.showHidden=r:r&&t._extend(n,r),isUndefined(n.showHidden)&&(n.showHidden=!1),isUndefined(n.depth)&&(n.depth=2),isUndefined(n.colors)&&(n.colors=!1),isUndefined(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=stylizeWithColor),formatValue(n,e,n.depth)}function stylizeWithColor(e,t){var r=inspect.styles[t];return r?"["+inspect.colors[r][0]+"m"+e+"["+inspect.colors[r][1]+"m":e}function stylizeNoColor(e,t){return e}function formatValue(e,r,n){if(e.customInspect&&r&&isFunction(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var a=r.inspect(n,e);return isString(a)||(a=formatValue(e,a,n)),a}var i=function formatPrimitive(e,t){if(isUndefined(t))return e.stylize("undefined","undefined");if(isString(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(isNumber(t))return e.stylize(""+t,"number");if(isBoolean(t))return e.stylize(""+t,"boolean");if(isNull(t))return e.stylize("null","null")}(e,r);if(i)return i;var o=Object.keys(r),s=function arrayToHash(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(r)),isError(r)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return formatError(r);if(0===o.length){if(isFunction(r)){var u=r.name?": "+r.name:"";return e.stylize("[Function"+u+"]","special")}if(isRegExp(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(isDate(r))return e.stylize(Date.prototype.toString.call(r),"date");if(isError(r))return formatError(r)}var c,l="",f=!1,h=["{","}"];(isArray(r)&&(f=!0,h=["[","]"]),isFunction(r))&&(l=" [Function"+(r.name?": "+r.name:"")+"]");return isRegExp(r)&&(l=" "+RegExp.prototype.toString.call(r)),isDate(r)&&(l=" "+Date.prototype.toUTCString.call(r)),isError(r)&&(l=" "+formatError(r)),0!==o.length||f&&0!=r.length?n<0?isRegExp(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),c=f?function formatArray(e,t,r,n,a){for(var i=[],o=0,s=t.length;o<s;++o)hasOwnProperty(t,String(o))?i.push(formatProperty(e,t,r,n,String(o),!0)):i.push("");return a.forEach(function(a){a.match(/^\d+$/)||i.push(formatProperty(e,t,r,n,a,!0))}),i}(e,r,n,s,o):o.map(function(t){return formatProperty(e,r,n,s,t,f)}),e.seen.pop(),function reduceToSingleString(e,t,r){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(c,l,h)):h[0]+l+h[1]}function formatError(e){return"["+Error.prototype.toString.call(e)+"]"}function formatProperty(e,t,r,n,a,i){var o,s,u;if((u=Object.getOwnPropertyDescriptor(t,a)||{value:t[a]}).get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),hasOwnProperty(n,a)||(o="["+a+"]"),s||(e.seen.indexOf(u.value)<0?(s=isNull(r)?formatValue(e,u.value,null):formatValue(e,u.value,r-1)).indexOf("\n")>-1&&(s=i?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),isUndefined(o)){if(i&&a.match(/^\d+$/))return s;(o=JSON.stringify(""+a)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function isArray(e){return Array.isArray(e)}function isBoolean(e){return"boolean"==typeof e}function isNull(e){return null===e}function isNumber(e){return"number"==typeof e}function isString(e){return"string"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return isObject(e)&&"[object RegExp]"===objectToString(e)}function isObject(e){return"object"==typeof e&&null!==e}function isDate(e){return isObject(e)&&"[object Date]"===objectToString(e)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(e){return"function"==typeof e}function objectToString(e){return Object.prototype.toString.call(e)}function pad(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(isUndefined(i)&&(i=n.env.NODE_DEBUG||""),e=e.toUpperCase(),!o[e])if(new RegExp("\\b"+e+"\\b","i").test(i)){var r=n.pid;o[e]=function(){var n=t.format.apply(t,arguments);console.error("%s %d: %s",e,r,n)}}else o[e]=function(){};return o[e]},t.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=isArray,t.isBoolean=isBoolean,t.isNull=isNull,t.isNullOrUndefined=function isNullOrUndefined(e){return null==e},t.isNumber=isNumber,t.isString=isString,t.isSymbol=function isSymbol(e){return"symbol"==typeof e},t.isUndefined=isUndefined,t.isRegExp=isRegExp,t.isObject=isObject,t.isDate=isDate,t.isError=isError,t.isFunction=isFunction,t.isPrimitive=function isPrimitive(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=r(76);var s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function hasOwnProperty(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",function timestamp(){var e=new Date,t=[pad(e.getHours()),pad(e.getMinutes()),pad(e.getSeconds())].join(":");return[e.getDate(),s[e.getMonth()],t].join(" ")}(),t.format.apply(t,arguments))},t.inherits=r(77),t._extend=function(e,t){if(!t||!isObject(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,r(75),r(31))},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){e.exports=function isBuffer(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function inherits(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function inherits(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t){function Yallist(e){var t=this;if(t instanceof Yallist||(t=new Yallist),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach(function(e){t.push(e)});else if(arguments.length>0)for(var r=0,n=arguments.length;r<n;r++)t.push(arguments[r]);return t}function push(e,t){e.tail=new Node(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function unshift(e,t){e.head=new Node(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function Node(e,t,r,n){if(!(this instanceof Node))return new Node(e,t,r,n);this.list=n,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}e.exports=Yallist,Yallist.Node=Node,Yallist.create=Yallist,Yallist.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,r=e.prev;t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),e.list.length--,e.next=null,e.prev=null,e.list=null},Yallist.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},Yallist.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},Yallist.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)push(this,arguments[e]);return this.length},Yallist.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)unshift(this,arguments[e]);return this.length},Yallist.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},Yallist.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},Yallist.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,n=0;null!==r;n++)e.call(t,r.value,n,this),r=r.next},Yallist.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,n=this.length-1;null!==r;n--)e.call(t,r.value,n,this),r=r.prev},Yallist.prototype.get=function(e){for(var t=0,r=this.head;null!==r&&t<e;t++)r=r.next;if(t===e&&null!==r)return r.value},Yallist.prototype.getReverse=function(e){for(var t=0,r=this.tail;null!==r&&t<e;t++)r=r.prev;if(t===e&&null!==r)return r.value},Yallist.prototype.map=function(e,t){t=t||this;for(var r=new Yallist,n=this.head;null!==n;)r.push(e.call(t,n.value,this)),n=n.next;return r},Yallist.prototype.mapReverse=function(e,t){t=t||this;for(var r=new Yallist,n=this.tail;null!==n;)r.push(e.call(t,n.value,this)),n=n.prev;return r},Yallist.prototype.reduce=function(e,t){var r,n=this.head;if(arguments.length>1)r=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");n=this.head.next,r=this.head.value}for(var a=0;null!==n;a++)r=e(r,n.value,a),n=n.next;return r},Yallist.prototype.reduceReverse=function(e,t){var r,n=this.tail;if(arguments.length>1)r=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");n=this.tail.prev,r=this.tail.value}for(var a=this.length-1;null!==n;a--)r=e(r,n.value,a),n=n.prev;return r},Yallist.prototype.toArray=function(){for(var e=new Array(this.length),t=0,r=this.head;null!==r;t++)e[t]=r.value,r=r.next;return e},Yallist.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,r=this.tail;null!==r;t++)e[t]=r.value,r=r.prev;return e},Yallist.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new Yallist;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var n=0,a=this.head;null!==a&&n<e;n++)a=a.next;for(;null!==a&&n<t;n++,a=a.next)r.push(a.value);return r},Yallist.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new Yallist;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var n=this.length,a=this.tail;null!==a&&n>t;n--)a=a.prev;for(;null!==a&&n>e;n--,a=a.prev)r.push(a.value);return r},Yallist.prototype.reverse=function(){for(var e=this.head,t=this.tail,r=e;null!==r;r=r.prev){var n=r.prev;r.prev=r.next,r.next=n}return this.head=t,this.tail=e,this}},function(e,t,r){"use strict";var n=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var r;try{(r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),r=r.getBlob()}catch(t){r=new Blob([e])}return new Worker(n.createObjectURL(r))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(!t)throw Error("Inline worker is not supported");return new Worker(t)}}},function(e,t,r){"use strict";var n=r(81),a=r(15),i=r(34),o=r(25),s=r(35),u=Object.prototype.toString,c=0,l=-1,f=0,h=8;function Deflate(e){if(!(this instanceof Deflate))return new Deflate(e);this.options=a.assign({level:l,method:h,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var r=n.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==c)throw new Error(o[r]);if(t.header&&n.deflateSetHeader(this.strm,t.header),t.dictionary){var d;if(d="string"==typeof t.dictionary?i.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=n.deflateSetDictionary(this.strm,d))!==c)throw new Error(o[r]);this._dict_set=!0}}function deflate(e,t){var r=new Deflate(t);if(r.push(e,!0),r.err)throw r.msg||o[r.err];return r.result}Deflate.prototype.push=function(e,t){var r,o,s=this.strm,l=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=i.string2buf(e):"[object ArrayBuffer]"===u.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new a.Buf8(l),s.next_out=0,s.avail_out=l),1!==(r=n.deflate(s,o))&&r!==c)return this.onEnd(r),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(i.buf2binstring(a.shrinkBuf(s.output,s.next_out))):this.onData(a.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==r);return 4===o?(r=n.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===c):2!==o||(this.onEnd(c),s.avail_out=0,!0)},Deflate.prototype.onData=function(e){this.chunks.push(e)},Deflate.prototype.onEnd=function(e){e===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=Deflate,t.deflate=deflate,t.deflateRaw=function deflateRaw(e,t){return(t=t||{}).raw=!0,deflate(e,t)},t.gzip=function gzip(e,t){return(t=t||{}).gzip=!0,deflate(e,t)}},function(e,t,r){"use strict";var n,a=r(15),i=r(82),o=r(32),s=r(33),u=r(25),c=0,l=1,f=3,h=4,d=5,p=0,m=1,_=-2,v=-3,y=-5,g=-1,b=1,x=2,w=3,k=4,T=0,C=2,E=8,M=9,A=15,S=8,I=286,P=30,D=19,N=2*I+1,R=15,F=3,O=258,L=O+F+1,z=32,B=42,V=69,G=73,U=91,q=103,j=113,W=666,H=1,Z=2,Y=3,X=4,Q=3;function err(e,t){return e.msg=u[t],t}function rank(e){return(e<<1)-(e>4?9:0)}function zero(e){for(var t=e.length;--t>=0;)e[t]=0}function flush_pending(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(a.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function flush_block_only(e,t){i._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,flush_pending(e.strm)}function put_byte(e,t){e.pending_buf[e.pending++]=t}function putShortMSB(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function read_buf(e,t,r,n){var i=e.avail_in;return i>n&&(i=n),0===i?0:(e.avail_in-=i,a.arraySet(t,e.input,e.next_in,i,r),1===e.state.wrap?e.adler=o(e.adler,t,i,r):2===e.state.wrap&&(e.adler=s(e.adler,t,i,r)),e.next_in+=i,e.total_in+=i,i)}function longest_match(e,t){var r,n,a=e.max_chain_length,i=e.strstart,o=e.prev_length,s=e.nice_match,u=e.strstart>e.w_size-L?e.strstart-(e.w_size-L):0,c=e.window,l=e.w_mask,f=e.prev,h=e.strstart+O,d=c[i+o-1],p=c[i+o];e.prev_length>=e.good_match&&(a>>=2),s>e.lookahead&&(s=e.lookahead);do{if(c[(r=t)+o]===p&&c[r+o-1]===d&&c[r]===c[i]&&c[++r]===c[i+1]){i+=2,r++;do{}while(c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&i<h);if(n=O-(h-i),i=h-O,n>o){if(e.match_start=t,o=n,n>=s)break;d=c[i+o-1],p=c[i+o]}}}while((t=f[t&l])>u&&0!=--a);return o<=e.lookahead?o:e.lookahead}function fill_window(e){var t,r,n,i,o,s=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=s+(s-L)){a.arraySet(e.window,e.window,s,s,0),e.match_start-=s,e.strstart-=s,e.block_start-=s,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=s?n-s:0}while(--r);t=r=s;do{n=e.prev[--t],e.prev[t]=n>=s?n-s:0}while(--r);i+=s}if(0===e.strm.avail_in)break;if(r=read_buf(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=r,e.lookahead+e.insert>=F)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+F-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<F)););}while(e.lookahead<L&&0!==e.strm.avail_in)}function deflate_fast(e,t){for(var r,n;;){if(e.lookahead<L){if(fill_window(e),e.lookahead<L&&t===c)return H;if(0===e.lookahead)break}if(r=0,e.lookahead>=F&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+F-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-L&&(e.match_length=longest_match(e,r)),e.match_length>=F)if(n=i._tr_tally(e,e.strstart-e.match_start,e.match_length-F),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=F){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+F-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(flush_block_only(e,!1),0===e.strm.avail_out))return H}return e.insert=e.strstart<F-1?e.strstart:F-1,t===h?(flush_block_only(e,!0),0===e.strm.avail_out?Y:X):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?H:Z}function deflate_slow(e,t){for(var r,n,a;;){if(e.lookahead<L){if(fill_window(e),e.lookahead<L&&t===c)return H;if(0===e.lookahead)break}if(r=0,e.lookahead>=F&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+F-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=F-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-L&&(e.match_length=longest_match(e,r),e.match_length<=5&&(e.strategy===b||e.match_length===F&&e.strstart-e.match_start>4096)&&(e.match_length=F-1)),e.prev_length>=F&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-F,n=i._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-F),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+F-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=F-1,e.strstart++,n&&(flush_block_only(e,!1),0===e.strm.avail_out))return H}else if(e.match_available){if((n=i._tr_tally(e,0,e.window[e.strstart-1]))&&flush_block_only(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return H}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=i._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<F-1?e.strstart:F-1,t===h?(flush_block_only(e,!0),0===e.strm.avail_out?Y:X):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?H:Z}function Config(e,t,r,n,a){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=a}function deflateResetKeep(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=C,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?B:j,e.adler=2===t.wrap?0:1,t.last_flush=c,i._tr_init(t),p):err(e,_)}function deflateReset(e){var t=deflateResetKeep(e);return t===p&&function lm_init(e){e.window_size=2*e.w_size,zero(e.head),e.max_lazy_match=n[e.level].max_lazy,e.good_match=n[e.level].good_length,e.nice_match=n[e.level].nice_length,e.max_chain_length=n[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=F-1,e.match_available=0,e.ins_h=0}(e.state),t}function deflateInit2(e,t,r,n,i,o){if(!e)return _;var s=1;if(t===g&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),i<1||i>M||r!==E||n<8||n>15||t<0||t>9||o<0||o>k)return err(e,_);8===n&&(n=9);var u=new function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=E,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*N),this.dyn_dtree=new a.Buf16(2*(2*P+1)),this.bl_tree=new a.Buf16(2*(2*D+1)),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(R+1),this.heap=new a.Buf16(2*I+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*I+1),zero(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return e.state=u,u.strm=e,u.wrap=s,u.gzhead=null,u.w_bits=n,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=i+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+F-1)/F),u.window=new a.Buf8(2*u.w_size),u.head=new a.Buf16(u.hash_size),u.prev=new a.Buf16(u.w_size),u.lit_bufsize=1<<i+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new a.Buf8(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=t,u.strategy=o,u.method=r,deflateReset(e)}n=[new Config(0,0,0,0,function deflate_stored(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(fill_window(e),0===e.lookahead&&t===c)return H;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,flush_block_only(e,!1),0===e.strm.avail_out))return H;if(e.strstart-e.block_start>=e.w_size-L&&(flush_block_only(e,!1),0===e.strm.avail_out))return H}return e.insert=0,t===h?(flush_block_only(e,!0),0===e.strm.avail_out?Y:X):(e.strstart>e.block_start&&(flush_block_only(e,!1),e.strm.avail_out),H)}),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],t.deflateInit=function deflateInit(e,t){return deflateInit2(e,t,E,A,S,T)},t.deflateInit2=deflateInit2,t.deflateReset=deflateReset,t.deflateResetKeep=deflateResetKeep,t.deflateSetHeader=function deflateSetHeader(e,t){return e&&e.state?2!==e.state.wrap?_:(e.state.gzhead=t,p):_},t.deflate=function deflate(e,t){var r,a,o,u;if(!e||!e.state||t>d||t<0)return e?err(e,_):_;if(a=e.state,!e.output||!e.input&&0!==e.avail_in||a.status===W&&t!==h)return err(e,0===e.avail_out?y:_);if(a.strm=e,r=a.last_flush,a.last_flush=t,a.status===B)if(2===a.wrap)e.adler=0,put_byte(a,31),put_byte(a,139),put_byte(a,8),a.gzhead?(put_byte(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),put_byte(a,255&a.gzhead.time),put_byte(a,a.gzhead.time>>8&255),put_byte(a,a.gzhead.time>>16&255),put_byte(a,a.gzhead.time>>24&255),put_byte(a,9===a.level?2:a.strategy>=x||a.level<2?4:0),put_byte(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(put_byte(a,255&a.gzhead.extra.length),put_byte(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=s(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=V):(put_byte(a,0),put_byte(a,0),put_byte(a,0),put_byte(a,0),put_byte(a,0),put_byte(a,9===a.level?2:a.strategy>=x||a.level<2?4:0),put_byte(a,Q),a.status=j);else{var v=E+(a.w_bits-8<<4)<<8;v|=(a.strategy>=x||a.level<2?0:a.level<6?1:6===a.level?2:3)<<6,0!==a.strstart&&(v|=z),v+=31-v%31,a.status=j,putShortMSB(a,v),0!==a.strstart&&(putShortMSB(a,e.adler>>>16),putShortMSB(a,65535&e.adler)),e.adler=1}if(a.status===V)if(a.gzhead.extra){for(o=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>o&&(e.adler=s(e.adler,a.pending_buf,a.pending-o,o)),flush_pending(e),o=a.pending,a.pending!==a.pending_buf_size));)put_byte(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>o&&(e.adler=s(e.adler,a.pending_buf,a.pending-o,o)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=G)}else a.status=G;if(a.status===G)if(a.gzhead.name){o=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>o&&(e.adler=s(e.adler,a.pending_buf,a.pending-o,o)),flush_pending(e),o=a.pending,a.pending===a.pending_buf_size)){u=1;break}u=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,put_byte(a,u)}while(0!==u);a.gzhead.hcrc&&a.pending>o&&(e.adler=s(e.adler,a.pending_buf,a.pending-o,o)),0===u&&(a.gzindex=0,a.status=U)}else a.status=U;if(a.status===U)if(a.gzhead.comment){o=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>o&&(e.adler=s(e.adler,a.pending_buf,a.pending-o,o)),flush_pending(e),o=a.pending,a.pending===a.pending_buf_size)){u=1;break}u=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,put_byte(a,u)}while(0!==u);a.gzhead.hcrc&&a.pending>o&&(e.adler=s(e.adler,a.pending_buf,a.pending-o,o)),0===u&&(a.status=q)}else a.status=q;if(a.status===q&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&flush_pending(e),a.pending+2<=a.pending_buf_size&&(put_byte(a,255&e.adler),put_byte(a,e.adler>>8&255),e.adler=0,a.status=j)):a.status=j),0!==a.pending){if(flush_pending(e),0===e.avail_out)return a.last_flush=-1,p}else if(0===e.avail_in&&rank(t)<=rank(r)&&t!==h)return err(e,y);if(a.status===W&&0!==e.avail_in)return err(e,y);if(0!==e.avail_in||0!==a.lookahead||t!==c&&a.status!==W){var g=a.strategy===x?function deflate_huff(e,t){for(var r;;){if(0===e.lookahead&&(fill_window(e),0===e.lookahead)){if(t===c)return H;break}if(e.match_length=0,r=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(flush_block_only(e,!1),0===e.strm.avail_out))return H}return e.insert=0,t===h?(flush_block_only(e,!0),0===e.strm.avail_out?Y:X):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?H:Z}(a,t):a.strategy===w?function deflate_rle(e,t){for(var r,n,a,o,s=e.window;;){if(e.lookahead<=O){if(fill_window(e),e.lookahead<=O&&t===c)return H;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=F&&e.strstart>0&&(n=s[a=e.strstart-1])===s[++a]&&n===s[++a]&&n===s[++a]){o=e.strstart+O;do{}while(n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&a<o);e.match_length=O-(o-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=F?(r=i._tr_tally(e,1,e.match_length-F),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(flush_block_only(e,!1),0===e.strm.avail_out))return H}return e.insert=0,t===h?(flush_block_only(e,!0),0===e.strm.avail_out?Y:X):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?H:Z}(a,t):n[a.level].func(a,t);if(g!==Y&&g!==X||(a.status=W),g===H||g===Y)return 0===e.avail_out&&(a.last_flush=-1),p;if(g===Z&&(t===l?i._tr_align(a):t!==d&&(i._tr_stored_block(a,0,0,!1),t===f&&(zero(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),flush_pending(e),0===e.avail_out))return a.last_flush=-1,p}return t!==h?p:a.wrap<=0?m:(2===a.wrap?(put_byte(a,255&e.adler),put_byte(a,e.adler>>8&255),put_byte(a,e.adler>>16&255),put_byte(a,e.adler>>24&255),put_byte(a,255&e.total_in),put_byte(a,e.total_in>>8&255),put_byte(a,e.total_in>>16&255),put_byte(a,e.total_in>>24&255)):(putShortMSB(a,e.adler>>>16),putShortMSB(a,65535&e.adler)),flush_pending(e),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?p:m)},t.deflateEnd=function deflateEnd(e){var t;return e&&e.state?(t=e.state.status)!==B&&t!==V&&t!==G&&t!==U&&t!==q&&t!==j&&t!==W?err(e,_):(e.state=null,t===j?err(e,v):p):_},t.deflateSetDictionary=function deflateSetDictionary(e,t){var r,n,i,s,u,c,l,f,h=t.length;if(!e||!e.state)return _;if(2===(s=(r=e.state).wrap)||1===s&&r.status!==B||r.lookahead)return _;for(1===s&&(e.adler=o(e.adler,t,h,0)),r.wrap=0,h>=r.w_size&&(0===s&&(zero(r.head),r.strstart=0,r.block_start=0,r.insert=0),f=new a.Buf8(r.w_size),a.arraySet(f,t,h-r.w_size,r.w_size,0),t=f,h=r.w_size),u=e.avail_in,c=e.next_in,l=e.input,e.avail_in=h,e.next_in=0,e.input=t,fill_window(r);r.lookahead>=F;){n=r.strstart,i=r.lookahead-(F-1);do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+F-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--i);r.strstart=n,r.lookahead=F-1,fill_window(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=F-1,r.match_available=0,e.next_in=c,e.input=l,e.avail_in=u,r.wrap=s,p},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,r){"use strict";var n=r(15),a=4,i=0,o=1,s=2;function zero(e){for(var t=e.length;--t>=0;)e[t]=0}var u=0,c=1,l=2,f=29,h=256,d=h+1+f,p=30,m=19,_=2*d+1,v=15,y=16,g=7,b=256,x=16,w=17,k=18,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],C=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],E=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],A=new Array(2*(d+2));zero(A);var S=new Array(2*p);zero(S);var I=new Array(512);zero(I);var P=new Array(256);zero(P);var D=new Array(f);zero(D);var N,R,F,O=new Array(p);function StaticTreeDesc(e,t,r,n,a){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=a,this.has_stree=e&&e.length}function TreeDesc(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function d_code(e){return e<256?I[e]:I[256+(e>>>7)]}function put_short(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function send_bits(e,t,r){e.bi_valid>y-r?(e.bi_buf|=t<<e.bi_valid&65535,put_short(e,e.bi_buf),e.bi_buf=t>>y-e.bi_valid,e.bi_valid+=r-y):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function send_code(e,t,r){send_bits(e,r[2*t],r[2*t+1])}function bi_reverse(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function gen_codes(e,t,r){var n,a,i=new Array(v+1),o=0;for(n=1;n<=v;n++)i[n]=o=o+r[n-1]<<1;for(a=0;a<=t;a++){var s=e[2*a+1];0!==s&&(e[2*a]=bi_reverse(i[s]++,s))}}function init_block(e){var t;for(t=0;t<d;t++)e.dyn_ltree[2*t]=0;for(t=0;t<p;t++)e.dyn_dtree[2*t]=0;for(t=0;t<m;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*b]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function bi_windup(e){e.bi_valid>8?put_short(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function smaller(e,t,r,n){var a=2*t,i=2*r;return e[a]<e[i]||e[a]===e[i]&&n[t]<=n[r]}function pqdownheap(e,t,r){for(var n=e.heap[r],a=r<<1;a<=e.heap_len&&(a<e.heap_len&&smaller(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!smaller(t,n,e.heap[a],e.depth));)e.heap[r]=e.heap[a],r=a,a<<=1;e.heap[r]=n}function compress_block(e,t,r){var n,a,i,o,s=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],a=e.pending_buf[e.l_buf+s],s++,0===n?send_code(e,a,t):(send_code(e,(i=P[a])+h+1,t),0!==(o=T[i])&&send_bits(e,a-=D[i],o),send_code(e,i=d_code(--n),r),0!==(o=C[i])&&send_bits(e,n-=O[i],o))}while(s<e.last_lit);send_code(e,b,t)}function build_tree(e,t){var r,n,a,i=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,u=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=_,r=0;r<u;r++)0!==i[2*r]?(e.heap[++e.heap_len]=c=r,e.depth[r]=0):i[2*r+1]=0;for(;e.heap_len<2;)i[2*(a=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[a]=0,e.opt_len--,s&&(e.static_len-=o[2*a+1]);for(t.max_code=c,r=e.heap_len>>1;r>=1;r--)pqdownheap(e,i,r);a=u;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],pqdownheap(e,i,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,i[2*a]=i[2*r]+i[2*n],e.depth[a]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,i[2*r+1]=i[2*n+1]=a,e.heap[1]=a++,pqdownheap(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function gen_bitlen(e,t){var r,n,a,i,o,s,u=t.dyn_tree,c=t.max_code,l=t.stat_desc.static_tree,f=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(i=0;i<=v;i++)e.bl_count[i]=0;for(u[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<_;r++)(i=u[2*u[2*(n=e.heap[r])+1]+1]+1)>p&&(i=p,m++),u[2*n+1]=i,n>c||(e.bl_count[i]++,o=0,n>=d&&(o=h[n-d]),s=u[2*n],e.opt_len+=s*(i+o),f&&(e.static_len+=s*(l[2*n+1]+o)));if(0!==m){do{for(i=p-1;0===e.bl_count[i];)i--;e.bl_count[i]--,e.bl_count[i+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(i=p;0!==i;i--)for(n=e.bl_count[i];0!==n;)(a=e.heap[--r])>c||(u[2*a+1]!==i&&(e.opt_len+=(i-u[2*a+1])*u[2*a],u[2*a+1]=i),n--)}}(e,t),gen_codes(i,c,e.bl_count)}function scan_tree(e,t,r){var n,a,i=-1,o=t[1],s=0,u=7,c=4;for(0===o&&(u=138,c=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)a=o,o=t[2*(n+1)+1],++s<u&&a===o||(s<c?e.bl_tree[2*a]+=s:0!==a?(a!==i&&e.bl_tree[2*a]++,e.bl_tree[2*x]++):s<=10?e.bl_tree[2*w]++:e.bl_tree[2*k]++,s=0,i=a,0===o?(u=138,c=3):a===o?(u=6,c=3):(u=7,c=4))}function send_tree(e,t,r){var n,a,i=-1,o=t[1],s=0,u=7,c=4;for(0===o&&(u=138,c=3),n=0;n<=r;n++)if(a=o,o=t[2*(n+1)+1],!(++s<u&&a===o)){if(s<c)do{send_code(e,a,e.bl_tree)}while(0!=--s);else 0!==a?(a!==i&&(send_code(e,a,e.bl_tree),s--),send_code(e,x,e.bl_tree),send_bits(e,s-3,2)):s<=10?(send_code(e,w,e.bl_tree),send_bits(e,s-3,3)):(send_code(e,k,e.bl_tree),send_bits(e,s-11,7));s=0,i=a,0===o?(u=138,c=3):a===o?(u=6,c=3):(u=7,c=4)}}zero(O);var L=!1;function _tr_stored_block(e,t,r,a){send_bits(e,(u<<1)+(a?1:0),3),function copy_block(e,t,r,a){bi_windup(e),a&&(put_short(e,r),put_short(e,~r)),n.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}t._tr_init=function _tr_init(e){L||(function tr_static_init(){var e,t,r,n,a,i=new Array(v+1);for(r=0,n=0;n<f-1;n++)for(D[n]=r,e=0;e<1<<T[n];e++)P[r++]=n;for(P[r-1]=n,a=0,n=0;n<16;n++)for(O[n]=a,e=0;e<1<<C[n];e++)I[a++]=n;for(a>>=7;n<p;n++)for(O[n]=a<<7,e=0;e<1<<C[n]-7;e++)I[256+a++]=n;for(t=0;t<=v;t++)i[t]=0;for(e=0;e<=143;)A[2*e+1]=8,e++,i[8]++;for(;e<=255;)A[2*e+1]=9,e++,i[9]++;for(;e<=279;)A[2*e+1]=7,e++,i[7]++;for(;e<=287;)A[2*e+1]=8,e++,i[8]++;for(gen_codes(A,d+1,i),e=0;e<p;e++)S[2*e+1]=5,S[2*e]=bi_reverse(e,5);N=new StaticTreeDesc(A,T,h+1,d,v),R=new StaticTreeDesc(S,C,0,p,v),F=new StaticTreeDesc(new Array(0),E,0,m,g)}(),L=!0),e.l_desc=new TreeDesc(e.dyn_ltree,N),e.d_desc=new TreeDesc(e.dyn_dtree,R),e.bl_desc=new TreeDesc(e.bl_tree,F),e.bi_buf=0,e.bi_valid=0,init_block(e)},t._tr_stored_block=_tr_stored_block,t._tr_flush_block=function _tr_flush_block(e,t,r,n){var u,f,d=0;e.level>0?(e.strm.data_type===s&&(e.strm.data_type=function detect_data_type(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return i;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return o;for(t=32;t<h;t++)if(0!==e.dyn_ltree[2*t])return o;return i}(e)),build_tree(e,e.l_desc),build_tree(e,e.d_desc),d=function build_bl_tree(e){var t;for(scan_tree(e,e.dyn_ltree,e.l_desc.max_code),scan_tree(e,e.dyn_dtree,e.d_desc.max_code),build_tree(e,e.bl_desc),t=m-1;t>=3&&0===e.bl_tree[2*M[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),u=e.opt_len+3+7>>>3,(f=e.static_len+3+7>>>3)<=u&&(u=f)):u=f=r+5,r+4<=u&&-1!==t?_tr_stored_block(e,t,r,n):e.strategy===a||f===u?(send_bits(e,(c<<1)+(n?1:0),3),compress_block(e,A,S)):(send_bits(e,(l<<1)+(n?1:0),3),function send_all_trees(e,t,r,n){var a;for(send_bits(e,t-257,5),send_bits(e,r-1,5),send_bits(e,n-4,4),a=0;a<n;a++)send_bits(e,e.bl_tree[2*M[a]+1],3);send_tree(e,e.dyn_ltree,t-1),send_tree(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,d+1),compress_block(e,e.dyn_ltree,e.dyn_dtree)),init_block(e),n&&bi_windup(e)},t._tr_tally=function _tr_tally(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(P[r]+h+1)]++,e.dyn_dtree[2*d_code(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function _tr_align(e){send_bits(e,c<<1,3),send_code(e,b,A),function bi_flush(e){16===e.bi_valid?(put_short(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,r){"use strict";var n=r(84),a=r(15),i=r(34),o=r(36),s=r(25),u=r(35),c=r(87),l=Object.prototype.toString;function Inflate(e){if(!(this instanceof Inflate))return new Inflate(e);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var r=n.inflateInit2(this.strm,t.windowBits);if(r!==o.Z_OK)throw new Error(s[r]);if(this.header=new c,n.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=i.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=n.inflateSetDictionary(this.strm,t.dictionary))!==o.Z_OK))throw new Error(s[r])}function inflate(e,t){var r=new Inflate(t);if(r.push(e,!0),r.err)throw r.msg||s[r.err];return r.result}Inflate.prototype.push=function(e,t){var r,s,u,c,f,h=this.strm,d=this.options.chunkSize,p=this.options.dictionary,m=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?h.input=i.binstring2buf(e):"[object ArrayBuffer]"===l.call(e)?h.input=new Uint8Array(e):h.input=e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new a.Buf8(d),h.next_out=0,h.avail_out=d),(r=n.inflate(h,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&p&&(r=n.inflateSetDictionary(this.strm,p)),r===o.Z_BUF_ERROR&&!0===m&&(r=o.Z_OK,m=!1),r!==o.Z_STREAM_END&&r!==o.Z_OK)return this.onEnd(r),this.ended=!0,!1;h.next_out&&(0!==h.avail_out&&r!==o.Z_STREAM_END&&(0!==h.avail_in||s!==o.Z_FINISH&&s!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(u=i.utf8border(h.output,h.next_out),c=h.next_out-u,f=i.buf2string(h.output,u),h.next_out=c,h.avail_out=d-c,c&&a.arraySet(h.output,h.output,u,c,0),this.onData(f)):this.onData(a.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(m=!0)}while((h.avail_in>0||0===h.avail_out)&&r!==o.Z_STREAM_END);return r===o.Z_STREAM_END&&(s=o.Z_FINISH),s===o.Z_FINISH?(r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===o.Z_OK):s!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),h.avail_out=0,!0)},Inflate.prototype.onData=function(e){this.chunks.push(e)},Inflate.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=Inflate,t.inflate=inflate,t.inflateRaw=function inflateRaw(e,t){return(t=t||{}).raw=!0,inflate(e,t)},t.ungzip=inflate},function(e,t,r){"use strict";var n=r(15),a=r(32),i=r(33),o=r(85),s=r(86),u=0,c=1,l=2,f=4,h=5,d=6,p=0,m=1,_=2,v=-2,y=-3,g=-4,b=-5,x=8,w=1,k=2,T=3,C=4,E=5,M=6,A=7,S=8,I=9,P=10,D=11,N=12,R=13,F=14,O=15,L=16,z=17,B=18,V=19,G=20,U=21,q=22,j=23,W=24,H=25,Z=26,Y=27,X=28,Q=29,$=30,J=31,K=32,ee=852,te=592,re=15;function zswap32(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function inflateResetKeep(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=w,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(ee),t.distcode=t.distdyn=new n.Buf32(te),t.sane=1,t.back=-1,p):v}function inflateReset(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,inflateResetKeep(e)):v}function inflateReset2(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?v:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,inflateReset(e))):v}function inflateInit2(e,t){var r,a;return e?(a=new function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},e.state=a,a.window=null,(r=inflateReset2(e,t))!==p&&(e.state=null),r):v}var ne,ae,ie=!0;function fixedtables(e){if(ie){var t;for(ne=new n.Buf32(512),ae=new n.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(c,e.lens,0,288,ne,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(l,e.lens,0,32,ae,0,e.work,{bits:5}),ie=!1}e.lencode=ne,e.lenbits=9,e.distcode=ae,e.distbits=5}function updatewindow(e,t,r,a){var i,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new n.Buf8(o.wsize)),a>=o.wsize?(n.arraySet(o.window,t,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((i=o.wsize-o.wnext)>a&&(i=a),n.arraySet(o.window,t,r-a,i,o.wnext),(a-=i)?(n.arraySet(o.window,t,r-a,a,0),o.wnext=a,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0}t.inflateReset=inflateReset,t.inflateReset2=inflateReset2,t.inflateResetKeep=inflateResetKeep,t.inflateInit=function inflateInit(e){return inflateInit2(e,re)},t.inflateInit2=inflateInit2,t.inflate=function inflate(e,t){var r,ee,te,re,ne,ae,ie,oe,se,ue,ce,le,fe,he,de,pe,me,_e,ve,ye,ge,be,xe,we,ke=0,Te=new n.Buf8(4),Ce=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return v;(r=e.state).mode===N&&(r.mode=R),ne=e.next_out,te=e.output,ie=e.avail_out,re=e.next_in,ee=e.input,ae=e.avail_in,oe=r.hold,se=r.bits,ue=ae,ce=ie,be=p;e:for(;;)switch(r.mode){case w:if(0===r.wrap){r.mode=R;break}for(;se<16;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}if(2&r.wrap&&35615===oe){r.check=0,Te[0]=255&oe,Te[1]=oe>>>8&255,r.check=i(r.check,Te,2,0),oe=0,se=0,r.mode=k;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&oe)<<8)+(oe>>8))%31){e.msg="incorrect header check",r.mode=$;break}if((15&oe)!==x){e.msg="unknown compression method",r.mode=$;break}if(se-=4,ge=8+(15&(oe>>>=4)),0===r.wbits)r.wbits=ge;else if(ge>r.wbits){e.msg="invalid window size",r.mode=$;break}r.dmax=1<<ge,e.adler=r.check=1,r.mode=512&oe?P:N,oe=0,se=0;break;case k:for(;se<16;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}if(r.flags=oe,(255&r.flags)!==x){e.msg="unknown compression method",r.mode=$;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=$;break}r.head&&(r.head.text=oe>>8&1),512&r.flags&&(Te[0]=255&oe,Te[1]=oe>>>8&255,r.check=i(r.check,Te,2,0)),oe=0,se=0,r.mode=T;case T:for(;se<32;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}r.head&&(r.head.time=oe),512&r.flags&&(Te[0]=255&oe,Te[1]=oe>>>8&255,Te[2]=oe>>>16&255,Te[3]=oe>>>24&255,r.check=i(r.check,Te,4,0)),oe=0,se=0,r.mode=C;case C:for(;se<16;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}r.head&&(r.head.xflags=255&oe,r.head.os=oe>>8),512&r.flags&&(Te[0]=255&oe,Te[1]=oe>>>8&255,r.check=i(r.check,Te,2,0)),oe=0,se=0,r.mode=E;case E:if(1024&r.flags){for(;se<16;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}r.length=oe,r.head&&(r.head.extra_len=oe),512&r.flags&&(Te[0]=255&oe,Te[1]=oe>>>8&255,r.check=i(r.check,Te,2,0)),oe=0,se=0}else r.head&&(r.head.extra=null);r.mode=M;case M:if(1024&r.flags&&((le=r.length)>ae&&(le=ae),le&&(r.head&&(ge=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,ee,re,le,ge)),512&r.flags&&(r.check=i(r.check,ee,le,re)),ae-=le,re+=le,r.length-=le),r.length))break e;r.length=0,r.mode=A;case A:if(2048&r.flags){if(0===ae)break e;le=0;do{ge=ee[re+le++],r.head&&ge&&r.length<65536&&(r.head.name+=String.fromCharCode(ge))}while(ge&&le<ae);if(512&r.flags&&(r.check=i(r.check,ee,le,re)),ae-=le,re+=le,ge)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=S;case S:if(4096&r.flags){if(0===ae)break e;le=0;do{ge=ee[re+le++],r.head&&ge&&r.length<65536&&(r.head.comment+=String.fromCharCode(ge))}while(ge&&le<ae);if(512&r.flags&&(r.check=i(r.check,ee,le,re)),ae-=le,re+=le,ge)break e}else r.head&&(r.head.comment=null);r.mode=I;case I:if(512&r.flags){for(;se<16;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}if(oe!==(65535&r.check)){e.msg="header crc mismatch",r.mode=$;break}oe=0,se=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=N;break;case P:for(;se<32;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}e.adler=r.check=zswap32(oe),oe=0,se=0,r.mode=D;case D:if(0===r.havedict)return e.next_out=ne,e.avail_out=ie,e.next_in=re,e.avail_in=ae,r.hold=oe,r.bits=se,_;e.adler=r.check=1,r.mode=N;case N:if(t===h||t===d)break e;case R:if(r.last){oe>>>=7&se,se-=7&se,r.mode=Y;break}for(;se<3;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}switch(r.last=1&oe,se-=1,3&(oe>>>=1)){case 0:r.mode=F;break;case 1:if(fixedtables(r),r.mode=G,t===d){oe>>>=2,se-=2;break e}break;case 2:r.mode=z;break;case 3:e.msg="invalid block type",r.mode=$}oe>>>=2,se-=2;break;case F:for(oe>>>=7&se,se-=7&se;se<32;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}if((65535&oe)!=(oe>>>16^65535)){e.msg="invalid stored block lengths",r.mode=$;break}if(r.length=65535&oe,oe=0,se=0,r.mode=O,t===d)break e;case O:r.mode=L;case L:if(le=r.length){if(le>ae&&(le=ae),le>ie&&(le=ie),0===le)break e;n.arraySet(te,ee,re,le,ne),ae-=le,re+=le,ie-=le,ne+=le,r.length-=le;break}r.mode=N;break;case z:for(;se<14;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}if(r.nlen=257+(31&oe),oe>>>=5,se-=5,r.ndist=1+(31&oe),oe>>>=5,se-=5,r.ncode=4+(15&oe),oe>>>=4,se-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=$;break}r.have=0,r.mode=B;case B:for(;r.have<r.ncode;){for(;se<3;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}r.lens[Ce[r.have++]]=7&oe,oe>>>=3,se-=3}for(;r.have<19;)r.lens[Ce[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,xe={bits:r.lenbits},be=s(u,r.lens,0,19,r.lencode,0,r.work,xe),r.lenbits=xe.bits,be){e.msg="invalid code lengths set",r.mode=$;break}r.have=0,r.mode=V;case V:for(;r.have<r.nlen+r.ndist;){for(;pe=(ke=r.lencode[oe&(1<<r.lenbits)-1])>>>16&255,me=65535&ke,!((de=ke>>>24)<=se);){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}if(me<16)oe>>>=de,se-=de,r.lens[r.have++]=me;else{if(16===me){for(we=de+2;se<we;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}if(oe>>>=de,se-=de,0===r.have){e.msg="invalid bit length repeat",r.mode=$;break}ge=r.lens[r.have-1],le=3+(3&oe),oe>>>=2,se-=2}else if(17===me){for(we=de+3;se<we;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}se-=de,ge=0,le=3+(7&(oe>>>=de)),oe>>>=3,se-=3}else{for(we=de+7;se<we;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}se-=de,ge=0,le=11+(127&(oe>>>=de)),oe>>>=7,se-=7}if(r.have+le>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=$;break}for(;le--;)r.lens[r.have++]=ge}}if(r.mode===$)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=$;break}if(r.lenbits=9,xe={bits:r.lenbits},be=s(c,r.lens,0,r.nlen,r.lencode,0,r.work,xe),r.lenbits=xe.bits,be){e.msg="invalid literal/lengths set",r.mode=$;break}if(r.distbits=6,r.distcode=r.distdyn,xe={bits:r.distbits},be=s(l,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,xe),r.distbits=xe.bits,be){e.msg="invalid distances set",r.mode=$;break}if(r.mode=G,t===d)break e;case G:r.mode=U;case U:if(ae>=6&&ie>=258){e.next_out=ne,e.avail_out=ie,e.next_in=re,e.avail_in=ae,r.hold=oe,r.bits=se,o(e,ce),ne=e.next_out,te=e.output,ie=e.avail_out,re=e.next_in,ee=e.input,ae=e.avail_in,oe=r.hold,se=r.bits,r.mode===N&&(r.back=-1);break}for(r.back=0;pe=(ke=r.lencode[oe&(1<<r.lenbits)-1])>>>16&255,me=65535&ke,!((de=ke>>>24)<=se);){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}if(pe&&0==(240&pe)){for(_e=de,ve=pe,ye=me;pe=(ke=r.lencode[ye+((oe&(1<<_e+ve)-1)>>_e)])>>>16&255,me=65535&ke,!(_e+(de=ke>>>24)<=se);){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}oe>>>=_e,se-=_e,r.back+=_e}if(oe>>>=de,se-=de,r.back+=de,r.length=me,0===pe){r.mode=Z;break}if(32&pe){r.back=-1,r.mode=N;break}if(64&pe){e.msg="invalid literal/length code",r.mode=$;break}r.extra=15&pe,r.mode=q;case q:if(r.extra){for(we=r.extra;se<we;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}r.length+=oe&(1<<r.extra)-1,oe>>>=r.extra,se-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=j;case j:for(;pe=(ke=r.distcode[oe&(1<<r.distbits)-1])>>>16&255,me=65535&ke,!((de=ke>>>24)<=se);){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}if(0==(240&pe)){for(_e=de,ve=pe,ye=me;pe=(ke=r.distcode[ye+((oe&(1<<_e+ve)-1)>>_e)])>>>16&255,me=65535&ke,!(_e+(de=ke>>>24)<=se);){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}oe>>>=_e,se-=_e,r.back+=_e}if(oe>>>=de,se-=de,r.back+=de,64&pe){e.msg="invalid distance code",r.mode=$;break}r.offset=me,r.extra=15&pe,r.mode=W;case W:if(r.extra){for(we=r.extra;se<we;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}r.offset+=oe&(1<<r.extra)-1,oe>>>=r.extra,se-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=$;break}r.mode=H;case H:if(0===ie)break e;if(le=ce-ie,r.offset>le){if((le=r.offset-le)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=$;break}le>r.wnext?(le-=r.wnext,fe=r.wsize-le):fe=r.wnext-le,le>r.length&&(le=r.length),he=r.window}else he=te,fe=ne-r.offset,le=r.length;le>ie&&(le=ie),ie-=le,r.length-=le;do{te[ne++]=he[fe++]}while(--le);0===r.length&&(r.mode=U);break;case Z:if(0===ie)break e;te[ne++]=r.length,ie--,r.mode=U;break;case Y:if(r.wrap){for(;se<32;){if(0===ae)break e;ae--,oe|=ee[re++]<<se,se+=8}if(ce-=ie,e.total_out+=ce,r.total+=ce,ce&&(e.adler=r.check=r.flags?i(r.check,te,ce,ne-ce):a(r.check,te,ce,ne-ce)),ce=ie,(r.flags?oe:zswap32(oe))!==r.check){e.msg="incorrect data check",r.mode=$;break}oe=0,se=0}r.mode=X;case X:if(r.wrap&&r.flags){for(;se<32;){if(0===ae)break e;ae--,oe+=ee[re++]<<se,se+=8}if(oe!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=$;break}oe=0,se=0}r.mode=Q;case Q:be=m;break e;case $:be=y;break e;case J:return g;case K:default:return v}return e.next_out=ne,e.avail_out=ie,e.next_in=re,e.avail_in=ae,r.hold=oe,r.bits=se,(r.wsize||ce!==e.avail_out&&r.mode<$&&(r.mode<Y||t!==f))&&updatewindow(e,e.output,e.next_out,ce-e.avail_out)?(r.mode=J,g):(ue-=e.avail_in,ce-=e.avail_out,e.total_in+=ue,e.total_out+=ce,r.total+=ce,r.wrap&&ce&&(e.adler=r.check=r.flags?i(r.check,te,ce,e.next_out-ce):a(r.check,te,ce,e.next_out-ce)),e.data_type=r.bits+(r.last?64:0)+(r.mode===N?128:0)+(r.mode===G||r.mode===O?256:0),(0===ue&&0===ce||t===f)&&be===p&&(be=b),be)},t.inflateEnd=function inflateEnd(e){if(!e||!e.state)return v;var t=e.state;return t.window&&(t.window=null),e.state=null,p},t.inflateGetHeader=function inflateGetHeader(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?v:(r.head=t,t.done=!1,p):v},t.inflateSetDictionary=function inflateSetDictionary(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&r.mode!==D?v:r.mode===D&&a(1,t,n,0)!==r.check?y:updatewindow(e,t,n,n)?(r.mode=J,g):(r.havedict=1,p):v},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,r){"use strict";e.exports=function inflate_fast(e,t){var r,n,a,i,o,s,u,c,l,f,h,d,p,m,_,v,y,g,b,x,w,k,T,C,E;r=e.state,n=e.next_in,C=e.input,a=n+(e.avail_in-5),i=e.next_out,E=e.output,o=i-(t-e.avail_out),s=i+(e.avail_out-257),u=r.dmax,c=r.wsize,l=r.whave,f=r.wnext,h=r.window,d=r.hold,p=r.bits,m=r.lencode,_=r.distcode,v=(1<<r.lenbits)-1,y=(1<<r.distbits)-1;e:do{p<15&&(d+=C[n++]<<p,p+=8,d+=C[n++]<<p,p+=8),g=m[d&v];t:for(;;){if(d>>>=b=g>>>24,p-=b,0===(b=g>>>16&255))E[i++]=65535&g;else{if(!(16&b)){if(0==(64&b)){g=m[(65535&g)+(d&(1<<b)-1)];continue t}if(32&b){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}x=65535&g,(b&=15)&&(p<b&&(d+=C[n++]<<p,p+=8),x+=d&(1<<b)-1,d>>>=b,p-=b),p<15&&(d+=C[n++]<<p,p+=8,d+=C[n++]<<p,p+=8),g=_[d&y];r:for(;;){if(d>>>=b=g>>>24,p-=b,!(16&(b=g>>>16&255))){if(0==(64&b)){g=_[(65535&g)+(d&(1<<b)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(w=65535&g,p<(b&=15)&&(d+=C[n++]<<p,(p+=8)<b&&(d+=C[n++]<<p,p+=8)),(w+=d&(1<<b)-1)>u){e.msg="invalid distance too far back",r.mode=30;break e}if(d>>>=b,p-=b,w>(b=i-o)){if((b=w-b)>l&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(k=0,T=h,0===f){if(k+=c-b,b<x){x-=b;do{E[i++]=h[k++]}while(--b);k=i-w,T=E}}else if(f<b){if(k+=c+f-b,(b-=f)<x){x-=b;do{E[i++]=h[k++]}while(--b);if(k=0,f<x){x-=b=f;do{E[i++]=h[k++]}while(--b);k=i-w,T=E}}}else if(k+=f-b,b<x){x-=b;do{E[i++]=h[k++]}while(--b);k=i-w,T=E}for(;x>2;)E[i++]=T[k++],E[i++]=T[k++],E[i++]=T[k++],x-=3;x&&(E[i++]=T[k++],x>1&&(E[i++]=T[k++]))}else{k=i-w;do{E[i++]=E[k++],E[i++]=E[k++],E[i++]=E[k++],x-=3}while(x>2);x&&(E[i++]=E[k++],x>1&&(E[i++]=E[k++]))}break}}break}}while(n<a&&i<s);n-=x=p>>3,d&=(1<<(p-=x<<3))-1,e.next_in=n,e.next_out=i,e.avail_in=n<a?a-n+5:5-(n-a),e.avail_out=i<s?s-i+257:257-(i-s),r.hold=d,r.bits=p}},function(e,t,r){"use strict";var n=r(15),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function inflate_table(e,t,r,u,c,l,f,h){var d,p,m,_,v,y,g,b,x,w=h.bits,k=0,T=0,C=0,E=0,M=0,A=0,S=0,I=0,P=0,D=0,N=null,R=0,F=new n.Buf16(16),O=new n.Buf16(16),L=null,z=0;for(k=0;k<=15;k++)F[k]=0;for(T=0;T<u;T++)F[t[r+T]]++;for(M=w,E=15;E>=1&&0===F[E];E--);if(M>E&&(M=E),0===E)return c[l++]=20971520,c[l++]=20971520,h.bits=1,0;for(C=1;C<E&&0===F[C];C++);for(M<C&&(M=C),I=1,k=1;k<=15;k++)if(I<<=1,(I-=F[k])<0)return-1;if(I>0&&(0===e||1!==E))return-1;for(O[1]=0,k=1;k<15;k++)O[k+1]=O[k]+F[k];for(T=0;T<u;T++)0!==t[r+T]&&(f[O[t[r+T]]++]=T);if(0===e?(N=L=f,y=19):1===e?(N=a,R-=257,L=i,z-=257,y=256):(N=o,L=s,y=-1),D=0,T=0,k=C,v=l,A=M,S=0,m=-1,_=(P=1<<M)-1,1===e&&P>852||2===e&&P>592)return 1;for(;;){g=k-S,f[T]<y?(b=0,x=f[T]):f[T]>y?(b=L[z+f[T]],x=N[R+f[T]]):(b=96,x=0),d=1<<k-S,C=p=1<<A;do{c[v+(D>>S)+(p-=d)]=g<<24|b<<16|x|0}while(0!==p);for(d=1<<k-1;D&d;)d>>=1;if(0!==d?(D&=d-1,D+=d):D=0,T++,0==--F[k]){if(k===E)break;k=t[r+f[T]]}if(k>M&&(D&_)!==m){for(0===S&&(S=M),v+=C,I=1<<(A=k-S);A+S<E&&!((I-=F[A+S])<=0);)A++,I<<=1;if(P+=1<<A,1===e&&P>852||2===e&&P>592)return 1;c[m=D&_]=M<<24|A<<16|v-l|0}}return 0!==D&&(c[v+D]=k-S<<24|64<<16|0),h.bits=M,0}},function(e,t,r){"use strict";e.exports=function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"create",function(){return create}),r.d(n,"clone",function(){return clone}),r.d(n,"copy",function(){return mat4_copy}),r.d(n,"fromValues",function(){return fromValues}),r.d(n,"set",function(){return mat4_set}),r.d(n,"identity",function(){return identity}),r.d(n,"transpose",function(){return transpose}),r.d(n,"invert",function(){return invert}),r.d(n,"adjoint",function(){return adjoint}),r.d(n,"determinant",function(){return determinant}),r.d(n,"multiply",function(){return multiply}),r.d(n,"translate",function(){return mat4_translate}),r.d(n,"scale",function(){return mat4_scale}),r.d(n,"rotate",function(){return mat4_rotate}),r.d(n,"rotateX",function(){return rotateX}),r.d(n,"rotateY",function(){return rotateY}),r.d(n,"rotateZ",function(){return rotateZ}),r.d(n,"fromTranslation",function(){return fromTranslation}),r.d(n,"fromScaling",function(){return fromScaling}),r.d(n,"fromRotation",function(){return fromRotation}),r.d(n,"fromXRotation",function(){return fromXRotation}),r.d(n,"fromYRotation",function(){return fromYRotation}),r.d(n,"fromZRotation",function(){return fromZRotation}),r.d(n,"fromRotationTranslation",function(){return fromRotationTranslation}),r.d(n,"fromQuat2",function(){return fromQuat2}),r.d(n,"getTranslation",function(){return getTranslation}),r.d(n,"getScaling",function(){return getScaling}),r.d(n,"getRotation",function(){return getRotation}),r.d(n,"fromRotationTranslationScale",function(){return fromRotationTranslationScale}),r.d(n,"fromRotationTranslationScaleOrigin",function(){return fromRotationTranslationScaleOrigin}),r.d(n,"fromQuat",function(){return fromQuat}),r.d(n,"frustum",function(){return frustum}),r.d(n,"perspective",function(){return perspective}),r.d(n,"perspectiveFromFieldOfView",function(){return perspectiveFromFieldOfView}),r.d(n,"ortho",function(){return ortho}),r.d(n,"lookAt",function(){return lookAt}),r.d(n,"targetTo",function(){return targetTo}),r.d(n,"str",function(){return mat4_str}),r.d(n,"frob",function(){return frob}),r.d(n,"add",function(){return mat4_add}),r.d(n,"subtract",function(){return subtract}),r.d(n,"multiplyScalar",function(){return multiplyScalar}),r.d(n,"multiplyScalarAndAdd",function(){return multiplyScalarAndAdd}),r.d(n,"exactEquals",function(){return exactEquals}),r.d(n,"equals",function(){return mat4_equals}),r.d(n,"mul",function(){return ae}),r.d(n,"sub",function(){return ie});var a={};r.r(a),r.d(a,"create",function(){return vec4_create}),r.d(a,"clone",function(){return vec4_clone}),r.d(a,"fromValues",function(){return vec4_fromValues}),r.d(a,"copy",function(){return vec4_copy}),r.d(a,"set",function(){return vec4_set}),r.d(a,"add",function(){return vec4_add}),r.d(a,"subtract",function(){return vec4_subtract}),r.d(a,"multiply",function(){return vec4_multiply}),r.d(a,"divide",function(){return divide}),r.d(a,"ceil",function(){return vec4_ceil}),r.d(a,"floor",function(){return vec4_floor}),r.d(a,"min",function(){return vec4_min}),r.d(a,"max",function(){return vec4_max}),r.d(a,"round",function(){return round}),r.d(a,"scale",function(){return vec4_scale}),r.d(a,"scaleAndAdd",function(){return scaleAndAdd}),r.d(a,"distance",function(){return distance}),r.d(a,"squaredDistance",function(){return squaredDistance}),r.d(a,"length",function(){return vec4_length}),r.d(a,"squaredLength",function(){return squaredLength}),r.d(a,"negate",function(){return negate}),r.d(a,"inverse",function(){return inverse}),r.d(a,"normalize",function(){return vec4_normalize}),r.d(a,"dot",function(){return dot}),r.d(a,"lerp",function(){return lerp}),r.d(a,"random",function(){return random}),r.d(a,"transformMat4",function(){return transformMat4}),r.d(a,"transformQuat",function(){return transformQuat}),r.d(a,"str",function(){return vec4_str}),r.d(a,"exactEquals",function(){return vec4_exactEquals}),r.d(a,"equals",function(){return vec4_equals}),r.d(a,"sub",function(){return oe}),r.d(a,"mul",function(){return se}),r.d(a,"div",function(){return ue}),r.d(a,"dist",function(){return ce}),r.d(a,"sqrDist",function(){return le}),r.d(a,"len",function(){return fe}),r.d(a,"sqrLen",function(){return he}),r.d(a,"forEach",function(){return de});var i={};r.r(i),r.d(i,"colorShaderGLSL",function(){return He}),r.d(i,"filterShaderGLSL",function(){return Ze}),r.d(i,"widthShaderGLSL",function(){return Ye});var o={};r.r(o),r.d(o,"symbolShaderGLSL",function(){return Je});var s={};r.r(s),r.d(s,"number",function(){return Ca}),r.d(s,"category",function(){return Ea}),r.d(s,"list",function(){return Ma}),r.d(s,"rgb",function(){return Aa}),r.d(s,"rgba",function(){return Sa}),r.d(s,"transition",function(){return Ia}),r.d(s,"nin",function(){return Da}),r.d(s,"in",function(){return Pa}),r.d(s,"between",function(){return Na}),r.d(s,"mul",function(){return Ra}),r.d(s,"div",function(){return Fa}),r.d(s,"add",function(){return Oa}),r.d(s,"sub",function(){return La}),r.d(s,"pow",function(){return za}),r.d(s,"mod",function(){return Ba}),r.d(s,"greaterThan",function(){return Va}),r.d(s,"greaterThanOrEqualTo",function(){return Ga}),r.d(s,"lessThan",function(){return Ua}),r.d(s,"lessThanOrEqualTo",function(){return qa}),r.d(s,"equals",function(){return ja}),r.d(s,"notEquals",function(){return Wa}),r.d(s,"and",function(){return Ha}),r.d(s,"or",function(){return Za}),r.d(s,"gt",function(){return Ya}),r.d(s,"gte",function(){return Xa}),r.d(s,"lt",function(){return Qa}),r.d(s,"lte",function(){return $a}),r.d(s,"eq",function(){return Ja}),r.d(s,"neq",function(){return Ka}),r.d(s,"blend",function(){return ei}),r.d(s,"buckets",function(){return ti}),r.d(s,"cielab",function(){return ri}),r.d(s,"clusterAvg",function(){return ni}),r.d(s,"clusterMax",function(){return ai}),r.d(s,"clusterMin",function(){return ii}),r.d(s,"clusterMode",function(){return oi}),r.d(s,"clusterSum",function(){return si}),r.d(s,"clusterCount",function(){return ui}),r.d(s,"clusterTime",function(){return ci}),r.d(s,"constant",function(){return li}),r.d(s,"image",function(){return fi}),r.d(s,"svg",function(){return hi}),r.d(s,"hex",function(){return di}),r.d(s,"hsl",function(){return pi}),r.d(s,"hsla",function(){return mi}),r.d(s,"hsv",function(){return _i}),r.d(s,"hsva",function(){return vi}),r.d(s,"cubic",function(){return yi}),r.d(s,"ilinear",function(){return gi}),r.d(s,"linear",function(){return bi}),r.d(s,"namedColor",function(){return xi}),r.d(s,"now",function(){return wi}),r.d(s,"opacity",function(){return ki}),r.d(s,"asc",function(){return Ti}),r.d(s,"desc",function(){return Ci}),r.d(s,"noOrder",function(){return Ei}),r.d(s,"width",function(){return Mi}),r.d(s,"reverse",function(){return Ai}),r.d(s,"property",function(){return Si}),r.d(s,"prop",function(){return Si}),r.d(s,"globalQuantiles",function(){return Ii}),r.d(s,"viewportQuantiles",function(){return Pi}),r.d(s,"globalEqIntervals",function(){return Di}),r.d(s,"viewportEqIntervals",function(){return Ni}),r.d(s,"globalStandardDev",function(){return Ri}),r.d(s,"viewportStandardDev",function(){return Fi}),r.d(s,"ramp",function(){return Oi}),r.d(s,"time",function(){return Li}),r.d(s,"date",function(){return Li}),r.d(s,"timeRange",function(){return zi}),r.d(s,"top",function(){return Bi}),r.d(s,"fade",function(){return Vi}),r.d(s,"animation",function(){return Gi}),r.d(s,"log",function(){return Ui}),r.d(s,"sqrt",function(){return qi}),r.d(s,"sin",function(){return ji}),r.d(s,"cos",function(){return Wi}),r.d(s,"tan",function(){return Hi}),r.d(s,"sign",function(){return Zi}),r.d(s,"abs",function(){return Yi}),r.d(s,"isNull",function(){return Xi}),r.d(s,"not",function(){return Qi}),r.d(s,"floor",function(){return $i}),r.d(s,"ceil",function(){return Ji}),r.d(s,"variable",function(){return Ki}),r.d(s,"var",function(){return Ki}),r.d(s,"viewportAvg",function(){return eo}),r.d(s,"viewportMax",function(){return to}),r.d(s,"viewportMin",function(){return ro}),r.d(s,"viewportSum",function(){return no}),r.d(s,"viewportCount",function(){return ao}),r.d(s,"viewportPercentile",function(){return io}),r.d(s,"viewportHistogram",function(){return oo}),r.d(s,"viewportFeatures",function(){return so}),r.d(s,"globalAvg",function(){return uo}),r.d(s,"globalMax",function(){return co}),r.d(s,"globalMin",function(){return lo}),r.d(s,"globalSum",function(){return fo}),r.d(s,"globalCount",function(){return ho}),r.d(s,"globalPercentile",function(){return po}),r.d(s,"globalHistogram",function(){return mo}),r.d(s,"zoom",function(){return _o}),r.d(s,"scaled",function(){return vo}),r.d(s,"zoomrange",function(){return yo}),r.d(s,"placement",function(){return go}),r.d(s,"translate",function(){return bo}),r.d(s,"rotate",function(){return xo}),r.d(s,"alphaNormalize",function(){return wo}),r.d(s,"HOLD",function(){return ko}),r.d(s,"TRUE",function(){return To}),r.d(s,"FALSE",function(){return Co}),r.d(s,"PI",function(){return Eo}),r.d(s,"E",function(){return Mo}),r.d(s,"BICYCLE",function(){return Ao}),r.d(s,"BUILDING",function(){return So}),r.d(s,"BUS",function(){return Io}),r.d(s,"CAR",function(){return Po}),r.d(s,"CIRCLE",function(){return Do}),r.d(s,"CIRCLE_OUTLINE",function(){return No}),r.d(s,"CROSS",function(){return Ro}),r.d(s,"FLAG",function(){return Fo}),r.d(s,"HOUSE",function(){return Oo}),r.d(s,"MARKER",function(){return Lo}),r.d(s,"MARKER_OUTLINE",function(){return zo}),r.d(s,"PLUS",function(){return Bo}),r.d(s,"SQUARE",function(){return Vo}),r.d(s,"SQUARE_OUTLINE",function(){return Go}),r.d(s,"STAR",function(){return Uo}),r.d(s,"STAR_OUTLINE",function(){return qo}),r.d(s,"TRIANGLE",function(){return jo}),r.d(s,"TRIANGLE_OUTLINE",function(){return Wo}),r.d(s,"ALIGN_CENTER",function(){return Ho}),r.d(s,"ALIGN_BOTTOM",function(){return Zo}),r.d(s,"palettes",function(){return Xr}),r.d(s,"Asc",function(){return Vr}),r.d(s,"Desc",function(){return Gr});var u={};r.r(u),r.d(u,"voyager",function(){return qu}),r.d(u,"darkmatter",function(){return ju}),r.d(u,"positron",function(){return Wu});var c=r(8),l=r.n(c),f=r(13),h=r.n(f),d=r(1),p=r.n(d),m=r(2),_=r.n(m),v=r(10),g=r.n(v),b=["year","month","day","hour","minute","second"],w=[1,1,1,0,0,0],k=0,T=1,C=2,E=3,M=4,A=5,S=864e5,I=36e5,P=6e4,D=1e3;function startLevel(e){for(var t=b.length-1;t>0&&e[b[t]]===w[t];)--t;return t}function pad(e,t){return e.toString().padStart(t,"0")}function parsedValue(e){var t=msToDate(e);return{year:t.getUTCFullYear(),month:t.getUTCMonth()+1,day:t.getUTCDate(),hour:t.getUTCHours(),minute:t.getUTCMinutes(),second:t.getUTCSeconds()}}function invalidPeriod(e,t){throw new Error("Invalid period of ".concat(t," between ").concat(e.v1," and ").concat(e.v2))}function yearWeek(e,t){var r=function isoDow(e,t,r){var n=new Date(e,t-1,r).getDay();return 0===n?7:n}(e,1,1),n=r>4?9-r:2-r;return Math.abs(t-n)%7!=0?[]:t<n?yearWeek(e-1,t+=Math.round((Date.UTC(e,0,1)-Date.UTC(e-1,0,1))/S)):Date.UTC(e,0,1)+(t-1+3)*S>=Date.UTC(e+1,0,1)?yearWeek(e+1,t-=Math.round((Date.UTC(e+1,0,1)-Date.UTC(e,0,1))/S)):[e,1+Math.round((t-n)/7)]}function periodISO(e,t){var r=parsedValue(e),n=parsedValue(t),a=startLevel(r),i=startLevel(n),o={v1:e,v2:t,t1:r,t2:n};return Math.max(a,i)===k?function yearsPeriod(e){var t=e.t2.year-e.t1.year;return 1e3===t&&(e.t1.year-1)%1e3==0?"M".concat(1+(e.t1.year-1)/1e3):100===t&&(e.t1.year-1)%100==0?"C".concat(1+(e.t1.year-1)/100):10===t&&e.t1.year%10==0?"D".concat(e.t1.year/10):1===t?pad(e.t1.year,4):void invalidPeriod("".concat(t," years"))}(o):Math.max(a,i)===T?function monthsPeriod(e){var t=12*e.t2.year+e.t2.month-12*e.t1.year-e.t1.month;return 6===t&&(e.t1.month-1)%6==0?"".concat(pad(e.t1.year,4),"S").concat(1+(e.t1.month-1)/6):4===t?"".concat(pad(e.t1.year,4),"t").concat(1+(e.t1.month-1)/4):3===t?"".concat(pad(e.t1.year,4),"-Q").concat(1+(e.t1.month-1)/3):1===t?"".concat(pad(e.t1.year,4),"-").concat(pad(e.t1.month,2)):void invalidPeriod("".concat(t," months"))}(o):Math.max(a,i)===C?function daysPeriod(e){var t=Math.round((e.v2-e.v1)/S);if(1===t)return"".concat(pad(e.t1.year,4),"-").concat(pad(e.t1.month,2),"-").concat(pad(e.t1.day,2));if(7===t){var r=e.t1.year,n=Date.UTC(r,0,1),a=yearWeek(r,1+Math.round((e.v1-n)/S)),i=g()(a,2),o=i[0],s=i[1];if(o&&s)return"".concat(pad(o,4),"-W").concat(pad(s,2));invalidPeriod("7 days")}else invalidPeriod("".concat(t," days"))}(o):Math.max(a,i)===E?function hoursPeriod(e){var t=Math.round((e.v2-e.v1)/I);if(1===t)return"".concat(pad(e.t1.year,4),"-").concat(pad(e.t1.month,2),"-").concat(pad(e.t1.day,2),"T").concat(pad(e.t1.hour,2));invalidPeriod("".concat(t," hours"))}(o):Math.max(a,i)===M?function minutesPeriod(e){var t=Math.round((e.v2-e.v1)/P);if(1===t)return"".concat(pad(e.t1.year,4),"-").concat(pad(e.t1.month,2),"-").concat(pad(e.t1.day,2),"T").concat(pad(e.t1.hour,2),":").concat(pad(e.t1.minute,2));invalidPeriod("".concat(t," minutes"))}(o):Math.max(a,i)===A?function secondsPeriod(e){var t=Math.round((e.v2-e.v1)/D);if(1===t)return"".concat(pad(e.t1.year,4),"-").concat(pad(e.t1.month,2),"-").concat(pad(e.t1.day,2),"T").concat(pad(e.t1.hour,2),":").concat(pad(e.t1.minute,2),":").concat(pad(e.t1.second,2));invalidPeriod("".concat(t," seconds"))}(o):void invalidPeriod(o,"fractional seconds")}var N=r(3),R=r.n(N),F=r(0),O=r.n(F),L=r(4),B=r.n(L),V=r(37),G=function(e){function CartoError(e){var t;if(p()(this,CartoError),!e)throw Error("Invalid CartoError, a message is mandatory");if(!e.message)throw Error("Invalid CartoError, a message is mandatory");if(!e.type)throw Error("Invalid CartoError, a type is mandatory");return(t=R()(this,O()(CartoError).call(this,"".concat(e.type," ").concat(e.message)))).name="CartoError",t.type=e.type,t.originalError=e,t}return B()(CartoError,e),CartoError}(r.n(V)()(Error)),U=function(e){function CartoParsingError(e){var t;p()(this,CartoParsingError);return(t=R()(this,O()(CartoParsingError).call(this,{message:e,type:"[Error]"}))).name="CartoParsingError",t}return B()(CartoParsingError,e),CartoParsingError}(G),q=function(){function IsoParser(e){p()(this,IsoParser),this._format=e}return _()(IsoParser,[{key:"check",value:function check(e){return e.match(this._format)}}]),IsoParser}();function fieldDefault(e,t){return void 0===e?t:Number(e)}function dateFields(e){return{year:fieldDefault(e.year,1),month:fieldDefault(e.month,1),day:fieldDefault(e.day,1),hour:fieldDefault(e.hour,0),minute:fieldDefault(e.minute,0),second:fieldDefault(e.second,0)}}function fieldsFromMatch(e){return dateFields({year:e[1],month:e[2],day:e[3],hour:e[4],minute:e[5],second:e[6]})}var j=function(e){function YMDHMSParser(){return p()(this,YMDHMSParser),R()(this,O()(YMDHMSParser).call(this,/^(\d\d\d\d)(?:\-?(\d\d)(?:\-?(\d\d)(?:[T\s]?(\d\d)(?:\:(\d\d)(?:\:(\d\d))?)?)?)?)?$/))}return B()(YMDHMSParser,e),_()(YMDHMSParser,[{key:"parse",value:function parse(e){var t=this.check(e)||[],r=t.slice(),n=[1,2,3,4,5,6].find(function(e){return void 0===r[e]})||7;return 1===n?r[1]=2:r[n-1]=Number(r[n-1])+1,[fieldsFromMatch(t),fieldsFromMatch(r)]}}]),YMDHMSParser}(q),W=function(e){function MillenniumParser(){return p()(this,MillenniumParser),R()(this,O()(MillenniumParser).call(this,/^M(\d+)$/))}return B()(MillenniumParser,e),_()(MillenniumParser,[{key:"parse",value:function parse(e){var t=this.check(e),r=Number(t[1]),n=function year(e){return 1e3*(e-1)+1};return[dateFields({year:n(r)}),dateFields({year:n(r+1)})]}}]),MillenniumParser}(q),H=function(e){function CenturyParser(){return p()(this,CenturyParser),R()(this,O()(CenturyParser).call(this,/^C(\d+)$/))}return B()(CenturyParser,e),_()(CenturyParser,[{key:"parse",value:function parse(e){var t=this.check(e),r=Number(t[1]),n=function year(e){return 100*(e-1)+1};return[dateFields({year:n(r)}),dateFields({year:n(r+1)})]}}]),CenturyParser}(q),Z=function(e){function DecadeParser(){return p()(this,DecadeParser),R()(this,O()(DecadeParser).call(this,/^D(\d+)$/))}return B()(DecadeParser,e),_()(DecadeParser,[{key:"parse",value:function parse(e){var t=this.check(e),r=Number(t[1]),n=function year(e){return 10*e};return[dateFields({year:n(r)}),dateFields({year:n(r+1)})]}}]),DecadeParser}(q),Y=function(e){function SemesterParser(){return p()(this,SemesterParser),R()(this,O()(SemesterParser).call(this,/^(\d\d\d\d)S(\d)$/))}return B()(SemesterParser,e),_()(SemesterParser,[{key:"parse",value:function parse(e){var t=this.check(e),r=Number(t[1]),n=Number(t[2]),a=function month(e){return 6*(e-1)+1};return[dateFields({year:r,month:a(n)}),dateFields({year:r,month:a(n+1)})]}}]),SemesterParser}(q),X=function(e){function TrimesterParser(){return p()(this,TrimesterParser),R()(this,O()(TrimesterParser).call(this,/^(\d\d\d\d)t(\d)$/))}return B()(TrimesterParser,e),_()(TrimesterParser,[{key:"parse",value:function parse(e){var t=this.check(e),r=Number(t[1]),n=Number(t[2]),a=function month(e){return 4*(e-1)+1};return[dateFields({year:r,month:a(n)}),dateFields({year:r,month:a(n+1)})]}}]),TrimesterParser}(q),Q=function(e){function QuarterParser(){return p()(this,QuarterParser),R()(this,O()(QuarterParser).call(this,/^(\d\d\d\d)\-?Q(\d)$/))}return B()(QuarterParser,e),_()(QuarterParser,[{key:"parse",value:function parse(e){var t=this.check(e),r=Number(t[1]),n=Number(t[2]),a=function month(e){return 3*(e-1)+1};return[dateFields({year:r,month:a(n)}),dateFields({year:r,month:a(n+1)})]}}]),QuarterParser}(q);function startOfIsoWeek(e,t){var r=function parseISO_isoDow(e,t,r){var n=new Date(e,t-1,r).getDay();return 0===n?7:n}(e,1,1);return function addDays(e,t){var r=new Date(e.valueOf());return r.setDate(r.getDate()+t),r}(new Date(e,0,r>4?9-r:2-r),7*(t-1))}var $=function(e){function WeekParser(){return p()(this,WeekParser),R()(this,O()(WeekParser).call(this,/^(\d\d\d\d)\-?W(\d\d)$/))}return B()(WeekParser,e),_()(WeekParser,[{key:"parse",value:function parse(e){var t=this.check(e),r=Number(t[1]),n=Number(t[2]),a=startOfIsoWeek(r,n),i=startOfIsoWeek(r,n+1),o=function fields(e){return{year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()}};return[dateFields(o(a)),dateFields(o(i))]}}]),WeekParser}(q),J=[new W,new H,new Z,new Y,new X,new Q,new $,new j];function parseISO(e){var t=function findParser(e){return J.find(function(t){return t.check(e)})}(e=e||"");if(!t)throw new U("No date parser found for ".concat(e));return t.parse(e)}var K=function(){function TimeZoneDate(e,t){p()(this,TimeZoneDate),this._value=e,this._date=msToDate(e),this._timeZone=t}return _()(TimeZoneDate,[{key:"year",get:function get(){return this._date.getUTCFullYear()}},{key:"month",get:function get(){return this._date.getUTCMonth()+1}},{key:"day",get:function get(){return this._date.getUTCDate()}},{key:"hour",get:function get(){return this._date.getUTCHours()}},{key:"minute",get:function get(){return this._date.getUTCMinutes()}},{key:"second",get:function get(){return this._date.getUTCSeconds()}},{key:"text",get:function get(){return periodISO(this._date.getTime(),this._date.getTime()+1e3)}},{key:"timeZone",get:function get(){return this._timeZone}}],[{key:"fromValue",value:function fromValue(e,t){return new TimeZoneDate(e,t)}},{key:"from",value:function from(e,t,r,n,a,i,o){return this.fromValue(Date.UTC(e,(t||1)-1,r,n,a,i),o)}}]),TimeZoneDate}(),ee=function(){function TimeRange(e,t,r,n){if(p()(this,TimeRange),this._startValue=r,this._endValue=n,r&&n)this._iso=periodISO(r,n);else if(!r&&!n&&t){var a=function _startEndTimeValues(e){return parseISO(e).map(_timeValue)}(t);this._iso=t,this._startValue=a[0],this._endValue=a[1]}this._timeZone=e}return _()(TimeRange,[{key:"timeZone",get:function get(){return this._timeZone}},{key:"iso",get:function get(){return this._iso}},{key:"startValue",get:function get(){return this._startValue}},{key:"endValue",get:function get(){return this._endValue}},{key:"startDate",get:function get(){return K.fromValue(this._startValue,this._timeZone)}},{key:"endDate",get:function get(){return K.fromValue(this._endValue,this._timeZone)}}]),TimeRange}();function _timeValue(e){return Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second)}var te=1e-6,re="undefined"!=typeof Float32Array?Float32Array:Array,ne=Math.random;Math.PI;function create(){var e=new re(16);return re!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function clone(e){var t=new re(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function mat4_copy(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function fromValues(e,t,r,n,a,i,o,s,u,c,l,f,h,d,p,m){var _=new re(16);return _[0]=e,_[1]=t,_[2]=r,_[3]=n,_[4]=a,_[5]=i,_[6]=o,_[7]=s,_[8]=u,_[9]=c,_[10]=l,_[11]=f,_[12]=h,_[13]=d,_[14]=p,_[15]=m,_}function mat4_set(e,t,r,n,a,i,o,s,u,c,l,f,h,d,p,m,_){return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e[4]=i,e[5]=o,e[6]=s,e[7]=u,e[8]=c,e[9]=l,e[10]=f,e[11]=h,e[12]=d,e[13]=p,e[14]=m,e[15]=_,e}function identity(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function transpose(e,t){if(e===t){var r=t[1],n=t[2],a=t[3],i=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=i,e[11]=t[14],e[12]=a,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function invert(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],o=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],h=t[10],d=t[11],p=t[12],m=t[13],_=t[14],v=t[15],y=r*s-n*o,g=r*u-a*o,b=r*c-i*o,x=n*u-a*s,w=n*c-i*s,k=a*c-i*u,T=l*m-f*p,C=l*_-h*p,E=l*v-d*p,M=f*_-h*m,A=f*v-d*m,S=h*v-d*_,I=y*S-g*A+b*M+x*E-w*C+k*T;return I?(I=1/I,e[0]=(s*S-u*A+c*M)*I,e[1]=(a*A-n*S-i*M)*I,e[2]=(m*k-_*w+v*x)*I,e[3]=(h*w-f*k-d*x)*I,e[4]=(u*E-o*S-c*C)*I,e[5]=(r*S-a*E+i*C)*I,e[6]=(_*b-p*k-v*g)*I,e[7]=(l*k-h*b+d*g)*I,e[8]=(o*A-s*E+c*T)*I,e[9]=(n*E-r*A-i*T)*I,e[10]=(p*w-m*b+v*y)*I,e[11]=(f*b-l*w-d*y)*I,e[12]=(s*C-o*M-u*T)*I,e[13]=(r*M-n*C+a*T)*I,e[14]=(m*g-p*x-_*y)*I,e[15]=(l*x-f*g+h*y)*I,e):null}function adjoint(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],o=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],h=t[10],d=t[11],p=t[12],m=t[13],_=t[14],v=t[15];return e[0]=s*(h*v-d*_)-f*(u*v-c*_)+m*(u*d-c*h),e[1]=-(n*(h*v-d*_)-f*(a*v-i*_)+m*(a*d-i*h)),e[2]=n*(u*v-c*_)-s*(a*v-i*_)+m*(a*c-i*u),e[3]=-(n*(u*d-c*h)-s*(a*d-i*h)+f*(a*c-i*u)),e[4]=-(o*(h*v-d*_)-l*(u*v-c*_)+p*(u*d-c*h)),e[5]=r*(h*v-d*_)-l*(a*v-i*_)+p*(a*d-i*h),e[6]=-(r*(u*v-c*_)-o*(a*v-i*_)+p*(a*c-i*u)),e[7]=r*(u*d-c*h)-o*(a*d-i*h)+l*(a*c-i*u),e[8]=o*(f*v-d*m)-l*(s*v-c*m)+p*(s*d-c*f),e[9]=-(r*(f*v-d*m)-l*(n*v-i*m)+p*(n*d-i*f)),e[10]=r*(s*v-c*m)-o*(n*v-i*m)+p*(n*c-i*s),e[11]=-(r*(s*d-c*f)-o*(n*d-i*f)+l*(n*c-i*s)),e[12]=-(o*(f*_-h*m)-l*(s*_-u*m)+p*(s*h-u*f)),e[13]=r*(f*_-h*m)-l*(n*_-a*m)+p*(n*h-a*f),e[14]=-(r*(s*_-u*m)-o*(n*_-a*m)+p*(n*u-a*s)),e[15]=r*(s*h-u*f)-o*(n*h-a*f)+l*(n*u-a*s),e}function determinant(e){var t=e[0],r=e[1],n=e[2],a=e[3],i=e[4],o=e[5],s=e[6],u=e[7],c=e[8],l=e[9],f=e[10],h=e[11],d=e[12],p=e[13],m=e[14],_=e[15];return(t*o-r*i)*(f*_-h*m)-(t*s-n*i)*(l*_-h*p)+(t*u-a*i)*(l*m-f*p)+(r*s-n*o)*(c*_-h*d)-(r*u-a*o)*(c*m-f*d)+(n*u-a*s)*(c*p-l*d)}function multiply(e,t,r){var n=t[0],a=t[1],i=t[2],o=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],h=t[9],d=t[10],p=t[11],m=t[12],_=t[13],v=t[14],y=t[15],g=r[0],b=r[1],x=r[2],w=r[3];return e[0]=g*n+b*s+x*f+w*m,e[1]=g*a+b*u+x*h+w*_,e[2]=g*i+b*c+x*d+w*v,e[3]=g*o+b*l+x*p+w*y,g=r[4],b=r[5],x=r[6],w=r[7],e[4]=g*n+b*s+x*f+w*m,e[5]=g*a+b*u+x*h+w*_,e[6]=g*i+b*c+x*d+w*v,e[7]=g*o+b*l+x*p+w*y,g=r[8],b=r[9],x=r[10],w=r[11],e[8]=g*n+b*s+x*f+w*m,e[9]=g*a+b*u+x*h+w*_,e[10]=g*i+b*c+x*d+w*v,e[11]=g*o+b*l+x*p+w*y,g=r[12],b=r[13],x=r[14],w=r[15],e[12]=g*n+b*s+x*f+w*m,e[13]=g*a+b*u+x*h+w*_,e[14]=g*i+b*c+x*d+w*v,e[15]=g*o+b*l+x*p+w*y,e}function mat4_translate(e,t,r){var n=r[0],a=r[1],i=r[2],o=void 0,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0,h=void 0,d=void 0,p=void 0,m=void 0,_=void 0,v=void 0;return t===e?(e[12]=t[0]*n+t[4]*a+t[8]*i+t[12],e[13]=t[1]*n+t[5]*a+t[9]*i+t[13],e[14]=t[2]*n+t[6]*a+t[10]*i+t[14],e[15]=t[3]*n+t[7]*a+t[11]*i+t[15]):(o=t[0],s=t[1],u=t[2],c=t[3],l=t[4],f=t[5],h=t[6],d=t[7],p=t[8],m=t[9],_=t[10],v=t[11],e[0]=o,e[1]=s,e[2]=u,e[3]=c,e[4]=l,e[5]=f,e[6]=h,e[7]=d,e[8]=p,e[9]=m,e[10]=_,e[11]=v,e[12]=o*n+l*a+p*i+t[12],e[13]=s*n+f*a+m*i+t[13],e[14]=u*n+h*a+_*i+t[14],e[15]=c*n+d*a+v*i+t[15]),e}function mat4_scale(e,t,r){var n=r[0],a=r[1],i=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function mat4_rotate(e,t,r,n){var a,i,o,s,u,c,l,f,h,d,p,m,_,v,y,g,b,x,w,k,T,C,E,M,A=n[0],S=n[1],I=n[2],P=Math.sqrt(A*A+S*S+I*I);return P<te?null:(A*=P=1/P,S*=P,I*=P,a=Math.sin(r),o=1-(i=Math.cos(r)),s=t[0],u=t[1],c=t[2],l=t[3],f=t[4],h=t[5],d=t[6],p=t[7],m=t[8],_=t[9],v=t[10],y=t[11],g=A*A*o+i,b=S*A*o+I*a,x=I*A*o-S*a,w=A*S*o-I*a,k=S*S*o+i,T=I*S*o+A*a,C=A*I*o+S*a,E=S*I*o-A*a,M=I*I*o+i,e[0]=s*g+f*b+m*x,e[1]=u*g+h*b+_*x,e[2]=c*g+d*b+v*x,e[3]=l*g+p*b+y*x,e[4]=s*w+f*k+m*T,e[5]=u*w+h*k+_*T,e[6]=c*w+d*k+v*T,e[7]=l*w+p*k+y*T,e[8]=s*C+f*E+m*M,e[9]=u*C+h*E+_*M,e[10]=c*C+d*E+v*M,e[11]=l*C+p*E+y*M,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function rotateX(e,t,r){var n=Math.sin(r),a=Math.cos(r),i=t[4],o=t[5],s=t[6],u=t[7],c=t[8],l=t[9],f=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*a+c*n,e[5]=o*a+l*n,e[6]=s*a+f*n,e[7]=u*a+h*n,e[8]=c*a-i*n,e[9]=l*a-o*n,e[10]=f*a-s*n,e[11]=h*a-u*n,e}function rotateY(e,t,r){var n=Math.sin(r),a=Math.cos(r),i=t[0],o=t[1],s=t[2],u=t[3],c=t[8],l=t[9],f=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*a-c*n,e[1]=o*a-l*n,e[2]=s*a-f*n,e[3]=u*a-h*n,e[8]=i*n+c*a,e[9]=o*n+l*a,e[10]=s*n+f*a,e[11]=u*n+h*a,e}function rotateZ(e,t,r){var n=Math.sin(r),a=Math.cos(r),i=t[0],o=t[1],s=t[2],u=t[3],c=t[4],l=t[5],f=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*a+c*n,e[1]=o*a+l*n,e[2]=s*a+f*n,e[3]=u*a+h*n,e[4]=c*a-i*n,e[5]=l*a-o*n,e[6]=f*a-s*n,e[7]=h*a-u*n,e}function fromTranslation(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function fromScaling(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromRotation(e,t,r){var n,a,i,o=r[0],s=r[1],u=r[2],c=Math.sqrt(o*o+s*s+u*u);return c<te?null:(o*=c=1/c,s*=c,u*=c,n=Math.sin(t),i=1-(a=Math.cos(t)),e[0]=o*o*i+a,e[1]=s*o*i+u*n,e[2]=u*o*i-s*n,e[3]=0,e[4]=o*s*i-u*n,e[5]=s*s*i+a,e[6]=u*s*i+o*n,e[7]=0,e[8]=o*u*i+s*n,e[9]=s*u*i-o*n,e[10]=u*u*i+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function fromXRotation(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromYRotation(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromZRotation(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromRotationTranslation(e,t,r){var n=t[0],a=t[1],i=t[2],o=t[3],s=n+n,u=a+a,c=i+i,l=n*s,f=n*u,h=n*c,d=a*u,p=a*c,m=i*c,_=o*s,v=o*u,y=o*c;return e[0]=1-(d+m),e[1]=f+y,e[2]=h-v,e[3]=0,e[4]=f-y,e[5]=1-(l+m),e[6]=p+_,e[7]=0,e[8]=h+v,e[9]=p-_,e[10]=1-(l+d),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function fromQuat2(e,t){var r=new re(3),n=-t[0],a=-t[1],i=-t[2],o=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=n*n+a*a+i*i+o*o;return f>0?(r[0]=2*(s*o+l*n+u*i-c*a)/f,r[1]=2*(u*o+l*a+c*n-s*i)/f,r[2]=2*(c*o+l*i+s*a-u*n)/f):(r[0]=2*(s*o+l*n+u*i-c*a),r[1]=2*(u*o+l*a+c*n-s*i),r[2]=2*(c*o+l*i+s*a-u*n)),fromRotationTranslation(e,t,r),e}function getTranslation(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function getScaling(e,t){var r=t[0],n=t[1],a=t[2],i=t[4],o=t[5],s=t[6],u=t[8],c=t[9],l=t[10];return e[0]=Math.sqrt(r*r+n*n+a*a),e[1]=Math.sqrt(i*i+o*o+s*s),e[2]=Math.sqrt(u*u+c*c+l*l),e}function getRotation(e,t){var r=t[0]+t[5]+t[10],n=0;return r>0?(n=2*Math.sqrt(r+1),e[3]=.25*n,e[0]=(t[6]-t[9])/n,e[1]=(t[8]-t[2])/n,e[2]=(t[1]-t[4])/n):t[0]>t[5]&&t[0]>t[10]?(n=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/n,e[0]=.25*n,e[1]=(t[1]+t[4])/n,e[2]=(t[8]+t[2])/n):t[5]>t[10]?(n=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/n,e[0]=(t[1]+t[4])/n,e[1]=.25*n,e[2]=(t[6]+t[9])/n):(n=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/n,e[0]=(t[8]+t[2])/n,e[1]=(t[6]+t[9])/n,e[2]=.25*n),e}function fromRotationTranslationScale(e,t,r,n){var a=t[0],i=t[1],o=t[2],s=t[3],u=a+a,c=i+i,l=o+o,f=a*u,h=a*c,d=a*l,p=i*c,m=i*l,_=o*l,v=s*u,y=s*c,g=s*l,b=n[0],x=n[1],w=n[2];return e[0]=(1-(p+_))*b,e[1]=(h+g)*b,e[2]=(d-y)*b,e[3]=0,e[4]=(h-g)*x,e[5]=(1-(f+_))*x,e[6]=(m+v)*x,e[7]=0,e[8]=(d+y)*w,e[9]=(m-v)*w,e[10]=(1-(f+p))*w,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function fromRotationTranslationScaleOrigin(e,t,r,n,a){var i=t[0],o=t[1],s=t[2],u=t[3],c=i+i,l=o+o,f=s+s,h=i*c,d=i*l,p=i*f,m=o*l,_=o*f,v=s*f,y=u*c,g=u*l,b=u*f,x=n[0],w=n[1],k=n[2],T=a[0],C=a[1],E=a[2],M=(1-(m+v))*x,A=(d+b)*x,S=(p-g)*x,I=(d-b)*w,P=(1-(h+v))*w,D=(_+y)*w,N=(p+g)*k,R=(_-y)*k,F=(1-(h+m))*k;return e[0]=M,e[1]=A,e[2]=S,e[3]=0,e[4]=I,e[5]=P,e[6]=D,e[7]=0,e[8]=N,e[9]=R,e[10]=F,e[11]=0,e[12]=r[0]+T-(M*T+I*C+N*E),e[13]=r[1]+C-(A*T+P*C+R*E),e[14]=r[2]+E-(S*T+D*C+F*E),e[15]=1,e}function fromQuat(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],o=r+r,s=n+n,u=a+a,c=r*o,l=n*o,f=n*s,h=a*o,d=a*s,p=a*u,m=i*o,_=i*s,v=i*u;return e[0]=1-f-p,e[1]=l+v,e[2]=h-_,e[3]=0,e[4]=l-v,e[5]=1-c-p,e[6]=d+m,e[7]=0,e[8]=h+_,e[9]=d-m,e[10]=1-c-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function frustum(e,t,r,n,a,i,o){var s=1/(r-t),u=1/(a-n),c=1/(i-o);return e[0]=2*i*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*i*u,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(a+n)*u,e[10]=(o+i)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i*2*c,e[15]=0,e}function perspective(e,t,r,n,a){var i=1/Math.tan(t/2),o=void 0;return e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(o=1/(n-a),e[10]=(a+n)*o,e[14]=2*a*n*o):(e[10]=-1,e[14]=-2*n),e}function perspectiveFromFieldOfView(e,t,r,n){var a=Math.tan(t.upDegrees*Math.PI/180),i=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(o+s),c=2/(a+i);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-s)*u*.5,e[9]=(a-i)*c*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function ortho(e,t,r,n,a,i,o){var s=1/(t-r),u=1/(n-a),c=1/(i-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*s,e[13]=(a+n)*u,e[14]=(o+i)*c,e[15]=1,e}function lookAt(e,t,r,n){var a=void 0,i=void 0,o=void 0,s=void 0,u=void 0,c=void 0,l=void 0,f=void 0,h=void 0,d=void 0,p=t[0],m=t[1],_=t[2],v=n[0],y=n[1],g=n[2],b=r[0],x=r[1],w=r[2];return Math.abs(p-b)<te&&Math.abs(m-x)<te&&Math.abs(_-w)<te?identity(e):(l=p-b,f=m-x,h=_-w,a=y*(h*=d=1/Math.sqrt(l*l+f*f+h*h))-g*(f*=d),i=g*(l*=d)-v*h,o=v*f-y*l,(d=Math.sqrt(a*a+i*i+o*o))?(a*=d=1/d,i*=d,o*=d):(a=0,i=0,o=0),s=f*o-h*i,u=h*a-l*o,c=l*i-f*a,(d=Math.sqrt(s*s+u*u+c*c))?(s*=d=1/d,u*=d,c*=d):(s=0,u=0,c=0),e[0]=a,e[1]=s,e[2]=l,e[3]=0,e[4]=i,e[5]=u,e[6]=f,e[7]=0,e[8]=o,e[9]=c,e[10]=h,e[11]=0,e[12]=-(a*p+i*m+o*_),e[13]=-(s*p+u*m+c*_),e[14]=-(l*p+f*m+h*_),e[15]=1,e)}function targetTo(e,t,r,n){var a=t[0],i=t[1],o=t[2],s=n[0],u=n[1],c=n[2],l=a-r[0],f=i-r[1],h=o-r[2],d=l*l+f*f+h*h;d>0&&(l*=d=1/Math.sqrt(d),f*=d,h*=d);var p=u*h-c*f,m=c*l-s*h,_=s*f-u*l;return(d=p*p+m*m+_*_)>0&&(p*=d=1/Math.sqrt(d),m*=d,_*=d),e[0]=p,e[1]=m,e[2]=_,e[3]=0,e[4]=f*_-h*m,e[5]=h*p-l*_,e[6]=l*m-f*p,e[7]=0,e[8]=l,e[9]=f,e[10]=h,e[11]=0,e[12]=a,e[13]=i,e[14]=o,e[15]=1,e}function mat4_str(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function frob(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))}function mat4_add(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function subtract(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function multiplyScalar(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function multiplyScalarAndAdd(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function exactEquals(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function mat4_equals(e,t){var r=e[0],n=e[1],a=e[2],i=e[3],o=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=e[9],h=e[10],d=e[11],p=e[12],m=e[13],_=e[14],v=e[15],y=t[0],g=t[1],b=t[2],x=t[3],w=t[4],k=t[5],T=t[6],C=t[7],E=t[8],M=t[9],A=t[10],S=t[11],I=t[12],P=t[13],D=t[14],N=t[15];return Math.abs(r-y)<=te*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(n-g)<=te*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(a-b)<=te*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(i-x)<=te*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-w)<=te*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(s-k)<=te*Math.max(1,Math.abs(s),Math.abs(k))&&Math.abs(u-T)<=te*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(c-C)<=te*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(l-E)<=te*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(f-M)<=te*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(h-A)<=te*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(d-S)<=te*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(p-I)<=te*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(m-P)<=te*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(_-D)<=te*Math.max(1,Math.abs(_),Math.abs(D))&&Math.abs(v-N)<=te*Math.max(1,Math.abs(v),Math.abs(N))}var ae=multiply,ie=subtract;function vec4_create(){var e=new re(4);return re!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function vec4_clone(e){var t=new re(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function vec4_fromValues(e,t,r,n){var a=new re(4);return a[0]=e,a[1]=t,a[2]=r,a[3]=n,a}function vec4_copy(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function vec4_set(e,t,r,n,a){return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e}function vec4_add(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function vec4_subtract(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function vec4_multiply(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function divide(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function vec4_ceil(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function vec4_floor(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function vec4_min(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function vec4_max(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function round(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function vec4_scale(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function scaleAndAdd(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e}function distance(e,t){var r=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2],i=t[3]-e[3];return Math.sqrt(r*r+n*n+a*a+i*i)}function squaredDistance(e,t){var r=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2],i=t[3]-e[3];return r*r+n*n+a*a+i*i}function vec4_length(e){var t=e[0],r=e[1],n=e[2],a=e[3];return Math.sqrt(t*t+r*r+n*n+a*a)}function squaredLength(e){var t=e[0],r=e[1],n=e[2],a=e[3];return t*t+r*r+n*n+a*a}function negate(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function inverse(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function vec4_normalize(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],o=r*r+n*n+a*a+i*i;return o>0&&(o=1/Math.sqrt(o),e[0]=r*o,e[1]=n*o,e[2]=a*o,e[3]=i*o),e}function dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function lerp(e,t,r,n){var a=t[0],i=t[1],o=t[2],s=t[3];return e[0]=a+n*(r[0]-a),e[1]=i+n*(r[1]-i),e[2]=o+n*(r[2]-o),e[3]=s+n*(r[3]-s),e}function random(e,t){var r,n,a,i,o,s;t=t||1;do{o=(r=2*ne()-1)*r+(n=2*ne()-1)*n}while(o>=1);do{s=(a=2*ne()-1)*a+(i=2*ne()-1)*i}while(s>=1);var u=Math.sqrt((1-o)/s);return e[0]=t*r,e[1]=t*n,e[2]=t*a*u,e[3]=t*i*u,e}function transformMat4(e,t,r){var n=t[0],a=t[1],i=t[2],o=t[3];return e[0]=r[0]*n+r[4]*a+r[8]*i+r[12]*o,e[1]=r[1]*n+r[5]*a+r[9]*i+r[13]*o,e[2]=r[2]*n+r[6]*a+r[10]*i+r[14]*o,e[3]=r[3]*n+r[7]*a+r[11]*i+r[15]*o,e}function transformQuat(e,t,r){var n=t[0],a=t[1],i=t[2],o=r[0],s=r[1],u=r[2],c=r[3],l=c*n+s*i-u*a,f=c*a+u*n-o*i,h=c*i+o*a-s*n,d=-o*n-s*a-u*i;return e[0]=l*c+d*-o+f*-u-h*-s,e[1]=f*c+d*-s+h*-o-l*-u,e[2]=h*c+d*-u+l*-s-f*-o,e[3]=t[3],e}function vec4_str(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function vec4_exactEquals(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function vec4_equals(e,t){var r=e[0],n=e[1],a=e[2],i=e[3],o=t[0],s=t[1],u=t[2],c=t[3];return Math.abs(r-o)<=te*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=te*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(a-u)<=te*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(i-c)<=te*Math.max(1,Math.abs(i),Math.abs(c))}var oe=vec4_subtract,se=vec4_multiply,ue=divide,ce=distance,le=squaredDistance,fe=vec4_length,he=squaredLength,de=function(){var e=vec4_create();return function(t,r,n,a,i,o){var s=void 0,u=void 0;for(r||(r=4),n||(n=0),u=a?Math.min(a*r+n,t.length):t.length,s=n;s<u;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],i(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}(),pe=function average(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length},me=function(e){function CartoValidationError(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_e.DEFAULT;return p()(this,CartoValidationError),(t=R()(this,O()(CartoValidationError).call(this,{message:e,type:r}))).name="CartoValidationError",t}return B()(CartoValidationError,e),CartoValidationError}(G),_e={DEFAULT:"[Error]",MISSING_REQUIRED:"[Missing required property]",INCORRECT_TYPE:"[Property with an incorrect type]",INCORRECT_VALUE:"[Incorrect value]",TOO_MANY_ARGS:"[Too many arguments]",NOT_ENOUGH_ARGS:"[Not enough arguments]",WRONG_NUMBER_ARGS:"[Wrong number of arguments]"},ve={UNKNOWN:"unknown",POINT:"point",LINE:"line",POLYGON:"polygon"};function getLineNormal(e,t){var r=function geometry_normalize(e,t){var r=Math.hypot(e,t);return[e/r,t/r]}(e[0]-t[0],e[1]-t[1]);return[-r[1],r[0]]}function getJoinNormal(e,t){var r=[e[1],-e[0]],n=[-t[1],t[0]],a=n[0]*r[1]-n[1]*r[0],i=n[0]*r[0]+n[1]*r[1],o=Math.abs(a);return{turnLeft:a>0,joinNormal:!(o<.866&&i>.5)&&neg([(r[0]+n[0])/o,(r[1]+n[1])/o])}}function neg(e){return[-e[0],-e[1]]}function pointInTriangle(e,t,r,n){if(equalPoints(t,r)||equalPoints(r,n)||equalPoints(n,t))return!1;var a=halfPlaneSign(e,t,r)<0,i=halfPlaneSign(e,r,n)<0,o=halfPlaneSign(e,n,t)<0;return a===i&&i===o}function halfPlaneSign(e,t,r){return(e.x-r.x)*(t.y-r.y)-(t.x-r.x)*(e.y-r.y)}function equalPoints(e,t){return e.x===t.x&&e.y===t.y}function pointInCircle(e,t,r){var n=e.x-t.x,a=e.y-t.y;return n*n+a*a<=r*r}function computeCentroids(e,t){switch(t){case ve.POINT:return function _computeCentroidsForPoints(e){for(var t=[],r=0;r<e.vertices.length/6;r++){var n=6*r,a=n+6,i=e.vertices.slice(n,a),o=g()(i,6),s=o[4],u=o[5];t.push({x:s,y:u})}return t}(e);case ve.LINE:case ve.POLYGON:return function _computeCentroidsForLinesOrPolygons(e,t){var r=[],n=0;return e.breakpoints.forEach(function(a){var i=e.vertices.slice(n,a),o=null;o=t===ve.LINE?function _centroidForLines(e){for(var t=[],r=[],n=0;n<e.length/6;n++){var a=6*n,i=a+6,o=e.slice(a,i),s=g()(o,6),u=s[0],c=s[1],l=s[2],f=s[3],h=s[4],d=s[5],p=u===l&&c===f,m=l===h&&f===d;if(!p||!m){var _=[u,c],v=p?[h,d]:[l,f];t.push(_[0]),t.push(v[0]),r.push(_[1]),r.push(v[1])}}return{x:pe(t),y:pe(r)}}(i):function _centroidForPolygons(e){for(var t=[],r=[],n=[],a=0;a<e.length/6;a++){var i=6*a,o=i+6,s=e.slice(i,o),u=g()(s,6),c=u[0],l=u[1],f=u[2],h=u[3],d=u[4],p=u[5],m=[[c,l],[f,h],[d,p]],_=triangleArea(m);if(_>0){var v=pe([c,f,d]),y=pe([l,h,p]);t.push(v*_),r.push(y*_),n.push(_)}}var b=_sumArray(n);return{x:_sumArray(t)/b,y:_sumArray(r)/b}}(i),r.push(o),n=a}),r}(e,t);default:throw new me("Invalid type argument, decoded geometry must have a point, line or polygon type.",_e.INCORRECT_VALUE)}}function _sumArray(e){return e.reduce(function(e,t){return e+t},0)}function triangleArea(e){var t=g()(e[0],2),r=t[0],n=t[1],a=g()(e[1],2),i=a[0],o=a[1],s=g()(e[2],2),u=s[0],c=s[1];return Math.abs((r-u)*(o-n)-(r-i)*(c-n))/2}function _updateAABBForGeometry(e,t,r){switch(r){case ve.LINE:return function _updateAABBLine(e,t){for(var r=e,n=e.length,a=0;a<n;a+=2)t.minx=Math.min(t.minx,r[a+0]),t.miny=Math.min(t.miny,r[a+1]),t.maxx=Math.max(t.maxx,r[a+0]),t.maxy=Math.max(t.maxy,r[a+1]);return t}(e,t);case ve.POLYGON:return function _updateAABBPolygon(e,t){for(var r=[e.flat,e.holes[0]||e.flat.length/2],n=r[0],a=r[1],i=0;i<a;i++)t.minx=Math.min(t.minx,n[2*i+0]),t.miny=Math.min(t.miny,n[2*i+1]),t.maxx=Math.max(t.maxx,n[2*i+0]),t.maxy=Math.max(t.maxy,n[2*i+1]);return t}(e,t)}}var ye=Math.PI/180,ge=6378137,be=ge*Math.PI;function isUndefined(e){return void 0===e}function isString(e){return"string"==typeof e}function isObject(e){var t=h()(e);return null!==e&&("object"===t||"function"===t)}function castDate(e){if(e instanceof Date)return e;if("number"==typeof e)return msToDate(e);if(isString(e))return new Date(e);throw new me("Invalid Date type",_e.INCORRECT_TYPE)}function msToDate(e){return new Date(e)}function isSetsEqual(e,t){return e.size===t.size&&l()(e).every(function(e){return t.has(e)})}function projectToWebMercator(e){var t=e.lat*ye;return{x:e.lng*ye*ge,y:Math.log(Math.tan(t/2+Math.PI/4))*ge}}function computeViewportFromCameraMatrix(e){var t=n.invert([],e),r=[[-1,-1],[-1,1],[1,-1],[1,1]].map(function(e){return function unproject(e,t,r){var n=a.transformMat4([],[t,r,1,1],e)[2],i=(n-a.transformMat4([],[t,r,2,1],e)[2])/-1,o=-(n-1*i)/i;return a.transformMat4([],[t,r,o,1],e).map(function(e,t,r){return e/r[3]})}.apply(void 0,[t].concat(l()(e)))}).map(function(e){return e.map(function(e){return 2*e-1})}),i=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],o=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];r.forEach(function(e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),o[0]=Math.max(o[0],e[0]),o[1]=Math.max(o[1],e[1])}),i[1]=-i[1],o[1]=-o[1];var s=i[1];return i[1]=o[1],o[1]=s,i.concat(o)}var xe,we,ke={WM_R:be,WM_2R:2*be,isUndefined:isUndefined,isString:isString,isNumber:function isNumber(e){return"number"==typeof e},isObject:isObject,castDate:castDate,isSetsEqual:isSetsEqual,equalArrays:function equalArrays(e,t){if(e&&t&&e.length===t.length){for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}},projectToWebMercator:projectToWebMercator,computeMatrixZoom:function computeMatrixZoom(e){return-2*e[15]/e[5]},computeMatrixCenter:function computeMatrixCenter(e){return{x:-(1+2*e[12]/e[0]),y:+(1+2*e[13]/e[5])}},computeViewportFromCameraMatrix:computeViewportFromCameraMatrix};function castTimeRange(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return void 0===e||function isTimeRange(e){return e instanceof ee}(e)?e&&t?util_timeRange({iso:e._iso,timeZone:t}):e:"string"==typeof e?util_timeRange({iso:e,timeZone:t}):void 0}function util_timeRange(e){var t=e.start,r=e.end,n=e.iso,a=e.timeZone;return new ee(a,n,t,r)}function setDefaultAuth(e){checkAuth(e),xe=e}function checkAuth(e){if(isUndefined(e))throw new me("'auth'",_e.MISSING_REQUIRED);if(!isObject(e))throw new me("'auth' property must be an object.",_e.INCORRECT_TYPE);e.username=isUndefined(e.username)?e.user:e.username,function checkApiKey(e){if(isUndefined(e))throw new me("'apiKey'",_e.MISSING_REQUIRED);if(!isString(e))throw new me("'apiKey' property must be a string.",_e.INCORRECT_TYPE);if(""===e)throw new me("'apiKey' property must be not empty.",_e.INCORRECT_VALUE)}(e.apiKey),function checkUsername(e){if(isUndefined(e))throw new me("'username'",_e.MISSING_REQUIRED);if(!isString(e))throw new me("'username' property must be a string.",_e.INCORRECT_TYPE);if(""===e)throw new me("'username' property must be not empty.",_e.INCORRECT_VALUE)}(e.username)}function setDefaultConfig(e){checkConfig(e),we=e}function checkConfig(e){if(e){if(!isObject(e))throw new me("'config' property must be an object.",_e.INCORRECT_TYPE);!function _checkServerURL(e){if(!isString(e))throw new me("'serverURL' property must be a string.",_e.INCORRECT_TYPE)}(e.serverURL)}}var Te="aggregated",Ce="unaggregated",Ee="unknown",Me={};function union(e,t){var r={};return new Set(Object.keys(e).concat(Object.keys(t))).forEach(function(n){var a=e[n]||[],i=t[n]||[],o=l()(a).concat(l()(i));r[n]=o}),r}function schema_equals(e,t){return!(!e||!t)&&JSON.stringify(simplify(e))===JSON.stringify(simplify(t))}function simplify(e){var t={};return Object.keys(e).sort().forEach(function(r){var n=l()(new Set(e[r].map(function(e){return JSON.stringify(e)})));n.sort(),n=n.map(function(e){return JSON.parse(e)}),t[r]=n}),t}var Ae={aggColumn:function aggColumn(e,t){return"".concat("_cdb_agg_").concat(t,"_").concat(e)},dimColumn:function dimColumn(e,t){return"".concat("_cdb_dim_").concat(t,"_").concat(e)}},Se={column:Ae,equals:schema_equals,notEquals:function schema_notEquals(e,t){return!schema_equals(e,t)},union:union,IDENTITY:Me,simplify:simplify},Ie=function(){function Cache(){p()(this,Cache),this.caches=new WeakMap}return _()(Cache,[{key:"get",value:function get(e,t){if(this.caches.has(e))return this.caches.get(e)[t]}},{key:"set",value:function set(e,t,r){if(this.caches.has(e)){this.caches.get(e)[t]=r}else{var n={};n[t]=r,this.caches.set(e,n)}}},{key:"has",value:function has(e,t){return void 0!==this.get(e,t)}}]),Cache}(),Pe=function(e){function CartoRuntimeError(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:De.DEFAULT;return p()(this,CartoRuntimeError),(t=R()(this,O()(CartoRuntimeError).call(this,{message:e,type:r}))).name="CartoRuntimeError",t}return B()(CartoRuntimeError,e),CartoRuntimeError}(G),De={DEFAULT:"[Error]",NOT_SUPPORTED:"[Not supported]",WEB_GL:"[WebGL]",MVT:"[MVT]"},Ne=1,Re=new Ie,Fe=new Ie;function compileProgram(e,t,r){var n=t+r;if(Fe.has(e,n))return Fe.get(e,n);var a={},i=utils_compileShader(e,t,e.VERTEX_SHADER),o=utils_compileShader(e,r,e.FRAGMENT_SHADER);if(a.program=e.createProgram(),e.attachShader(a.program,i),e.attachShader(a.program,o),e.linkProgram(a.program),e.deleteShader(i),e.deleteShader(o),!e.getProgramParameter(a.program,e.LINK_STATUS))throw new Pe("Unable to link the shader program: ".concat(e.getProgramInfoLog(a.program),"."),De.WEB_GL);return a.programID=Ne++,Fe.set(e,n,a),a}function utils_compileShader(e,t,r){if(Re.has(e,t))return Re.get(e,t);var n=e.createShader(r);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS)){var a=e.getShaderInfoLog(n);throw e.deleteShader(n),new Pe("An error occurred compiling the shaders: ".concat(a,"\nSource:\n").concat(t),De.WEB_GL)}return Re.set(e,t,n),n}var Oe=r(42),Le=r.n(Oe),ze=r(41),Be=r.n(ze),Ve=r(43),Ge=r.n(Ve),Ue=r(23),qe=r.n(Ue),je=r(22),We=r.n(je),He={vertexShader:"".concat(We.a),fragmentShader:"".concat(qe.a).replace("$style_inline","$color_inline").replace("$style_preface","$color_preface")},Ze={vertexShader:"".concat(We.a),fragmentShader:"".concat(qe.a).replace("$style_inline","vec4($filter_inline)").replace("$style_preface","$filter_preface")},Ye={vertexShader:"".concat(We.a),fragmentShader:"".concat(qe.a).replace("$style_inline","vec4(encodeWidth($width_inline), vec2(0.))").replace("$style_preface","".concat(Ge.a))},Xe=r(45),Qe=r.n(Xe),$e=r(44),Je={vertexShader:"".concat(r.n($e).a),fragmentShader:"".concat(Qe.a)},Ke={styler:i,symbolizer:o,AABlender:function AntiAliasingShader(e){p()(this,AntiAliasingShader),Object.assign(this,compileProgram(e,Be.a,Le.a)),this.vertexAttribute=e.getAttribLocation(this.program,"vertex"),this.readTU=e.getUniformLocation(this.program,"aaTex")}},et=function(){function IDGenerator(){p()(this,IDGenerator),this._ids=new Map}return _()(IDGenerator,[{key:"getID",value:function getID(e){if(this._ids.has(e))return this._ids.get(e);var t=this._ids.size;return this._ids.set(e,t),t}}]),IDGenerator}();function compileShader(e,t,r){var n={},a=function getPropertyAccessCode(e){return void 0===n[e]&&(n[e]=Object.keys(n).length),"texture2D(propertyTex".concat(n[e],", abs(featureID)).a")},i={},o=new et;Object.keys(r).forEach(function(e){var t=r[e];t._setUID(o);var n=t._applyToShaderSource(a);i[e+"_preface"]=n.preface,i[e+"_inline"]=n.inline}),i.propertyPreface=Object.keys(n).map(function(e){return"uniform sampler2D propertyTex".concat(n[e],";")}).join("\n");var s=function createShaderFromTemplate(e,t,r){var n=t.vertexShader,a=t.fragmentShader;Object.keys(r).forEach(function(e){n=n.replace("$"+e,r[e]),a=a.replace("$"+e,r[e])});var i=compileProgram(e,n,a);return i.vertexPositionAttribute=e.getAttribLocation(i.program,"vertexPosition"),i.featureIdAttr=e.getAttribLocation(i.program,"featureID"),i.normalAttr=e.getAttribLocation(i.program,"normal"),i.colorTexture=e.getUniformLocation(i.program,"colorTex"),i.strokeColorTexture=e.getUniformLocation(i.program,"strokeColorTex"),i.strokeWidthTexture=e.getUniformLocation(i.program,"strokeWidthTex"),i.widthTexture=e.getUniformLocation(i.program,"widthTex"),i.orderMinWidth=e.getUniformLocation(i.program,"orderMinWidth"),i.orderMaxWidth=e.getUniformLocation(i.program,"orderMaxWidth"),i.filterTexture=e.getUniformLocation(i.program,"filterTex"),i.normalScale=e.getUniformLocation(i.program,"normalScale"),i.resolution=e.getUniformLocation(i.program,"resolution"),i.matrix=e.getUniformLocation(i.program,"matrix"),i}(e,t,i);return Object.keys(n).map(function(t){n[t]=e.getUniformLocation(s.program,"propertyTex".concat(n[t]))}),Object.values(r).forEach(function(t){t._postShaderCompile(s.program,e)}),{shader:s,textureIds:n,_codes:i,_template:t}}var tt=r(6),rt=r.n(tt),nt=r(7),at=r.n(nt),it=r(9),ot=r.n(it);function sRGBToCielab(e){return function XYZToCieLab(e){var t=e.x,r=e.y,n=e.z,a=e.a,i=st,o=ut,s=ct,u=function f(e){return e>=.008856451679035631?Math.pow(e,.333333333333333):841/108*e+4/29};return{l:116*u(r/o)-16,a:500*(u(t/i)-u(r/o)),b:200*(u(r/o)-u(n/s)),alpha:a}}(function sRGBToXYZ(e){var t=function sRGBToLinearRGB(e){var t=e.r,r=e.g,n=e.b,a=e.a,i=function inverseGammaCorrection(e){return e<=.0404482362771076?e/12.92:Math.pow((e+.055)/1.055,2.4)};return{r:i(t),g:i(r),b:i(n),a:a}}(e),r=t.r,n=t.g,a=t.b,i=t.a;return{x:.41239558896741424*r+.3575834307637148*n+.18049264738170157*a,y:.21258623078559555*r+.7151703037034108*n+.07220049864333623*a,z:.019297215491746945*r+.11918386458084854*n+.9504971251315798*a,a:i}}(e))}function cielabToSRGB(e){return function XYZToSRGB(e){var t=e.x,r=e.y,n=e.z,a=e.a,i=utils_clamp(3.2406*t-1.5372*r-.4986*n,0,1),o=utils_clamp(-.9689*t+1.8758*r+.0415*n,0,1),s=utils_clamp(.0557*t-.204*r+1.057*n,0,1);return function linearRGBToSRGB(e){var t=e.r,r=e.g,n=e.b,a=e.a,i=function gammaCorrection(e){return e<=.0031306684425005883?12.92*e:1.055*Math.pow(e,.4166666666666667)-.055};return{r:i(t),g:i(r),b:i(n),a:a}}({r:i,g:o,b:s,a:a})}(function cielabToXYZ(e){var t=e.l,r=e.a,n=e.b,a=e.alpha,i=function f(e){return e>=.20689655172413793?e*e*e:108/841*(e-4/29)};return{x:st*i((t+16)/116+r/500),y:ut*i((t+16)/116),z:ct*i((t+16)/116-n/200),a:a}}(e))}var st=.950456,ut=1,ct=1.088754;function checkMaxArguments(e,t,r){if(e.length>t)throw new me("Expression '".concat(r,"' accepts just ").concat(t," arguments, but ").concat(e.length," were passed."),_e.TOO_MANY_ARGS)}function checkMinArguments(e,t,r){if(e.length<t)throw new me("Expression '".concat(r,"' accepts at least ").concat(t," arguments, but ").concat(e.length," were passed."),_e.NOT_ENOUGH_ARGS)}function checkExactNumberOfArguments(e,t,r){if(e.length!==t)throw new me("Expression '".concat(r,"' accepts exactly ").concat(t," arguments, but ").concat(e.length," were passed."),_e.WRONG_NUMBER_ARGS)}function implicitCast(e){return _isNumber(e)?Ca(e):"string"==typeof e?Ea(e):Array.isArray(e)?Ma(e):e}function hexToRgb(e){var t=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(e);if(t)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:1};if(t=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(e))return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:parseInt(t[4]+t[4],16)/255};if(t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e))return{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16),a:1};if(t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e))return{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16),a:parseInt(t[4],16)/255};throw new U("Invalid hexadecimal color")}function noOverrideColor(){return Sa(255,255,255,0)}function getOrdinalFromIndex(e){return{1:"first",2:"second",3:"third",4:"fourth"}[e]||String(e)}function getStringErrorPreface(e,t,r){return"".concat(e,"(): invalid ").concat(getOrdinalFromIndex(r+1)," parameter '").concat(t,"'")}function throwInvalidType(e,t,r,n,a){throw new me("".concat(getStringErrorPreface(e,t,r),"\n        expected type was '").concat(n,"', actual type was '").concat(a,"'"),_e.INCORRECT_TYPE)}function throwInvalidInstance(e,t,r,n){var a=Array.isArray(n)?n.join(", "):n.name;throw new me("".concat(getStringErrorPreface(e,t,r),"\n    expected type was instance of '").concat(a,"'"),_e.INCORRECT_TYPE)}function throwInvalidString(e,t,r,n){throw new me("".concat(getStringErrorPreface(e,t,r),"\n    expected type was 'string', but ").concat(n,"' is not a string"),_e.INCORRECT_TYPE)}function checkExpression(e,t,r,n){if(!(n instanceof lt))throw new me("".concat(getStringErrorPreface(e,t,r),"\n        '").concat(n,'\' is not of type "carto.expressions.Base"'),_e.INCORRECT_TYPE)}function checkType(e,t,r,n,a){if(checkExpression(e,t,r,a),Array.isArray(n)){if(!n.some(function(e){return a.type===e}))throw new me("".concat(getStringErrorPreface(e,t,r),"\n            expected type was one of ").concat(n.join(),", actual type was '").concat(a.type,"'"),_e.INCORRECT_TYPE)}else a.type!==n&&throwInvalidType(e,t,r,n,a.type)}function checkInstance(e,t,r,n,a){(checkExpression(e,t,r,a),Array.isArray(n))?n.some(function(e){return a.isA(e)})||throwInvalidInstance(e,t,r,n):a.isA(n)||throwInvalidInstance(e,t,r,n)}function checkNumber(e,t,r,n){_isNumber(n)||function throwInvalidNumber(e,t,r,n){throw new me("".concat(getStringErrorPreface(e,t,r),"\n    type of '").concat(n,"' is ").concat(h()(n),", 'number' was expected"),_e.INCORRECT_TYPE)}(e,t,r,n)}function checkString(e,t,r,n){"string"!=typeof n&&throwInvalidString(e,t,r,n)}function checkStringValue(e,t,r,n,a){"string"!=typeof n?throwInvalidString(e,t,r,n):a.includes(n)||function throwInvalidStringValue(e,t,r,n,a){throw new me("".concat(getStringErrorPreface(e,t,r),"\n    value '").concat(n,"' is not valid. It should be one of ").concat(a.map(function(e){return"'".concat(e,"'")}).join(", ")),_e.INCORRECT_TYPE)}(e,t,r,n,a)}function checkArray(e,t,r,n){Array.isArray(n)||function throwInvalidArray(e,t,r,n){throw new me("".concat(getStringErrorPreface(e,t,r),"\n    '").concat(n,"' is not an array"),_e.INCORRECT_TYPE)}(e,t,r,n)}function checkFeatureIndependent(e,t,r,n){if(n.isFeatureDependent())throw new me("".concat(getStringErrorPreface(e,t,r),"\n        parameter cannot be feature dependent"),_e.INCORRECT_VALUE)}function utils_clamp(e,t,r){return Math.min(Math.max(e,t),r)}function utils_mix(e,t,r){return"number"==typeof e?_mixNumber(e,t,r):e instanceof Date?function _mixDate(e,t,r){var n=e.getTime(),a=t.getTime(),i=Math.abs(_mixNumber(n,a,r));return new Date(i)}(e,t,r):function interpolateRGBAinCieLAB(e,t,r){var n=sRGBToCielab({r:e.r/255,g:e.g/255,b:e.b/255,a:e.a}),a=sRGBToCielab({r:t.r/255,g:t.g/255,b:t.b/255,a:t.a}),i=cielabToSRGB({l:(1-r)*n.l+r*a.l,a:(1-r)*n.a+r*a.a,b:(1-r)*n.b+r*a.b,alpha:(1-r)*n.alpha+r*a.alpha});return{r:Math.round(255*i.r),g:Math.round(255*i.g),b:Math.round(255*i.b),a:i.a}}(e,t,r)}function _mixNumber(e,t,r){return e*(1-r)+t*r}function _isNumber(e){return Number.isFinite(e)||e===1/0||e===-1/0||Number.isNaN(e)}var lt=function(){function Base(e){p()(this,Base),this._initializeChildren(e),this.preface="",this._shaderBindings=new Map,this.expressionName=function _toCamelCase(e){if(e.toUpperCase()===e)return e.toLowerCase();return e.charAt(0).toLowerCase()+e.slice(1)}(this.constructor.name),this._variableName=null}return _()(Base,[{key:"eval",value:function _eval(){return this.value}},{key:"toString",value:function toString(){return"".concat(this.expressionName,"(").concat(this._getChildren().map(function(e){return e.toString()}).join(", "),")")}},{key:"isAnimated",value:function isAnimated(){return this._getChildren().some(function(e){return e.isAnimated()})}},{key:"isPlaying",value:function isPlaying(){return this._getChildren().some(function(e){return e.isPlaying()})}},{key:"blendTo",value:function(){var e=ot()(at.a.mark(function _callee(e){var t,r,n,a=arguments;return at.a.wrap(function _callee$(i){for(;;)switch(i.prev=i.next){case 0:t=a.length>1&&void 0!==a[1]?a[1]:500,e=implicitCast(e),this.keepDefaultsOnBlend&&this.keepDefaultsOnBlend(),r=this.parent,n=ei(this,e,Ia(t)),r.replaceChild(this,n),n.notify();case 7:case"end":return i.stop()}},_callee,this)}));return function blendTo(t){return e.apply(this,arguments)}}()},{key:"isA",value:function isA(e){return this instanceof e}},{key:"notify",value:function notify(){return this.parent.notify()}},{key:"accumViewportAgg",value:function accumViewportAgg(e){this._getChildren().forEach(function(t){return t.accumViewportAgg(e)})}},{key:"loadImages",value:function loadImages(){return Promise.all(this._getChildren().map(function(e){return e.loadImages()}))}},{key:"getLegendData",value:function getLegendData(){return{name:this.propertyName,data:[]}}},{key:"_bindMetadata",value:function _bindMetadata(e){this._getChildren().forEach(function(t){return t._bindMetadata(e)})}},{key:"_initializeChildren",value:function _initializeChildren(e){Array.isArray(e)?this._initializeChildrenArray(e):this._initializeChildrenObject(e),this._addParentToChildren()}},{key:"_initializeChildrenArray",value:function _initializeChildrenArray(e){var t=this;if(this.maxParameters&&this.maxParameters<e.length)throw new me("Extra parameters, got ".concat(e.length," but maximum is ").concat(this.maxParameters),_e.TOO_MANY_ARGS);this.childrenNames=[],e.map(function(e,r){var n="".concat(e.type,"-").concat(r);t.childrenNames.push(n),t[n]=implicitCast(e)})}},{key:"_initializeChildrenObject",value:function _initializeChildrenObject(e){var t,r=this;if(void 0===this.childrenNames&&(this.childrenNames=[]),(t=this.childrenNames).push.apply(t,l()(Object.keys(e))),this.maxParameters&&this.maxParameters<this.childrenNames.length)throw new me(_e.TOO_MANY_ARGS,"Extra parameters, got ".concat(this.childrenNames.length," but maximum is ").concat(this.maxParameters));Object.keys(e).map(function(t){r[t]=implicitCast(e[t])})}},{key:"_addParentToChildren",value:function _addParentToChildren(){var e=this;this._getChildren().map(function(t){t.parent=e})}},{key:"_setUID",value:function _setUID(e){this._uid=e.getID(this),this._getChildren().map(function(t){return t._setUID(e)})}},{key:"_dataReady",value:function _dataReady(){this._getChildren().map(function(e){return e._dataReady()})}},{key:"isFeatureDependent",value:function isFeatureDependent(){return this._getChildren().some(function(e){return e.isFeatureDependent()})}},{key:"_prefaceCode",value:function _prefaceCode(e){return e?"\n".concat(this._buildGLSLCode(e),"\n"):""}},{key:"_buildGLSLCode",value:function _buildGLSLCode(e){return"\n            #ifndef DEF_".concat(this._uid,"\n            #define DEF_").concat(this._uid,"\n            ").concat(e,"\n            #endif")}},{key:"_getDependencies",value:function _getDependencies(){return this._getChildren().map(function(e){return e._getDependencies()}).reduce(function(e,t){return e.concat(t)},[])}},{key:"_resolveAliases",value:function _resolveAliases(e){this._getChildren().map(function(t){return t._resolveAliases(e)})}},{key:"_setGenericGLSL",value:function _setGenericGLSL(e,t){this.inlineMaker=e,this.preface=t||""}},{key:"_applyToShaderSource",value:function _applyToShaderSource(e){var t=this,r=this.childrenNames.map(function(r){return t[r]._applyToShaderSource(e)}),n={};return r.map(function(e,r){n[t.childrenNames[r]]=e.inline}),{preface:this._prefaceCode(r.map(function(e){return e.preface}).reduce(function(e,t){return e+t},"")+this.preface),inline:this.inlineMaker(n,e)}}},{key:"_postShaderCompile",value:function _postShaderCompile(e,t){var r=this;this.childrenNames.forEach(function(n){return r[n]._postShaderCompile(e,t)})}},{key:"_getBinding",value:function _getBinding(e){return this._shaderBindings.has(e)||this._shaderBindings.set(e,{}),this._shaderBindings.get(e)}},{key:"_resetViewportAgg",value:function _resetViewportAgg(e){this._getChildren().forEach(function(t){return t._resetViewportAgg(e)})}},{key:"_setTimestamp",value:function _setTimestamp(e){var t=this;this.childrenNames.forEach(function(r){return t[r]._setTimestamp(e)})}},{key:"_preDraw",value:function _preDraw(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];this.childrenNames.forEach(function(t){var n;return(n=e[t])._preDraw.apply(n,r)})}},{key:"replaceChild",value:function replaceChild(e,t){var r=this;this[this.childrenNames.find(function(t){return r[t]===e})]=t,t.parent=this,t.notify=e.notify,t.notify().catch(function(){})}},{key:"_blendFrom",value:function _blendFrom(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!this.default||!e.default){e=implicitCast(e);var n=this.parent,a=ei(e,this,Ia(t),r);n.replaceChild(this,a),a.notify()}}},{key:"_getChildren",value:function _getChildren(){var e=this;return this.childrenNames.map(function(t){return e[t]})}},{key:"_getMinimumNeededSchema",value:function _getMinimumNeededSchema(){return this._getChildren().map(function(e){return e._getMinimumNeededSchema()}).reduce(union,Me)}},{key:"value",get:function get(){throw new Pe("Must evaluate a feature using .eval(feature)")}},{key:"values",get:function get(){return this.getLegendData().data}},{key:"propertyName",get:function get(){return this._getChildren().map(function(e){return e.propertyName}).find(function(e){return!!e})}}]),Base}();var ft=function(e){function Transition(e){var t;if(p()(this,Transition),checkMaxArguments(arguments,1,"transition"),checkNumber("transition","duration",0,e),e<0){var r=getStringErrorPreface("transition","duration",0);throw new me("".concat(r," 'duration' must be greater than or equal to 0."),_e.INCORRECT_VALUE)}return(t=R()(this,O()(Transition).call(this,{}))).aTime=Date.now(),t.bTime=t.aTime+Number(e),t.type="number",t}return B()(Transition,e),_()(Transition,[{key:"eval",value:function _eval(){return this.value}},{key:"isAnimated",value:function isAnimated(){return!this.mix||this.mix<=1}},{key:"isPlaying",value:function isPlaying(){return this.isAnimated()}},{key:"_applyToShaderSource",value:function _applyToShaderSource(){return{preface:this._prefaceCode("uniform float anim".concat(this._uid,";\n")),inline:"anim".concat(this._uid)}}},{key:"_postShaderCompile",value:function _postShaderCompile(e,t){this._getBinding(e).uniformLocation=t.getUniformLocation(e,"anim".concat(this._uid))}},{key:"_preDraw",value:function _preDraw(e,t,r){var n=Date.now();this.mix=(n-this.aTime)/(this.bTime-this.aTime),this.mix>1?r.uniform1f(this._getBinding(e).uniformLocation,1):r.uniform1f(this._getBinding(e).uniformLocation,this.mix)}},{key:"value",get:function get(){var e=Date.now();return this.mix=(e-this.aTime)/(this.bTime-this.aTime),Math.min(this.mix,1)}}]),Transition}(lt),ht=r(5),dt=r.n(ht),pt=generateBelongsExpression("in",function(e,t){return t.some(function(t){return t===e})?1:0}),mt={nin:{check:"1.",result:"0."},in:{check:"0.",result:"1."}},_t=generateBelongsExpression("nin",function(e,t){return t.some(function(t){return t===e})?0:1});function generateBelongsExpression(e,t){return function(r){function BelongExpression(t,r){var n;return p()(this,BelongExpression),checkMaxArguments(arguments,2,e),t=implicitCast(t),r=implicitCast(r),checkExpression(e,"input",0,t),checkExpression(e,["list","variable"],1,r),(n=R()(this,O()(BelongExpression).call(this,{input:t,list:r}))).type="number",n.name=e,n}return B()(BelongExpression,r),_()(BelongExpression,[{key:"eval",value:function _eval(e){return t(this.input.eval(e),this.list.eval(e))}},{key:"_applyToShaderSource",value:function _applyToShaderSource(e){var t=this,r={};this.childrenNames.map(function(r){return t[r]._applyToShaderSource(e)}).map(function(e,n){r[t.childrenNames[n]]=e});var n="belongs".concat(this._uid),a=this._getFuncList(),i=this.list.elems.map(a).join(""),o=mt[this.name].check,s="float ".concat(n,"(float x){\n                ").concat(i,"\n\n                return ").concat(o,";\n            }");return{preface:this._prefaceCode(r.input.preface+r.list.preface+s),inline:"".concat(n,"(").concat(r.input.inline,")")}}},{key:"_getFuncList",value:function _getFuncList(){var e=this,t=mt[this.name].result;return function(r){var n="number"===e.input.type?"".concat(r,".0"):"cat".concat(r._uid);return"if (x==".concat(n,") { return ").concat(t,"; }")}}},{key:"_bindMetadata",value:function _bindMetadata(t){var r=this;dt()(O()(BelongExpression.prototype),"_bindMetadata",this).call(this,t);["number","category"].forEach(function(t){r.input.type===t&&(checkType(e,"input",0,t,r.input),checkType(e,"list",1,"".concat(t,"-list"),r.list))})}},{key:"value",get:function get(){return t(this.input.value,this.list.value)}}]),BelongExpression}(lt)}var vt=function(e){function Between(e,t,r){var n;return p()(this,Between),checkMaxArguments(arguments,3,"between"),e=implicitCast(e),t=implicitCast(t),r=implicitCast(r),(n=R()(this,O()(Between).call(this,{input:e,lowerLimit:t,upperLimit:r}))).type="number",n.inlineMaker=function(e){return"((".concat(e.input," >= ").concat(e.lowerLimit," &&  ").concat(e.input," <= ").concat(e.upperLimit,") ? 1. : 0.)")},n}return B()(Between,e),_()(Between,[{key:"eval",value:function _eval(e){var t=this.input.eval(e),r=this.lowerLimit.eval(e),n=this.upperLimit.eval(e);return t>=r&&t<=n?1:0}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(Between.prototype),"_bindMetadata",this).call(this,e),checkType("between","input",0,["number","date"],this.input),checkType("between","lowerLimit",1,["number","date"],this.lowerLimit),checkType("between","upperLimit",2,["number","date"],this.upperLimit)}}]),Between}(lt),yt=0,gt=1,bt=2,xt=4,wt=8,kt=16,Tt=32,Ct={0:null,1:"number",2:"color",4:"color",8:"number",16:"image",32:"date"},Et=function(e){function BinaryOperation(e,t,r,n){var a;return p()(this,BinaryOperation),checkMaxArguments(arguments,4),Number.isFinite(e)&&Number.isFinite(t)?R()(a,Ca(r[gt](e,t))):(e=implicitCast(e),t=implicitCast(t),(a=R()(this,O()(BinaryOperation).call(this,{a:e,b:t}))).signatureMethods=r,a._signature=getSignature(e,t),a.glsl=n,a.allowedSignature=yt,a.type=Ct[a._signature],a.inlineMaker=function(e){return n(e.a,e.b)},a)}return B()(BinaryOperation,e),_()(BinaryOperation,[{key:"eval",value:function _eval(){if(Number.isFinite(this.a)&&Number.isFinite(this.b))return this.operation(this.a.value,this.b.value);for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Number.isFinite(this.a))return this.operation(this.a.value,this.b.eval(t[0]));if(Number.isFinite(this.b))return this.operation(this.a.eval(t[0]),this.b.value);var n=this._getDependentFeatures(t),a=n.featureA,i=n.featureB,o=this.a.eval(a),s=this.b.eval(i);return this.operation(o,s)}},{key:"getLegendData",value:function getLegendData(e){for(var t=this.a.getLegendData(e),r=this.b.getLegendData(e),n=t.data.length,a=r.data.length,i=[],o=0;o<n;o++)for(var s=0;s<a;s++){var u=this.operation(t.data[o].value,r.data[s].value);i.push({value:u})}return{n:n,m:a,data:i}}},{key:"_getDependentFeatures",value:function _getDependentFeatures(e){var t=e.length>1?{featureA:e[0],featureB:e[1]}:{featureA:e[0],featureB:e[0]};return{featureA:t.featureA,featureB:t.featureB}}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(BinaryOperation.prototype),"_bindMetadata",this).call(this,e);var t=[this.a,this.b],r=t[0],n=t[1];if(this._signature=getSignature(r,n),this._signature===yt||!(this._signature&this.allowedSignature))throw new me("".concat(this.expressionName,"(): invalid parameter types\n'x' type was ").concat(r.type,", 'y' type was ").concat(n.type),_e.INCORRECT_TYPE);this.type=function getReturnTypeFromSignature(e){switch(e){case gt:return"number";case bt:case xt:return"color";case wt:return"number";case kt:return"image";default:return}}(this._signature)}},{key:"value",get:function get(){return this.operation(this.a.value,this.b.value)}},{key:"operation",get:function get(){return this.signatureMethods[this._signature]||this.signatureMethods[gt]}}]),BinaryOperation}(lt);function getSignature(e,t){return e.type&&t.type?"date"===e.type&&"date"===t.type?Tt:"number"===e.type&&"number"===t.type?gt:"number"===e.type&&"color"===t.type?bt:"color"===e.type&&"number"===t.type?bt:"color"===e.type&&"color"===t.type?xt:"category"===e.type&&"category"===t.type?wt:"image"===e.type&&"color"===t.type||"image"===e.type&&"color"===t.type||"image"===e.type&&"image"===t.type||"color"===e.type&&"image"===t.type?kt:yt:void 0}var Mt=function(e){function Add(e,t){var r;p()(this,Add),checkMaxArguments(arguments,2);var n={1:function _(e,t){return e+t},4:_addColors};return(r=R()(this,O()(Add).call(this,e,t,n,function glsl(e,t){return"(".concat(e," + ").concat(t,")")}))).allowedSignature=gt|xt|kt,r}return B()(Add,e),Add}(Et);function _addColors(e,t){return{r:e.r+t.r<255?e.r+t.r:255,g:e.g+t.g<255?e.g+t.g:255,b:e.b+t.b<255?e.b+t.b:255,a:e.a}}var At=function(e){function And(e,t){var r;p()(this,And),checkMaxArguments(arguments,2);var n={1:function _(e,t){return Math.min(e*t,1)}};return e=implicitCast(e),t=implicitCast(t),(r=R()(this,O()(And).call(this,e,t,n,function glsl(e,t){return"min(".concat(e," * ").concat(t,", 1.)")}))).allowedSignature=gt,r}return B()(And,e),And}(Et),St=function(e){function Div(e,t){var r;if(p()(this,Div),checkMaxArguments(arguments,2),Number.isFinite(e)&&Number.isFinite(t))return R()(r,Ca(e/t));var n={1:function _(e,t){return e/t},2:_divNumberColor,4:_divColors};return e=implicitCast(e),t=implicitCast(t),(r=R()(this,O()(Div).call(this,e,t,n,function glsl(e,t){return"(".concat(e," / ").concat(t,")")}))).allowedSignature=gt|bt|xt|kt,r}return B()(Div,e),Div}(Et);function _divColors(e,t){return{r:Math.round(e.r/t.r),g:Math.round(e.g/t.g),b:Math.round(e.b/t.b),a:e.a}}function _divNumberColor(e,t){var r="number"==typeof e?{n:e,color:t}:{n:t,color:e},n=r.n,a=r.color;return{r:Math.round(a.r/n),g:Math.round(a.g/n),b:Math.round(a.b/n),a:a.a}}var It=function(e){function Equals(e,t){var r;p()(this,Equals),checkMaxArguments(arguments,2);return(r=R()(this,O()(Equals).call(this,e,t,{1:function _(e,t){return e===t?1:0},8:function _(e,t){return e===t?1:0}},function glsl(e,t){return"(".concat(e,"==").concat(t,"? 1.:0.)")}))).allowedSignature=gt|wt,r}return B()(Equals,e),Equals}(Et),Pt=function(e){function GreaterThan(e,t){var r;p()(this,GreaterThan),checkMaxArguments(arguments,2);return(r=R()(this,O()(GreaterThan).call(this,e,t,{1:function _(e,t){return e>t?1:0}},function glsl(e,t){return"(".concat(e,">").concat(t,"? 1.:0.)")}))).allowedSignature=gt|Tt,r}return B()(GreaterThan,e),GreaterThan}(Et),Dt=function(e){function GreaterThanOrEqualTo(e,t){var r;p()(this,GreaterThanOrEqualTo),checkMaxArguments(arguments,2);return(r=R()(this,O()(GreaterThanOrEqualTo).call(this,e,t,{1:function _(e,t){return e>=t?1:0}},function glsl(e,t){return"(".concat(e,">=").concat(t,"? 1.:0.)")}))).allowedSignature=gt|Tt,r}return B()(GreaterThanOrEqualTo,e),GreaterThanOrEqualTo}(Et),Nt=function(e){function LessThan(e,t){var r;p()(this,LessThan),checkMaxArguments(arguments,2);return(r=R()(this,O()(LessThan).call(this,e,t,{1:function _(e,t){return e<t?1:0}},function glsl(e,t){return"(".concat(e,"<").concat(t,"? 1.:0.)")}))).allowedSignature=gt|Tt,r}return B()(LessThan,e),LessThan}(Et),Rt=function(e){function LessThanOrEqualTo(e,t){var r;p()(this,LessThanOrEqualTo),checkMaxArguments(arguments,2);return(r=R()(this,O()(LessThanOrEqualTo).call(this,e,t,{1:function _(e,t){return e<=t?1:0}},function glsl(e,t){return"(".concat(e,"<=").concat(t,"? 1.:0.)")}))).allowedSignature=gt|Tt,r}return B()(LessThanOrEqualTo,e),LessThanOrEqualTo}(Et),Ft=function(e){function Mod(e,t){var r;p()(this,Mod),checkMaxArguments(arguments,2);return e=implicitCast(e),t=implicitCast(t),(r=R()(this,O()(Mod).call(this,e,t,{1:function _(e,t){return e%t}},function glsl(e,t){return"mod(".concat(e,", ").concat(t,")")}))).allowedSignature=gt|Tt,r}return B()(Mod,e),Mod}(Et),Ot=function(e){function Mul(e,t){var r;p()(this,Mul),checkMaxArguments(arguments,2);var n={1:function _(e,t){return e*t},2:_mulNumberColor,4:_mulColors};return(r=R()(this,O()(Mul).call(this,e,t,n,function glsl(e,t){return"(".concat(e," * ").concat(t,")")}))).allowedSignature=gt|bt|xt|kt,r}return B()(Mul,e),Mul}(Et);function _mulColors(e,t){return{r:Math.round(e.r*t.r/255),g:Math.round(e.g*t.g/255),b:Math.round(e.b*t.b/255),a:e.a}}function _mulNumberColor(e,t){var r="number"==typeof e?{n:e,color:t}:{n:t,color:e},n=r.n,a=r.color;return{r:Math.round(n*a.r/255),g:Math.round(n*a.g/255),b:Math.round(n*a.b/255),a:a.a}}var Lt=function(e){function NotEquals(e,t){var r;p()(this,NotEquals),checkMaxArguments(arguments,2);return(r=R()(this,O()(NotEquals).call(this,e,t,{1:function _(e,t){return e!==t?1:0},8:function _(e,t){return e!==t?1:0}},function glsl(e,t){return"(".concat(e,"!=").concat(t,"? 1.:0.)")}))).allowedSignature=gt|wt|Tt,r}return B()(NotEquals,e),NotEquals}(Et),zt=function(e){function Or(e,t){var r;p()(this,Or),checkMaxArguments(arguments,2);var n={1:function _(e,t){return Math.min(e+t,1)}};return e=implicitCast(e),t=implicitCast(t),(r=R()(this,O()(Or).call(this,e,t,n,function glsl(e,t){return"min(".concat(e," + ").concat(t,", 1.)")}))).allowedSignature=gt,r}return B()(Or,e),Or}(Et),Bt=function(e){function Pow(e,t){var r;p()(this,Pow),checkMaxArguments(arguments,2);var n={1:function _(e,t){return Math.pow(e,t)}};return(r=R()(this,O()(Pow).call(this,e,t,n,function glsl(e,t){return"pow(".concat(e,", ").concat(t,")")}))).allowedSignature=gt,r}return B()(Pow,e),Pow}(Et),Vt=function(e){function Sub(e,t){var r;p()(this,Sub),checkMaxArguments(arguments,2);var n={1:function _(e,t){return e-t},4:_subColors};return(r=R()(this,O()(Sub).call(this,e,t,n,function glsl(e,t){return"(".concat(e," - ").concat(t,")")}))).allowedSignature=gt|xt|kt,r}return B()(Sub,e),Sub}(Et);function _subColors(e,t){return{r:e.r-t.r>0?e.r-t.r:0,g:e.g-t.g>0?e.g-t.g:0,b:e.b-t.b>0?e.b-t.b:0,a:e.a}}var Gt=function(e){function Blend(e,t,r,n){var a;p()(this,Blend),checkMaxArguments(arguments,4,"blend"),e=implicitCast(e),t=implicitCast(t),r=implicitCast(r),checkExpression("blend","a",0,e),checkExpression("blend","b",1,t),checkExpression("blend","mix",2,r);var i=r;return n&&(r=n(r)),(a=R()(this,O()(Blend).call(this,{a:e,b:t,mix:r}))).originalMix=i,e.type&&t.type&&(a.type=e.type),a.inlineMaker=function(e){return"mix(".concat(e.a,", ").concat(e.b,", clamp(").concat(e.mix,", 0., 1.))")},a}return B()(Blend,e),_()(Blend,[{key:"eval",value:function _eval(e){var t=utils_clamp(this.mix.eval(e),0,1);return utils_mix(this.a.eval(e),this.b.eval(e),t)}},{key:"replaceChild",value:function replaceChild(e,t){e===this.mix&&(this.originalMix=t),dt()(O()(Blend.prototype),"replaceChild",this).call(this,e,t)}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(Blend.prototype),"_bindMetadata",this).call(this,e),function abTypeCheck(e,t){if(e.type!==t.type||!["number","color","image","placement","date"].includes(e.type))throw new me("blend(): invalid parameter types\n\t'a' type was '".concat(e.type,"'\n\t'b' type was '").concat(t.type,"'"),_e.INCORRECT_TYPE)}(this.a,this.b),checkType("blend","mix",2,"number",this.mix),this.type=this.a.type}},{key:"_preDraw",value:function _preDraw(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=dt()(O()(Blend.prototype),"_preDraw",this)).call.apply(e,[this].concat(r)),this.originalMix.isA(ft)&&!this.originalMix.isAnimated()&&this.parent.replaceChild(this,this.b)}},{key:"value",get:function get(){var e=utils_clamp(this.mix.value,0,1);return utils_mix(this.a.value,this.b.value,e)}}]),Blend}(lt);var Ut=r(12),qt=r.n(Ut),jt="DEFAULT_RAMP_OTHERS",Wt=10,Ht=-1,Zt="CARTO_VL_OTHERS",Yt="DESC",Xt={othersLabel:Zt,samples:Wt,order:"ASC"},Qt=-(1<<24),$t=function(){function BucketsGLSLHelper(e){p()(this,BucketsGLSLHelper),this.buckets=e}return _()(BucketsGLSLHelper,[{key:"applyToShaderSource",value:function applyToShaderSource(e){var t=this,r={};this.buckets.childrenNames.map(function(r){return t.buckets[r]._applyToShaderSource(e)}).map(function(e,n){r[t.buckets.childrenNames[n]]=e});var n="buckets".concat(this.buckets._uid),a=this._getComparisons(r),i=this.buckets.list.elems.map(a).join(""),o="float ".concat(n,"(float x){\n            ").concat(i,"\n            return ").concat("category"===this.buckets.input.type?"(-1.)":(this.buckets.numCategories-1).toFixed(20),";\n        }");return{preface:this.buckets._prefaceCode(r.input.preface+r.list.preface+o),inline:"".concat(n,"(").concat(r.input.inline,")")}}},{key:"_getComparisons",value:function _getComparisons(e){var t="category"===this.buckets.input.type?"==":"<",r=this.buckets.numCategoriesWithoutOthers-1||1;return r<=20?function elif(n,a){return"".concat(a>0?"else":""," if (x").concat(t,"(").concat(e.list.inline[a],")){\n                return ").concat(a,"./").concat(r.toFixed(20),";\n            }")}:function elif(n,a){return"if (x".concat(t,"(").concat(e.list.inline[a],")){\n                return ").concat(a,"./").concat(r.toFixed(20),";\n            }")}}}]),BucketsGLSLHelper}(),Jt=function(e){function Buckets(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Zt;p()(this,Buckets),checkMaxArguments(arguments,3,"buckets");var a={input:e=implicitCast(e),list:t=implicitCast(t),othersLabel:n=implicitCast(n)};return(r=R()(this,O()(Buckets).call(this,a))).numCategories=null,r.numCategoriesWithoutOthers=null,r.type="category",r._GLSLhelper=new $t(qt()(qt()(r))),r}return B()(Buckets,e),_()(Buckets,[{key:"eval",value:function _eval(e){var t=this.input.eval(e),r=this.numCategoriesWithoutOthers-1||1;if("category"===this.input.type){for(var n=0;n<this.list.elems.length;n++)if(t===this.list.elems[n].eval(e))return n/r;return Ht}for(var a=0;a<this.list.elems.length;a++)if(t<this.list.elems[a].eval(e))return a/r;return 1}},{key:"_bindMetadata",value:function _bindMetadata(e){var t=this;if(dt()(O()(Buckets.prototype),"_bindMetadata",this).call(this,e),"number"!==this.input.type&&"category"!==this.input.type)throw new me("buckets(): invalid first parameter type\n\t'input' type was ".concat(this.input.type),_e.INCORRECT_TYPE);if(checkType("buckets","list",1,["number-list","category-list"],this.list),checkType("buckets","othersLabel",2,"category",this.othersLabel),checkFeatureIndependent("buckets","othersLabel",2,this.othersLabel),this.list.elems.map(function(e,r){if(t.input.type!==e.type)throw new me("buckets(): invalid ".concat(getOrdinalFromIndex(r+1)," parameter type")+"\n\texpected type was ".concat(t.input.type,"\n\tactual type was ").concat(e.type),_e.INCORRECT_TYPE);if("number"!==e.type&&"category"!==e.type)throw new me("buckets(): invalid ".concat(getOrdinalFromIndex(r+1)," parameter type\n\ttype was ").concat(e.type),_e.INCORRECT_TYPE)}),"category"===this.input.type){var r=e.properties[this.input.propertyName];this._numDatasetCategories=r?r.categories.length:this.list.elems.length-1}this.numCategories=this.list.elems.length+1,this.numCategoriesWithoutOthers="category"===this.input.type?this.numCategories-1:this.numCategories}},{key:"_applyToShaderSource",value:function _applyToShaderSource(e){return this._GLSLhelper.applyToShaderSource(e)}},{key:"getLegendData",value:function getLegendData(e){var t=this.toString(),r=this.list.elems.map(function(e){return e.value}),n={othersLabel:e&&e.othersLabel?e.othersLabel:this.othersLabel.value,order:e?e.order:Yt.ASCENDING};return{data:"number"===this.input.type?function _getLegendDataNumeric(e,t){for(var r=[],n=0;n<=e.length;n++){var a=n-1>=0?e[n-1]:Number.NEGATIVE_INFINITY,i=n<e.length?e[n]:Number.POSITIVE_INFINITY,o=[a,i],s=n/e.length;r.push({key:o,value:s})}t&&t===Yt&&(r=r.sort(function(e,t){return t.key[0]-e.key[0]}));return r}(r,n.sort):function _getLegendDataCategory(e,t,r){var n=e.length-1||1,a=e.map(function(e,t){var r=e,a=t/n;return{key:r,value:a}});t>e.length&&a.push({key:r.othersLabel,value:Ht});r.order&&r.order===Yt&&(a=a.sort(function(e,t){return t.key-e.key}));return a}(r,this._numDatasetCategories,n),name:t}}},{key:"value",get:function get(){return this.eval()}}]),Buckets}(lt);var Kt=function(e){function BaseCategory(e){var t;return p()(this,BaseCategory),checkMaxArguments(arguments,1,"category"),checkString("category","categoryName",0,e),(t=R()(this,O()(BaseCategory).call(this,{})))._value=e,t.type="category",t}return B()(BaseCategory,e),_()(BaseCategory,[{key:"eval",value:function _eval(){return this.value}},{key:"isAnimated",value:function isAnimated(){return!1}},{key:"isPlaying",value:function isPlaying(){return!1}},{key:"_bindMetadata",value:function _bindMetadata(e){this._metadata=e}},{key:"_applyToShaderSource",value:function _applyToShaderSource(){return{preface:this._prefaceCode("uniform float cat".concat(this._uid,";\n")),inline:"cat".concat(this._uid)}}},{key:"_postShaderCompile",value:function _postShaderCompile(e,t){this._getBinding(e).uniformLocation=t.getUniformLocation(e,"cat".concat(this._uid))}},{key:"_preDraw",value:function _preDraw(e,t,r){if(this._metadata){var n=this._metadata.categoryToID.get(this.value);r.uniform1f(this._getBinding(e).uniformLocation,n)}}},{key:"value",get:function get(){return this._value},set:function set(e){this.value=e}}]),BaseCategory}(lt),er=r(19),tr=r.n(er),rr=function(e){function CIELab(e,t,r){var n;return p()(this,CIELab),checkMaxArguments(arguments,3,"cielab"),e=implicitCast(e),t=implicitCast(t),r=implicitCast(r),checkExpression("cielab","l",0,e),checkExpression("cielab","a",1,t),checkExpression("cielab","b",2,r),(n=R()(this,O()(CIELab).call(this,{l:e,a:t,b:r}))).type="color",n._setGenericGLSL(function(e){return"cielabToSRGBA(vec4(".concat(e.l,", ").concat(e.a,", ").concat(e.b,", 1.))")},tr.a),n}return B()(CIELab,e),_()(CIELab,[{key:"eval",value:function _eval(e){return cielabToSRGB({l:this.l.eval(e),a:this.a.eval(e),b:this.b.eval(e)})}},{key:"getLegendData",value:function getLegendData(){return{name:"color",data:[{key:"",value:this.value}]}}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(CIELab.prototype),"_bindMetadata",this).call(this,e),checkType("cielab","l",0,"number",this.l),checkType("cielab","a",1,"number",this.a),checkType("cielab","b",2,"number",this.b)}},{key:"value",get:function get(){return this.eval(null)}}]),CIELab}(lt),nr=r(16),ar=r.n(nr),ir=function(e){function Property(e){var t;if(p()(this,Property),checkMaxArguments(arguments,1,"property"),checkString("property","name",0,e),""===e)throw new me("property(): invalid parameter, zero-length string",_e.INCORRECT_VALUE);return(t=R()(this,O()(Property).call(this,{}))).name=e,t.expressionName=e,dt()(O()(Property.prototype),"_setGenericGLSL",qt()(t)).call(qt()(t),function(e,r){return r(t.name)}),t}return B()(Property,e),_()(Property,[{key:"isFeatureDependent",value:function isFeatureDependent(){return!0}},{key:"eval",value:function _eval(e){if(!e)throw new me("A property needs to be evaluated in a 'feature'.",_e.MISSING_REQUIRED);return e[this.name]&&e[this.name]===Qt?null:e[this.name]}},{key:"toString",value:function toString(){return"$".concat(this.name)}},{key:"_bindMetadata",value:function _bindMetadata(e){var t=e.properties[this.name];if(!t)throw new me("Property '".concat(this.name,"' does not exist"),_e.MISSING_REQUIRED);this._metadata=e,this.type=t.type,"category"===this.type&&void 0===this.numCategories&&Object.defineProperty(this,"numCategories",{get:function get(){return t.categories.length}})}},{key:"_applyToShaderSource",value:function _applyToShaderSource(e){return{preface:"",inline:e(this.name)}}},{key:"_getMinimumNeededSchema",value:function _getMinimumNeededSchema(){var e=this._variableName?Ee:Ce;return ar()({},this.name,[{type:e}])}},{key:"value",get:function get(){return this.propertyName}},{key:"propertyName",get:function get(){return this.name}},{key:"categories",get:function get(){return"category"===this.type?this._metadata.properties[this.name].categories:void 0}}]),Property}(lt),sr=function(e){function ClusterAggregation(e){var t,r=e.property,n=e.expressionName,a=e.aggName,i=e.aggType;return p()(this,ClusterAggregation),checkExpression(n,"property",0,r),(t=R()(this,O()(ClusterAggregation).call(this,{property:r})))._aggName=a,t._expressionName=n,t.type=i,t}return B()(ClusterAggregation,e),_()(ClusterAggregation,[{key:"eval",value:function _eval(e){return e[this.propertyName]}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(ClusterAggregation.prototype),"_bindMetadata",this).call(this,e),this._metadata=e,checkInstance(this._expressionName,"property",0,ir,this.property),checkType(this._expressionName,"property",0,this.type,this.property)}},{key:"_applyToShaderSource",value:function _applyToShaderSource(e){return{preface:"",inline:"".concat(e(this.propertyName))}}},{key:"_postShaderCompile",value:function _postShaderCompile(){}},{key:"_getMinimumNeededSchema",value:function _getMinimumNeededSchema(){return ar()({},this.property.name,[{type:Te,op:this._aggName}])}},{key:"name",get:function get(){return this.property.name}},{key:"propertyName",get:function get(){return Ae.aggColumn(this.property.name,this._aggName)}},{key:"aggName",get:function get(){return this._aggName}},{key:"numCategories",get:function get(){return this.property.numCategories}},{key:"categories",get:function get(){return this.property.categories}},{key:"value",get:function get(){return this.propertyName}}]),ClusterAggregation}(lt),ur=function(e){function ClusterAvg(e){return p()(this,ClusterAvg),checkMaxArguments(arguments,1,"clusterAvg"),R()(this,O()(ClusterAvg).call(this,{property:e,expressionName:"clusterAvg",aggName:"avg",aggType:"number"}))}return B()(ClusterAvg,e),ClusterAvg}(sr),cr=function(e){function ClusterMax(e){return p()(this,ClusterMax),checkMaxArguments(arguments,1,"clusterMax"),R()(this,O()(ClusterMax).call(this,{property:e,expressionName:"clusterMax",aggName:"max",aggType:"number"}))}return B()(ClusterMax,e),ClusterMax}(sr),lr=function(e){function ClusterMin(e){return p()(this,ClusterMin),checkMaxArguments(arguments,1,"clusterMin"),R()(this,O()(ClusterMin).call(this,{property:e,expressionName:"clusterMin",aggName:"min",aggType:"number"}))}return B()(ClusterMin,e),ClusterMin}(sr),fr=function(e){function ClusterMode(e){return p()(this,ClusterMode),checkMaxArguments(arguments,1,"clusterMode"),R()(this,O()(ClusterMode).call(this,{property:e,expressionName:"clusterMode",aggName:"mode",aggType:"category"}))}return B()(ClusterMode,e),ClusterMode}(sr),hr=function(e){function ClusterSum(e){return p()(this,ClusterSum),checkMaxArguments(arguments,1,"clusterSum"),R()(this,O()(ClusterSum).call(this,{property:e,expressionName:"clusterSum",aggName:"sum",aggType:"number"}))}return B()(ClusterSum,e),ClusterSum}(sr),dr=function(e){function ClusterCount(){var e;return p()(this,ClusterCount),checkMaxArguments(arguments,0,"clusterCount"),(e=R()(this,O()(ClusterCount).call(this,{}))).type="number",e._hasClusterFeatureCount=!1,e}return B()(ClusterCount,e),_()(ClusterCount,[{key:"isFeatureDependent",value:function isFeatureDependent(){return!0}},{key:"eval",value:function _eval(e){return Number(e._cdb_feature_count)||1}},{key:"getLegendData",value:function getLegendData(){return{data:this._hasClusterFeatureCount?this._metadata.properties._cdb_feature_count:[]}}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(ClusterCount.prototype),"_bindMetadata",this).call(this,e),this._metadata=e,this._hasClusterFeatureCount=void 0!==e.properties._cdb_feature_count}},{key:"_applyToShaderSource",value:function _applyToShaderSource(e){return{preface:"",inline:this._hasClusterFeatureCount?e("_cdb_feature_count"):"1."}}},{key:"propertyName",get:function get(){return"_cdb_feature_count"}}]),ClusterCount}(lt),pr=["second","minute","hour","day","month","year","week","quarter","trimester","semester","decade","century","millennium"],mr=["dayOfYear","weekOfYear","monthOfYear","quarterOfYear","dayOfMonth","dayOfWeek","hourOfDay","minuteOfHour"],_r=function(e){function clusterTimeDimension(e){var t,r=e.property,n=e.expressionName,a=e.dimension,i=e.type,o=e.range;return p()(this,clusterTimeDimension),checkExpression(n,"property",0,r),(t=R()(this,O()(clusterTimeDimension).call(this,{property:r})))._dimension=a,t._dimension.propertyName=Ae.dimColumn(t.property.propertyName,t._dimension.group.units),t._expressionName=n,t.type=i,t._range=o,t}return B()(clusterTimeDimension,e),_()(clusterTimeDimension,[{key:"eval",value:function _eval(e){return e[this.propertyName]}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(clusterTimeDimension.prototype),"_bindMetadata",this).call(this,e),checkInstance(this._expressionName,"property",0,ir,this.property),checkType(this._expressionName,"property",0,"date",this.property),this._range=e.properties[e.baseName(this.propertyName)].dimension.range}},{key:"_resolveAliases",value:function _resolveAliases(){}},{key:"_applyToShaderSource",value:function _applyToShaderSource(e){return{preface:"",inline:this._range?this._range.map(function(t){return["".concat(e(t))]}):"".concat(e(this.propertyName))}}},{key:"_postShaderCompile",value:function _postShaderCompile(){}},{key:"_getMinimumNeededSchema",value:function _getMinimumNeededSchema(){return ar()({},this.name,[{type:"dimension",dimension:this._dimension,range:!!this._range}])}},{key:"name",get:function get(){return this.property.propertyName}},{key:"propertyName",get:function get(){return this._dimension.propertyName}},{key:"value",get:function get(){return{name:this.propertyName,range:this._range,dimension:this._dimension}}}],[{key:"serialUnits",get:function get(){return pr}},{key:"cyclicUnits",get:function get(){return mr}}]),clusterTimeDimension}(lt),vr=function(e){function ClusterTime(e,t,r){p()(this,ClusterTime);var n=_r.cyclicUnits.includes(t);return checkMaxArguments(arguments,3,"clusterTime"),checkExpression("clusterTime","property",0,e),checkStringValue("clusterTime","units",1,t,n?_r.cyclicUnits:_r.serialUnits),R()(this,O()(ClusterTime).call(this,{property:e,expressionName:"clusterTime",dimension:{group:{units:t,timezone:r},format:n?"number":"iso"},type:n?"number":"timerange",range:n?void 0:[]}))}return B()(ClusterTime,e),_()(ClusterTime,[{key:"converse",value:function converse(e){return e}}]),ClusterTime}(_r),yr=function(e){function Constant(e){var t;return p()(this,Constant),checkMaxArguments(arguments,1,"constant"),checkNumber("constant","x",0,e),(t=R()(this,O()(Constant).call(this,{})))._value=e,t.type="number",t.inlineMaker=function(){return"(".concat(e.toFixed(20),")")},t}return B()(Constant,e),_()(Constant,[{key:"eval",value:function _eval(){return this.value}},{key:"toString",value:function toString(){return"".concat(this.value)}},{key:"value",get:function get(){return this._value},set:function set(e){this._value=e}}]),Constant}(lt),gr=function(e){function Hex(e){var t;p()(this,Hex),checkMaxArguments(arguments,1,"hex"),checkString("hex","hexadecimalColor",0,e),(t=R()(this,O()(Hex).call(this,{}))).type="color";try{t.color=hexToRgb(e)}catch(e){var r=getStringErrorPreface("hex","hexadecimalColor",0);throw new me("".concat(r," \nInvalid hexadecimal color string"),_e.INCORRECT_VALUE)}return t.hexadecimalColor=e,t.inlineMaker=function(){return"vec4(".concat((t.color.r/255).toFixed(4),", ").concat((t.color.g/255).toFixed(4),", ").concat((t.color.b/255).toFixed(4),", ").concat(t.color.a.toFixed(4),")")},t}return B()(Hex,e),_()(Hex,[{key:"toString",value:function toString(){return this.hexadecimalColor}},{key:"eval",value:function _eval(){return this.value}},{key:"getLegendData",value:function getLegendData(){return{name:"color",data:[{key:"",value:this.value}]}}},{key:"value",get:function get(){return this.color}}]),Hex}(lt),br=genHSL("hsl",!1),xr=genHSL("hsla",!0);function genHSL(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(r){function HSLA(r,n,a,i){var o;p()(this,HSLA),checkMaxArguments(arguments,4,"hsla");var s=[r,n,a,i].map(implicitCast),u=g()(s,4);r=u[0],n=u[1],a=u[2],i=u[3];var c={h:r,s:n,l:a};return t&&(checkExpression(e,"a",3,i),c.a=i),checkExpression(e,"h",0,r),checkExpression(e,"s",1,n),checkExpression(e,"l",2,a),(o=R()(this,O()(HSLA).call(this,c)))._alpha=t,o.type="color",o}return B()(HSLA,r),_()(HSLA,[{key:"eval",value:function _eval(e){return function hslToRgb(e,t,r,n,a,i){var o=a?i?n.eval(i):n.value:1,s={r:Math.abs(6*e-3)-1,g:2-Math.abs(6*e-2),b:2-Math.abs(6*e-4),a:o},u=(1-Math.abs(2*r-1))*t;return s.r=utils_clamp(s.r,0,1),s.g=utils_clamp(s.g,0,1),s.b=utils_clamp(s.b,0,1),s.r=255*((s.r-.5)*u+r),s.g=255*((s.g-.5)*u+r),s.b=255*((s.b-.5)*u+r),s}(utils_clamp(normalize(this.h,e,!0),0,1),utils_clamp(normalize(this.s,e),0,1),utils_clamp(normalize(this.l,e),0,1),this.a,this._alpha,e)}},{key:"getLegendData",value:function getLegendData(){return{name:"color",data:[{key:"",value:this.value}]}}},{key:"_bindMetadata",value:function _bindMetadata(e){var t=this;dt()(O()(HSLA.prototype),"_bindMetadata",this).call(this,e),hslCheckType("h",0,this.h),hslCheckType("s",1,this.s),hslCheckType("l",2,this.l),this._alpha&&checkType("hsla","a",3,"number",this.a),dt()(O()(HSLA.prototype),"_setGenericGLSL",this).call(this,function(e){return"vec4(HSLtoRGB(vec3(\n                    ".concat(e.h).concat(normalizeGLSL(t.h,!0),",\n                    clamp(").concat(e.s).concat(normalizeGLSL(t.s),", 0., 1.),\n                    clamp(").concat(e.l).concat(normalizeGLSL(t.l),", 0., 1.)\n                )), ").concat(t._alpha?"clamp(".concat(e.a,", 0., 1.)"):"1.",")")},"\n                    #ifndef HSL2RGB\n                    #define HSL2RGB\n                    vec3 HSLtoRGB(vec3 HSL) {\n                        float R = abs(HSL.x * 6. - 3.) - 1.;\n                        float G = 2. - abs(HSL.x * 6. - 2.);\n                        float B = 2. - abs(HSL.x * 6. - 4.);\n                        float C = (1. - abs(2. * HSL.z - 1.)) * HSL.y;\n                        vec3 RGB = clamp(vec3(R,G,B), 0., 1.);\n                        return (RGB - 0.5) * C + HSL.z;\n                    }\n                    #endif\n                ")}},{key:"value",get:function get(){return this.eval(null)}}]),HSLA}(lt);function hslCheckType(t,r,n){if(checkExpression(e,t,r,n),"number"!==n.type&&"category"!==n.type&&void 0!==n.type)throw new me("".concat(e,"(): invalid parameter\n\t").concat(t," type was: '").concat(n.type,"'"),_e.INCORRECT_TYPE)}function normalize(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=null!==t?e.eval(t):e.value;return"category"===e.type?n/(r?e.numCategories+1:e.numCategories):n}function normalizeGLSL(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"category"===e.type?"/".concat(t?e.numCategories+1:e.numCategories,"."):""}}var wr=genHSV("hsv",!1),kr=genHSV("hsva",!0);function genHSV(e,t){return function(r){function _class(r,n,a,i){var o;p()(this,_class),checkMaxArguments(arguments,t?4:3,e);var s={h:r=implicitCast(r),s:n=implicitCast(n),v:a=implicitCast(a)};return t&&(i=implicitCast(i),checkExpression(e,"a",3,i),s.a=i),checkExpression(e,"h",0,r),checkExpression(e,"s",1,n),checkExpression(e,"v",2,a),(o=R()(this,O()(_class).call(this,s))).type="color",o}return B()(_class,r),_()(_class,[{key:"eval",value:function _eval(e){var r=this,n=function normalize(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"category"===t.type?t.eval(e)/(r?t.numCategories+1:t.numCategories):t.eval(e)};return function hsvToRgb(n,a,i){var o={r:Math.abs(6*n-3)-1,g:2-Math.abs(6*n-2),b:2-Math.abs(6*n-4),a:t?utils_clamp(r.a.eval(e),0,1):1};return o.r=utils_clamp(o.r,0,1),o.g=utils_clamp(o.g,0,1),o.b=utils_clamp(o.b,0,1),o.r=((o.r-1)*a+1)*i*255,o.g=((o.g-1)*a+1)*i*255,o.b=((o.b-1)*a+1)*i*255,o}(utils_clamp(n(this.h,!0),0,1),utils_clamp(n(this.s),0,1),utils_clamp(n(this.v),0,1))}},{key:"getLegendData",value:function getLegendData(){return{name:"color",data:[{key:"",value:this.value}]}}},{key:"_bindMetadata",value:function _bindMetadata(e){var r=this;dt()(O()(_class.prototype),"_bindMetadata",this).call(this,e),hsvCheckType("h",0,this.h),hsvCheckType("s",1,this.s),hsvCheckType("v",2,this.v),t&&checkType("hsva","a",3,"number",this.a);var n=function normalize(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"category"===e.type?"/".concat(t?e.numCategories+1:e.numCategories,"."):""};dt()(O()(_class.prototype),"_setGenericGLSL",this).call(this,function(e){return"vec4(HSVtoRGB(vec3(\n                    ".concat(e.h).concat(n(r.h,!0),",\n                    clamp(").concat(e.s).concat(n(r.s),", 0.,1.),\n                    clamp(").concat(e.v).concat(n(r.v),", 0.,1.)\n                )), ").concat(t?"clamp(".concat(e.a,", 0.,1.)"):"1.",")")},"\n                    #ifndef HSV2RGB\n                    #define HSV2RGB\n                    vec3 HSVtoRGB(vec3 HSV) {\n                        float R = abs(HSV.x * 6. - 3.) - 1.;\n                        float G = 2. - abs(HSV.x * 6. - 2.);\n                        float B = 2. - abs(HSV.x * 6. - 4.);\n                        vec3 RGB = clamp(vec3(R,G,B), 0., 1.);\n                        return ((RGB - 1.) * HSV.y + 1.) * HSV.z;\n                    }\n                    #endif\n                ")}},{key:"value",get:function get(){return this.eval(null)}}]),_class}(lt);function hsvCheckType(t,r,n){if(checkExpression(e,t,r,n),"number"!==n.type&&"category"!==n.type&&void 0!==n.type)throw new me("".concat(e,"(): invalid parameter\n\t").concat(t," type was: '").concat(n.type,"'"),_e.INCORRECT_TYPE)}}var Tr=function(e){function ILinear(){return p()(this,ILinear),R()(this,O()(ILinear).apply(this,arguments))}return B()(ILinear,e),ILinear}(genInterpolator("iLinear",function(e){return e},void 0,function(e){return e})),Cr=function(e){function Cubic(){return p()(this,Cubic),R()(this,O()(Cubic).apply(this,arguments))}return B()(Cubic,e),Cubic}(genInterpolator("cubic",function(e){return"cubicEaseInOut(".concat(e,")")},"\n    #ifndef CUBIC\n    #define CUBIC\n    float cubicEaseInOut(float p){\n        if (p < 0.5) {\n            return 4. * p * p * p;\n        }else {\n            float f = ((2. * p) - 2.);\n            return 0.5 * f * f * f + 1.;\n        }\n    }\n    #endif\n",function(e){return e}));genInterpolator("bounceEaseIn",function(e){return"BounceEaseIn(".concat(e,")")},"\n    #ifndef BOUNCE_EASE_IN\n    #define BOUNCE_EASE_IN\n    float BounceEaseIn_BounceEaseOut(float p)\n    {\n        if(p < 4./11.0)\n        {\n            return (121. * p * p)/16.0;\n        }\n        else if(p < 8./11.0)\n        {\n            return (363./40.0 * p * p) - (99./10.0 * p) + 17./5.0;\n        }\n        else if(p < 9./10.0)\n        {\n            return (4356./361.0 * p * p) - (35442./1805.0 * p) + 16061./1805.0;\n        }\n        else\n        {\n            return (54./5.0 * p * p) - (513./25.0 * p) + 268./25.0;\n        }\n    }\n    float BounceEaseIn(float p)\n    {\n        return 1. - BounceEaseOut(1. - p);\n    }\n    #endif\n\n",function(e){return e});function genInterpolator(e,t,r,n){var a=function(a){function Interpolator(t){return p()(this,Interpolator),checkMaxArguments(arguments,1,e),t=implicitCast(t),R()(this,O()(Interpolator).call(this,{m:t}))}return B()(Interpolator,a),_()(Interpolator,[{key:"eval",value:function _eval(e){return n(this.m.eval(e))}},{key:"_bindMetadata",value:function _bindMetadata(e){if(dt()(O()(Interpolator.prototype),"_bindMetadata",this).call(this,e),"number"!==this.m.type)throw new me("Blending cannot be performed by '".concat(this.m.type,"'"),_e.INCORRECT_TYPE);this.type="number",this._setGenericGLSL(function(e){return t(e.m)},r)}}]),Interpolator}(lt);return a.type="interpolator",a}var Er=function(){function BaseCodec(e,t){p()(this,BaseCodec),e&&t&&(this._baseName=e.baseName(t))}return _()(BaseCodec,[{key:"isRange",value:function isRange(){return!1}},{key:"isIdentity",value:function isIdentity(){return!1}},{key:"sourceToInternal",value:function sourceToInternal(e,t){return t}},{key:"internalToExternal",value:function internalToExternal(e,t){return t}},{key:"externalToSource",value:function externalToSource(e,t){return t}},{key:"sourceToExternal",value:function sourceToExternal(e,t){return this.internalToExternal(e,this.sourceToInternal(e,t))}},{key:"externalToInternal",value:function externalToInternal(e,t){return this.sourceToInternal(e,this.externalToSource(e,t))}},{key:"inlineInternalMatch",value:function inlineInternalMatch(e,t){return"".concat(e)}}]),BaseCodec}(),Mr=function(e){function IdentityCodec(){return p()(this,IdentityCodec),R()(this,O()(IdentityCodec).apply(this,arguments))}return B()(IdentityCodec,e),_()(IdentityCodec,[{key:"isIdentity",value:function isIdentity(){return!0}},{key:"sourceToInternal",value:function sourceToInternal(e,t){return t}},{key:"internalToExternal",value:function internalToExternal(e,t){return t}},{key:"sourceToExternal",value:function sourceToExternal(e,t){return t}},{key:"externalToSource",value:function externalToSource(e,t){return t}},{key:"externalToInternal",value:function externalToInternal(e,t){return t}}]),IdentityCodec}(Er),Ar=function(e){function Linear(e,t,r,n){var a,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Wt;return p()(this,Linear),checkMaxArguments(arguments,5,"linear"),e=implicitCast(e),!t||t instanceof lt||void 0!==r||void 0!==n||(n=t,t=void 0,r=void 0),void 0===t&&void 0===r&&(t=lo(e),r=co(e)),t=implicitCast(t),r=implicitCast(r),i=implicitCast(i),checkExpression("linear","input",0,e),checkExpression("linear","min",1,t),checkExpression("linear","max",2,r),checkExpression("linear","samples",4,i),(a=R()(this,O()(Linear).call(this,{input:e,min:t,max:r}))).type="number",a.samples=i,a._rangeMode=n||"unit",a}return B()(Linear,e),_()(Linear,[{key:"converse",value:function converse(e){if("date"===this.input.type){var t=this.min.value.getTime();return msToDate(e*(this.max.value.getTime()-t)+t)}if("timerange"===this.input.type){var r,n,a=castTimeRange(this.min.value),i=castTimeRange(this.max.value);if(void 0===a||void 0===i)return null;switch(this._rangeMode){case"unit":r=a.startValue,n=i.startValue;break;case"start":case"end":r=a.startValue,n=i.endValue}return K.fromValue(e*(n-r)+r,a.timeZone)}var o=this.min.value;return e*(this.max.value-o)+o}},{key:"limits",value:function limits(){var e,t;if("timerange"===this.input.type)switch(this._rangeMode){case"unit":e=castTimeRange(this.min.value).startValue,t=castTimeRange(this.max.value).startValue;break;case"start":case"end":e=castTimeRange(this.min.value).startValue,t=castTimeRange(this.max.value).endValue}else e=this.min.value,t=this.max.value;return[e,t]}},{key:"eval",value:function _eval(e){if("timerange"===this.input.type){var t;switch(this._rangeMode){case"unit":case"start":t=0;break;case"end":t=1}return(e._dataframe.properties[this._metadata.decodedProperties(this.input.propertyName)[t]][e._index]-this._internalMin)/(this._internalMax-this._internalMin)}var r=this.input.eval(e),n=this._metadata,a=n&&this.input.propertyName?n.codec(this.input.propertyName):new Mr,i=a.externalToInternal(n,this.min.eval(e)),o=a.externalToInternal(n,this.max.eval(e));return(a.externalToInternal(n,r)-i)/(o-i)}},{key:"_bindMetadata",value:function _bindMetadata(e){if(dt()(O()(Linear.prototype),"_bindMetadata",this).call(this,e),this._metadata=e,"timerange"===this.input.type){var t,r,n;switch(this._rangeMode){case"unit":t=0,r=e.codec(this.input.propertyName).externalToInternal(e,this.min.value)[t],n=e.codec(this.input.propertyName).externalToInternal(e,this.max.value)[t];break;case"start":t=0,r=e.codec(this.input.propertyName).externalToInternal(e,this.min.value)[0],n=e.codec(this.input.propertyName).externalToInternal(e,this.max.value)[1];break;case"end":t=1,r=e.codec(this.input.propertyName).externalToInternal(e,this.min.value)[0],n=e.codec(this.input.propertyName).externalToInternal(e,this.max.value)[1]}this._internalMin=r,this._internalMax=n,this.inlineMaker=function(e){return"((".concat(e.input[t],"-(").concat(r.toFixed(20),"))/(").concat((n-r).toFixed(20),"))")}}else{checkType("linear","input",0,["number","date"],this.input),checkType("linear","min",1,["number","date"],this.min),checkType("linear","max",2,["number","date"],this.max),checkType("linear","samples",4,["number"],this.samples);var a=this.input.propertyName&&e.codec(this.input.propertyName);if(!a||a.isIdentity())this.inlineMaker=function(e){return"((".concat(e.input,"-").concat(e.min,")/(").concat(e.max,"-").concat(e.min,"))")};else{var i=a.externalToInternal(e,this.min.value),o=a.externalToInternal(e,this.max.value);this.inlineMaker=function(e){return"((".concat(e.input,"-(").concat(i.toFixed(20),"))/(").concat((o-i).toFixed(20),"))")}}}}},{key:"getLegendData",value:function getLegendData(e){var t=this.min.value,r=this.max.value,n=this.toString();if(t===r)return{min:t,max:r,name:n,data:[]};for(var a=e&&e.samples?e.samples:this.samples,i=1/(a-1),o=[],s=0;o.length<a;s+=i){var u=utils_clamp(s,0,1),c=s*(r-t)+t;o.push({key:c,value:u})}return e.order&&e.order===Yt&&(o=o.sort(function(e,t){return t.key-e.key})),{data:o,min:t,max:r,name:n}}},{key:"value",get:function get(){return{min:this.min,max:this.max,input:this.input.value,range:this._rangeMode,samples:this.samples}}}]),Linear}(lt),Sr=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","transparent","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"],Ir=function(e){function NamedColor(e){var t;if(p()(this,NamedColor),checkMaxArguments(arguments,1,"namedColor"),checkString("namedColor","colorName",0,e),!Sr.includes(e.toLowerCase())){var r=getStringErrorPreface("namedColor","colorName",0);throw new me("".concat(r,"\nInvalid color name:  '").concat(e,"'"),_e.INCORRECT_VALUE)}return(t=R()(this,O()(NamedColor).call(this,{}))).type="color",t.name=e,t.expressionName=e,t.color=function _nameToRGBA(e){if(Pr[e])return Pr[e];var t=document.createElement("div");t.style.backgroundColor=e,document.body.appendChild(t);var r=getComputedStyle(t).backgroundColor;document.body.removeChild(t);var n=/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/.exec(r),a={r:Number(n[1]),g:Number(n[2]),b:Number(n[3]),a:Number(n[4]||1)};return Pr[e]=a,a}(t.name),t.inlineMaker=function(){return"vec4(".concat((t.color.r/255).toFixed(4),", ").concat((t.color.g/255).toFixed(4),", ").concat((t.color.b/255).toFixed(4),", ").concat(t.color.a.toFixed(4),")")},t}return B()(NamedColor,e),_()(NamedColor,[{key:"toString",value:function toString(){return this.expressionName}},{key:"getLegendData",value:function getLegendData(){return{name:"color",data:[{key:"",value:this.color}]}}},{key:"value",get:function get(){return this.color}}]),NamedColor}(lt),Pr={};var Dr=r(17),Nr=r.n(Dr),Rr=function(e){function Now(){var e;return p()(this,Now),checkMaxArguments(arguments,0,"now"),(e=R()(this,O()(Now).call(this,{now:Ca(0)}))).type="number",Nr()(O()(Now.prototype),"inlineMaker",function(e){return e.now},qt()(e),!0),e}return B()(Now,e),_()(Now,[{key:"eval",value:function _eval(){return this.value}},{key:"isAnimated",value:function isAnimated(){return!0}},{key:"isPlaying",value:function isPlaying(){return!0}},{key:"_setTimestamp",value:function _setTimestamp(e){this.now.value=e}},{key:"value",get:function get(){return this.now.value}}]),Now}(lt),Fr=function(e){function BaseNumber(e){var t;return p()(this,BaseNumber),checkMaxArguments(arguments,1,"number"),checkNumber("number","x",0,e),(t=R()(this,O()(BaseNumber).call(this,{})))._value=e,t.type="number",t}return B()(BaseNumber,e),_()(BaseNumber,[{key:"eval",value:function _eval(){return this.value}},{key:"toString",value:function toString(){return"".concat(this.value)}},{key:"isAnimated",value:function isAnimated(){return!1}},{key:"isPlaying",value:function isPlaying(){return!1}},{key:"_applyToShaderSource",value:function _applyToShaderSource(){return{preface:this._prefaceCode("uniform float number".concat(this._uid,";")),inline:"number".concat(this._uid)}}},{key:"_postShaderCompile",value:function _postShaderCompile(e,t){this._getBinding(e).uniformLocation=t.getUniformLocation(e,"number".concat(this._uid))}},{key:"_preDraw",value:function _preDraw(e,t,r){r.uniform1f(this._getBinding(e).uniformLocation,this.value)}},{key:"value",get:function get(){return this._value},set:function set(e){this._value=e}}]),BaseNumber}(lt),Lr=r(14),zr=r.n(Lr),Br=function(e){function Opacity(e,t){var r;return p()(this,Opacity),checkMaxArguments(arguments,2,"opacity"),e=implicitCast(e),t=implicitCast(t),checkExpression("opacity","input",0,e),checkExpression("opacity","alpha",1,t),(r=R()(this,O()(Opacity).call(this,{input:e,alpha:t}))).inlineMaker=function(e){return"vec4((".concat(e.input,").rgb, ").concat(e.alpha,")")},r}return B()(Opacity,e),_()(Opacity,[{key:"eval",value:function _eval(e){var t=this.input.eval(e),r=this.alpha.eval(e);return t.a=r,t}},{key:"getLegendData",value:function getLegendData(e){var t=this.input.getLegendData(e),r=this.alpha.value;if("color"===this.input.type){var n=t.data.map(function(e){var t=e.key,n=e.value;return{key:t,value:{r:n.r,g:n.g,b:n.b,a:r}}});return zr()({},t,{data:n})}var a=t.data;return zr()({},t,{data:a,alpha:r})}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(Opacity.prototype),"_bindMetadata",this).call(this,e),checkType("opacity","input",0,["color","image"],this.input),checkType("opacity","alpha",1,"number",this.alpha),this.type=this.input.type}},{key:"value",get:function get(){var e=this.input.value,t=this.alpha.value;return e.a=t,e}}]),Opacity}(lt),Vr=function(e){function Asc(e){var t;return p()(this,Asc),checkMaxArguments(arguments,1,"asc"),checkExpression("asc","input",0,e=implicitCast(e)),(t=R()(this,O()(Asc).call(this,{input:e}))).type="orderer",t}return B()(Asc,e),_()(Asc,[{key:"eval",value:function _eval(){return this.value}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(Asc.prototype),"_bindMetadata",this).call(this,e),checkInstance("asc","input",0,qr,this.input)}},{key:"value",get:function get(){return"asc"}}]),Asc}(lt),Gr=function(e){function Desc(e){var t;return p()(this,Desc),checkMaxArguments(arguments,1,"desc"),checkExpression("desc","input",0,e=implicitCast(e)),(t=R()(this,O()(Desc).call(this,{input:e}))).type="orderer",t}return B()(Desc,e),_()(Desc,[{key:"eval",value:function _eval(){return this.value}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(Desc.prototype),"_bindMetadata",this).call(this,e),checkInstance("desc","input",0,qr,this.input)}},{key:"value",get:function get(){return"desc"}}]),Desc}(lt),Ur=function(e){function NoOrder(){var e;return p()(this,NoOrder),checkMaxArguments(arguments,0,"noOrder"),(e=R()(this,O()(NoOrder).call(this,{}))).type="orderer",e}return B()(NoOrder,e),_()(NoOrder,[{key:"eval",value:function _eval(){return this.value}},{key:"value",get:function get(){return"noOrder"}}]),NoOrder}(lt),qr=function(e){function Width(){var e;return p()(this,Width),checkMaxArguments(arguments,1,"width"),(e=R()(this,O()(Width).call(this,{}))).type="propertyReference",e}return B()(Width,e),Width}(lt),jr=r(26),Wr=genRGB("rgb",!1),Hr=genRGB("rgba",!0);function genRGB(e,t){return function(r){function RGBA(r,n,a,i){var o;p()(this,RGBA),checkMaxArguments(arguments,4,"rgba");var s=[r,n,a,i].map(implicitCast),u=g()(s,4);r=u[0],n=u[1],a=u[2],i=u[3],checkExpression(e,"r",0,r),checkExpression(e,"g",1,n),checkExpression(e,"b",2,a);var c={r:r,g:n,b:a};return t&&(checkExpression(e,"a",3,i),c.a=i),(o=R()(this,O()(RGBA).call(this,c))).type="color",o.inlineMaker=function(e){return"vec4(".concat(e.r,"/255., ").concat(e.g,"/255., ").concat(e.b,"/255., ").concat(t?e.a:"1.",")")},o}return B()(RGBA,r),_()(RGBA,[{key:"eval",value:function _eval(){return this.value}},{key:"getLegendData",value:function getLegendData(){return{name:"color",data:[{key:"",value:this.value}]}}},{key:"_bindMetadata",value:function _bindMetadata(r){dt()(O()(RGBA.prototype),"_bindMetadata",this).call(this,r),checkType(e,"r",0,"number",this.r),checkType(e,"g",1,"number",this.g),checkType(e,"b",2,"number",this.b),t&&checkType("rgba","a",3,"number",this.a)}},{key:"value",get:function get(){return{r:this.r.value,g:this.g.value,b:this.b.value,a:t?this.a.value:1}}}]),RGBA}(lt)}var Zr=function(e){function Palette(e,t){var r;return p()(this,Palette),(r=R()(this,O()(Palette).call(this,{}))).type="palette",r.childType="color",r.name=e,r.subPalettes=new Proxy(t,{get:function get(e,t){if("symbol"!==h()(t)&&Number.isSafeInteger(Number(t))&&Array.isArray(e[t]))return e[t].map(hexToRgb)}}),r.expressionName=e,r.tags=t.tags,r}return B()(Palette,e),_()(Palette,[{key:"getColors",value:function getColors(e){var t=this._getBestSubPalette(e);return this.isQualitative()?{colors:t,othersColor:t.pop()}:{colors:t,othersColor:null}}},{key:"toString",value:function toString(){return this.expressionName}},{key:"_getBestSubPalette",value:function _getBestSubPalette(e){var t=this.getLongestSubPaletteIndex(),r=this.getSmallestSubPaletteIndex();return!Number.isInteger(e)||e>t?e=t:e<r&&(e=r),l()(this.subPalettes[e]).map(function(e){return new Hr(li(e.r),li(e.g),li(e.b),li(e.a))})}},{key:"getSmallestSubPaletteIndex",value:function getSmallestSubPaletteIndex(){for(var e=this.subPalettes,t=0;t<=20;t++)if(e[t])return t}},{key:"getLongestSubPaletteIndex",value:function getLongestSubPaletteIndex(){for(var e=this.subPalettes,t=20;t>=0;t--)if(e[t])return t}},{key:"isQualitative",value:function isQualitative(){return this.tags.includes("qualitative")}},{key:"isQuantitative",value:function isQuantitative(){return this.tags.includes("quantitative")}}]),Palette}(lt),Yr={};Object.keys(jr).map(function(e){Yr["".concat(e.toUpperCase())]=new Zr(e,jr[e])});var Xr=Yr,Qr=function(e){function ReversePalette(){return p()(this,ReversePalette),R()(this,O()(ReversePalette).apply(this,arguments))}return B()(ReversePalette,e),_()(ReversePalette,[{key:"_bindMetadata",value:function _bindMetadata(e){var t=this;this.type="palette",this.childType="color",this.subPalettes=new Proxy(this.input.subPalettes,{get:function get(e,r){return Number.isFinite(Number(r))&&Array.isArray(e[r])?t._reversePalette(e[r]):e[r]}}),this.tags=this.input.tags}},{key:"getLongestSubPalette",value:function getLongestSubPalette(){return this._reversePalette(this.input.getLongestSubPalette())}},{key:"_reversePalette",value:function _reversePalette(e){if(this.isQualitative()){var t=l()(e),r=t.pop();return l()(t.reverse()).concat([r])}return l()(e).reverse()}}]),ReversePalette}(Zr),$r=function(e){function ReverseList(){return p()(this,ReverseList),R()(this,O()(ReverseList).apply(this,arguments))}return B()(ReverseList,e),_()(ReverseList,[{key:"_bindMetadata",value:function _bindMetadata(e){checkType("reverse","array",0,["number-list","category-list","color-list","date-list","image-list"],this.input),this.type=this.input.type,this.childType=this.input.childType}},{key:"eval",value:function _eval(e){return this.elems.map(function(t){return t.eval(e)})}},{key:"elems",get:function get(){return l()(this.input.elems).reverse()}},{key:"value",get:function get(){return this.elems.map(function(e){return e.value})}}]),ReverseList}(lt),Jr=function(e){function Reverse(e){return p()(this,Reverse),checkMaxArguments(arguments,1,"reverse"),checkExpression("reverse","input",0,e=implicitCast(e)),R()(this,O()(Reverse).call(this,{input:e}))}return B()(Reverse,e),_()(Reverse,[{key:"_bindMetadata",value:function _bindMetadata(e){return dt()(O()(Reverse.prototype),"_bindMetadata",this).call(this,e),"palette"===this.input.type?Object.setPrototypeOf(this,Qr.prototype):Object.setPrototypeOf(this,$r.prototype),this._bindMetadata(e)}}]),Reverse}(lt),Kr=function(){function ClassifierGLSLHelper(e){p()(this,ClassifierGLSLHelper),this.classifier=e}return _()(ClassifierGLSLHelper,[{key:"applyToShaderSource",value:function applyToShaderSource(e){var t=this,r=this.classifier.childrenNames.map(function(r){return t.classifier[r]._applyToShaderSource(e)}),n={};r.map(function(e,r){n[t.classifier.childrenNames[r]]=e.inline});var a="classifier".concat(this.classifier.classifierUID),i=this.classifier.numCategories-1||1,o=this.classifier.breakpoints?this.classifier.breakpoints.map(function elif(e,t){return"".concat(t>0?"else":""," if (x<(").concat(n["arg".concat(t)],")){\n                return ").concat((t/i).toFixed(20),";\n            }")}).join(""):"",s="float ".concat(a,"(float x){\n            ").concat(o,"\n            return 1.;\n        }");return{preface:this.classifier._prefaceCode(r.map(function(e){return e.preface}).reduce(function(e,t){return e+t},"")+s),inline:"".concat(a,"(").concat(n.input,")")}}}]),ClassifierGLSLHelper}(),en=1e3,tn=0,rn=function(e){function Classifier(e){var t;return p()(this,Classifier),(t=R()(this,O()(Classifier).call(this,e))).classifierUID=tn++,t.type="category",t._GLSLhelper=new Kr(qt()(qt()(t))),t}return B()(Classifier,e),_()(Classifier,[{key:"eval",value:function _eval(e){var t=this.input.eval(e),r=this.breakpoints.findIndex(function(e){return t<=e.value}),n=this.numCategories-1||1;return-1===r?1:r/n}},{key:"toString",value:function toString(){return"".concat(this.expressionName,"(").concat(this.input.toString(),", ").concat(this.numCategories,")")}},{key:"_resolveAliases",value:function _resolveAliases(e){dt()(O()(Classifier.prototype),"_resolveAliases",this).call(this,e),this._bucketsInitialization()}},{key:"_bucketsInitialization",value:function _bucketsInitialization(){this._validateBucketsIsProperNumber();var e=this.buckets.value;this.numCategories=e,this.numCategoriesWithoutOthers=e,this._initBreakpointsChildren(e)}},{key:"_initBreakpointsChildren",value:function _initBreakpointsChildren(e){this.breakpoints=this._breakpointsWithZeros(e);var t=this.breakpoints.reduce(function(e,t,r){return e["arg".concat(r)]=t,e},{});this._initializeChildren(t)}},{key:"_breakpointsWithZeros",value:function _breakpointsWithZeros(e){for(var t=[],r=0;r<e-1;r++)t.push(Ca(0));return t}},{key:"_validateBucketsIsProperNumber",value:function _validateBucketsIsProperNumber(){var e=this.buckets.value;if(checkNumber(this.expressionName,"buckets",1,e),e<=1)throw new me("The number of 'buckets' must be >=2, but ".concat(e," was used"),_e.INCORRECT_VALUE)}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(Classifier.prototype),"_bindMetadata",this).call(this,e),this._validateInputIsNumericProperty()}},{key:"_validateInputIsNumericProperty",value:function _validateInputIsNumericProperty(){checkType(this.expressionName,"input",0,"number",this.input)}},{key:"_getBreakpointList",value:function _getBreakpointList(){return this._genBreakpoints(),this.breakpoints.map(function(e){return e.value})}},{key:"_genBreakpoints",value:function _genBreakpoints(){}},{key:"_applyToShaderSource",value:function _applyToShaderSource(e){return this._GLSLhelper?this._GLSLhelper.applyToShaderSource(e):null}},{key:"_preDraw",value:function _preDraw(e,t,r){this._genBreakpoints(),dt()(O()(Classifier.prototype),"_preDraw",this).call(this,e,t,r)}},{key:"getLegendData",value:function getLegendData(){for(var e=this._getBreakpointList(),t=e.length,r=this.min.value,n=this.max.value,a=[],i=0;i<=t;i++){var o=[0===e[i-1]?0:e[i-1]||r,0===e[i]?0:e[i]||n],s=i/t;a.push({key:o,value:s})}return{name:this.toString(),data:a}}},{key:"value",get:function get(){return this.eval()}}]),Classifier}(lt),nn=function(e){function GlobalEqIntervals(e,t){return p()(this,GlobalEqIntervals),checkExactNumberOfArguments(arguments,2,"globalEqIntervals"),R()(this,O()(GlobalEqIntervals).call(this,{input:e,buckets:t}))}return B()(GlobalEqIntervals,e),_()(GlobalEqIntervals,[{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(GlobalEqIntervals.prototype),"_bindMetadata",this).call(this,e),this._updateBreakpointsWith(e)}},{key:"_updateBreakpointsWith",value:function _updateBreakpointsWith(e){var t=this;if("_cdb_feature_count"===this.input.propertyName)throw new me("'clusterCount' can not be used in GlobalEqIntervals. Consider using ViewportEqIntervals instead",_e.INCORRECT_TYPE);var r=this.input.name,n=e.stats(r),a=n.min,i=n.max;this.min=Ca(a),this.max=Ca(i),this.breakpoints.map(function(e,r){var n=(r+1)/t.numCategories;e.value=a+(i-a)*n})}}]),GlobalEqIntervals}(rn),an=function(e){function GlobalQuantiles(e,t){return p()(this,GlobalQuantiles),checkExactNumberOfArguments(arguments,2,"globalQuantiles"),R()(this,O()(GlobalQuantiles).call(this,{input:e,buckets:t}))}return B()(GlobalQuantiles,e),_()(GlobalQuantiles,[{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(GlobalQuantiles.prototype),"_bindMetadata",this).call(this,e),checkType("globalQuantiles","input",0,"number",this.input),this._updateBreakpointsWith(e)}},{key:"_validateInputIsNumericProperty",value:function _validateInputIsNumericProperty(){}},{key:"_updateBreakpointsWith",value:function _updateBreakpointsWith(e){var t=this;if("_cdb_feature_count"===this.input.propertyName)throw new me("'clusterCount' can not be used in GlobalQuantiles. Consider using ViewportQuantiles instead",_e.INCORRECT_TYPE);var r=this.input.name,n=e.stats(r),a=n.min,i=n.max,o=e.sample.map(function(e){return e[r]});this.min=Ca(a),this.max=Ca(i),o.sort(function(e,t){return e-t}),this.breakpoints=this.breakpoints.map(function(e,r){var n=(r+1)/t.numCategories;return e.value=o[Math.floor(n*o.length)],e})}}]),GlobalQuantiles}(rn),sn=function(e){function GlobalStandardDev(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return p()(this,GlobalStandardDev),checkMinArguments(arguments,2,"globalStandardDev"),checkMaxArguments(arguments,3,"globalStandardDev"),R()(this,O()(GlobalStandardDev).call(this,{input:e,buckets:t,_classSize:r}))}return B()(GlobalStandardDev,e),_()(GlobalStandardDev,[{key:"_resolveAliases",value:function _resolveAliases(e){dt()(O()(GlobalStandardDev.prototype),"_resolveAliases",this).call(this,e),this._validateClassSizeIsProperNumber()}},{key:"_validateClassSizeIsProperNumber",value:function _validateClassSizeIsProperNumber(){var e=this._classSize.value;if(checkNumber(this.expressionName,"classSize",2,e),e<=0)throw new me("The 'classSize' must be > 0.0, but ".concat(e," was used."),_e.INCORRECT_VALUE)}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(GlobalStandardDev.prototype),"_bindMetadata",this).call(this,e),this._updateBreakpointsWith(e)}},{key:"_updateBreakpointsWith",value:function _updateBreakpointsWith(e){if("_cdb_feature_count"===this.input.propertyName)throw new me("'clusterCount' can not be used in GlobalStandardDev. Consider using ViewportStandardDev instead",_e.INCORRECT_TYPE);var t=this.input.name,r=e.sample.map(function(e){return e[t]}),n=pe(r),a=function standardDeviation(e){var t=pe(e),r=pe(function variance(e,t){for(var r=[],n=0;n<e.length;n++){var a=e[n]-t;r.push(a*a)}return r}(e,t));return Math.sqrt(r)}(r),i=e.stats(t),o=i.min,s=i.max;this.min=Ca(o),this.max=Ca(s);var u=calculateBreakpoints(n,a,this.numCategories,this._classSize.value);this.breakpoints.forEach(function(e,t){e.value=u[t]})}}]),GlobalStandardDev}(rn);function calculateBreakpoints(e,t,r,n){if(0===t||isNaN(t))throw new Pe("There is no Standard Deviation, not possible to compute ".concat(r," buckets (just one feature or maybe all share the same value...?)"),De.NOT_SUPPORTED);var a,i=[],o=[],s=r%2==0?0:1;do{var u=s*(t*n);i.push(e+u),o.push(e-u),(a=l()(new Set(i.concat(o)))).sort(function(e,t){return e-t}),s++}while(a.length<r-1);return a}var un=function(e){function ViewportEqIntervals(e,t){return p()(this,ViewportEqIntervals),checkExactNumberOfArguments(arguments,2,"viewportEqIntervals"),R()(this,O()(ViewportEqIntervals).call(this,{input:e,buckets:t}))}return B()(ViewportEqIntervals,e),_()(ViewportEqIntervals,[{key:"_resolveAliases",value:function _resolveAliases(e){dt()(O()(ViewportEqIntervals.prototype),"_resolveAliases",this).call(this,e),this._minMaxInitialization()}},{key:"_minMaxInitialization",value:function _minMaxInitialization(){var e=this.input,t={min:ro(e),max:to(e)};this._initializeChildren(t)}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(ViewportEqIntervals.prototype),"_bindMetadata",this).call(this,e),checkType("viewportEqIntervals","input",0,"number",this.input)}},{key:"_validateInputIsNumericProperty",value:function _validateInputIsNumericProperty(){}},{key:"_genBreakpoints",value:function _genBreakpoints(){var e=this,t=this.min.value,r=this.max.value;this.breakpoints.map(function(n,a){var i=(a+1)/e.numCategories;n.value=t+(r-t)*i})}}]),ViewportEqIntervals}(rn),cn=function(e){function ViewportQuantiles(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:en;return p()(this,ViewportQuantiles),checkMinArguments(arguments,2,"viewportQuantiles"),checkMaxArguments(arguments,3,"viewportQuantiles"),e=implicitCast(e),R()(this,O()(ViewportQuantiles).call(this,{input:e,buckets:t,_histogramSize:r}))}return B()(ViewportQuantiles,e),_()(ViewportQuantiles,[{key:"_resolveAliases",value:function _resolveAliases(e){dt()(O()(ViewportQuantiles.prototype),"_resolveAliases",this).call(this,e),this._histogramInitialization()}},{key:"_histogramInitialization",value:function _histogramInitialization(){this._validateHistogramSizeIsProperNumber();var e=this.input,t=this._histogramSize.value,r={min:ro(e),max:to(e),_histogram:oo(e,t)};this._initializeChildren(r)}},{key:"_validateHistogramSizeIsProperNumber",value:function _validateHistogramSizeIsProperNumber(){var e=this._histogramSize.value;if(checkNumber(this.expressionName,"histogramSize",2,e),e<=0)throw new me("The 'histogramSize' must be > 0, but ".concat(e," was used"),_e.INCORRECT_VALUE)}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(ViewportQuantiles.prototype),"_bindMetadata",this).call(this,e),checkType("viewportQuantiles","input",0,"number",this.input)}},{key:"_validateInputIsNumericProperty",value:function _validateInputIsNumericProperty(){}},{key:"_genBreakpoints",value:function _genBreakpoints(){var e=this._histogram.value;if(e){var t=this._getAccumHistogramFrom(e),r=this._getMinMaxFrom(e),n=g()(r,2),a=n[0],i=n[1];this._updateBreakpointsWith({accumHistogram:t,min:a,max:i})}}},{key:"_updateBreakpointsWith",value:function _updateBreakpointsWith(e){var t=this,r=e.accumHistogram,n=e.min,a=e.max,i=r.length,o=0,s=r[i-1];this.breakpoints.map(function(e,u){for(;o<i&&!(r[o]>(u+1)/t.numCategories*s);o++);var c=o/i*(a-n)+n;e.value=c})}},{key:"_getAccumHistogramFrom",value:function _getAccumHistogramFrom(e){var t=0;return e.map(function(e){var r=e.y;return t+=r})}},{key:"_getMinMaxFrom",value:function _getMinMaxFrom(e){return[e[0].x[0],e[e.length-1].x[1]]}}]),ViewportQuantiles}(rn),ln=function(e){function ViewportStandardDev(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:en;return p()(this,ViewportStandardDev),checkMinArguments(arguments,2,"viewportStandardDev"),checkMaxArguments(arguments,4,"viewportStandardDev"),R()(this,O()(ViewportStandardDev).call(this,{input:e,buckets:t,_classSize:r,_histogramSize:n}))}return B()(ViewportStandardDev,e),_()(ViewportStandardDev,[{key:"_resolveAliases",value:function _resolveAliases(e){dt()(O()(ViewportStandardDev.prototype),"_resolveAliases",this).call(this,e),this._validateClassSizeIsProperNumber(),this._histogramInitialization()}},{key:"_histogramInitialization",value:function _histogramInitialization(){this._validateHistogramSizeIsProperNumber();var e=this.input,t=this._histogramSize.value,r={min:ro(e),max:to(e),_histogram:oo(e,t)};this._initializeChildren(r)}},{key:"_validateClassSizeIsProperNumber",value:function _validateClassSizeIsProperNumber(){var e=this._classSize.value;if(checkNumber(this.expressionName,"classSize",2,e),e<=0)throw new me("The 'classSize' must be > 0.0, but ".concat(e," was used."),_e.INCORRECT_VALUE)}},{key:"_validateHistogramSizeIsProperNumber",value:function _validateHistogramSizeIsProperNumber(){var e=this._histogramSize.value;if(checkNumber(this.expressionName,"histogramSize",3,e),e<=0)throw new me("The 'histogramSize' must be > 0, but ".concat(e," was used"),_e.INCORRECT_VALUE)}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(ViewportStandardDev.prototype),"_bindMetadata",this).call(this,e),checkType("viewportStandardDev","input",0,"number",this.input)}},{key:"_validateInputIsNumericProperty",value:function _validateInputIsNumericProperty(){}},{key:"_genBreakpoints",value:function _genBreakpoints(){var e=this._histogram.value;if(void 0!==e){var t=this._getAverageFrom(e),r=this._getStandardDevFrom(e,t);this._updateBreakpointsWith({avg:t,stdev:r})}}},{key:"_updateBreakpointsWith",value:function _updateBreakpointsWith(e){var t=calculateBreakpoints(e.avg,e.stdev,this.numCategories,this._classSize.value);this.breakpoints.forEach(function(e,r){e.value=t[r]})}},{key:"_getAverageFrom",value:function _getAverageFrom(e){var t=0,r=0;return e.forEach(function(e){var n=e.x,a=e.y;t+=a;var i=(n[0]+n[1])/2;r+=i*a}),r/t}},{key:"_getStandardDevFrom",value:function _getStandardDevFrom(e,t){var r=0,n=0;e.forEach(function(e){var a=e.x,i=e.y;r+=i;var o=(a[0]+a[1])/2-t;n+=i*o*o});var a=n/r;return Math.sqrt(a)}}]),ViewportStandardDev}(rn),fn="https://libs.cartocdn.com/carto-vl/assets/symbols",hn={bicycle:"".concat(fn,"/bicycle.svg"),building:"".concat(fn,"/building.svg"),bus:"".concat(fn,"/bus.svg"),car:"".concat(fn,"/car.svg"),circle:"".concat(fn,"/circle.svg"),circleOutline:"".concat(fn,"/circleOutline.svg"),cross:"".concat(fn,"/cross.svg"),house:"".concat(fn,"/house.svg"),flag:"".concat(fn,"/flag.svg"),marker:"".concat(fn,"/marker.svg"),markerOutline:"".concat(fn,"/markerOutline.svg"),plus:"".concat(fn,"/plus.svg"),square:"".concat(fn,"/square.svg"),squareOutline:"".concat(fn,"/squareOutline.svg"),star:"".concat(fn,"/star.svg"),starOutline:"".concat(fn,"/starOutline.svg"),triangle:"".concat(fn,"/triangle.svg"),triangleOutline:"".concat(fn,"/triangleOutline.svg")},dn=256,pn=function(e){function CategoryIndex(e){var t;return p()(this,CategoryIndex),checkMaxArguments(arguments,1,"categoryIndex"),checkExpression("categoryIndex","property",0,e=implicitCast(e)),(t=R()(this,O()(CategoryIndex).call(this,{property:e})))._numTranslatedCategories=null,t.type="category",t._translatePixels=new Float32Array(dn*dn),t._translateArray=[],t._numTranslatedCategories=0,t._numTranslatedCategoriesGL=0,t}return B()(CategoryIndex,e),_()(CategoryIndex,[{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(CategoryIndex.prototype),"_bindMetadata",this).call(this,e),checkType("categoryIndex","property",0,"category",this.property),this._metadata=e,this._calcTranslated()}},{key:"eval",value:function _eval(e){var t=this.property.eval(e),r=this._metadata.categoryToID.get(t);return this._translateArray[r]}},{key:"_preDraw",value:function _preDraw(e,t,r){r.activeTexture(r.TEXTURE0+t.freeTexUnit),this._numTranslatedCategoriesGL!==this.numCategories?(this._numTranslatedCategoriesGL=this.numCategories,this._calcTranslated(),this._translateTexture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this._translateTexture),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,dn,dn,0,r.ALPHA,r.FLOAT,this._translatePixels),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)):r.bindTexture(r.TEXTURE_2D,this._translateTexture),r.uniform1i(this._getBinding(e).texRampTranslateLoc,t.freeTexUnit),t.freeTexUnit++}},{key:"_applyToShaderSource",value:function _applyToShaderSource(e){var t=dn.toFixed(20),r=this.property._applyToShaderSource(e);return{inline:"ramp_translate".concat(this._uid,"(").concat(r.inline,")"),preface:"\n                    uniform sampler2D texRampTranslate".concat(this._uid,";\n                    float ramp_translate").concat(this._uid,"(float s){\n                        vec2 v = vec2(mod(s, ").concat(t,"), floor(s / ").concat(t,"));\n                        return texture2D(texRampTranslate").concat(this._uid,", v/").concat(t,").a;\n                    }")}}},{key:"_postShaderCompile",value:function _postShaderCompile(e,t){this._getBinding(e).texRampTranslateLoc=t.getUniformLocation(e,"texRampTranslate".concat(this._uid))}},{key:"_calcTranslated",value:function _calcTranslated(){var e=this.numCategories;if(this._numTranslatedCategories!==e){this._numTranslatedCategories=e;for(var t=0;t<e;t++){var r=this._metadata.categoryToID.get(this.metaColumn.categories[t].name),n=t/(e-1),a={x:r%dn,y:Math.floor(r/dn)};this._translatePixels[dn*a.y+a.x]=n,this._translateArray.push(n)}}}},{key:"getLegendData",value:function getLegendData(e){for(var t=this._metadata.properties[this.property.propertyName].categories,r=t.length,n=r-1,a=[],i=0;i<r;i++){var o=t[i].name,s=i/n;a.push({key:o,value:s})}return e.order&&e.order===Yt&&(a=a.sort(function(e,t){return t.key-e.key})),{data:a}}},{key:"numCategories",get:function get(){return this.metaColumn.categories.length}},{key:"metaColumn",get:function get(){var e=this.property.propertyName;return this._metadata.properties[e]?this._metadata.properties[e]:this._metadata.properties[this.property.name]}},{key:"numCategoriesWithoutOthers",get:function get(){return this.numCategories}},{key:"value",get:function get(){return this.eval()}}]),CategoryIndex}(lt),mn=function(e){function ListImage(){return p()(this,ListImage),R()(this,O()(ListImage).apply(this,arguments))}return B()(ListImage,e),_()(ListImage,[{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(ListImage.prototype),"_bindMetadata",this).call(this,e),this.numImages=this.elems.length,this._getChildren().forEach(function(e,t){return checkType("imageArray","imageArray[".concat(t,"]"),0,"image",e)})}},{key:"eval",value:function _eval(e){return this.elems.map(function(t){return t.eval(e)})}},{key:"_applyToShaderSource",value:function _applyToShaderSource(){return{preface:this._prefaceCode("\n                uniform sampler2D atlas".concat(this._uid,";\n\n                vec4 atlas").concat(this._uid,"Fn(vec2 imageUV, float category) {\n                    return texture2D(atlas").concat(this._uid,", imageUV/16. + vec2(mod(category, 16.), floor(category/16.))/16. ).rgba;\n                }\n            ")),inline:"atlas".concat(this._uid,"Fn")}}},{key:"_postShaderCompile",value:function _postShaderCompile(e,t){this._getBinding(e).texLoc=t.getUniformLocation(e,"atlas".concat(this._uid))}},{key:"_preDraw",value:function _preDraw(e,t,r){this.init=!0;for(var n=0;n<this.numImages;n++){var a=this["image-".concat(n)];this.init=this.init&&a.canvas}if(this.init&&!this.texture){r.activeTexture(r.TEXTURE0+t.freeTexUnit),this.texture=r.createTexture(),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.bindTexture(r.TEXTURE_2D,this.texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,4096,4096,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);for(var i=0,o=0,s=0;s<this.numImages;s++){var u=this["image-".concat(s)];r.texSubImage2D(r.TEXTURE_2D,0,i,o,r.RGBA,r.UNSIGNED_BYTE,u.canvas),(i+=256)+256>4096&&(i=0,o+=256)}r.generateMipmap(r.TEXTURE_2D)}this.texture&&(r.activeTexture(r.TEXTURE0+t.freeTexUnit),r.bindTexture(r.TEXTURE_2D,this.texture),r.uniform1i(this._getBinding(e).texLoc,t.freeTexUnit),t.freeTexUnit++)}}]),ListImage}(lt),_n=function(e){function Image(e){var t;return p()(this,Image),checkMaxArguments(arguments,1,"image"),checkString("image","url",0,e),(t=R()(this,O()(Image).call(this,{}))).type="image",t.canvas=null,t.url=e,t._promise=new Promise(function(e,r){t.image=new window.Image,t.image.onload=function(){t.canvas=function _getCanvasFromImage(e){var t=document.createElement("canvas");t.width=256,t.height=256;var r=t.getContext("2d"),n=Math.max(e.width,e.height),a=e.width/n*256,i=e.height/n*256;return r.drawImage(e,(256-a)/2,(256-i)/2,a,i),t}(t.image),t.image=null,e()},t.image.onerror=r,t.image.crossOrigin="anonymous",t.image.src=t.url}),t}return B()(Image,e),_()(Image,[{key:"loadImages",value:function loadImages(){return this.count=this.count+1||1,this._promise}},{key:"keepDefaultsOnBlend",value:function keepDefaultsOnBlend(){this.default&&this.parent.color.default&&(this.parent.color=noOverrideColor())}},{key:"eval",value:function _eval(){return this.value}},{key:"getLegendData",value:function getLegendData(e){return{name:"image",data:[{key:"url",value:this.url}]}}},{key:"_free",value:function _free(e){this.texture&&e.deleteTexture(this.texture)}},{key:"_applyToShaderSource",value:function _applyToShaderSource(){return{preface:this._prefaceCode("uniform sampler2D texSprite".concat(this._uid,";")),inline:"texture2D(texSprite".concat(this._uid,", imageUV).rgba")}}},{key:"_postShaderCompile",value:function _postShaderCompile(e,t){this._getBinding(e)._texLoc=t.getUniformLocation(e,"texSprite".concat(this._uid))}},{key:"_preDraw",value:function _preDraw(e,t,r){!this.init&&this.canvas&&(this.init=!0,r.activeTexture(r.TEXTURE0+t.freeTexUnit),this.texture=r.createTexture(),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.bindTexture(r.TEXTURE_2D,this.texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,this.canvas),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.generateMipmap(r.TEXTURE_2D),this.canvas=null),this.texture&&(r.activeTexture(r.TEXTURE0+t.freeTexUnit),r.bindTexture(r.TEXTURE_2D,this.texture),r.uniform1i(this._getBinding(e)._texLoc,t.freeTexUnit),t.freeTexUnit++)}},{key:"value",get:function get(){return this.url}}]),Image}(lt);var vn=new _n(hn.circle),yn=function(e){function RampImage(){return p()(this,RampImage),R()(this,O()(RampImage).apply(this,arguments))}return B()(RampImage,e),_()(RampImage,[{key:"_bindMetadata",value:function _bindMetadata(e){lt.prototype._bindMetadata.call(this,e),this.type=this.palette.childType,checkType("ramp","input",0,"category",this.input),checkInstance("ramp","palette",1,mn,this.palette),this.others===jt?this.others=vn:checkType("ramp","others",2,"image",this.others),this.input.isA(ir)&&(this.input=new pn(this.input),this.input._bindMetadata(e)),this.others._bindMetadata(e),this.childrenNames.push("others")}},{key:"eval",value:function _eval(e){var t=this.input.eval(e);return this._calcEval(t)}},{key:"_calcEval",value:function _calcEval(e){var t=Math.round(e*(this.input.numCategoriesWithoutOthers-1));return this.palette.eval()[t]||this.others.eval()}},{key:"getLegendData",value:function getLegendData(e){var t=this,r=this.input.type,n=this.input.getLegendData(e),a=n.data.map(function(e){var r=e.key,n=e.value;return{key:r,value:n=t._calcEval(n)}});return e&&e.order&&e.order===Yt&&(a=a.sort(function(e,t){return t.key-e.key})),zr()({type:r},n,{data:a})}},{key:"_applyToShaderSource",value:function _applyToShaderSource(e){var t=this.input._applyToShaderSource(e),r=this.palette._applyToShaderSource(e),n=this.others._applyToShaderSource(e);return{preface:this._prefaceCode("\n                uniform float rampImageMultiplier".concat(this._uid,";\n\n                ").concat(t.preface,"\n                ").concat(r.preface,"\n                ").concat(n.preface,"\n\n                vec4 rampImage").concat(this._uid,"(vec2 imageUV, float index){\n                    if (index == ").concat("(-1.)","){\n                        return ").concat(n.inline,";\n                    }\n                    return ").concat(r.inline,"(imageUV, rampImageMultiplier").concat(this._uid,"*index);\n                }\n            ")),inline:"rampImage".concat(this._uid,"(imageUV, ").concat(t.inline,")")}}},{key:"_postShaderCompile",value:function _postShaderCompile(e,t){dt()(O()(RampImage.prototype),"_postShaderCompile",this).call(this,e,t),this._getBinding(e)._multiplierLoc=t.getUniformLocation(e,"rampImageMultiplier".concat(this._uid))}},{key:"_preDraw",value:function _preDraw(e,t,r){dt()(O()(RampImage.prototype),"_preDraw",this).call(this,e,t,r),r.uniform1f(this._getBinding(e)._multiplierLoc,this.input.numCategoriesWithoutOthers-1)}},{key:"value",get:function get(){return this.eval()}}]),RampImage}(lt),gn=function(e){function RampGeneric(){return p()(this,RampGeneric),R()(this,O()(RampGeneric).apply(this,arguments))}return B()(RampGeneric,e),_()(RampGeneric,[{key:"_bindMetadata",value:function _bindMetadata(e){var t=new yr(1),r=new Ir("gray");dt()(O()(RampGeneric.prototype),"_bindMetadata",this).call(this,e),this.type=this.palette.childType,this.others===jt?(this.others="number-list"===this.palette.type?t:r,this.others._bindMetadata(e)):(this.others._bindMetadata(e),checkType("ramp","others",2,this.palette.childType,this.others)),(this.input.isA(ir)||this.input.isA(sr))&&(this.input="number"===this.input.type?new Ar(this.input):new pn(this.input),this.input._bindMetadata(e)),checkType("ramp","input",0,["number","category"],this.input),this.childrenNames.push("others"),this._metadata=e}},{key:"eval",value:function _eval(e){var t=this.input.eval(e);return this._calcEval(t,e)}},{key:"_calcEval",value:function _calcEval(e,t){var r=this._getPalette(),n=r.palette,a=r.others,i=this.palette.isA(Zr)?n.map(function(e){return e.eval(t)}):this.palette.eval(t);if(e===Ht)return a.eval(t);var o=i.length-1,s=Math.floor(e*o),u=Math.ceil(e*o),c=utils_clamp(s,0,o),l=utils_clamp(u,0,o),f=function fract(e){return e-Math.floor(e)}(e*o);return utils_mix(i[c],i[l],f)}},{key:"getLegendData",value:function getLegendData(e){var t=this,r=Object.assign({},Xt,e),n=this.input.type,a=this.input.getLegendData(r),i=a.data.map(function(e){var r=e.key,n=e.value;return{key:r,value:n=t._calcEval(n,void 0)}});return r.order&&r.order===Yt&&(i=function _checkBuckets(e){return e[0]&&(Array.isArray(e[0].key)||"number"==typeof e[0].key)}(i)?function _sortNumericValues(e,t){if(Array.isArray(e[0].key))return t===Yt?e.sort(function(e,t){return t.key[0]-e.key[0]}):e;return t===Yt?e.sort(function(e,t){return t.key-e.key}):e}(i,r.order):function _sortCategoricalValues(e,t){return t===Yt?e.sort(function(e,t){return t.key.localeCompare(e.key)}):e.sort(function(e,t){return e.key.localeCompare(t.key)})}(i,r.order)),zr()({type:n},a,{data:i})}},{key:"_applyToShaderSource",value:function _applyToShaderSource(e){var t=this.input._applyToShaderSource(e),r=this._getPalette(),n=r.palette,a=r.others,i=n.map(function(t){return t._applyToShaderSource(e)}),o=a._applyToShaderSource(e),s="number-list"===this.palette.type?function _getInlineGLSLBlend(e){return _generateGLSLBlend(e.map(function(e){return e.inline}))}(i):function _getInlineColorGLSLBlend(e){return"cielabToSRGBA(".concat(_generateGLSLBlend(e.map(function(e){return"sRGBAToCieLAB(".concat(e.inline,")")})),")")}(i),u="number-list"===this.palette.type?"float":"vec4",c="ramp_color".concat(this._uid,"(").concat(t.inline,")");return{preface:this._prefaceCode("\n            ".concat(t.preface,"\n            ").concat(tr.a,"\n            ").concat(i.map(function(e){return e.preface}).join("\n"),"\n            ").concat(o.preface,"\n\n            ").concat(u," ramp_color").concat(this._uid,"(float x){\n                return x==").concat("(-1.)","\n                    ? ").concat(o.inline,"\n                    : ").concat(s,";\n            }")),inline:c}}},{key:"_getPalette",value:function _getPalette(){return this.palette.isA(Zr)?this._getColorPalette():{palette:this.palette.elems,others:this.others}}},{key:"_getColorPalette",value:function _getColorPalette(){var e=this.palette.getColors(this.input.numCategoriesWithoutOthers);return{palette:e.colors,others:this._defaultOthers&&e.othersColor?e.othersColor:this.others}}},{key:"value",get:function get(){return this.eval()}}]),RampGeneric}(lt);function _generateGLSLBlend(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=e[t];return t===e.length-1?r:function _mixClampGLSL(e,t,r,n){var a=(r/(n-1)).toFixed(20),i=(1/(n-1)).toFixed(20),o="clamp((x - ".concat(a,")/").concat(i,", 0., 1.)");return"mix(".concat(e,", ").concat(t,", ").concat(o,")")}(r,_generateGLSLBlend(e,t+1),t,e.length)}var bn=function(e){function Ramp(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:jt;return p()(this,Ramp),checkMaxArguments(arguments,3,"ramp"),e=implicitCast(e),t=implicitCast(t),checkExpression("ramp","input",0,e),checkExpression("ramp","palette",1,t),n!==jt&&checkExpression("ramp","others",2,n=implicitCast(n)),(r=R()(this,O()(Ramp).call(this,{input:e,palette:t}))).palette=t,r.others=n,r.type=t.type,r._defaultOthers=n===jt,r}return B()(Ramp,e),_()(Ramp,[{key:"_bindMetadata",value:function _bindMetadata(e){switch(dt()(O()(Ramp.prototype),"_bindMetadata",this).call(this,e),this.palette.type){case"image-list":Object.setPrototypeOf(this,yn.prototype);break;default:Object.setPrototypeOf(this,gn.prototype)}return this._bindMetadata(e)}}]),Ramp}(lt),xn=function(e){function ListGeneric(){return p()(this,ListGeneric),R()(this,O()(ListGeneric).apply(this,arguments))}return B()(ListGeneric,e),_()(ListGeneric,[{key:"eval",value:function _eval(e){return this.elems.map(function(t){return t.eval(e)})}},{key:"_applyToShaderSource",value:function _applyToShaderSource(e){var t=this.elems.map(function(t){return t._applyToShaderSource(e)});return{preface:t.map(function(e){return e.preface}).join("\n"),inline:t.map(function(e){return e.inline})}}},{key:"value",get:function get(){return this.elems.map(function(e){return e.value})}}]),ListGeneric}(lt),wn=function(e){function ListTransform(){return p()(this,ListTransform),R()(this,O()(ListTransform).apply(this,arguments))}return B()(ListTransform,e),_()(ListTransform,[{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(ListTransform.prototype),"_bindMetadata",this).call(this,e),this._getChildren().forEach(function(e,t){return checkType("ListTransformation","ListTransformation[".concat(t,"]"),0,"transformation",e)}),this.type="transformation"}},{key:"eval",value:function _eval(e){return this.elems.map(function(t){return t.eval(e)})}},{key:"_applyToShaderSource",value:function _applyToShaderSource(e){var t=this.elems.map(function(t){return t._applyToShaderSource(e)});return{preface:this._prefaceCode("\n                ".concat(t.map(function(e){return e.preface}).join("\n"),"\n\n                vec2 listTransform").concat(this._uid,"(vec2 p) {\n                    ").concat(t.map(function(e){return"p = ".concat(e.inline,"(p);")}).join("\n"),"\n                    return p;\n                }\n            ")),inline:"listTransform".concat(this._uid)}}}]),ListTransform}(lt),kn=["number","category","color","date","image","transformation"],Tn=function(e){function List(e){var t;if(p()(this,List),checkMaxArguments(arguments,1,"list"),!e)throw new me("list(): invalid parameters: must receive at least one argument.",_e.MISSING_REQUIRED);if(Array.isArray(e)||(e=[e]),!(e=e.map(implicitCast)).length)throw new me("list(): invalid parameters: must receive at least one argument.",_e.MISSING_REQUIRED);return e.map(function(e,t){checkExpression("list","item[".concat(t,"]"),t,e)}),(t=R()(this,O()(List).call(this,e))).elems=e,t.type=e[0].type,t}return B()(List,e),_()(List,[{key:"eval",value:function _eval(e){return this.elems.map(function(t){return t.eval(e)})}},{key:"_bindMetadata",value:function _bindMetadata(e){var t=this;if(dt()(O()(List.prototype),"_bindMetadata",this).call(this,e),this._setTypes(),-1===kn.indexOf(this.childType))throw new me("list(): invalid parameters type: ".concat(this.childType,"."),_e.INCORRECT_TYPE);switch(this.elems.map(function(e,r){if(checkExpression("list","item[".concat(r,"]"),r,e),e.type!==t.childType)throw new me("list(): invalid ".concat(getOrdinalFromIndex(r+1)," parameter type, invalid argument type combination."),_e.INCORRECT_TYPE)}),this.elems[0].type){case"image":Object.setPrototypeOf(this,mn.prototype);break;case"transformation":Object.setPrototypeOf(this,wn.prototype);break;default:Object.setPrototypeOf(this,xn.prototype)}return this._bindMetadata(e)}},{key:"_setTypes",value:function _setTypes(){this.childType=this.elems[0].type,this.type="".concat(this.childType,"-list")}},{key:"value",get:function get(){return this.elems.map(function(e){return e.value})}}]),List}(lt),Cn=function(e){function Time(e){var t;p()(this,Time),checkMaxArguments(arguments,1,"time"),(t=R()(this,O()(Time).call(this,{}))).type="date";try{t.date=castDate(e)}catch(e){throwInvalidType("time","date",0,"Date or string or number","other type")}return t.inlineMaker=function(){},t}return B()(Time,e),_()(Time,[{key:"eval",value:function _eval(){return this.value}},{key:"isAnimated",value:function isAnimated(){return!1}},{key:"isPlaying",value:function isPlaying(){return!1}},{key:"value",get:function get(){return this.date}}]),Time}(lt),En=function(e){function TimeRangeExpr(e){var t;return p()(this,TimeRangeExpr),(t=R()(this,O()(TimeRangeExpr).call(this,{}))).type="timerange",t.range=castTimeRange(e),t.inlineMaker=function(){},t}return B()(TimeRangeExpr,e),_()(TimeRangeExpr,[{key:"eval",value:function _eval(e){return{iso:this.range.iso.eval(e),timeZone:this.range.timeZone.eval(e),startValue:this.range.startValue.eval(e),endValue:this.range.endValue.eval(e),startDate:this.range.startDate.eval(e),endDate:this.range.endDate.eval(e)}}},{key:"isAnimated",value:function isAnimated(){return!1}},{key:"isPlaying",value:function isPlaying(){return!1}},{key:"value",get:function get(){return{iso:this.range.iso.value,timeZone:this.range.timeZone.value,startValue:this.range.startValue.value,endValue:this.range.endValue.value,startDate:this.range.startDate.value,endDate:this.range.endDate.value}}}]),TimeRangeExpr}(lt),Mn=16,An=function(e){function Top(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Zt;p()(this,Top),checkMaxArguments(arguments,3,"top");for(var a={property:e,buckets:t=implicitCast(t),othersLabel:n=implicitCast(n)},i=0;i<Mn;i++)a["_top".concat(i)]=Ca(0);return(r=R()(this,O()(Top).call(this,a))).numBuckets=0,r.type="category",r}return B()(Top,e),_()(Top,[{key:"eval",value:function _eval(e){var t=this._metadata.properties[this.property.propertyName],r=l()(t.categories).sort(function(e,t){return t.frequency-e.frequency}),n=this.property.eval(e),a=r.findIndex(function(e){return e.name===n}),i=this.numCategoriesWithoutOthers-1||1;return a>=this.numBuckets||-1===a?{label:Zt,index:Ht}:{label:n,index:a/i}}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(Top.prototype),"_bindMetadata",this).call(this,e),checkInstance("top","property",0,ir,this.property),checkType("top","property",0,"category",this.property),checkFeatureIndependent("top","buckets",1,this.buckets),checkType("top","buckets",1,"number",this.buckets),checkType("top","othersLabel",2,"category",this.othersLabel),checkFeatureIndependent("top","othersLabel",2,this.othersLabel),this._metadata=e,this._textureBuckets=null,this.numBuckets=this.getNumBuckets(this.buckets)}},{key:"getNumBuckets",value:function getNumBuckets(e){var t=Math.round(e);if(t>this.property.numCategories&&(t=this.property.numCategories),t>Mn){var r=e;throw new me("top() function has a limit of ".concat(Mn," buckets but '").concat(r,"' buckets were specified."),_e.INCORRECT_VALUE)}return t}},{key:"_applyToShaderSource",value:function _applyToShaderSource(e){var t=this,r={};return this.childrenNames.forEach(function(n){r[n]=t[n]._applyToShaderSource(e)}),{preface:this._prefaceCode(Object.values(r).map(function(e){return e.preface}).join("")+"\n            uniform float numCategoriesWithoutOthers".concat(this._uid,";\n\n            float top").concat(this._uid,"(float id){\n                float r;\n                if (").concat(r._top0.inline," == id){\n                    r = 0.;\n                } else if (").concat(r._top1.inline," == id){\n                    r = 1.;\n                } else if (").concat(r._top2.inline," == id){\n                    r = 2.;\n                } else if (").concat(r._top3.inline," == id){\n                    r = 3.;\n                } else if (").concat(r._top4.inline," == id){\n                    r = 4.;\n                } else if (").concat(r._top5.inline," == id){\n                    r = 5.;\n                } else if (").concat(r._top6.inline," == id){\n                    r = 6.;\n                } else if (").concat(r._top7.inline," == id){\n                    r = 7.;\n                } else if (").concat(r._top8.inline," == id){\n                    r = 8.;\n                } else if (").concat(r._top9.inline," == id){\n                    r = 9.;\n                } else if (").concat(r._top10.inline," == id){\n                    r = 10.;\n                } else if (").concat(r._top11.inline," == id){\n                    r = 11.;\n                } else if (").concat(r._top12.inline," == id){\n                    r = 12.;\n                } else if (").concat(r._top13.inline," == id){\n                    r = 13.;\n                } else if (").concat(r._top14.inline," == id){\n                    r = 14.;\n                } else if (").concat(r._top15.inline," == id){\n                    r = 15.;\n                }else{\n                    return ").concat("(-1.)",";\n                }\n                return r/(numCategoriesWithoutOthers").concat(this._uid,"-1.);\n            }")),inline:"top".concat(this._uid,"(").concat(r.property.inline,")")}}},{key:"_postShaderCompile",value:function _postShaderCompile(e,t){this._numCategoriesLoc=t.getUniformLocation(e,"numCategoriesWithoutOthers".concat(this._uid)),dt()(O()(Top.prototype),"_postShaderCompile",this).call(this,e,t)}},{key:"_preDraw",value:function _preDraw(e,t,r){for(var n=this,a=this.numBuckets,i=this._metadata.properties[this.property.propertyName],o=l()(i.categories).sort(function(e,t){return t.frequency-e.frequency}),s=0;s<Mn;s++)this["_top".concat(s)].value=Number.POSITIVE_INFINITY;o.forEach(function(e,t){t<a&&(n["_top".concat(t)].value=n._metadata.categoryToID.get(e.name))}),r.uniform1f(this._numCategoriesLoc,this.numCategoriesWithoutOthers),dt()(O()(Top.prototype),"_preDraw",this).call(this,e,t,r)}},{key:"getLegendData",value:function getLegendData(e){var t=this._metadata.properties[this.property.propertyName],r=l()(t.categories).sort(function(e,t){return t.frequency-e.frequency}),n=this.numBuckets,a=[],i=this.toString(),o=this.numCategoriesWithoutOthers-1||1;if(r.forEach(function(e,t){if(t<n){var r=e.name,i=t/o;a.push({key:r,value:i})}}),r.length>this.buckets){var s=e&&e.othersLabel?e.othersLabel:this.othersLabel.value;a.push({key:s,value:Ht})}return{name:i,data:a}}},{key:"value",get:function get(){return this.eval()}},{key:"numCategories",get:function get(){return this.numBuckets+1}},{key:"numCategoriesWithoutOthers",get:function get(){return this.numCategories-1}}]),Top}(lt),Sn=.15,In=void 0,Pn=function(e){function Fade(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:In,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:In;p()(this,Fade),checkMaxArguments(arguments,2,"fade");var n=implicitCast(t===In?Sn:t),a=r===In?n:implicitCast(r);return checkExpression("fade","param1",0,n),checkExpression("fade","param2",1,a),(e=R()(this,O()(Fade).call(this,{fadeIn:n,fadeOut:a}))).type="fade",e.inlineMaker=function(e){return{in:e.fadeIn,out:e.fadeOut}},e}return B()(Fade,e),_()(Fade,[{key:"eval",value:function _eval(e){return{fadeIn:this.fadeIn.eval(e),fadeOut:this.fadeOut.eval(e)}}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(Fade.prototype),"_bindMetadata",this).call(this,e),checkType("fade","param1",0,"number",this.fadeIn),checkType("fade","param2",1,"number",this.fadeOut)}},{key:"value",get:function get(){return{fadeIn:this.fadeIn.value,fadeOut:this.fadeOut.value}}}]),Fade}(lt),Dn=new Set,Nn=new Set,Rn=function(e){function AnimationGeneral(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Pn;return p()(this,AnimationGeneral),checkMaxArguments(arguments,3,"animation"),r=implicitCast(r),e=implicitCast(e),(t=R()(this,O()(AnimationGeneral).call(this,{input:e,duration:r,fade:n})))._init(),t}return B()(AnimationGeneral,e),_()(AnimationGeneral,[{key:"_init",value:function _init(){var e=this.input,t=e;e.isA(ir)||e.isA(vr)&&"timerange"===e.type?this._input=bi(e,lo(e),co(e),"start"):this._input=this.input,this.childrenNames=this.childrenNames.filter(function(e){return"_input"===e}),this.childrenNames.push("_input"),this.childrenNames.push("fade"),this.childrenNames.push("duration"),this.type="number",this._originalInput=t,this._paused=!1,this.progress=Ca(0),this.childrenNames.push("progress"),this.expressionName="animation",this.preface="\n        #ifndef ANIMATION\n        #define ANIMATION\n\n        float animation(float _input, float progress, float duration, float fadeIn, float fadeOut){\n            float x = 0.;\n\n            // Check for NaN\n            if (_input <= 0.0 || 0.0 <= _input){\n                x = 1. - clamp(abs(_input - progress) * duration / (_input > progress ? fadeIn: fadeOut), 0., 1.);\n            }\n\n            return x;\n        }\n\n        #endif\n    ",this.inlineMaker=function(e){return"animation(".concat(e._input,", ").concat(e.progress,", ").concat(e.duration,", ").concat(e.fade.in,", ").concat(e.fade.out,")")},Dn.add(this),this._paused||(this._paused="default")}},{key:"toString",value:function toString(){return"".concat(this.expressionName,"(").concat(this._input.toString(),", ").concat(this.duration.toString(),", ").concat(this.fade.toString(),")")}},{key:"_bindMetadata",value:function _bindMetadata(e){this._input._bindMetadata(e),this.progress._bindMetadata(e),this.fade._bindMetadata(e),this.duration._bindMetadata(e),checkType("animation","input",0,["number","date","timerange"],this._originalInput),checkType("animation","duration",1,"number",this.duration),checkType("animation","fade",2,"fade",this.fade),checkFeatureIndependent("animation","duration",1,this.duration)}},{key:"isAnimated",value:function isAnimated(){return!0}},{key:"_dataReady",value:function _dataReady(){var e=this;Dn.has(this)&&(Dn.delete(this),Nn.add(this)),setTimeout(function(){if(Nn.has(e)){if((Dn=new Set(l()(Dn).filter(function(e){for(;e.parent;)e=e.parent;return!!e._getRootExpressions}))).size>0)return;l()(Nn.values()).map(function(e){"default"===e._paused&&e.play()}),Nn.clear()}},0)}},{key:"_postShaderCompile",value:function _postShaderCompile(e,t){dt()(O()(AnimationGeneral.prototype),"_postShaderCompile",this).call(this,e,t)}},{key:"_setTimestamp",value:function _setTimestamp(e){if(dt()(O()(AnimationGeneral.prototype),"_setTimestamp",this).call(this,e),!this._paused||void 0!==this._lastTime){var t=0,r=1/this.duration.value;void 0!==this._lastTime&&(t=e-this._lastTime),this._lastTime=e,this._paused||(this.progress.value=(this.progress.value+r*t)%1)}}},{key:"eval",value:function _eval(e){var t=this._input.eval(e);if(null===t)return 0;var r=this.progress.value,n=this.duration.value,a=this.fade.fadeIn.eval(e),i=this.fade.fadeOut.eval(e);return 1-utils_clamp(Math.abs(t-r)*n/(t>r?a:i),0,1)}},{key:"getProgressValue",value:function getProgressValue(){var e=this.progress.value;return this._input.converse(e)}},{key:"setTimestamp",value:function setTimestamp(e){var t=castDate(e),r=this._input.limits(),n=g()(r,2),a=n[0],i=n[1];if(t.getTime()<a)throw new RangeError("animation.setTimestamp requires the date parameter to be higher than the lower limit");if(t.getTime()>i)throw new RangeError("animation.setTimestamp requires the date parameter to be lower than the higher limit");this.progress.value=(t.getTime()-a)/(i-a)}},{key:"getProgressPct",value:function getProgressPct(){return this.progress.value}},{key:"setProgressPct",value:function setProgressPct(e){if((e=Number.parseFloat(e))<0||e>1)throw new TypeError("animation.setProgressPct requires a number between 0 and 1 as parameter but got: ".concat(e));this.progress.value=e}},{key:"isPlaying",value:function isPlaying(){return!1===this._paused}},{key:"pause",value:function pause(){this._paused=!0}},{key:"play",value:function play(){this._paused=!1,this.notify()}},{key:"stop",value:function stop(){this.progress.value=0,this._paused=!0}}]),AnimationGeneral}(lt),Fn=function(e){function AnimationRange(){return p()(this,AnimationRange),R()(this,O()(AnimationRange).apply(this,arguments))}return B()(AnimationRange,e),_()(AnimationRange,[{key:"_init",value:function _init(){var e=this.input,t=this.duration,r=this.fade,n=bi(e,lo(e),co(e),"start"),a={};Object.keys(e).forEach(function(t){a[t]=e[t]}),Object.setPrototypeOf(a,e);var i=bi(a,lo(a),co(a),"end"),o=new Rn(n,t,new Pn(r.fadeIn,ko)),s=new Rn(i,t,new Pn(ko,r.fadeOut)),u=Ra(o,s);this.combinedAnimation=u,this.childrenNames.push("combinedAnimation"),u.parent=this,this.type="number",this._startAnim=o,this._endAnim=s,this.expressionName="animation",this.inlineMaker=function(e){return e.combinedAnimation}}},{key:"_bindMetadata",value:function _bindMetadata(e){this.combinedAnimation._bindMetadata(e)}},{key:"eval",value:function _eval(e){return this.combinedAnimation.eval(e)}},{key:"isAnimated",value:function isAnimated(){return!0}},{key:"isPlaying",value:function isPlaying(){return this._startAnim.isPlaying()}},{key:"getProgressValue",value:function getProgressValue(){return this._startAnim.getProgressValue()}},{key:"getProgressPct",value:function getProgressPct(){return this._startAnim.getProgressPct()}},{key:"setProgressPct",value:function setProgressPct(e){this._startAnim.setProgressPct(e),this._endAnim.setProgressPct(e)}},{key:"pause",value:function pause(){this._startAnim.pause(),this._endAnim.pause()}},{key:"play",value:function play(){this._startAnim.play(),this._endAnim.play(),this._endAnim.setProgressPct(this._startAnim.getProgressPct())}},{key:"stop",value:function stop(){this._startAnim.stop(),this._endAnim.stop()}},{key:"toString",value:function toString(){return"".concat(this.expressionName,"(").concat(this._input.toString(),", ").concat(this.duration.toString(),", ").concat(this.fade.toString(),")")}}]),AnimationRange}(lt),On=function(e){function Animation(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Pn;return p()(this,Animation),checkMaxArguments(arguments,3,"animation"),t=implicitCast(t),e=implicitCast(e),R()(this,O()(Animation).call(this,{input:e,duration:t,fade:r}))}return B()(Animation,e),_()(Animation,[{key:"_resolveAliases",value:function _resolveAliases(e){this._getChildren().map(function(t){return t._resolveAliases(e)}),"timerange"===this.input.type?Object.setPrototypeOf(this,Fn.prototype):Object.setPrototypeOf(this,Rn.prototype),this._init()}},{key:"_bindMetadata",value:function _bindMetadata(e){this._resolveAliases({}),this._bindMetadata(e)}}]),Animation}(lt),Ln=genUnaryOp("log",function(e){return Math.log(e)},function(e){return"log(".concat(e,")")}),zn=genUnaryOp("sqrt",function(e){return Math.sqrt(e)},function(e){return"sqrt(".concat(e,")")}),Bn=genUnaryOp("sin",function(e){return Math.sin(e)},function(e){return"sin(".concat(e,")")}),Vn=genUnaryOp("cos",function(e){return Math.cos(e)},function(e){return"cos(".concat(e,")")}),Gn=genUnaryOp("tan",function(e){return Math.tan(e)},function(e){return"tan(".concat(e,")")}),Un=genUnaryOp("sign",function(e){return Math.sign(e)},function(e){return"sign(".concat(e,")")}),qn=genUnaryOp("abs",function(e){return Math.abs(e)},function(e){return"abs(".concat(e,")")}),jn=genUnaryOp("isNull",function(e){return null===e?1:0},function(e){return"((".concat(e," == ").concat(Qt.toFixed(20),") ? 1. : 0.)")},["number","category"]),Wn=genUnaryOp("not",function(e){return 1-e},function(e){return"(1.0 - ".concat(e,")")}),Hn=genUnaryOp("floor",function(e){return Math.floor(e)},function(e){return"floor(".concat(e,")")}),Zn=genUnaryOp("ceil",function(e){return Math.ceil(e)},function(e){return"ceil(".concat(e,")")});function genUnaryOp(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"number";return function(a){function UnaryOperation(t){var n;return p()(this,UnaryOperation),checkMaxArguments(arguments,1,e),t=implicitCast(t),(n=R()(this,O()(UnaryOperation).call(this,{a:t}))).type="number",n.expressionName=e,n.inlineMaker=function(e){return r(e.a)},n}return B()(UnaryOperation,a),_()(UnaryOperation,[{key:"eval",value:function _eval(e){return t(this.a.eval(e))}},{key:"_bindMetadata",value:function _bindMetadata(t){dt()(O()(UnaryOperation.prototype),"_bindMetadata",this).call(this,t),checkType(e,"x",0,n,this.a)}},{key:"value",get:function get(){return t(this.a.value)}}]),UnaryOperation}(lt)}var Yn=function(e){function Variable(){return p()(this,Variable),R()(this,O()(Variable).call(this,{}))}return B()(Variable,e),Variable}(lt);var Xn=function(e){function ViewportAggregation(e){var t,r=e.property;return p()(this,ViewportAggregation),r=implicitCast(r),(t=R()(this,O()(ViewportAggregation).call(this,{property:r,_impostor:Ca(0)})))._isViewport=!0,t.type="number",t.inlineMaker=function(e){return e._impostor},t}return B()(ViewportAggregation,e),_()(ViewportAggregation,[{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(ViewportAggregation.prototype),"_bindMetadata",this).call(this,e)}},{key:"_getMinimumNeededSchema",value:function _getMinimumNeededSchema(){return this.property._getMinimumNeededSchema()}},{key:"_preDraw",value:function _preDraw(){var e;this._impostor.value=this.value;for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=dt()(O()(ViewportAggregation.prototype),"_preDraw",this)).call.apply(e,[this].concat(r))}}]),ViewportAggregation}(lt),Qn=function(e){function ViewportAvg(e){var t;return p()(this,ViewportAvg),checkMaxArguments(arguments,1,"viewportAvg"),(t=R()(this,O()(ViewportAvg).call(this,{property:e})))._sum=0,t._count=0,t}return B()(ViewportAvg,e),_()(ViewportAvg,[{key:"eval",value:function _eval(){return this.value}},{key:"accumViewportAgg",value:function accumViewportAgg(e){var t=this.property.eval(e);if(null!==t){var r=e._cdb_feature_count||1;this._count+=r,this._sum+=r*t}}},{key:"_resetViewportAgg",value:function _resetViewportAgg(){this._sum=0,this._count=0}},{key:"value",get:function get(){return this._sum/this._count}}]),ViewportAvg}(Xn),$n=function(e){function ViewportMax(e){var t;return p()(this,ViewportMax),checkMaxArguments(arguments,1,"viewportMax"),(t=R()(this,O()(ViewportMax).call(this,{property:e})))._value=Number.NEGATIVE_INFINITY,t}return B()(ViewportMax,e),_()(ViewportMax,[{key:"eval",value:function _eval(){return this.value}},{key:"accumViewportAgg",value:function accumViewportAgg(e){var t=this.property.eval(e);null!==t&&(this._value=Math.max(this._value,t))}},{key:"_resetViewportAgg",value:function _resetViewportAgg(){this._value=Number.NEGATIVE_INFINITY}},{key:"value",get:function get(){return this._value}}]),ViewportMax}(Xn),Jn=function(e){function ViewportMin(e){var t;return p()(this,ViewportMin),checkMaxArguments(arguments,1,"viewportMin"),(t=R()(this,O()(ViewportMin).call(this,{property:e})))._value=Number.POSITIVE_INFINITY,t}return B()(ViewportMin,e),_()(ViewportMin,[{key:"eval",value:function _eval(){return this.value}},{key:"accumViewportAgg",value:function accumViewportAgg(e){var t=this.property.eval(e);null!==t&&(this._value=Math.min(this._value,t))}},{key:"_resetViewportAgg",value:function _resetViewportAgg(){this._value=Number.POSITIVE_INFINITY}},{key:"value",get:function get(){return this._value}}]),ViewportMin}(Xn),Kn=function(e){function ViewportSum(e){var t;return p()(this,ViewportSum),checkMaxArguments(arguments,1,"viewportSum"),(t=R()(this,O()(ViewportSum).call(this,{property:e})))._value=0,t}return B()(ViewportSum,e),_()(ViewportSum,[{key:"eval",value:function _eval(){return this.value}},{key:"accumViewportAgg",value:function accumViewportAgg(e){var t=this.property.eval(e);if(null!==t){var r=e._cdb_feature_count||1;this._value=this._value+r*t}}},{key:"_resetViewportAgg",value:function _resetViewportAgg(){this._value=0}},{key:"value",get:function get(){return this._value}}]),ViewportSum}(Xn),ea=function(e){function ViewportCount(){var e;return p()(this,ViewportCount),checkMaxArguments(arguments,0,"viewportCount"),(e=R()(this,O()(ViewportCount).call(this,{property:Ca(0)})))._value=0,e}return B()(ViewportCount,e),_()(ViewportCount,[{key:"toString",value:function toString(){return"".concat(this.expressionName,"()")}},{key:"eval",value:function _eval(){return this.value}},{key:"accumViewportAgg",value:function accumViewportAgg(e){var t=e._cdb_feature_count||1;this._value+=t}},{key:"_resetViewportAgg",value:function _resetViewportAgg(){this._value=0}},{key:"_getMinimumNeededSchema",value:function _getMinimumNeededSchema(){return{}}},{key:"value",get:function get(){return this._value}}]),ViewportCount}(Xn),ta=function(e){function ViewportPercentile(e,t){var r;return p()(this,ViewportPercentile),e=implicitCast(e),t=implicitCast(t),checkExpression("viewportPercentile","property",0,e),checkExpression("viewportPercentile","percentile",0,t),checkMaxArguments(arguments,2,"viewportPercentile"),(r=R()(this,O()(ViewportPercentile).call(this,{property:e}))).percentile=t,r.childrenNames.push("percentile"),r}return B()(ViewportPercentile,e),_()(ViewportPercentile,[{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(ViewportPercentile.prototype),"_bindMetadata",this).call(this,e),checkType("viewportPercentile","property",0,"number",this.property),checkType("viewportPercentile","percentile",1,"number",this.percentile)}},{key:"eval",value:function _eval(e){return null===this._value&&(this._value=_nearestRankMethod(this.percentile.eval(e),this._total,this._values)),this._value}},{key:"_resetViewportAgg",value:function _resetViewportAgg(){this._value=null,this._map=new Map,this._total=0}},{key:"accumViewportAgg",value:function accumViewportAgg(e){var t=this.property.eval(e),r=e._cdb_feature_count||1;this._map.set(t,(this._map.get(t)||0)+r),this._total+=r}},{key:"value",get:function get(){return _nearestRankMethod(this.percentile.value,this._total,this._values)}},{key:"_values",get:function get(){return l()(this._map.entries())}}]),ViewportPercentile}(Xn);function _nearestRankMethod(e,t,r){var n=utils_clamp(Math.ceil(e/100*t)-1,0,t-1);r.sort(function(e,t){return e[0]-t[0]});for(var a=0,i=0;i<r.length;i++)a+=r[i][1],r[i][1]=a;return function binarySearch(e,t,r,n){var a=Math.round((r+n)/2);var i=e[a][1];var o=(e[a-1]||[e[a][0]-1,0])[1];return t>=o&&t<i?e[a][0]:t<o?binarySearch(e,t,r,a-1):binarySearch(e,t,a+1,n)}(r,n,0,r.length-1)}var ra=r(39),na=r.n(ra),aa=function(e){function Histogram(e){var t;return p()(this,Histogram),(t=R()(this,O()(Histogram).call(this,e))).type="histogram",t.inlineMaker=function(){return null},t}return B()(Histogram,e),_()(Histogram,[{key:"eval",value:function _eval(){return this.value}},{key:"getAllCategories",value:function getAllCategories(){return this._categories||[]}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(Histogram.prototype),"_bindMetadata",this).call(this,e),this._metadata=e;var t=this.propertyName;this._categories=this._metadata.properties[t]?this._metadata.properties[t].categories.sort(this._sortByFrequency):[]}},{key:"_getCategoryValue",value:function _getCategoryValue(e){var t=this;return l()(e).map(function(e){var t=g()(e,2);return{x:t[0],y:t[1]}}).sort(this._sortByFrequency).map(function(e,r){return{x:"number"==typeof e.x&&t._categories[r]?t._categories[r].name:e.x,y:e.y}})}},{key:"_getNumericValue",value:function _getNumericValue(e,t){for(var r=l()(e),n=r.length,a=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,o=0;o<n;o++){var s=r[o][0];a=Math.min(a,s),i=Math.max(i,s)}for(var u=Array(t).fill(0),c=i-a,f=t-1,h=0;h<n;h++){var d=r[h][0],p=r[h][1];u[Math.min(Math.floor(t*(d-a)/c),f)]+=p}return u.map(function(e,r){return{x:[a+r/t*c,a+(r+1)/t*c],y:e}})}},{key:"_getBucketsValue",value:function _getBucketsValue(e,t){for(var r=na()(e).slice(0),n=(t=t.length&&0===t.length?this._genBreakpoints(t):t).length,a=Array(n).fill(0),i=0,o=r.length;i<o;i++)for(var s=r[i][0],u=0;u<n;u++){var c=t[u];if(s>=c[0]&&s<c[1]){a[u]+=r[i][1];break}}return a.map(function(e,r){return{x:t[r],y:e}})}},{key:"_getDateValue",value:function _getDateValue(e,t){for(var r=l()(e).map(function(e){return{x:e[0].getTime(),y:e[1]}}),n=r.length,a=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,o=0;o<n;o++){var s=r[o].x;a=Math.min(a,s),i=Math.max(i,s)}for(var u=Array(t).fill(0),c=i-a,f=t-1,h=0;h<n;h++){var d=r[h].x,p=r[h].y;u[Math.min(Math.floor(t*(d-a)/c),f)]+=p}return u.map(function(e,r){return{x:[new Date(a+r/t*c),new Date(a+(r+1)/t*c)],y:e}})}},{key:"_genBreakpoints",value:function _genBreakpoints(){var e=this._histogram.value;if(e){var t=this._getAccumHistogramFrom(e),r=this._getMinMaxFrom(e),n=g()(r,2),a=n[0],i=n[1];this._updateBreakpointsWith({accumHistogram:t,min:a,max:i})}}},{key:"_getAccumHistogramFrom",value:function _getAccumHistogramFrom(e){var t=0;return e.map(function(e){var r=e.y;return t+=r})}},{key:"_getMinMaxFrom",value:function _getMinMaxFrom(e){return[e[0].x[0],e[e.length-1].x[1]]}},{key:"_sortByFrequency",value:function _sortByFrequency(e,t){var r=t.y-e.y;if(0===r){var n=e.x,a=t.x;return n||a?n?a?"string"==typeof n&&"string"==typeof a?n.localeCompare(a):n<a?-1:n>a?1:0:-1:1:0}return r}},{key:"value",get:function get(){switch(this.input.type){case"number":return this._hasBuckets?this._getBucketsValue(this._histogram,this._sizeOrBuckets):this._getNumericValue(this._histogram,this._sizeOrBuckets);case"date":return this._hasBuckets?this._getBucketsValue(this._histogram,this._sizeOrBuckets):this._getDateValue(this._histogram,this._sizeOrBuckets);default:return this._getCategoryValue(this._histogram)}}}]),Histogram}(lt),ia=function(e){function ViewportHistogram(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return p()(this,ViewportHistogram),checkMaxArguments(arguments,3,"viewportHistogram"),(t=R()(this,O()(ViewportHistogram).call(this,{input:implicitCast(e),weight:implicitCast(n)})))._sizeOrBuckets=r,t._isViewport=!0,t._hasBuckets=Array.isArray(r),t._cached=null,t}return B()(ViewportHistogram,e),_()(ViewportHistogram,[{key:"eval",value:function _eval(){return this.value}},{key:"getJoinedValues",value:function getJoinedValues(e,t){if(checkArray("viewportHistogram.getJoinedValues","values",0,e),!e.length)return[];var r=Object.assign({},Xt,t),n=[],a=[];this.value.forEach(function(t){var r=e.find(function(e){return Array.isArray(e.key)?e.key[0]===t.x[0]&&e.key[1]===t.x[1]:t.x===e.key});if(r){var i=t.y,o=r.key,s=r.value;n.push({frequency:i,key:o,value:s})}else a.push(t.y)});var i=e.find(function(e){return r.othersLabel===e.key});if(i){var o=a.reduce(function(e,t){return e+t}),s=i.key,u=i.value;n.push({frequency:o,key:s,value:u})}return n.sort(function(e,t){return t.frequency-e.frequency})}},{key:"accumViewportAgg",value:function accumViewportAgg(e){var t=this.input.eval(e),r=this.input.isA(An)?t.label:t;if(void 0!==r){var n=(e._cdb_feature_count||1)*this.weight.eval(e),a=this._histogram.get(r)||0;this._histogram.set(r,a+n)}}},{key:"_resetViewportAgg",value:function _resetViewportAgg(e){e&&this._bindMetadata(e),this._cached=null,this._histogram=new Map}},{key:"value",get:function get(){if(null===this._cached){if(!this._histogram)return null;this._cached=dt()(O()(ViewportHistogram.prototype),"value",this)}return this._cached}}]),ViewportHistogram}(aa),oa=function(e){function GlobalHistogram(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return p()(this,GlobalHistogram),checkMaxArguments(arguments,3,"globalHistogram"),(t=R()(this,O()(GlobalHistogram).call(this,{input:implicitCast(e)})))._sizeOrBuckets=r,t._hasBuckets=Array.isArray(r),t._histogram=new Map,t}return B()(GlobalHistogram,e),_()(GlobalHistogram,[{key:"getJoinedValues",value:function getJoinedValues(e,t){if(checkArray("globalHistogram.getJoinedValues","values",0,e),!e.length)return[];var r=Object.assign({},Xt,t),n=[];return this.value.forEach(function(t){t.x=t.x===Zt?r.othersLabel:t.x;var a=e.find(function(e){return t.x===e.key});if(a){var i=t.y,o=a.key,s=a.value;n.push({frequency:i,key:o,value:s})}}),n}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(GlobalHistogram.prototype),"_bindMetadata",this).call(this,e),this._histogram=new Map,this.input.isA(ir)?"number"!==this.input.type?this._setHistogramForCategoryValues():this._setHistogramForNumericValues():this._setHistogramForExpression()}},{key:"_setHistogramForExpression",value:function _setHistogramForExpression(){var e=this,t=this.input.getLegendData(Xt).data;this._categories.forEach(function(r){if(t.find(function(e){return r.name===e.key}))e._histogram.set(r.name,r.frequency);else{var n=e._histogram.get(Zt)||0;e._histogram.set(Zt,r.frequency+parseInt(n))}})}},{key:"_setHistogramForCategoryValues",value:function _setHistogramForCategoryValues(){var e=this;this._categories.forEach(function(t){e._histogram.set(t.name,t.frequency)})}},{key:"_setHistogramForNumericValues",value:function _setHistogramForNumericValues(){var e=this,t=this.propertyName,r=this._metadata.featureCount/this._metadata.sample.length;this._metadata.sample.forEach(function(n){var a=n[t],i=e._histogram.get(a)||0;e._histogram.set(a,i+r)})}}]),GlobalHistogram}(aa);function generateResetFunction(e,t,r,n,a){return function reset(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;r[t]&&r[t][e]&&(r[t][e].replaceChild(r[t][e].mix,ei(Wa(Si(a),t),Ia(0),Ia(i))),n[e].notify(),r[t][e]=void 0)}}function generateBlenderFunction(e,t,r,n,a,i,o){return function generatedBlendTo(s){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;if("string"==typeof s&&(s=o(s)),r[t]&&r[t][e])r[t][e].a.blendTo(s,u);else{var c=ei(s,n[e],ei(1,Wa(Si(i),t),Ia(u)));a(t,e,c,r),n.replaceChild(n[e],c),n[e].notify()}}}var sa=["color","filter","order","resolution","strokeColor","strokeWidth","symbol","symbolPlacement","transform","width"],ua=["color","filter","order","strokeColor","strokeWidth","symbol","symbolPlacement","transform","width"];function genLightweightFeatureClass(e,t){var r=function LightweightFeature(e){p()(this,LightweightFeature),this._rawFeature=e,this._featureProperties=null};return function _defineIdProperty(e,t){Object.defineProperty(e,"id",{get:function get(){var e=t.viz.metadata.idProperty;return this._rawFeature[e]},configurable:!0})}(r.prototype,t),function lightweightFeature_defineVizProperties(e,t){sa.forEach(function(r){_createLightweightFeatureVizProperty(e,t,r)})}(r.prototype,t),function _defineVizVariables(e,t){Object.defineProperty(e,"variables",{get:function get(){var e={};Object.defineProperty(e,"id",{get:function get(){return this.id}});var r=t.viz.variables;return Object.keys(r).forEach(function(r){var n="__cartovl_variable_".concat(r);_createLightweightFeatureVizProperty(e,t,n,r)}),e}})}(r.prototype,t),function _defineFeatureProperties(e,t){Object.defineProperty(e,"properties",{get:function get(){var e=this;return null===this._featureProperties&&(this._featureProperties={},t.forEach(function(t){var r=t.property,n=t.variable,a=n||r;e._featureProperties[a]=e._rawFeature[r]})),this._featureProperties}})}(r.prototype,e),function _defineRootBlendToMethod(e){Object.defineProperty(e,"blendTo",{get:function get(){var e=this;return function blendTo(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;Object.keys(t).forEach(function(n){if(!sa.includes(n))throw new me("Property '".concat(n,"' is not a valid viz property"),_e.INCORRECT_VALUE);var a=t[n];e[n].blendTo(a,r)})}}})}(r.prototype),function _defineRootResetMethod(e){Object.defineProperty(e,"reset",{get:function get(){var e=this;return function reset(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;for(var r in sa.forEach(function(r){e[r].reset(t)}),e.variables)e.variables[r].reset(t)}}})}(r.prototype),function _defineGetRenderedCentroidMethod(e){Object.defineProperty(e,"getRenderedCentroid",{get:function get(){var e=this;return function getRenderedCentroid(){return e._rawFeature._dataframe.getRenderedCentroid(e._rawFeature._index)}},configurable:!0})}(r.prototype),r}function _createLightweightFeatureVizProperty(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r,a=t.customizedFeatures,i=t.viz,o=t.trackFeatureViz,s=t.parseVizExpression,u=i.metadata.idProperty;Object.defineProperty(e,n,{get:function get(){var e=this;return{blendTo:function blendTo(){return function blender(e){return generateBlenderFunction(r,e,a,i,o,u,s)}(e.id).apply(void 0,arguments)},reset:function reset(){return function reset(e){return generateResetFunction(r,e,a,i,u)}(e.id).apply(void 0,arguments)},value:i[r].eval(this._rawFeature)}}})}function getCompoundFeature(e){var t=e[0];if(1===e.length)return t;var r=function _getGeomPropertiesFromPieces(e){return e.map(function(e){var t=e.getRenderedCentroid(),r=g()(t,2);return{centroid:{x:r[0],y:r[1]},aabb:e._rawFeature._dataframe._aabb[e._rawFeature._index]}}).filter(function(e){var t=e.centroid,r=t.x,n=t.y;return!(isNaN(r)||isNaN(n))})}(e);return Object.defineProperty(t,"getRenderedCentroid",{get:function get(){return function getRenderedCentroid(){var e=r.reduce(function(e,t){var r=t.aabb,n=r.minx,a=r.miny,i=(r.maxx-n)*(r.maxy-a),o=t.centroid.x*i,s=t.centroid.y*i;return[e[0]+o,e[1]+s,e[2]+i]},[0,0,0]),t=g()(e,3),n=t[0],a=t[1],i=t[2];return[n/i,a/i]}}}),t}var ca=function(e){function ViewportFeatures(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return p()(this,ViewportFeatures),r=r.map(function(e){return implicitCast(e)}),(e=R()(this,O()(ViewportFeatures).call(this,function _childrenFromProperties(e){var t=0,r={};return e.forEach(function(e){r["p"+ ++t]=e}),r}(r))))._value=[],e.type="featureList",e._isViewport=!0,e._requiredProperties=r,e._FeatureProxy=null,e}return B()(ViewportFeatures,e),_()(ViewportFeatures,[{key:"_applyToShaderSource",value:function _applyToShaderSource(){throw new Pe("'viewportFeatures' cannot be used in visualizations.")}},{key:"isFeatureDependent",value:function isFeatureDependent(){return!1}},{key:"eval",value:function _eval(){return this.value}},{key:"_resetViewportAgg",value:function _resetViewportAgg(e,t){if(!this._FeatureProxy){if(!this._requiredProperties.every(function(e){return function validProperty(e){return[ir,sr,dr,_r].some(function(t){return e.isA(t)})}(e)}))throw new me("viewportFeatures arguments can only be properties",_e.INCORRECT_TYPE);var r=this._requiredProperties.map(function(e){return{property:e.propertyName,variable:e._variableName}});this._FeatureProxy=genLightweightFeatureClass(r,t)}this._value=[]}},{key:"accumViewportAgg",value:function accumViewportAgg(e){var t=this;if(1===(e=Array.isArray(e)?e:[e]).length)this._value.push(new this._FeatureProxy(e[0]));else{var r=getCompoundFeature(e.map(function(e){return new t._FeatureProxy(e)}));this._value.push(r)}}},{key:"value",get:function get(){return this._value},set:function set(e){this._value=e}}]),ViewportFeatures}(lt);var la=function(e){function GlobalAggregation(e){var t,r=e.property,n=e.name,a=e.type,i=e.baseStats,o=void 0!==i&&i;return p()(this,GlobalAggregation),(t=R()(this,O()(GlobalAggregation).call(this,{_value:Ca(0)}))).property=implicitCast(r),t._name=n,t.type=a,t.baseStats=o,Nr()(O()(GlobalAggregation.prototype),"inlineMaker",function(e){return e._value},qt()(t),!0),t}return B()(GlobalAggregation,e),_()(GlobalAggregation,[{key:"toString",value:function toString(){return"".concat(this.expressionName,"(").concat(this.property.toString(),")")}},{key:"isFeatureDependent",value:function isFeatureDependent(){return!1}},{key:"eval",value:function _eval(){return this.value}},{key:"_resolveAliases",value:function _resolveAliases(e){this.property&&this.property._resolveAliases(e)}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(GlobalAggregation.prototype),"_bindMetadata",this).call(this,e),this.property._bindMetadata(e);var t=this.property.name||this.property.propertyName,r=this._getValueFromStats(e,t);this._value.value=e.codec(t).sourceToExternal(e,r)}},{key:"_getValueFromStats",value:function _getValueFromStats(e,t){var r;if(this.baseStats)if("_count"===this.baseStats)r=e.featureCount;else{var n=e.stats(this.property.name);r=n&&n[this.baseStats]}else{if("_cdb_feature_count"===t)throw new me(_e.INCORRECT_TYPE,"'clusterCount' can not be used in ".concat(this.expressionName,"."));var a=e.stats(t);r=a&&a[this._name]}if(void 0===r)throw new me("Metadata ".concat(this._name," for property ").concat(t," is not defined"),_e.MISSING_REQUIRED);return r}},{key:"_getMinimumNeededSchema",value:function _getMinimumNeededSchema(){return this.property._getMinimumNeededSchema()}},{key:"value",get:function get(){return this._value.value}}]),GlobalAggregation}(lt),fa=function(e){function GlobalAvg(e){p()(this,GlobalAvg),checkMaxArguments(arguments,1,"globalAvg");var t=!1;if(e&&e.isA(sr)){if(!e.isA(ur))throw new me("Invalid globlalAvg input",_e.INCORRECT_TYPE);t="avg"}return R()(this,O()(GlobalAvg).call(this,{property:e,name:"avg",type:"number",baseStats:t}))}return B()(GlobalAvg,e),_()(GlobalAvg,[{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(GlobalAvg.prototype),"_bindMetadata",this).call(this,e),checkType(this.expressionName,"property",0,"number",this.property)}}]),GlobalAvg}(la),ha=function(e){function GlobalCount(){return p()(this,GlobalCount),checkMaxArguments(arguments,0,"globalCount"),R()(this,O()(GlobalCount).call(this,{name:"count",type:"number"}))}return B()(GlobalCount,e),_()(GlobalCount,[{key:"toString",value:function toString(){return"".concat(this.expressionName,"()")}},{key:"_bindMetadata",value:function _bindMetadata(e){this._value.value=e.featureCount}},{key:"_getMinimumNeededSchema",value:function _getMinimumNeededSchema(){return{}}}]),GlobalCount}(la),da=function(e){function GlobalMax(e){p()(this,GlobalMax),checkMaxArguments(arguments,1,"globalMax");var t=!1;if(e&&e.isA(sr)){if(!(e.isA(ur)||e.isA(lr)||e.isA(cr)))throw new me("Invalid globlalAvg input",_e.INCORRECT_TYPE);t="max"}return R()(this,O()(GlobalMax).call(this,{property:e,name:"max",type:"number",baseStats:t}))}return B()(GlobalMax,e),GlobalMax}(la),pa=function(e){function GlobalMin(e){p()(this,GlobalMin),checkMaxArguments(arguments,1,"globalMin");var t=!1;if(e&&e.isA(sr)){if(!(e.isA(ur)||e.isA(lr)||e.isA(cr)))throw new me("Invalid globlalAvg input",_e.INCORRECT_TYPE);t="min"}return R()(this,O()(GlobalMin).call(this,{property:e,name:"min",type:"number",baseStats:t}))}return B()(GlobalMin,e),GlobalMin}(la),ma=function(e){function GlobalSum(e){p()(this,GlobalSum),checkMaxArguments(arguments,1,"globalSum");var t=e.type,r=!1;if(e&&(e.isA(sr)||e.isA(dr)))if(e.isA(hr))r="sum";else{if(!e.isA(dr))throw new me("Invalid globlalAvg input",_e.INCORRECT_TYPE);r="_count"}return R()(this,O()(GlobalSum).call(this,{property:e,name:"sum",baseStats:r,type:t}))}return B()(GlobalSum,e),GlobalSum}(la),_a=function(e){function GlobalPercentile(e,t){var r;return p()(this,GlobalPercentile),checkMaxArguments(arguments,2,"globalPercentile"),e=implicitCast(e),t=implicitCast(t),checkExpression("globalPercentile","property",0,e),checkExpression("globalPercentile","percentile",1,t),(r=R()(this,O()(GlobalPercentile).call(this,{_value:Ca(0),property:e,percentile:t}))).type="number",Nr()(O()(GlobalPercentile.prototype),"inlineMaker",function(e){return e._value},qt()(r),!0),r}return B()(GlobalPercentile,e),_()(GlobalPercentile,[{key:"isFeatureDependent",value:function isFeatureDependent(){return!1}},{key:"eval",value:function _eval(){return this.value}},{key:"_bindMetadata",value:function _bindMetadata(e){var t=this;dt()(O()(GlobalPercentile.prototype),"_bindMetadata",this).call(this,e),checkType("globalPercentile","property",0,"number",this.property),checkType("globalPercentile","percentile",0,"number",this.percentile),checkInstance("globalPercentile","property",0,ir,this.property),checkFeatureIndependent("globalPercentile","percentile",1,this.percentile),this._copySample=e.sample.map(function(e){return e[t.property.propertyName]}),this._copySample.sort(function(e,t){return e-t})}},{key:"_preDraw",value:function _preDraw(){var e;this._value.value=this.value;for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=dt()(O()(GlobalPercentile.prototype),"_preDraw",this)).call.apply(e,[this].concat(r))}},{key:"_getMinimumNeededSchema",value:function _getMinimumNeededSchema(){return this.property._getMinimumNeededSchema()}},{key:"value",get:function get(){var e=this.percentile.value/100;return this._copySample[Math.floor(e*this._copySample.length)]}}]),GlobalPercentile}(lt),va=function(e){function Zoom(){var e;return p()(this,Zoom),checkMaxArguments(arguments,0,"zoom"),(e=R()(this,O()(Zoom).call(this,{zoom:Ca(0)}))).type="number",Nr()(O()(Zoom.prototype),"inlineMaker",function(e){return e.zoom},qt()(e),!0),e}return B()(Zoom,e),_()(Zoom,[{key:"eval",value:function _eval(){return this.zoom.value}},{key:"_preDraw",value:function _preDraw(e,t,r){this.zoom.value=t.zoomLevel,this.zoom._preDraw(e,t,r)}},{key:"value",get:function get(){return this.zoom.value}}]),Zoom}(lt),ya=function(e){function Placement(e,t){var r;return p()(this,Placement),checkMaxArguments(arguments,2,"placement"),e=implicitCast(e),t=implicitCast(t),(r=R()(this,O()(Placement).call(this,{x:e,y:t}))).inlineMaker=function(e){return"vec2(".concat(e.x,", ").concat(e.y,")")},r.type="placement",r}return B()(Placement,e),_()(Placement,[{key:"eval",value:function _eval(e){return[this.x.eval(e),this.y.eval(e)]}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(Placement.prototype),"_bindMetadata",this).call(this,e),checkType("placement","x",0,"number",this.x),checkType("placement","y",1,"number",this.y)}},{key:"value",get:function get(){return[this.x.value,this.y.value]}}]),Placement}(lt),ga=function(e){function SVG(e){return p()(this,SVG),checkMaxArguments(arguments,1,"svg"),R()(this,O()(SVG).call(this,"data:image/svg+xml,".concat(encodeURIComponent(e))))}return B()(SVG,e),SVG}(_n),ba=function(e){function Zoomrange(e){var t;return p()(this,Zoomrange),e=implicitCast(e),t=R()(this,O()(Zoomrange).call(this,{})),checkExpression("zoomrange","zoomBreakpointList",0,e),t.type="number",t._zoomBreakpointList=e,t.inlineMaker=function(e){return e._impostor},t}return B()(Zoomrange,e),_()(Zoomrange,[{key:"_bindMetadata",value:function _bindMetadata(e){if(this._zoomBreakpointList._bindMetadata(e),checkType("zoomrange","zoomBreakpointList",0,"number-list",this._zoomBreakpointList),this._zoomBreakpointList.elems.length<2)throw new me("zoomrange() function must receive a list with at least two elements.",_e.INCORRECT_VALUE);var t=l()(this._zoomBreakpointList.elems);this._impostor=function _genImpostor(e,t,r){if(1===e.length)return 1;var n=e[0];var a=e[1];e.shift();return ei(t/r,_genImpostor(e,t+1,r),bi(za(2,_o()),za(2,n),za(2,a)))}(t,0,t.length-1),this.childrenNames.push("_impostor"),dt()(O()(Zoomrange.prototype),"_bindMetadata",this).call(this,e)}},{key:"eval",value:function _eval(e){return this._impostor.eval(e)}},{key:"value",get:function get(){return this._zoomBreakpointList.elems.map(function(e){return e.value})}}]),Zoomrange}(lt);var xa=function(e){function Scaled(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return p()(this,Scaled),e=implicitCast(e),r=implicitCast(r),(t=R()(this,O()(Scaled).call(this,{scale:Fa(Ra(e,0),za(2,r))}))).type="number",t.inlineMaker=function(e){return e.scale},t}return B()(Scaled,e),_()(Scaled,[{key:"eval",value:function _eval(e){return this.scale.eval(e)}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(Scaled.prototype),"_bindMetadata",this).call(this,e),checkType("scaled","width",0,"number",this.scale.a.a),checkType("scaled","zoomlevel",1,"number",this.scale.b)}},{key:"_preDraw",value:function _preDraw(e,t,r){this.scale.a.b.value=Math.pow(2,t.zoomLevel),dt()(O()(Scaled.prototype),"_preDraw",this).call(this,e,t,r)}},{key:"value",get:function get(){return this.scale.value}}]),Scaled}(lt),wa=function(e){function AlphaNormalize(e,t){var r;return p()(this,AlphaNormalize),checkMaxArguments(arguments,2,"alphaNormalize"),checkExpression("alphaNormalize","input",0,e),checkExpression("alphaNormalize","normalizer",1,t),(r=R()(this,O()(AlphaNormalize).call(this,{_impostor:ki(e,Fa(t,co(t)))})))._input=e,r._normalizer=t,r.type="color",r.inlineMaker=function(e){return e._impostor},r}return B()(AlphaNormalize,e),_()(AlphaNormalize,[{key:"_bindMetadata",value:function _bindMetadata(e){this._input._bindMetadata(e),this._normalizer._bindMetadata(e),checkType("alphaNormalize","input",0,"color",this._input),checkType("alphaNormalize","normalizer",1,"number",this._normalizer),checkInstance("alphaNormalize","normalizer",1,ir,this._normalizer),dt()(O()(AlphaNormalize.prototype),"_bindMetadata",this).call(this,e)}},{key:"eval",value:function _eval(e){return this._impostor.eval(e)}},{key:"value",get:function get(){return this._impostor.value}}]),AlphaNormalize}(lt),ka=function(e){function Translate(e,t){var r;return p()(this,Translate),checkMaxArguments(arguments,2,"translate"),e=implicitCast(e),t=implicitCast(t),(r=R()(this,O()(Translate).call(this,{x:e,y:t}))).type="transformation",r}return B()(Translate,e),_()(Translate,[{key:"_applyToShaderSource",value:function _applyToShaderSource(e){var t=this.x._applyToShaderSource(e),r=this.y._applyToShaderSource(e);return{preface:this._prefaceCode("\n                ".concat(t.preface,"\n                ").concat(r.preface,"\n\n                vec2 translate").concat(this._uid,"(vec2 p){\n                    return p+vec2(").concat(t.inline,", ").concat(r.inline,");\n                }")),inline:"translate".concat(this._uid)}}},{key:"eval",value:function _eval(e){return[this.x.eval(e),this.y.eval(e)]}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(Translate.prototype),"_bindMetadata",this).call(this,e),checkType("translate","x",0,"number",this.x),checkType("translate","y",1,"number",this.y)}},{key:"value",get:function get(){return[this.x.value,this.y.value]}}]),Translate}(lt),Ta=function(e){function Rotate(e){var t;p()(this,Rotate),checkMaxArguments(arguments,1,"rotate");var r=implicitCast(e);return(t=R()(this,O()(Rotate).call(this,{angle:r}))).type="transformation",t}return B()(Rotate,e),_()(Rotate,[{key:"eval",value:function _eval(e){return this.angle.eval(e)}},{key:"_bindMetadata",value:function _bindMetadata(e){dt()(O()(Rotate.prototype),"_bindMetadata",this).call(this,e),checkType("rotate","angle",0,"number",this.angle)}},{key:"_applyToShaderSource",value:function _applyToShaderSource(e){var t=this.angle._applyToShaderSource(e);return{preface:this._prefaceCode("\n                ".concat(t.preface,"\n\n                #ifndef DEGREES_TO_RADIANS\n                #define DEGREES_TO_RADIANS\n                float degreesToRadians(float degrees){\n                    return degrees/360.*2.*3.14159265359;\n                }\n                #endif\n                \n                vec2 rotate").concat(this._uid,"(vec2 p){\n                    float angle = degreesToRadians(").concat(t.inline,");\n                    mat2 M = mat2(cos(angle), -sin(angle),\n                                  sin(angle),  cos(angle));\n                    return M * p;\n                }")),inline:"rotate".concat(this._uid)}}},{key:"value",get:function get(){return this.angle.value}}]),Rotate}(lt),Ca=function number(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Fr,t)},Ea=function category(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Kt,t)},Ma=function list(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Tn,t)},Aa=function rgb(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Wr,t)},Sa=function rgba(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Hr,t)},Ia=function transition(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(ft,t)},Pa=function in_(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(pt,t)},Da=function nin(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(_t,t)},Na=function between(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(vt,t)},Ra=function mul(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Ot,t)},Fa=function div(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(St,t)},Oa=function add(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Mt,t)},La=function sub(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Vt,t)},za=function pow(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Bt,t)},Ba=function mod(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Ft,t)},Va=function greaterThan(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Pt,t)},Ga=function greaterThanOrEqualTo(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Dt,t)},Ua=function lessThan(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Nt,t)},qa=function lessThanOrEqualTo(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Rt,t)},ja=function equals(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(It,t)},Wa=function notEquals(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Lt,t)},Ha=function and(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(At,t)},Za=function or(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(zt,t)},Ya=Va,Xa=Ga,Qa=Ua,$a=qa,Ja=ja,Ka=Wa,ei=function blend(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Gt,t)},ti=function buckets(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Jt,t)},ri=function cielab(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(rr,t)},ni=function clusterAvg(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(ur,t)},ai=function clusterMax(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(cr,t)},ii=function clusterMin(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(lr,t)},oi=function clusterMode(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(fr,t)},si=function clusterSum(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(hr,t)},ui=function clusterCount(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(dr,t)},ci=function clusterTime(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(vr,t)},li=function constant(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(yr,t)},fi=function image(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(_n,t)},hi=function svg(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(ga,t)},di=function hex(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(gr,t)},pi=function hsl(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(br,t)},mi=function hsla(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(xr,t)},_i=function hsv(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(wr,t)},vi=function hsva(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(kr,t)},yi=function cubic(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Cr,t)},gi=function ilinear(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Tr,t)},bi=function linear(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Ar,t)},xi=function namedColor(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Ir,t)},wi=function now(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Rr,t)},ki=function opacity(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Br,t)},Ti=function asc(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Vr,t)},Ci=function desc(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Gr,t)},Ei=function noOrder(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Ur,t)},Mi=function width(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(qr,t)},Ai=function reverse(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Jr,t)},Si=function property(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(ir,t)},Ii=function globalQuantiles(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(an,t)},Pi=function viewportQuantiles(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(cn,t)},Di=function globalEqIntervals(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(nn,t)},Ni=function viewportEqIntervals(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(un,t)},Ri=function globalStandardDev(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(sn,t)},Fi=function viewportStandardDev(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(ln,t)},Oi=function ramp(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(bn,t)},Li=function time(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Cn,t)},zi=function timeRange(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(En,t)},Bi=function top(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(An,t)},Vi=function fade(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Pn,t)},Gi=function animation(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(On,t)},Ui=function log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Ln,t)},qi=function sqrt(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(zn,t)},ji=function sin(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Bn,t)},Wi=function cos(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Vn,t)},Hi=function tan(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Gn,t)},Zi=function sign(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Un,t)},Yi=function abs(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(qn,t)},Xi=function isNull(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(jn,t)},Qi=function not(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Wn,t)},$i=function floor(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Hn,t)},Ji=function ceil(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Zn,t)},Ki=function variable(){return function variable_variable(e){if(checkMaxArguments(arguments,1,"variable"),checkString("variable","name",0,e),""===e)throw new me("variable(): invalid parameter, zero-length string",_e.INCORRECT_VALUE);var t,r=function resolve(r){if(!r[e])throw new me("variable() with name '".concat(e,"' doesn't exist"),_e.MISSING_REQUIRED);t=r[e]},n=function _getDependencies(){return[t]},a={set:function set(e,r,n){if("parent"===r)e[r]=n;else if("notify"===r)e[r]=n;else{if(!t||!t[r])return!1;t[r]=n}return!0},get:function get(e,a){switch(a){case"propertyName":return t.propertyName;case"name":return t._dimension?t.propertyName:t.name;case"parent":case"notify":case"blendTo":return e[a];case"_resolveAliases":return r;case"_getDependencies":return n;default:if(void 0!==t){var i=t[a];if(void 0!==i)return i.bind?i.bind(t):i}return e[a]}}};return new Proxy(new Yn,a)}.apply(void 0,arguments)},eo=function viewportAvg(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Qn,t)},to=function viewportMax(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()($n,t)},ro=function viewportMin(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Jn,t)},no=function viewportSum(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Kn,t)},ao=function viewportCount(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(ea,t)},io=function viewportPercentile(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(ta,t)},oo=function viewportHistogram(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(ia,t)},so=function viewportFeatures(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(ca,t)},uo=function globalAvg(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(fa,t)},co=function globalMax(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(da,t)},lo=function globalMin(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(pa,t)},fo=function globalSum(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(ma,t)},ho=function globalCount(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(ha,t)},po=function globalPercentile(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(_a,t)},mo=function globalHistogram(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(oa,t)},_o=function zoom(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(va,t)},vo=function scaled(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(xa,t)},yo=function zoomrange(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(ba,t)},go=function placement(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(ya,t)},bo=function translate(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(ka,t)},xo=function rotate(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(Ta,t)},wo=function alphaNormalize(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt()(wa,t)},ko=new yr(Number.MAX_SAFE_INTEGER),To=new yr(1),Co=new yr(0),Eo=new yr(Math.PI),Mo=new yr(Math.E),Ao=new _n(hn.bicycle),So=new _n(hn.building),Io=new _n(hn.bus),Po=new _n(hn.car),Do=new _n(hn.circle),No=new _n(hn.circleOutline),Ro=new _n(hn.cross),Fo=new _n(hn.flag),Oo=new _n(hn.house),Lo=new _n(hn.marker),zo=new _n(hn.markerOutline),Bo=new _n(hn.plus),Vo=new _n(hn.square),Go=new _n(hn.squareOutline),Uo=new _n(hn.star),qo=new _n(hn.starOutline),jo=new _n(hn.triangle),Wo=new _n(hn.triangleOutline),Ho=new ya(li(0),li(0)),Zo=new ya(li(0),li(1)),Yo=r(11),Xo=r.n(Yo),Qo=[],$o={};Object.keys(s).filter(function(e){return e[0]===e[0].toLowerCase()}).map(function(e){$o[e.toLocaleLowerCase()]=s[e]}),$o.true=To,$o.false=Co,$o.align_center=Ho,$o.align_bottom=Zo,$o.pi=Eo,$o.e=Mo,$o.hold=ko,$o.bicycle=Ao,$o.building=So,$o.bus=Io,$o.car=Po,$o.circle=Do,$o.circle_outline=No,$o.cross=Ro,$o.flag=Fo,$o.house=Oo,$o.marker=Lo,$o.marker_outline=zo,$o.plus=Bo,$o.square=Vo,$o.square_outline=Go,$o.star=Uo,$o.star_outline=qo,$o.triangle=jo,$o.triangle_outline=Wo;var Jo=lt.prototype.blendTo;function parser_parseVizExpression(e){prepareJsep();var t=implicitCast(parseNode(Xo()(e)));return cleanJsep(),t}function parseVizNamedExpr(e,t){if(":"!==t.operator)throw new U("Invalid syntax.");t.left.name.length&&"@"===t.left.name[0]&&(t.left.name="__cartovl_variable_"+t.left.name.substr(1));var r=t.left.name;if(!r)throw new U("Invalid syntax.");if(r.startsWith("__cartovl_variable_")){if((r=t.left.name.substr("__cartovl_variable_".length))in e.variables)throw new U("Variable '".concat(r,"' is already defined."));e.variables[r]=implicitCast(parseNode(t.right))}else{if(r in e)throw new U("Property '".concat(r,"' is already defined."));var n=parseNode(t.right);e[r]="resolution"===r?n:implicitCast(n)}}function parseNode(e){if("CallExpression"===e.type)return function parseFunctionCall(e){var t=e.callee.name.toLowerCase();if(Qo.includes(t))return e.arguments.map(function(e){return parseNode(e)})[0];var r=e.arguments.map(function(e){return parseNode(e)});if($o[t])return $o[t].apply($o,l()(r));throw new U("Invalid function name '".concat(e.callee.name,"'."))}(e);if("Literal"===e.type)return e.value;if("ArrayExpression"===e.type)return e.elements.map(function(e){return parseNode(e)});if("BinaryExpression"===e.type)return function parseBinaryOperation(e){var t=parseNode(e.left),r=parseNode(e.right);switch(e.operator.toLowerCase()){case"*":return Ra(t,r);case"/":return Fa(t,r);case"+":return Oa(t,r);case"-":return La(t,r);case"%":return Ba(t,r);case"^":return za(t,r);case">":return Va(t,r);case">=":return Ga(t,r);case"<":return Ua(t,r);case"<=":return qa(t,r);case"==":return ja(t,r);case"!=":return Wa(t,r);case"and":return Ha(t,r);case"or":return Za(t,r);case"in":return Pa(t,r);case"nin":return Da(t,r);default:throw new U("Invalid binary operator '".concat(e.operator,"'."))}}(e);if("UnaryExpression"===e.type)return function parseUnaryOperation(e){switch(e.operator){case"-":return Ra(-1,parseNode(e.argument));case"+":return parseNode(e.argument);default:throw new U("Invalid unary operator '".concat(e.operator,"'."))}}(e);if("Identifier"===e.type)return function parseIdentifier(e){if(e.name.length&&"@"===e.name[0]&&(e.name="__cartovl_variable_"+e.name.substr(1)),e.name.startsWith("__cartovl_variable_"))return Ki(e.name.substr("__cartovl_variable_".length));if("#"===e.name[0])return new gr(e.name);if("$"===e.name[0])return Si(e.name.substring(1));if(Xr[e.name.toUpperCase()])return Xr[e.name.toUpperCase()];if($o[e.name.toLowerCase()])return $o[e.name.toLowerCase()];if(Sr.includes(e.name.toLowerCase()))return new Ir(e.name.toLowerCase());throw new U("Invalid expression '".concat(JSON.stringify(e),"'."))}(e);throw new U("Invalid expression '".concat(JSON.stringify(e),"'."))}function prepareJsep(){Xo.a.addBinaryOp(":",0),Xo.a.addBinaryOp("^",11),Xo.a.addBinaryOp("or",1),Xo.a.addBinaryOp("OR",1),Xo.a.addBinaryOp("and",2),Xo.a.addBinaryOp("AND",2),Xo.a.addBinaryOp("in",13),Xo.a.addBinaryOp("IN",1),Xo.a.addBinaryOp("nin",13),Xo.a.addBinaryOp("NIN",13),Xo.a.addIdentifierChar("@"),Xo.a.addIdentifierChar("#"),Xo.a.removeLiteral("true"),Xo.a.removeLiteral("false")}function cleanJsep(){Xo.a.removeBinaryOp("in"),Xo.a.removeBinaryOp("IN"),Xo.a.removeBinaryOp("nin"),Xo.a.removeBinaryOp("NIN"),Xo.a.removeBinaryOp("and"),Xo.a.removeBinaryOp("AND"),Xo.a.removeBinaryOp("or"),Xo.a.removeBinaryOp("OR"),Xo.a.removeBinaryOp("^"),Xo.a.removeBinaryOp(":"),Xo.a.removeIdentifierChar("@"),Xo.a.removeIdentifierChar("#"),Xo.a.addLiteral("true"),Xo.a.addLiteral("false")}lt.prototype.blendTo=function(e){"string"==typeof e&&(e=parser_parseVizExpression(e));for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Jo.bind(this).apply(void 0,[e].concat(r))};var Ko=r(49),es=r.n(Ko),ts=r(50),rs=r.n(ts),ns=r(51),as=r.n(ns),is=r(52),os=r.n(is),ss=r(53),us=r.n(ss),cs=r(54),ls=r.n(cs),fs=function(){function Viz(e){var t=this;p()(this,Viz);var r=this._getVizDefinition(e);this._checkVizSpec(r),Object.keys(r).forEach(function(e){t._defineProperty(e,r[e])}),Object.keys(r).includes("variables")||this._defineProperty("variables",{}),this.updated=!0,this._changeCallback=null,this._updateRootExpressionList(),this._updateRootExpressions(),this._resolveAliases(),this._validateAliasDAG()}return _()(Viz,[{key:"loadImages",value:function loadImages(){return Promise.all(this._getRootExpressions().map(function(e){return e.loadImages()}))}},{key:"_ignoreChangeRejections",value:function _ignoreChangeRejections(){return{}}},{key:"_defineProperty",value:function _defineProperty(e,t){var r=this;if("variables"===e||sa.includes(e)){Object.defineProperty(this,e,{get:function get(){return r["_"+e]},set:function set(t){r["_"+e]=implicitCast(t),r._changed().catch(r._ignoreChangeRejections)}});var n=t;if("variables"===e){var a=!1;n=new Proxy({},{get:function get(e,t){return e[t]},set:function set(e,t,n){return(n=implicitCast(n))instanceof lt&&(n._variableName=t),e[t]=n,r["__cartovl_variable_"+t]=n,a&&r._changed().catch(r._ignoreChangeRejections),!0}}),Object.keys(t).map(function(e){n[e]=t[e]}),a=!0}this["_"+e]=n}}},{key:"_getRootExpressions",value:function _getRootExpressions(){return this._rootExpressions}},{key:"_getRootStyleExpressions",value:function _getRootStyleExpressions(){return this._rootStyleExpressions}},{key:"_updateRootExpressions",value:function _updateRootExpressions(){var e=this;this._getRootExpressions().forEach(function(t){t.parent=e,t.notify=e._changed.bind(e)})}},{key:"isAnimated",value:function isAnimated(){return this._getRootStyleExpressions().some(function(e){return e.isAnimated()})}},{key:"isPlaying",value:function isPlaying(){return this._getRootStyleExpressions().some(function(e){return e.isPlaying()})}},{key:"onChange",value:function onChange(e){this._changeCallback=e}},{key:"_changed",value:function _changed(){return this._updateRootExpressionList(),this._resolveAliases(),this._validateAliasDAG(),this._changeCallback?this._changeCallback(this):Promise.resolve(null)}},{key:"_updateRootExpressionList",value:function _updateRootExpressionList(){var e=this,t=l()(sa).map(function(t){return e[t]}),r=l()(ua).map(function(t){return e[t]}),n=l()(Object.values(this.variables));this._rootExpressions=l()(t).concat(l()(n)),this._rootStyleExpressions=r}},{key:"getMinimumNeededSchema",value:function getMinimumNeededSchema(){return this._getRootExpressions().filter(function(e){return e&&e._getMinimumNeededSchema}).map(function(e){return e._getMinimumNeededSchema()}).reduce(Se.union,Se.IDENTITY)}},{key:"setDefaultsIfRequired",value:function setDefaultsIfRequired(e){if(this._geomType=e,!this._appliedDefaults){var t=this._getDefaultGeomStyle(e);t&&(this._appliedDefaults=!0,this.color.default&&(this.color=t.COLOR_EXPRESSION()),this.width.default&&(this.width=t.WIDTH_EXPRESSION()),this.strokeColor.default&&(this.strokeColor=t.STROKE_COLOR_EXPRESSION()),this.strokeWidth.default&&(this.strokeWidth=t.STROKE_WIDTH_EXPRESSION()),this._updateRootExpressions())}}},{key:"_getDefaultGeomStyle",value:function _getDefaultGeomStyle(e){return e===ve.POINT?{COLOR_EXPRESSION:function COLOR_EXPRESSION(){return _markDefault(di("#EE4D5A"))},WIDTH_EXPRESSION:function WIDTH_EXPRESSION(){return _markDefault(Ca(7))},STROKE_COLOR_EXPRESSION:function STROKE_COLOR_EXPRESSION(){return _markDefault(di("#FFF"))},STROKE_WIDTH_EXPRESSION:function STROKE_WIDTH_EXPRESSION(){return _markDefault(Ca(1))}}:e===ve.LINE?{COLOR_EXPRESSION:function COLOR_EXPRESSION(){return _markDefault(di("#4CC8A3"))},WIDTH_EXPRESSION:function WIDTH_EXPRESSION(){return _markDefault(Ca(1.5))},STROKE_COLOR_EXPRESSION:function STROKE_COLOR_EXPRESSION(){return _markDefault(di("#FFF"))},STROKE_WIDTH_EXPRESSION:function STROKE_WIDTH_EXPRESSION(){return _markDefault(Ca(1))}}:e===ve.POLYGON?{COLOR_EXPRESSION:function COLOR_EXPRESSION(){return _markDefault(di("#826DBA"))},WIDTH_EXPRESSION:function WIDTH_EXPRESSION(){return _markDefault(Ca(1))},STROKE_COLOR_EXPRESSION:function STROKE_COLOR_EXPRESSION(){return _markDefault(di("#FFF"))},STROKE_WIDTH_EXPRESSION:function STROKE_WIDTH_EXPRESSION(){return _markDefault(Ca(1))}}:void 0}},{key:"_resolveAliases",value:function _resolveAliases(){var e=this;this._getRootExpressions().forEach(function(t){t._resolveAliases(e.variables)})}},{key:"_validateAliasDAG",value:function _validateAliasDAG(){for(var e=new Set,t=new Set,r=function visit(r){if(!e.has(r)){if(t.has(r))throw new Pe("Viz contains a circular dependency");t.add(r),r._getDependencies().forEach(visit),e.add(r)}},n=this._getRootExpressions().map(function(e){return e._getDependencies()}).reduce(function(e,t){return l()(e).concat(l()(t))},[]);n.length;)r(n.pop())}},{key:"_bindMetadata",value:function _bindMetadata(e){var t=this;this._colorShader=null,this._widthShader=null,this._strokeColorShader=null,this._strokeWidthShader=null,this._filterShader=null,this._symbolShader=null,this._pointShader=null,this._lineShader=null,this._polygonShader=null,this.metadata=e,this._getRootExpressions().forEach(function(e){return e._bindMetadata(t.metadata)}),function checkVizPropertyTypes(e){var t={color:"color",filter:"number",order:"orderer",resolution:"number",strokeColor:"color",strokeWidth:"number",symbol:"image",symbolPlacement:"placement",transform:"transformation",width:"number"};Object.keys(t).forEach(function(r){var n=e[r].type,a=t[r];if(n!==a)throw new me("Viz property '".concat(r,"': must be of type '").concat(a,"' but it was of type '").concat(n,"'"),_e.INCORRECT_TYPE)})}(this)}},{key:"_compileShader",value:function _compileShader(e,t,r){return this["_"+e]||(this["_"+e]=compileShader(this.gl,t,r)),this["_"+e]}},{key:"replaceChild",value:function replaceChild(e,t){var r=this;if(Object.values(this.variables).includes(e)){var n=Object.keys(this.variables).find(function(t){return r.variables[t]===e});this.variables[n]=t,t.parent=this,t.notify=e.notify}else{var a=sa.find(function(t){return r[t]===e});if(!a)throw new Pe("No child found");this[a]=t,t.parent=this,t.notify=e.notify}}},{key:"_getVizDefinition",value:function _getVizDefinition(e){if(ke.isUndefined(e))return this._setDefaults({});if(ke.isObject(e))return this._setDefaults(e);if(ke.isString(e))return this._setDefaults(function parseVizDefinition(e){prepareJsep();var t=Xo()(function cleanComments(e){for(var t={singleQuote:!1,doubleQuote:!1,blockComment:!1,lineComment:!1,escape:0},r=0,n=(e=("_"+e+"_").split("")).length;r<n;r++)if(t.singleQuote)"\\"===e[r]?t.escape++:"'"===e[r]&&t.escape%2==0&&(t.singleQuote=!1,t.escape=0);else if(t.doubleQuote)"\\"===e[r]?t.escape++:'"'===e[r]&&t.escape%2==0&&(t.doubleQuote=!1,t.escape=0);else if(t.blockComment)"*"===e[r]&&"/"===e[r+1]&&(e[r+1]="",t.blockComment=!1),e[r]="";else if(t.lineComment)"\n"!==e[r+1]&&"\r"!==e[r+1]||(t.lineComment=!1),r+1<n&&(e[r]="");else if(t.doubleQuote='"'===e[r],t.singleQuote="'"===e[r],"/"===e[r]){if("*"===e[r+1]){e[r]="",t.blockComment=!0;continue}if("/"===e[r+1]){e[r]="",t.lineComment=!0;continue}}return e.join("").slice(1,-1)}(e)),r={variables:{}};return"Compound"===t.type?t.body.map(function(e){return parseVizNamedExpr(r,e)}):parseVizNamedExpr(r,t),cleanJsep(),r}(e));throw new me("viz 'definition' should be a vizSpec object or a valid viz string.",_e.INCORRECT_VALUE)}},{key:"_setDefaults",value:function _setDefaults(e){return ke.isUndefined(e.color)&&(e.color=ke.isUndefined(e.symbol)?function DEFAULT_COLOR_EXPRESSION(){return _markDefault(Aa(0,0,0))}():noOverrideColor()),ke.isUndefined(e.width)&&(e.width=function DEFAULT_WIDTH_EXPRESSION(){return _markDefault(Ca(1))}()),ke.isUndefined(e.strokeColor)&&(e.strokeColor=function DEFAULT_STROKE_COLOR_EXPRESSION(){return _markDefault(Aa(0,0,0))}()),ke.isUndefined(e.strokeWidth)&&(e.strokeWidth=function DEFAULT_STROKE_WIDTH_EXPRESSION(){return _markDefault(Ca(0))}()),ke.isUndefined(e.order)&&(e.order=function DEFAULT_ORDER_EXPRESSION(){return _markDefault(Ei())}()),ke.isUndefined(e.filter)&&(e.filter=function DEFAULT_FILTER_EXPRESSION(){return _markDefault(li(1))}()),ke.isUndefined(e.resolution)&&(e.resolution=function DEFAULT_RESOLUTION(){return _markDefault(Ca(1))}()),ke.isUndefined(e.symbol)&&(e.symbol=function DEFAULT_SYMBOL_EXPRESSION(){return _markDefault(new _n(hn.circle))}()),ke.isUndefined(e.symbolPlacement)&&(e.symbolPlacement=function DEFAULT_SYMBOLPLACEMENT_EXPRESSION(){return _markDefault(new ya(li(0),li(1)))}()),ke.isUndefined(e.transform)&&(e.transform=function DEFAULT_TRANSFORM_EXPRESSION(){return _markDefault(new ka(li(0),li(0)))}()),e.variables=e.variables||{},e}},{key:"_checkResolution",value:function _checkResolution(e){var t=e instanceof lt?e.eval():e;if(!ke.isNumber(t))throw new me("'resolution' property must be a number.",_e.INCORRECT_TYPE);if(e<=0)throw new me("'resolution' is ".concat(e,", must be greater than ").concat(0,"."),_e.INCORRECT_VALUE);if(e>=256)throw new me("'resolution' is ".concat(e,", must be lower than ").concat(256,"."),_e.INCORRECT_VALUE)}},{key:"_applyImplitCastToNumericProperties",value:function _applyImplitCastToNumericProperties(e){e.filter=implicitCast(e.filter),e.resolution=implicitCast(e.resolution),e.strokeWidth=implicitCast(e.strokeWidth),e.symbol=implicitCast(e.symbol),e.symbolPlacement=implicitCast(e.symbolPlacement),e.transform=implicitCast(e.transform),e.width=implicitCast(e.width)}},{key:"_checkVizSpec",value:function _checkVizSpec(e){for(var t in this._applyImplitCastToNumericProperties(e),this._checkResolution(e.resolution),sa.forEach(function(t){if(!(e[t]instanceof lt))throw new me("'".concat(t,"' parameter is not a valid viz Expresion."),_e.INCORRECT_TYPE)}),e)"variables"!==t&&-1===sa.indexOf(t)&&console.warn("Property '".concat(t,"' is not supported"))}},{key:"toString",value:function toString(){var e=this,t=Object.keys(this.variables).map(function(t){return"@".concat(t,": ").concat(e.variables[t].toString())}),r=sa.map(function(t){return"".concat(t,": ").concat(e[t].toString())});return l()(t).concat(l()(r)).join("\n")}},{key:"geometryType",get:function get(){return this._geomType}},{key:"colorMetaShader",get:function get(){return this._compileShader("colorShader",Ke.styler.colorShaderGLSL,{color:this.color})}},{key:"widthMetaShader",get:function get(){return this._compileShader("widthShader",Ke.styler.widthShaderGLSL,{width:this.width})}},{key:"strokeColorMetaShader",get:function get(){return this._compileShader("strokeColorShader",Ke.styler.colorShaderGLSL,{color:this.strokeColor})}},{key:"strokeWidthMetaShader",get:function get(){return this._compileShader("strokeWidthShader",Ke.styler.widthShaderGLSL,{width:this.strokeWidth})}},{key:"filterMetaShader",get:function get(){return this._compileShader("filterShader",Ke.styler.filterShaderGLSL,{filter:this.filter})}},{key:"symbolMetaShader",get:function get(){return this._compileShader("symbolShader",Ke.symbolizer.symbolShaderGLSL,{symbol:this.symbol,symbolPlacement:this.symbolPlacement,transform:this.transform})}},{key:"pointMetaShader",get:function get(){return this._compileShader("pointShader",{vertexShader:es.a,fragmentShader:rs.a},{transform:this.transform})}},{key:"lineMetaShader",get:function get(){return this._compileShader("lineShader",{vertexShader:as.a,fragmentShader:os.a},{transform:this.transform})}},{key:"polygonMetaShader",get:function get(){return this._compileShader("polygonShader",{vertexShader:us.a,fragmentShader:ls.a},{transform:this.transform})}}]),Viz}();function _markDefault(e){return e.default=!0,e}var hs=function mitt(e){return e=e||Object.create(null),{on:function on(t,r){(e[t]||(e[t]=[])).push(r)},off:function off(t,r){e[t]&&e[t].splice(e[t].indexOf(r)>>>0,1)},emit:function emit(t,r){(e[t]||[]).slice().map(function(e){e(r)}),(e["*"]||[]).slice().map(function(e){e(t,r)})}}},ds=function Base(){p()(this,Base)};function runViewportAggregations(e){var t=function _getViewportExpressions(e){var t=[];return e.map(function dfs(e){e._isViewport?t.push(e):e._getChildren().map(dfs)}),t}(e.viz._getRootExpressions());t.length&&(!function ViewportAggCalculator_reset(e,t){var r=t.viz.metadata;e.forEach(function(e){return e._resetViewportAgg(r,t)})}(t,e),function _runInActiveDataframes(e,t){var r=t.getActiveDataframes(),n=function _runInDataframes(e,t,r){var n=new Set,a=t.viz,i=new Set;return r.forEach(function(t){!function _runInDataframe(e,t,r,n,a){for(var i=function _loop(i){var o=e.metadata.idProperty,s=r.properties[o][i],u=n.has(s);if(u)return"continue";var c=!r.inViewport(i);if(c)return"continue";n.add(s);var l=r.getFeature(i),f=e.filter.eval(l)<_s;if(f)return"continue";a.add(l[o]),t.forEach(function(e){return e.accumViewportAgg(l)})},o=0;o<r.numFeatures;o++)i(o)}(a,e,t,n,i)}),i}(e,t,r);!function _runImprovedForPartialFeatures(e,t,r){if(0===r.size)return;if(t.viz.geometryType===ve.POINT)return;var n=e.filter(function(e){return e.isA(ca)});n.length>0&&function _runForPartialViewportFeatures(e,t,r){e.forEach(function(e){return e._resetViewportAgg(null,t)});var n=t.getAllPiecesPerFeature(r);e.forEach(function(e){for(var t in n)e.accumViewportAgg(n[t])})}(n,t,r)}(e,t,n)}(t,e))}var ps=Date.now(),ms=ps;requestAnimationFrame(function refreshClock(){ms=(Date.now()-ps)/1e3;requestAnimationFrame(refreshClock)});var _s=.5,vs=1024,ys=8,gs=function(){function Renderer(e){p()(this,Renderer),e&&(this.gl=getValidWebGLContextOrThrow(e),this._initGL(this.gl)),this._center={x:0,y:0},this._zoom=1,this.RTT_WIDTH=vs,this.dataframes=[]}return _()(Renderer,[{key:"initialize",value:function initialize(e){e=getValidWebGLContextOrThrow(null,e),this._initGL(e)}},{key:"_initGL",value:function _initGL(e){this.gl=e,this._initShaders(),this.auxFB=e.createFramebuffer(),this.bigTriangleVBO=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.bigTriangleVBO);var t=new Float32Array([10,-10,0,10,-10,-10]);e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.zeroTex=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.zeroTex),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),this._AATex=e.createTexture(),this._AAFB=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindTexture(e.TEXTURE_2D,this.zeroTex)}},{key:"_getAspect",value:function _getAspect(){return this.gl?this.gl.canvas.width/this.gl.canvas.height:1}},{key:"renderLayer",value:function renderLayer(e,t){var r=this;this.drawMetadata=t;var n=e.getActiveDataframes(),a=e.viz;if(a){var i=this.gl;if(this._updateDataframeMatrices(n),e.parseVizExpression=parser_parseVizExpression,runViewportAggregations(e),n.length){a._getRootExpressions().map(function(e){return e._dataReady()}),i.enable(i.CULL_FACE),i.disable(i.BLEND),i.disable(i.DEPTH_TEST),i.disable(i.STENCIL_TEST),i.depthMask(!1),i.bindFramebuffer(i.FRAMEBUFFER,this.auxFB);var o=function styleDataframe(e,n,a,o){var s=a.shader,u=a.textureIds;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,n,0),i.viewport(0,0,vs,e.getSize().height),i.clear(i.COLOR_BUFFER_BIT),i.useProgram(s.program),t.freeTexUnit=Object.keys(u).length,o._setTimestamp(ms),o._preDraw(s.program,t,i),Object.keys(u).forEach(function(t,r){i.activeTexture(i.TEXTURE0+r),i.bindTexture(i.TEXTURE_2D,e.getPropertyTexture(t)),i.uniform1i(u[t],r)}),i.enableVertexAttribArray(s.vertexAttribute),i.bindBuffer(i.ARRAY_BUFFER,r.bigTriangleVBO),i.vertexAttribPointer(s.vertexAttribute,2,i.FLOAT,!1,0,0),i.drawArrays(i.TRIANGLES,0,3),i.disableVertexAttribArray(s.vertexAttribute)};if(n.map(function(e){return o(e,e.texColor,a.colorMetaShader,a.color)}),n[0].type!==ve.POLYGON&&n.map(function(e){return o(e,e.texWidth,a.widthMetaShader,a.width)}),n[0].type!==ve.LINE&&(n.map(function(e){return o(e,e.texStrokeColor,a.strokeColorMetaShader,a.strokeColor)}),n.map(function(e){return o(e,e.texStrokeWidth,a.strokeWidthMetaShader,a.strokeWidth)})),n.map(function(e){return o(e,e.texFilter,a.filterMetaShader,a.filter)}),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.enable(i.BLEND),e.type===ve.POINT)i.bindFramebuffer(i.FRAMEBUFFER,null),i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight);else{var s=(window.devicePixelRatio||1)>=2?1:2;i.bindFramebuffer(i.FRAMEBUFFER,this._AAFB);var u=[i.drawingBufferWidth,i.drawingBufferHeight],c=u[0],l=u[1];if(c!==this._width||l!==this._height){i.bindTexture(i.TEXTURE_2D,this._AATex),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,c*s,l*s,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this._AATex,0);var f=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,f),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,c*s,l*s),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,f);var h=[c,l];this._width=h[0],this._height=h[1]}i.viewport(0,0,c*s,l*s),i.clear(i.COLOR_BUFFER_BIT)}var d=function getOrderingRenderBuckets(e){var t=e.viz.order,r=[0],n=[1030];t.isA(Vr)?(r=Array.from({length:64},function(e,t){return 2*(63-t)}),n=Array.from({length:64},function(e,t){return 0===t?1030:2*(63-t+1)})):t.isA(Gr)&&(r=Array.from({length:64},function(e,t){return 2*t}),n=Array.from({length:64},function(e,t){return 63===t?1030:2*(t+1)}));return{orderingMins:r,orderingMaxs:n}}(e),p=d.orderingMins,m=d.orderingMaxs;n[0].type!==ve.LINE&&n[0].type!==ve.POLYGON||(i.clearDepth(1),i.depthRange(0,1),i.depthFunc(i.NOTEQUAL),i.depthMask(!0),i.enable(i.DEPTH_TEST));p.map(function(e,r){!function renderDrawPass(e){n.forEach(function(r){var n=0,o=null,s=(o=a.symbol.default?r.type===ve.POINT?a.pointMetaShader:r.type===ve.LINE?a.lineMetaShader:a.polygonMetaShader:a.symbolMetaShader).shader;if(i.useProgram(s.program),i.uniform1f(s.orderMinWidth,p[e]),i.uniform1f(s.orderMaxWidth,m[e]),i.uniform1f(s.normalScale,1/(512*Math.pow(2,t.zoomLevel)*r.scale)),i.uniform2f(s.resolution,i.canvas.width/window.devicePixelRatio,i.canvas.height/window.devicePixelRatio),i.enableVertexAttribArray(s.vertexPositionAttribute),i.bindBuffer(i.ARRAY_BUFFER,r.vertexBuffer),i.vertexAttribPointer(s.vertexPositionAttribute,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(s.featureIdAttr),i.bindBuffer(i.ARRAY_BUFFER,r.featureIDBuffer),i.vertexAttribPointer(s.featureIdAttr,2,i.FLOAT,!1,0,0),r.type!==ve.LINE&&r.type!==ve.POLYGON||(i.enableVertexAttribArray(s.normalAttr),i.bindBuffer(i.ARRAY_BUFFER,r.normalBuffer),i.vertexAttribPointer(s.normalAttr,2,i.FLOAT,!1,0,0)),i.activeTexture(i.TEXTURE0+n),i.bindTexture(i.TEXTURE_2D,r.texColor),i.uniform1i(s.colorTexture,n),n++,i.activeTexture(i.TEXTURE0+n),i.bindTexture(i.TEXTURE_2D,r.texFilter),i.uniform1i(s.filterTexture,n),n++,"point"!==r.type&&"line"!==r.type||(i.activeTexture(i.TEXTURE0+n),i.bindTexture(i.TEXTURE_2D,r.texWidth),i.uniform1i(s.widthTexture,n),n++),a.symbol.default)r.type!==ve.LINE&&(i.activeTexture(i.TEXTURE0+n),i.bindTexture(i.TEXTURE_2D,r.texStrokeColor),i.uniform1i(s.strokeColorTexture,n),n++,i.activeTexture(i.TEXTURE0+n),i.bindTexture(i.TEXTURE_2D,r.texStrokeWidth),i.uniform1i(s.strokeWidthTexture,n),n++);else{var u=o.textureIds;t.freeTexUnit=n+Object.keys(u).length,a.symbol._setTimestamp(ms),a.symbol._preDraw(s.program,t,i),a.symbolPlacement._setTimestamp(ms),a.symbolPlacement._preDraw(s.program,t,i),n=t.freeTexUnit,Object.keys(u).forEach(function(e){i.activeTexture(i.TEXTURE0+n),i.bindTexture(i.TEXTURE_2D,r.getPropertyTexture(e)),i.uniform1i(u[e],n),n++})}if(r.type!==ve.LINE&&r.type!==ve.POLYGON||i.clear(i.DEPTH_BUFFER_BIT),!a.transform.default){var c=o.textureIds;t.freeTexUnit=n+Object.keys(c).length,a.transform._setTimestamp(ms),a.transform._preDraw(s.program,t,i),n=t.freeTexUnit,Object.keys(c).forEach(function(e){i.activeTexture(i.TEXTURE0+n),i.bindTexture(i.TEXTURE_2D,r.getPropertyTexture(e)),i.uniform1i(c[e],n),n++}),i.uniform2f(s.resolution,i.canvas.width,i.canvas.height)}i.uniformMatrix4fv(s.matrix,!1,r.matrix),i.drawArrays(i.TRIANGLES,0,r.numVertex),i.disableVertexAttribArray(s.vertexPositionAttribute),i.disableVertexAttribArray(s.featureIdAttr),r.type!==ve.LINE&&r.type!==ve.POLYGON||(i.disableVertexAttribArray(s.normalAttr),i.disable(i.DEPTH_TEST))})}(r)}),e.type!==ve.POINT&&(i.bindFramebuffer(i.FRAMEBUFFER,null),i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight),i.useProgram(this._aaBlendShader.program),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this._AATex),i.uniform1i(this._aaBlendShader.readTU,0),i.enableVertexAttribArray(this._aaBlendShader.vertexAttribute),i.bindBuffer(i.ARRAY_BUFFER,this.bigTriangleVBO),i.vertexAttribPointer(this._aaBlendShader.vertexAttribute,2,i.FLOAT,!1,0,0),i.drawArrays(i.TRIANGLES,0,3),i.disableVertexAttribArray(this._aaBlendShader.vertexAttribute)),i.disable(i.CULL_FACE)}}}},{key:"_updateDataframeMatrices",value:function _updateDataframeMatrices(e){var t=this;e.forEach(function(e){var r=[],a=[];n.copy(r,t.matrix),n.identity(a),n.translate(a,a,[.5,.5,0]),n.scale(a,a,[.5,-.5,1]),n.translate(a,a,[e.center.x,e.center.y,0]),n.scale(a,a,[e.scale,e.scale,1]),n.multiply(r,r,a),e.matrix=r})}},{key:"_initShaders",value:function _initShaders(){this._aaBlendShader=new Ke.AABlender(this.gl)}}]),Renderer}();function getValidWebGLContextOrThrow(e,t){var r=unsupportedBrowserReasons(e,t,!0);if(r.length>0)throw r[0];return t}function isBrowserSupported(e,t){return 0===unsupportedBrowserReasons(e,t).length}function unsupportedBrowserReasons(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[];if(t||(e||(e=document.createElement("canvas")),t=e.getContext("webgl")||e.getContext("experimental-webgl")),!t)return n.push(new Pe("WebGL 1 is unsupported",De.WEB_GL)),n;if(!t.getExtension("OES_texture_float")&&(n.push(new Pe("WebGL extension 'OES_texture_float' is unsupported",De.WEB_GL)),r))return n;var a=t.getParameter(t.MAX_RENDERBUFFER_SIZE);a<vs&&n.push(new Pe("WebGL parameter 'gl.MAX_RENDERBUFFER_SIZE' is below the requirement: ".concat(a," < ").concat(vs),De.WEB_GL));var i=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return i<ys&&n.push(new Pe("WebGL parameter 'gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS' is below the requirement: ".concat(i," < ").concat(ys),De.WEB_GL)),n}var bs=function(){function FeatureVizProperty(e,t,r,n,a,i){p()(this,FeatureVizProperty),this._propertyName=e,this._properties=t,this._viz=r,this.blendTo=generateBlenderFunction(e,t[i],n,r,a,i,parser_parseVizExpression),this.reset=generateResetFunction(e,t[i],n,r,i)}return _()(FeatureVizProperty,[{key:"eval",value:function _eval(){for(var e=this,t=[],r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return n.forEach(function(r){var n={};n[r]=e._properties[r],t.push(n)}),this._viz[this._propertyName].eval(t)}},{key:"value",get:function get(){return this._viz[this._propertyName].eval(this._properties)}}]),FeatureVizProperty}(),xs=function(){function Feature(e,t){var r=t.viz,n=t.customizedFeatures,a=t.trackFeatureViz,i=t.idProperty,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];p()(this,Feature),this.id=e[i],this._rawFeature=e,this._featureVizParams={rawFeature:e,viz:r,customizedFeatures:n,trackFeatureViz:a,idProperty:i},this._defineVizProperties(),this._defineVizVariables(),this._defineFeatureProperties(o)}return _()(Feature,[{key:"_defineVizProperties",value:function _defineVizProperties(){var e=this;sa.forEach(function(t){e[t]=e._buildFeatureVizProperty(t)})}},{key:"_buildFeatureVizProperty",value:function _buildFeatureVizProperty(e){var t=this._featureVizParams,r=t.rawFeature,n=t.viz,a=t.customizedFeatures,i=t.trackFeatureViz,o=t.idProperty;return new bs(e,r,n,a,i,o)}},{key:"_defineVizVariables",value:function _defineVizVariables(){var e=this,t={},r=this._featureVizParams.viz.variables;Object.keys(r).forEach(function(r){var n="__cartovl_variable_".concat(r);t[r]=e._buildFeatureVizProperty(n)}),this.variables=t}},{key:"_defineFeatureProperties",value:function _defineFeatureProperties(e){var t=this;e.forEach(function(e){Object.defineProperty(t,e,{get:function get(){return this._rawFeature[e]}})})}},{key:"blendTo",value:function blendTo(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;Object.keys(e).forEach(function(n){if(!sa.includes(n))throw new me("Property '".concat(n,"' is not a valid viz property"),_e.INCORRECT_VALUE);var a=e[n];t[n].blendTo(a,r)})}},{key:"reset",value:function reset(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;for(var r in sa.forEach(function(r){e[r].reset(t)}),this.variables)this.variables[r].reset(t)}},{key:"getRenderedCentroid",value:function getRenderedCentroid(){return this._rawFeature._dataframe.getRenderedCentroid(this._rawFeature._index)}}]),Feature}(),ws=function(){function RenderLayer(){p()(this,RenderLayer),this.dataframes=[],this.renderer=null,this.viz=null,this.type=null,this.customizedFeatures={},this.idProperty=null}return _()(RenderLayer,[{key:"addDataframe",value:function addDataframe(e){this.type&&this._checkDataframeType(e),this.type=e.type,this.renderer&&e.bindRenderer(this.renderer),this.dataframes.push(e),this.idProperty=e.metadata.idProperty}},{key:"setRenderer",value:function setRenderer(e){this.renderer=e,this.dataframes.forEach(function(t){return t.bindRenderer(e)})}},{key:"setViz",value:function setViz(e){this.viz=e}},{key:"getActiveDataframes",value:function getActiveDataframes(){this.dataframes=this.dataframes.filter(function(e){return!e.freed});var e=this.dataframes.filter(function(e){return e.active&&e.numVertex});return e.length&&void 0!==e[0].orderID&&(e=e.sort(function(e,t){return e.orderID-t.orderID})),e}},{key:"hasDataframes",value:function hasDataframes(){return this.getActiveDataframes().length>0}},{key:"getNumFeatures",value:function getNumFeatures(){return this.getActiveDataframes().map(function(e){return e.numFeatures}).reduce(function(e,t){return e+t},0)}},{key:"_checkDataframeType",value:function _checkDataframeType(e){if(this.type!==e.type)throw new me("Layer dataframes must always be of the same type",_e.INCORRECT_TYPE)}},{key:"getFeaturesAtPosition",value:function getFeaturesAtPosition(e){return this.viz?this.viz.geometryType===ve.POINT?this._getPointFeaturesAtPosition(e):this._getPartialFeaturesAtPosition(e):[]}},{key:"_getPointFeaturesAtPosition",value:function _getPointFeaturesAtPosition(e){var t=this;return this._getRawFeaturesAtPosition(e).map(function(e){return t._buildFeatureFromRaw(e)})}},{key:"_buildFeatureFromRaw",value:function _buildFeatureFromRaw(e){var t=this.viz,r=this.customizedFeatures,n=this.trackFeatureViz,a=this.idProperty;return new xs(e,{viz:t,customizedFeatures:r,trackFeatureViz:n,idProperty:a})}},{key:"_getRawFeaturesAtPosition",value:function _getRawFeaturesAtPosition(e){var t,r=this;return(t=[]).concat.apply(t,l()(this.getActiveDataframes().map(function(t){return t.getFeaturesAtPosition(e,r.viz)})))}},{key:"_getPartialFeaturesAtPosition",value:function _getPartialFeaturesAtPosition(e){var t=this._getRawFeaturesAtPosition(e);if(0===t.length)return[];var r=this._getPartialFeaturesFromSingle(t);return this._getCompoundFeaturesFrom(r)}},{key:"_getCompoundFeaturesFrom",value:function _getCompoundFeaturesFrom(e){var t=this,r=[];for(var n in e){var a=e[n].map(function(e){return t._buildFeatureFromRaw(e)});r.push(getCompoundFeature(a))}return r}},{key:"_getPartialFeaturesFromSingle",value:function _getPartialFeaturesFromSingle(e){var t=this,r=new Set(e.map(function(e){return e[t.idProperty]}));return this.getAllPiecesPerFeature(r)}},{key:"getAllPiecesPerFeature",value:function getAllPiecesPerFeature(e){var t=this,r={};return e.forEach(function(e){r[e]=[]}),this.getActiveDataframes().forEach(function(n){t._addPartialFeaturesIfExistIn(n,e,r)}),r}},{key:"_addPartialFeaturesIfExistIn",value:function _addPartialFeaturesIfExistIn(e,t,r){for(var n=0;n<e.numFeatures;n++){var a=e.getFeature(n),i=a[this.idProperty];if(t.has(i))r[i].push(a)}}},{key:"trackFeatureViz",value:function trackFeatureViz(e,t,r,n){n[e]=n[e]||{},n[e][t]=r}},{key:"freeDataframes",value:function freeDataframes(){this.dataframes.map(function(e){return e.free()}),this.dataframes=[],this.type=null}}]),RenderLayer}(),ks=function(){function LayerConcurrencyHelper(){p()(this,LayerConcurrencyHelper),this._majorNextUID=0,this._majorCurrentUID=null,this._minorNextUID=0,this._minorCurrentUID=null}return _()(LayerConcurrencyHelper,[{key:"initMajorChange",value:function initMajorChange(){return this._getChangeUID(!0)}},{key:"initMinorChange",value:function initMinorChange(){return this._getChangeUID(!1)}},{key:"endMajorChange",value:function endMajorChange(e){this._detectConcurrentChanges(!0,e),this._setUID(e)}},{key:"endMinorChange",value:function endMinorChange(e){this._detectConcurrentChanges(!1,e),this._setUID(e)}},{key:"_getChangeUID",value:function _getChangeUID(e){var t;return e?(t={major:this._majorNextUID,minor:0},this._majorNextUID++,this._minorNextUID=1):(t={major:this._majorCurrentUID,minor:this._minorNextUID},this._minorNextUID++),t}},{key:"_detectConcurrentChanges",value:function _detectConcurrentChanges(e,t){if(e){if(this._majorCurrentUID>t.major)throw new Pe("Another `Layer.update()` finished before this one:\n                 Commit ".concat(t," overridden by commit ").concat(this._majorCurrentUID,"."))}else{if(this._majorCurrentUID>t.major||null!==this._majorCurrentUID&&null===t.major)throw new Pe("Another `Layer.update()` finished before this viz change:\n                 Commit ".concat(t," overridden by commit ").concat(this._majorCurrentUID,".").concat(this._minorCurrentUID));if(this._minorCurrentUID>t.minor)throw new Pe("Another `viz change` finished before this one:\n                 Commit ".concat(t.major,".").concat(t.minor," overridden by commit ").concat(this._majorCurrentUID,".").concat(this._minorCurrentUID))}}},{key:"_setUID",value:function _setUID(e){this._majorCurrentUID=e.major,this._minorCurrentUID=e.minor}}]),LayerConcurrencyHelper}(),Ts=new WeakMap,Cs=Object.freeze({INIT:"init",IDLE:"idle",UPDATING:"updating"}),Es=function(){function Layer(e,t,r){var a=this;p()(this,Layer),this._checkId(e),this._checkSource(t),this._checkViz(r),this.id=e,this.type="custom",r._boundLayer=this,this._context=new Promise(function(e){a._contextInitialize=e}),this._state=Cs.INIT,this._visible=!0,this._emitter=hs(),this._renderLayer=new ws,this.concurrencyHelper=new ks,this._initialSource=t,this._initialViz=r,this._renderWaiters=[],this._cameraMatrix=n.identity([]),this._updateLayer=this.update(t,r),this._map_init=!1}return _()(Layer,[{key:"show",value:function show(){this.visible=!0}},{key:"hide",value:function hide(){this.visible=!1}},{key:"on",value:function on(e,t){return this._emitter.on(e,t)}},{key:"off",value:function off(e,t){return this._emitter.off(e,t)}},{key:"addTo",value:function(){var e=ot()(at.a.mark(function _callee(e,t){var r,n=this;return at.a.wrap(function _callee$(a){for(;;)switch(a.prev=a.next){case 0:a.prev=0,e.once("error",function(r){console.warn(r.error.message),n._waitForMapToLoad(e,t)}),e.addLayer(this,t),a.next=12;break;case 5:if(a.prev=5,a.t0=a.catch(0),r=/Cannot read property 'addLayer' of undefined/,/Style is not done loading/.test(a.t0)||r.test(a.t0)){a.next=11;break}throw new Pe("Error adding layer to map: ".concat(a.t0));case 11:this._waitForMapToLoad(e,t);case 12:case"end":return a.stop()}},_callee,this,[[0,5]])}));return function addTo(t,r){return e.apply(this,arguments)}}()},{key:"_waitForMapToLoad",value:function _waitForMapToLoad(e,t){var r=this;e.on("load",function(){e.addLayer(r,t)})}},{key:"remove",value:function remove(){this.map&&this.map.removeLayer(this.id)}},{key:"update",value:function(){var e=ot()(at.a.mark(function _callee2(e){var t,r=arguments;return at.a.wrap(function _callee2$(n){for(;;)switch(n.prev=n.next){case 0:return t=r.length>1&&void 0!==r[1]?r[1]:this._viz,n.abrupt("return",this._update(e,t,!0));case 2:case"end":return n.stop()}},_callee2,this)}));return function update(t){return e.apply(this,arguments)}}()},{key:"_update",value:function(){var e=ot()(at.a.mark(function _callee3(e,t,r){var n,a,i,o,s,u;return at.a.wrap(function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return this._checkSource(e),this._checkViz(t),n=this._cloneSourceIfDifferent(e),a=this._initChange(r),c.next=6,Promise.all([t.loadImages(),n.requestMetadata(t)]);case 6:return i=c.sent,o=g()(i,2),s=o[1],c.next=11,this._context;case 11:!this._map_init&&n._tilesetMetadata&&n._tilesetMetadata.center&&(this._map_init=!0,u=n._tilesetMetadata.center,this.map.setZoom(u.zoom),this.map.setCenter([u.longitude,u.latitude])),this._endChange(r,a),this._commitSuccesfulUpdate(s,t,n);case 14:case"end":return c.stop()}},_callee3,this)}));return function _update(t,r,n){return e.apply(this,arguments)}}()},{key:"_initChange",value:function _initChange(e){return e?this.concurrencyHelper.initMajorChange():this.concurrencyHelper.initMinorChange()}},{key:"_endChange",value:function _endChange(e,t){e?this.concurrencyHelper.endMajorChange(t):this.concurrencyHelper.endMinorChange(t)}},{key:"_commitSuccesfulUpdate",value:function _commitSuccesfulUpdate(e,t,r){this.metadata=e,this._commitVizChange(t),this._commitSourceChange(r),this._needRefresh()}},{key:"_commitVizChange",value:function _commitVizChange(e){this._viz&&this._viz.onChange(null),e.setDefaultsIfRequired(this.metadata.geomType),e.setDefaultsIfRequired(this._renderLayer.type),e.onChange(this._vizChanged.bind(this)),e._bindMetadata(this.metadata),e.gl=this.gl,this._viz=e}},{key:"_commitSourceChange",value:function _commitSourceChange(e){e.bindLayer(this._onDataframeAdded.bind(this)),e!==this._source&&this._freeSource(),this._source=e}},{key:"_cloneSourceIfDifferent",value:function _cloneSourceIfDifferent(e){return e!==this._source?e._clone():e}},{key:"blendToViz",value:function(){var e=ot()(at.a.mark(function _callee4(e){var t,r,n=this,a=arguments;return at.a.wrap(function _callee4$(i){for(;;)switch(i.prev=i.next){case 0:return t=a.length>1&&void 0!==a[1]?a[1]:400,r=a.length>2&&void 0!==a[2]?a[2]:yi,this._checkViz(e),i.next=5,this._updateLayer;case 5:return this._viz&&!this._source.requiresNewMetadata(e)&&(Object.keys(this._viz.variables).map(function(t){e.variables[t]=n._viz.variables[t]}),e.color._blendFrom(this._viz.color,t,r),e.strokeColor._blendFrom(this._viz.strokeColor,t,r),e.width._blendFrom(this._viz.width,t,r),e.strokeWidth._blendFrom(this._viz.strokeWidth,t,r),e.filter._blendFrom(this._viz.filter,t,r)),i.abrupt("return",this._update(this._source,e,!1));case 7:case"end":return i.stop()}},_callee4,this)}));return function blendToViz(t){return e.apply(this,arguments)}}()},{key:"hasDataframes",value:function hasDataframes(){return this._renderLayer.hasDataframes()}},{key:"getNumFeatures",value:function getNumFeatures(){return this._renderLayer.getNumFeatures()}},{key:"getFeaturesAtPosition",value:function getFeaturesAtPosition(e){return this.visible?this._renderLayer.getFeaturesAtPosition(e).map(this._addLayerIdToFeature.bind(this)):[]}},{key:"isAnimated",value:function isAnimated(){return this._viz&&this._viz.isAnimated()}},{key:"isPlaying",value:function isPlaying(){return this._viz&&this._viz.isPlaying()}},{key:"onAdd",value:function onAdd(e,t){this.map=e,this.gl=t,this.renderer=function _getRenderer(e,t){if(!Ts.get(e)){var r=new gs;r.initialize(t),Ts.set(e,r)}return Ts.get(e)}(e,t),this._renderLayer.setRenderer(this.renderer),this._contextInitialize()}},{key:"onRemove",value:function onRemove(e,t){this._fire("removed",this)}},{key:"prerender",value:function prerender(e,t){var r=this._detectAndSetNewMatrix(t);this._source&&this.visible&&this._checkSourceRequestsAndFireEvents(r)}},{key:"_detectAndSetNewMatrix",value:function _detectAndSetNewMatrix(e){var t=!n.exactEquals(e,this._cameraMatrix);return t&&(this._cameraMatrix=e,this.renderer.matrix=e),t}},{key:"_checkSourceRequestsAndFireEvents",value:function _checkSourceRequestsAndFireEvents(e){var t=this;this._source.requestData(this._getZoom(),this._getViewport()).then(function(r){r?t._needRefresh().then(function(){t._state===Cs.INIT&&(t._state=Cs.IDLE,t._fire("loaded")),t._fire("updated","different dataframes required from source")}):e&&t._fire("updated","new camara view")})}},{key:"_getViewport",value:function _getViewport(){return computeViewportFromCameraMatrix(this._cameraMatrix)}},{key:"render",value:function render(e,t){var r=this;this._paintLayer(),this._renderWaiters.forEach(function(e){return e()}),this.isAnimated()?this.isPlaying()?this._needRefresh().then(function(){r._fire("updated","animation is playing")}):this._keepTimestampIfPaused():this._state===Cs.UPDATING&&(this._state=Cs.IDLE,this._fire("updated","updated viz"))}},{key:"_keepTimestampIfPaused",value:function _keepTimestampIfPaused(){var e=this.renderer.timestamp;this._viz._getRootStyleExpressions().forEach(function(t){t._setTimestamp(e)})}},{key:"_paintLayer",value:function _paintLayer(){this._renderLayer.setViz(this._viz),this.renderer.renderLayer(this._renderLayer,{zoomLevel:this.map.getZoom()})}},{key:"_fire",value:function _fire(e,t){var r=this;new Promise(function(n){r._emitter.emit(e,t),n()})}},{key:"_onDataframeAdded",value:function _onDataframeAdded(e){this._renderLayer.addDataframe(e),this._viz&&this._viz.setDefaultsIfRequired(e.type)}},{key:"_needRefresh",value:function _needRefresh(){var e=this;return this._state===Cs.IDLE&&(this._state=Cs.UPDATING),new Promise(function(t){e._renderWaiters.push(t),e.map.triggerRepaint()})}},{key:"_addLayerIdToFeature",value:function _addLayerIdToFeature(e){return e.layerId=this.id,e}},{key:"_vizChanged",value:function(){var e=ot()(at.a.mark(function _callee5(e){return at.a.wrap(function _callee5$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._update(this._source,e,!1));case 1:case"end":return t.stop()}},_callee5,this)}));return function _vizChanged(t){return e.apply(this,arguments)}}()},{key:"_checkId",value:function _checkId(e){if(void 0===e)throw new me("'id'",_e.MISSING_REQUIRED);if(!ke.isString(e))throw new me("'id' property must be a string.",_e.INCORRECT_TYPE);if(""===e)throw new me("'id' property must be not empty.",_e.INCORRECT_VALUE)}},{key:"_checkSource",value:function _checkSource(e){if(void 0===e)throw new me("'source'",_e.MISSING_REQUIRED);if(!(e instanceof ds))throw new me("The given object is not a valid 'source'. See \"carto.source\".",_e.INCORRECT_TYPE)}},{key:"_checkViz",value:function _checkViz(e){if(ke.isUndefined(e))throw new me("'viz'",_e.MISSING_REQUIRED);if(!(e instanceof fs))throw new me("The given object is not a valid 'viz'. See \"carto.Viz\".",_e.INCORRECT_TYPE);if(e._boundLayer&&e._boundLayer!==this)throw new me("The given Viz object is already bound to another layer. Vizs cannot be shared between different layers.",_e.INCORRECT_VALUE)}},{key:"_getZoom",value:function _getZoom(){return this.map.getZoom()}},{key:"_freeSource",value:function _freeSource(){this._source&&this._source.free(),this._renderLayer.freeDataframes()}},{key:"visible",get:function get(){return this._visible},set:function set(e){var t=this._visible;this.map.setLayoutProperty(this.id,"visibility",e?"visible":"none"),this._visible=e,e!==t&&this._fire("updated","visibility change")}},{key:"viz",get:function get(){return this._viz}}]),Layer}();var Ms=["featureClick","featureClickOut","featureEnter","featureHover","featureLeave"],As="idle",Ss="moving",Is=function(){function Interactivity(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{autoChangePointer:!0};p()(this,Interactivity),e instanceof Es&&(e=[e]),function preCheckLayerList(e){if(!Array.isArray(e))throw new me('Invalid layer list, parameter must be an array of "carto.Layer" objects.',_e.INCORRECT_TYPE);if(!e.length)throw new me("Invalid argument, layer list must not be empty.",_e.INCORRECT_VALUE);if(!e.every(function(e){return e instanceof Es}))throw new me('Invalid layer, layer must be an instance of "carto.Layer".',_e.INCORRECT_TYPE)}(e),this._init(e,t)}return _()(Interactivity,[{key:"on",value:function on(e,t){checkEvent(e);var r=this._numListeners[e]||0;return this._numListeners[e]=r+1,this._emitter.on(e,t)}},{key:"off",value:function off(e,t){checkEvent(e);var r=this._numListeners[e];return this._numListeners[e]=r-1,this._emitter.off(e,t)}},{key:"disable",value:function disable(){this._enabled=!1}},{key:"enable",value:function enable(){this._enabled=!0}},{key:"_init",value:function _init(e,t){var r=this;this._enabled=!0,this._mapState=As,this._emitter=hs(),this._layerList=e,this._prevHoverFeatures=[],this._prevClickFeatures=[],this._numListeners={},this._isAutoChangePointerEnabled=t.autoChangePointer;var n=e.map(function(e){return e._context});return Promise.all(n).then(function(){!function postCheckLayerList(e){if(!e.every(function(t){return t.map===e[0].map}))throw new me("Invalid argument, all layers must belong to the same map.",_e.INCORRECT_VALUE)}(e),r._map=e[0].map,r._subscribeToLayerEvents(e),r._subscribeToMapEvents(r._map),r._isAutoChangePointerEnabled&&r._setInteractiveCursor()})}},{key:"_setInteractiveCursor",value:function _setInteractiveCursor(){var e=this;this._map.__carto_interactivities||(this._map.__carto_interactivities=new Set),this.on("featureHover",function(t){return e._onFeatureHover(t,e._map)})}},{key:"_onFeatureHover",value:function _onFeatureHover(e,t){e.features.length?t.__carto_interactivities.add(this):t.__carto_interactivities.delete(this),t.getCanvas().style.cursor=t.__carto_interactivities.size>0?"pointer":""}},{key:"_subscribeToMapEvents",value:function _subscribeToMapEvents(e){this._onMouseMoveBound=this._onMouseMove.bind(this),e.on("mousemove",this._onMouseMoveBound),this._onClickBound=this._onClick.bind(this),e.on("click",this._onClickBound),this._disableWhileMovingMap(e)}},{key:"_unsubscribeToMapEvents",value:function _unsubscribeToMapEvents(e){e.off("mousemove",this._onMouseMoveBound),e.off("click",this._onClickBound)}},{key:"_disableWhileMovingMap",value:function _disableWhileMovingMap(e){var t=this;e.on("movestart",function(){t._setMapState(Ss)}),e.on("moveend",function(){t._setMapState(As)})}},{key:"_setMapState",value:function _setMapState(e){this._mapState=e}},{key:"_subscribeToLayerEvents",value:function _subscribeToLayerEvents(e){var t=this;e.forEach(function(e){e.on("updated",t._onLayerUpdated.bind(t)),e.on("removed",t._onLayerRemoved.bind(t))})}},{key:"_onLayerUpdated",value:function _onLayerUpdated(){this._onMouseMove(this._mouseEvent,!0)}},{key:"_onLayerRemoved",value:function _onLayerRemoved(e){this._removeLayerFromInteractivity(e),this._isAutoChangePointerEnabled&&this._onFeatureHover({features:[]},this._map),this._layerList.length||this._unsubscribeToMapEvents(this._map)}},{key:"_removeLayerFromInteractivity",value:function _removeLayerFromInteractivity(e){var t=this._layerList.indexOf(e);-1!==t&&this._layerList.splice(t,1)}},{key:"_onMouseMove",value:function _onMouseMove(e,t){if(this._mouseEvent=e,this.isEnabled&&e&&(this._numListeners.featureEnter||this._numListeners.featureHover||this._numListeners.featureLeave)){var r=this._createFeatureEvent(e),n=this._manageFeatureLeaveEvent(r),a=this._manageFeatureEnterEvent(r);this._prevHoverFeatures=r.features,this._manageFeatureHoverEvent(r,{featuresLeft:n,featuresEntered:a},t)}}},{key:"_manageFeatureLeaveEvent",value:function _manageFeatureLeaveEvent(e){var t=this._getDiffFeatures(this._prevHoverFeatures,e.features);return this._fireEventIfFeatures("featureLeave",{featureEvent:e,eventFeatures:t}),t}},{key:"_manageFeatureEnterEvent",value:function _manageFeatureEnterEvent(e){var t=this._getDiffFeatures(e.features,this._prevHoverFeatures);return this._fireEventIfFeatures("featureEnter",{featureEvent:e,eventFeatures:t}),t}},{key:"_manageFeatureHoverEvent",value:function _manageFeatureHoverEvent(e,t,r){var n=t.featuresLeft,a=t.featuresEntered;(!r||r&&(n.length||a.length))&&this._fireEvent("featureHover",e)}},{key:"_fireEventIfFeatures",value:function _fireEventIfFeatures(e,t){var r=t.featureEvent,n=t.eventFeatures;n.length>0&&this._fireEvent(e,{coordinates:r.coordinates,position:r.position,features:n})}},{key:"_onClick",value:function _onClick(e){if(this.isEnabled&&(this._numListeners.featureClick||this._numListeners.featureClickOut)){var t=this._createFeatureEvent(e);this._manageClickOutEvent(t),this._prevClickFeatures=t.features,this._fireEvent("featureClick",t)}}},{key:"_manageClickOutEvent",value:function _manageClickOutEvent(e){var t=this._getDiffFeatures(this._prevClickFeatures,e.features);return this._fireEventIfFeatures("featureClickOut",{featureEvent:e,eventFeatures:t}),t}},{key:"_createFeatureEvent",value:function _createFeatureEvent(e){var t=this._getFeaturesAtPosition(e.point);return{coordinates:e.lngLat,position:e.point,features:t}}},{key:"_fireEvent",value:function _fireEvent(e,t){this._emitter.emit(e,t)}},{key:"_getFeaturesAtPosition",value:function _getFeaturesAtPosition(e){var t;return(t=[]).concat.apply(t,l()(this._layerList.map(function(t){return t.getFeaturesAtPosition(e)})))}},{key:"_getDiffFeatures",value:function _getDiffFeatures(e,t){var r=this._getFeatureIDs(t);return e.filter(function(e){return!r.includes(e.id)})}},{key:"_getFeatureIDs",value:function _getFeatureIDs(e){return e.map(function(e){return e.id})}},{key:"isEnabled",get:function get(){return this._enabled&&this._mapState!==Ss}}]),Interactivity}();function checkEvent(e){if(!Ms.includes(e))throw new me("Unrecognized event: '".concat(e,"'. Available events: ").concat(Ms.join(", "),"."),_e.INCORRECT_VALUE)}var Ps=r(38),Ds=r.n(Ps);function addLineString(e,t,r,n,a){var i,o,s,u,c;if(e.length>=4){i=[e[0],e[1]];for(var l=2;l<=e.length;l+=2)if(o=[e[l],e[l+1]],i[0]!==o[0]||i[1]!==o[1]){l+=2;break}for(s=getLineNormal(i,o);l<=e.length;l+=2){c=!(a&&a(l));var f=void 0;if(l<=e.length-2?f=[e[l],e[l+1]]:n&&(f=[e[2],e[3]]),!c||i[0]===o[0]&&i[1]===o[1]||(t.vertices[r]=i[0],t.normals[r++]=-s[0],t.vertices[r]=i[1],t.normals[r++]=-s[1],t.vertices[r]=i[0],t.normals[r++]=s[0],t.vertices[r]=i[1],t.normals[r++]=s[1],t.vertices[r]=o[0],t.normals[r++]=s[0],t.vertices[r]=o[1],t.normals[r++]=s[1],t.vertices[r]=i[0],t.normals[r++]=-s[0],t.vertices[r]=i[1],t.normals[r++]=-s[1],t.vertices[r]=o[0],t.normals[r++]=s[0],t.vertices[r]=o[1],t.normals[r++]=s[1],t.vertices[r]=o[0],t.normals[r++]=-s[0],t.vertices[r]=o[1],t.normals[r++]=-s[1]),!f||f[0]===o[0]&&f[1]===o[1])u=s;else if(u=getLineNormal(o,f),c){var h=getJoinNormal(s,u),d=h.turnLeft,p=h.joinNormal,m=d?s:neg(u),_=d?u:neg(s);t.vertices[r]=o[0],t.normals[r++]=0,t.vertices[r]=o[1],t.normals[r++]=n?1e-37:0,t.vertices[r]=o[0],t.normals[r++]=m[0],t.vertices[r]=o[1],t.normals[r++]=m[1],t.vertices[r]=o[0],t.normals[r++]=_[0],t.vertices[r]=o[1],t.normals[r++]=_[1],p&&(t.vertices[r]=o[0],t.normals[r++]=p[0],t.vertices[r]=o[1],t.normals[r++]=p[1],t.vertices[r]=o[0],t.normals[r++]=_[0],t.vertices[r]=o[1],t.normals[r++]=_[1],t.vertices[r]=o[0],t.normals[r++]=m[0],t.vertices[r]=o[1],t.normals[r++]=m[1])}i=o,o=f,s=u}}return r}function resizeBuffer(e,t){var r=new Float32Array(t);return r.set(e),r}var Ns=24,Rs=0,Fs={vertices:new Float32Array(1048576),normals:new Float32Array(1048576)};function resizeBuffers(e){var t=Rs+e;if(t>Fs.vertices.length){var r=2*t;Fs.vertices=resizeBuffer(Fs.vertices,r),Fs.normals=resizeBuffer(Fs.normals,r)}}var Os=r(46),Ls=2,zs=24,Bs=0,Vs={vertices:new Float32Array(2097152),normals:new Float32Array(2097152)};function polygonDecoder_resizeBuffers(e){var t=Bs+e;if(t>Vs.vertices.length){var r=2*t;Vs.vertices=resizeBuffer(Vs.vertices,r),Vs.normals=resizeBuffer(Vs.normals,r)}}function addVertex(e,t){Vs.vertices[Bs]=e[t],Vs.normals[Bs++]=0,Vs.vertices[Bs]=e[t+1],Vs.normals[Bs++]=0}function isClipped(e,t,r){return!!(e.clipped.includes(t)&&e.clipped.includes(r)&&e.clippedType[e.clipped.indexOf(t)]&e.clippedType[e.clipped.indexOf(r)])}function decodeGeom(e,t){switch(e){case ve.POINT:return function decodePoint(e){return{verticesArrayBuffer:e,vertices:new Float32Array(e),breakpoints:[]}}(t);case ve.LINE:return function decodeLine(e){var t=[],r=new Map;Rs=0;for(var n=0;n<e.length;n++){for(var a=e[n],i=0;i<a.length;i++)resizeBuffers(Ns*a[i].length),Rs=addLineString(a[i],Fs,Rs);r.set(t.length,0===t.length?{start:0,end:Rs}:{start:r.get(t.length-1).end,end:Rs}),t.push(Rs)}for(var o=new ArrayBuffer(4*Rs),s=new ArrayBuffer(4*Rs),u=new Float32Array(o),c=new Float32Array(s),l=0;l<Rs;l++)u[l]=Fs.vertices[l],c[l]=Fs.normals[l];return{vertices:u,normals:c,verticesArrayBuffer:o,normalsArrayBuffer:s,featureIDToVertexIndex:r,breakpoints:t}}(t);case ve.POLYGON:return function decodePolygon(e){var t=[],r=new Map;Bs=0;for(var n=0;n<e.length;n++){for(var a=e[n],i=function _loop(e){var t=a[e],r=Os(t.flat,t.holes);polygonDecoder_resizeBuffers(Ls*r.length+zs*t.flat.length);for(var n=0;n<r.length;n++)addVertex(t.flat,2*r[n]);Bs=addLineString(t.flat,Vs,Bs,!0,function(e){return t.holes.includes((e-2)/2)||isClipped(t,e-4,e-2)})},o=0;o<a.length;o++)i(o);r.set(t.length,0===t.length?{start:0,end:Bs}:{start:r.get(t.length-1).end,end:Bs}),t.push(Bs)}for(var s=new ArrayBuffer(4*Bs),u=new ArrayBuffer(4*Bs),c=new Float32Array(s),l=new Float32Array(u),f=0;f<Bs;f++)c[f]=Vs.vertices[f],l[f]=Vs.normals[f];return{vertices:c,normals:l,verticesArrayBuffer:s,normalsArrayBuffer:u,featureIDToVertexIndex:r,breakpoints:t}}(t);default:throw new Pe("Unimplemented geometry type: '".concat(e,"'."),De.NOT_SUPPORTED)}}var Gs=function(){function FeatureIdsHelper(e){p()(this,FeatureIdsHelper),this.dataframe=e}return _()(FeatureIdsHelper,[{key:"getFeatureIds",value:function getFeatureIds(){return!this.decodedGeom.breakpoints.length?this._getFeatureIdsForPoints():this._getFeatureIdsForLinesOrPolygons()}},{key:"_getFeatureIdsForPoints",value:function _getFeatureIdsForPoints(){for(var e=this.decodedGeom.vertices.length,t=this._createTablesXY(),r=t.tableX,n=t.tableY,a=new Float32Array(e),i=0,o=0;o<e;o+=6)a[o+0]=r[i],a[o+1]=n[i],0===a[o+0]&&(a[o+0]+=1/65536),0===a[o+1]&&(a[o+1]+=1/65536),a[o+2]=-a[o+0],a[o+3]=a[o+1],a[o+4]=a[o+0],a[o+5]=-a[o+1],i++;return a}},{key:"_getFeatureIdsForLinesOrPolygons",value:function _getFeatureIdsForLinesOrPolygons(){for(var e=this.decodedGeom.vertices.length,t=this._createTablesXY(),r=t.tableX,n=t.tableY,a=this.decodedGeom.breakpoints,i=new Float32Array(e),o=0,s=0;s<e;s+=2){for(;s===a[o];)o++;i[s+0]=r[o],i[s+1]=n[o]}return i}},{key:"_createTablesXY",value:function _createTablesXY(){for(var e={},t={},r=this.dataframe.getSize(),n=r.height,a=r.width,i=0;i<this.numFeatures;i++)e[i]=i%a/(a-1),t[i]=n>1?Math.floor(i/a)/(n-1):.5;return{tableX:e,tableY:t}}},{key:"decodedGeom",get:function get(){return this.dataframe.decodedGeom}},{key:"numFeatures",get:function get(){return this.dataframe.numFeatures}}]),FeatureIdsHelper}(),Us=r(40),qs="separatingLineFound",js="separatingLineNotFound";function triangleCollides(e,t){return function _noArea(e){var t=g()(e,3),r=t[0],n=t[1],a=t[2];return equalPoints(r,n)||equalPoints(n,a)}(e)?function _noAreaTriangleCollides(e,t){var r=g()(e,3),n=r[0],a=r[1],i=r[2],o=n,s=equalPoints(a,o)?i:a,u=[t.minx,t.miny,t.maxx,t.maxy];return Us([[o.x,o.y],[s.x,s.y]],u).length>0}(e,t):function _viewportLineSeparatesTriangle(e,t){if(t[0].x<e.minx&&t[1].x<e.minx&&t[2].x<e.minx)return qs;if(t[0].y<e.miny&&t[1].y<e.miny&&t[2].y<e.miny)return qs;if(t[0].x>e.maxx&&t[1].x>e.maxx&&t[2].x>e.maxx)return qs;if(t[0].y>e.maxy&&t[1].y>e.maxy&&t[2].y>e.maxy)return qs;return js}(t,e)!==qs&&function _triangleLineSeparatesViewport(e,t){for(var r=0;r<3;r++)for(var n=0;n<t.length;n++){var a=halfPlaneSign(t[n],e[r],e[(r+1)%3]);if(a>0)break;if(3===n)return qs}return js}(e,[{x:t.minx,y:t.miny},{x:t.minx,y:t.maxy},{x:t.maxx,y:t.miny},{x:t.maxx,y:t.maxy}])!==qs}var Ws=function(){function ProjectionHelper(e){p()(this,ProjectionHelper),this.dataframe=e}return _()(ProjectionHelper,[{key:"toNDC",value:function toNDC(e,t){var r=this.toClipSpace(e,t),n=r.ox,a=r.oy,i=r.ow;return{x:n/i,y:a/i}}},{key:"toClipSpace",value:function toClipSpace(e,t){var r=this.matrix;return{ox:r[0]*e+r[4]*t+r[12],oy:r[1]*e+r[5]*t+r[13],ow:r[3]*e+r[7]*t+r[15]}}},{key:"matrix",get:function get(){return this.dataframe.matrix}}]),ProjectionHelper}(),Hs=1,Zs=-1,Ys=0,Xs=function(){function ViewportHelper(e){p()(this,ViewportHelper),this.dataframe=e,this.getFeature=e.getFeature.bind(e),this._getGL=e._getGL.bind(e),this._projection=new Ws(e)}return _()(ViewportHelper,[{key:"isPointInViewport",value:function isPointInViewport(e){var t=this.decodedGeom.vertices,r=t[6*e+0],n=t[6*e+1],a=this._projection.toClipSpace(r,n),i=a.ox,o=a.oy,s=a.ow;return i>-s&&i<s&&o>-s&&o<s}},{key:"isPolygonInViewport",value:function isPolygonInViewport(e){var t=this._aabb[e],r=this._compareAABBs(t);if(r===Ys){var n=this.decodedGeom.vertices,a=this.decodedGeom.normals,i=this.decodedGeom.featureIDToVertexIndex.get(e);return this._isPolygonCollidingViewport(n,a,i.start,i.end)}return r===Hs}},{key:"_getCanvasSizeInPixels",value:function _getCanvasSizeInPixels(){var e=this._getGL().canvas;return{WIDTH:e.width/window.devicePixelRatio,HEIGHT:e.height/window.devicePixelRatio}}},{key:"_compareAABBs",value:function _compareAABBs(e){if(null===e)return Zs;var t=this._projection.toNDC(e.minx,e.miny),r=this._projection.toNDC(e.minx,e.maxy),n=this._projection.toNDC(e.maxx,e.miny),a=this._projection.toNDC(e.maxx,e.maxy),i={minx:Math.min(t.x,r.x,n.x,a.x),miny:Math.min(t.y,r.y,n.y,a.y),maxx:Math.max(t.x,r.x,n.x,a.x),maxy:Math.max(t.y,r.y,n.y,a.y)},o={minx:-1,miny:-1,maxx:1,maxy:1};switch(!0){case this._isFeatureAABBInsideViewport(i,o):return Hs;case this._isFeatureAABBOutsideViewport(i,o):return Zs;default:return Ys}}},{key:"_isPolygonCollidingViewport",value:function _isPolygonCollidingViewport(e,t,r,n){if(!this.matrix)return!1;for(var a={minx:-1,miny:-1,maxx:1,maxy:1},i=r;i<n;i+=6){var o=this._projection.toNDC(e[i+0],e[i+1]),s=this._projection.toNDC(e[i+2],e[i+3]),u=this._projection.toNDC(e[i+4],e[i+5]);if(triangleCollides([{x:o.x,y:o.y},{x:s.x,y:s.y},{x:u.x,y:u.y}],a))return!0}return!1}},{key:"_isFeatureAABBInsideViewport",value:function _isFeatureAABBInsideViewport(e,t){return e.minx>=t.minx&&e.maxx<=t.maxx&&e.miny>=t.miny&&e.maxy<=t.maxy}},{key:"_isFeatureAABBOutsideViewport",value:function _isFeatureAABBOutsideViewport(e,t){return e.minx>t.maxx||e.miny>t.maxy||e.maxx<t.minx||e.maxy<t.miny}},{key:"getPointsAtPosition",value:function getPointsAtPosition(e,t){for(var r=this.decodedGeom.vertices,n=[],a=0;a<6*this.numFeatures;a+=6){var i=a/6,o=this.getFeature(i);if(!this._isFeatureFiltered(o,t.filter)){var s={x:r[a],y:r[a+1]},u=this._getCircleFor(s,o,t);pointInCircle(e,u.center,u.radius)&&n.push(o)}}return n}},{key:"_isFeatureFiltered",value:function _isFeatureFiltered(e,t){return t.eval(e)<_s}},{key:"_getCircleFor",value:function _getCircleFor(e,t,r){var n=this._getCanvasSizeInPixels(),a=n.WIDTH,i=n.HEIGHT,o=this._projection.toNDC(e.x,e.y);o.x*=.5,o.y*=-.5,o.x+=.5,o.y+=.5,o.x*=a,o.y*=i;var s=this._computePointRadius(t,r);if(!r.symbol.default){var u=r.symbolPlacement.eval(t);o.x+=u[0]*s,o.y-=u[1]*s}if(!r.transform.default){var c=r.transform.eval(t);o.x+=c.x,o.y-=c.y}return{center:o,radius:s}}},{key:"getFeaturesAtPositionFromTriangles",value:function getFeaturesAtPositionFromTriangles(e,t,r){for(var n,a=this.decodedGeom.vertices,i=this.decodedGeom.normals,o=this.decodedGeom.breakpoints,s=[],u=-1,c={x:0,y:0},l=this._getCanvasSizeInPixels(),f=l.WIDTH,h=l.HEIGHT,d=0;d<a.length;d+=6){if(0===d||d>=o[u]){u++;var p=this.getFeature(u);if(!r.transform.default){var m=r.transform.eval(p);c.x=m[0],c.y=m[1]}if(n=e===ve.LINE?this._computeLineWidthScale(p,r):this._computePolygonWidthScale(p,r),this._isFeatureFiltered(p,r.filter)||!this._isPointInAABB(t,c,e===ve.LINE?r.width.eval(p):r.strokeWidth.eval(p),u)){d=o[u]-6;continue}}var _=this._projection.toNDC(a[d+0]+i[d+0]*n,a[d+1]+i[d+1]*n),v=this._projection.toNDC(a[d+2]+i[d+2]*n,a[d+3]+i[d+3]*n),y=this._projection.toNDC(a[d+4]+i[d+4]*n,a[d+5]+i[d+5]*n);_.x*=.5,_.y*=-.5,_.x+=.5,_.y+=.5,v.x*=.5,v.y*=-.5,v.x+=.5,v.y+=.5,y.x*=.5,y.y*=-.5,y.x+=.5,y.y+=.5,pointInTriangle(t,{x:_.x*f+c.x,y:_.y*h-c.y},{x:v.x*f+c.x,y:v.y*h-c.y},{x:y.x*f+c.x,y:y.y*h-c.y})&&(s.push(this.getFeature(u)),d=o[u]-6)}return s}},{key:"_isPointInAABB",value:function _isPointInAABB(e,t,r,n){var a=this._aabb[n];if(null===a||!this.matrix)return!1;var i=this._projection.toNDC(a.minx,a.miny),o=this._projection.toNDC(a.minx,a.maxy),s=this._projection.toNDC(a.maxx,a.miny),u=this._projection.toNDC(a.maxx,a.maxy),c={minx:Math.min(i.x,o.x,s.x,u.x),miny:Math.min(i.y,o.y,s.y,u.y),maxx:Math.max(i.x,o.x,s.x,u.x),maxy:Math.max(i.y,o.y,s.y,u.y)},l=this._getCanvasSizeInPixels(),f=l.WIDTH,h=l.HEIGHT,d=2*t.x/f,p=2*t.y/h,m=e.x/f*2-1,_=-(e.y/h*2-1),v={minx:m+d-2*r/f,miny:_-p-2*r/h,maxx:m+d+2*r/f,maxy:_-p+2*r/h};return!this._isFeatureAABBOutsideViewport(c,v)}},{key:"_computePointRadius",value:function _computePointRadius(e,t){return(Math.min(t.width.eval(e),1024)+Math.min(t.strokeWidth.eval(e),1024))/2}},{key:"_computeLineWidthScale",value:function _computeLineWidthScale(e,t){return Math.min(t.width.eval(e),1024)/2/this.scale/this._resolutionForZoomLevel()}},{key:"_computePolygonWidthScale",value:function _computePolygonWidthScale(e,t){return Math.min(t.strokeWidth.eval(e),1024)/2/this.scale/this._resolutionForZoomLevel()}},{key:"_resolutionForZoomLevel",value:function _resolutionForZoomLevel(){return 512*Math.pow(2,this.renderer.drawMetadata.zoomLevel)}},{key:"decodedGeom",get:function get(){return this.dataframe.decodedGeom}},{key:"_aabb",get:function get(){return this.dataframe._aabb}},{key:"numFeatures",get:function get(){return this.dataframe.numFeatures}},{key:"renderer",get:function get(){return this.dataframe.renderer}},{key:"matrix",get:function get(){return this.dataframe.matrix}},{key:"scale",get:function get(){return this.dataframe.scale}}]),ViewportHelper}(),Qs=new Map,$s=function(e){function Dataframe(){var e,t;p()(this,Dataframe);for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return(t=R()(this,(e=O()(Dataframe)).call.apply(e,[this].concat(n))))._initHelpers(),t}return B()(Dataframe,e),_()(Dataframe,[{key:"_initHelpers",value:function _initHelpers(){this._featureIdsHelper||(this._featureIdsHelper=new Gs(this)),this._viewportHelper||(this._viewportHelper=new Xs(this))}},{key:"bindRenderer",value:function bindRenderer(e){this.renderer=e,this._initHelpers(),this.addProperties(),this._loadVertices(),this._loadNormals(),this._loadFeatureIds(),this._createEmptyStyleTextures()}},{key:"getSize",value:function getSize(){var e=this.renderer.RTT_WIDTH;return{width:e,height:Math.ceil(this.numFeatures/e)}}},{key:"_getGL",value:function _getGL(){return this.renderer.gl}},{key:"_loadVertices",value:function _loadVertices(){var e=this._getGL(),t=this.decodedGeom.vertices;this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)}},{key:"_loadNormals",value:function _loadNormals(){var e=this._getGL(),t=this.decodedGeom.normals;t&&(this.normalBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.normalBuffer),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW))}},{key:"_loadFeatureIds",value:function _loadFeatureIds(){var e=this._getGL(),t=this._featureIdsHelper.getFeatureIds();this.featureIDBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.featureIDBuffer),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)}},{key:"getFeaturesAtPosition",value:function getFeaturesAtPosition(e,t){if(!this.matrix)return[];switch(this.type){case ve.POINT:return this._viewportHelper.getPointsAtPosition(e,t);case ve.LINE:case ve.POLYGON:return this._viewportHelper.getFeaturesAtPositionFromTriangles(this.type,e,t);default:return[]}}},{key:"inViewport",value:function inViewport(e){if(!this.matrix)return!1;switch(this.type){case ve.POINT:return this._viewportHelper.isPointInViewport(e);case ve.LINE:case ve.POLYGON:return this._viewportHelper.isPolygonInViewport(e);default:return!1}}},{key:"getRenderedCentroid",value:function getRenderedCentroid(e){var t=zr()({},this._centroids[e]);t.x=t.x*this.scale+this.center.x,t.y=t.y*this.scale+this.center.y;var r=this._unprojectFromWebMercator(t);return[r.lng,r.lat]}},{key:"getPropertyTexture",value:function getPropertyTexture(e){var t=this._encodePropertyName(e);return this.propertyTex[t]?this.propertyTex[t]:(this._loadPropertyValuesToTexture(e),this.propertyTex[t])}},{key:"_loadPropertyValuesToTexture",value:function _loadPropertyValuesToTexture(e){var t=this._getGL(),r=this.properties[e],n=this._encodePropertyName(e),a=this.getSize(),i=a.width,o=a.height;r&&(this.propertyTex[n]=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.propertyTex[n]),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,i,o,0,t.ALPHA,t.FLOAT,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST))}},{key:"_encodePropertyName",value:function _encodePropertyName(e){return"_".concat(e)}},{key:"free",value:function free(){var e=this;this._freeWebGLElements(),Object.keys(this).forEach(function(t){e[t]=null}),this.freed=!0}},{key:"_freeWebGLElements",value:function _freeWebGLElements(){if(this.propertyTex){var e=this._getGL();this.propertyTex.map(function(t){return e.deleteTexture(t)}),e.deleteTexture(this.texColor),e.deleteTexture(this.texStrokeColor),e.deleteTexture(this.texWidth),e.deleteTexture(this.texStrokeWidth),e.deleteTexture(this.texFilter),e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.featureIDBuffer)}}},{key:"_unprojectFromWebMercator",value:function _unprojectFromWebMercator(e){var t=e.x,r=e.y,n=Math.PI/180;return{lng:t*be/6378137/n,lat:2*(Math.atan(Math.pow(Math.E,r*be/6378137))-Math.PI/4)/n}}},{key:"_genFeatureClass",value:function _genFeatureClass(){if(Qs.has(this.metadata))this._featureClass=Qs.get(this.metadata);else{var e=function genViewportFeatureClass(e){var t=function ViewportFeature(e,t){p()(this,ViewportFeature),this._index=e,this._dataframe=t};return Object.defineProperties(t.prototype,function buildGettersFrom(e){var t={};return e.propertyKeys.forEach(function(r){var n=e.codec(r);if(n.isRange()){var a=e.decodedProperties(r);t[r]={get:function get(){var t=this,r=this._index,i=a.map(function(e){return t._dataframe.properties[e][r]});return n.internalToExternal(e,i)}}}else t[r]={get:function get(){var t=this._index,a=this._dataframe.properties[r][t];return n.internalToExternal(e,a)}}}),t}(e)),t}(this.metadata);Qs.set(this.metadata,e),this._featureClass=e}}},{key:"getFeature",value:function getFeature(e){if(this.cachedFeatures||(this.cachedFeatures=new Array(this.numFeatures)),void 0!==this.cachedFeatures[e])return this.cachedFeatures[e];this._featureClass||this._genFeatureClass();var t=new this._featureClass(e,this);return this.cachedFeatures[e]=t,t}},{key:"addProperties",value:function addProperties(){for(var e=0;e<this.metadata.propertyKeys.length;e++){var t=this.metadata.propertyKeys[e];this._addProperty(t)}this._genFeatureClass()}},{key:"_addProperty",value:function _addProperty(e){Object.keys(this.propertyTex).length<32&&this.getPropertyTexture(e)}},{key:"_createEmptyStyleTextures",value:function _createEmptyStyleTextures(){this.texColor=this._createStyleDataframeTexture(),this.texWidth=this._createStyleDataframeTexture(),this.texStrokeColor=this._createStyleDataframeTexture(),this.texStrokeWidth=this._createStyleDataframeTexture(),this.texFilter=this._createStyleDataframeTexture()}},{key:"_createStyleDataframeTexture",value:function _createStyleDataframeTexture(){var e=this._getGL(),t=this.getSize(),r=t.width,n=t.height,a=e.createTexture();return e.bindTexture(e.TEXTURE_2D,a),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,n,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),a}}]),Dataframe}(function DummyDataframe(e){var t=e.active,r=e.center,n=e.properties,a=e.propertiesArrayBuffer,i=e.scale,o=e.type,s=e.geom,u=e.size,c=e.metadata,l=e.x,f=e.y,h=e.z;p()(this,DummyDataframe),this.active=t,this.center=r,this.properties=n,this.propertiesArrayBuffer=a,this.scale=i,this.type=o,this.decodedGeom=decodeGeom(o,s),this.numVertex=o===ve.POINT?3*u:this.decodedGeom.vertices.length/2,this.numFeatures=o===ve.POINT?u:this.decodedGeom.breakpoints.length||this.numVertex,this.propertyTex=[],this.metadata=c,this.propertyCount=0,this.x=l,this.y=f,this.z=h,this._aabb=function computeAABB(e,t){switch(t){case ve.POINT:return[];case ve.LINE:case ve.POLYGON:for(var r=[],n=0;n<e.length;n++){for(var a=e[n],i={minx:Number.POSITIVE_INFINITY,miny:Number.POSITIVE_INFINITY,maxx:Number.NEGATIVE_INFINITY,maxy:Number.NEGATIVE_INFINITY},o=0;o<a.length;o++)i=_updateAABBForGeometry(a[o],i,t);i.minx===Number.POSITIVE_INFINITY&&(i=null),r.push(i)}return r}}(s,o),this._centroids=computeCentroids(this.decodedGeom,o),this.t1=[.1,.1,.1,.1],this.t2=[.1,.1,.1,.1],this.t3=[.1,.1,.1,.1],this.t4=[.1,.1,.1,.1]}),Js=4096,Ks="cartodb_id",eu=function(){function Metadata(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{properties:{}},r=t.properties,n=t.featureCount,a=t.sample,i=t.geomType,o=t.isAggregated,s=t.idProperty,u=t.extent;p()(this,Metadata),this.properties=r,this.featureCount=n,this.sample=a,this.geomType=i,this.isAggregated=o,this.idProperty=s||Ks,this.properties.hasOwnProperty(this.idProperty)||(this.properties[this.idProperty]={type:"number"}),this.categoryToID=new Map,this.IDToCategory=new Map,this.numCategories=0,this.extent=u||Js,Object.values(r).map(function(t){t.categories=t.categories||[],t.categories.map(function(r){return e.categorizeString(t,r.name,!0)})}),this.propertyKeys=Object.keys(r)}return _()(Metadata,[{key:"setCodecs",value:function setCodecs(){throw new Pe('You must call "setCodecs" once you have determined the proper subclass')}},{key:"categorizeString",value:function categorizeString(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===t&&(t=null),this.categoryToID.has(t))return this.categoryToID.get(t);r||null===t||this.properties[e].categories.push({name:t,frequency:Number.NaN});var n=null===t?Qt:this.numCategories;return this.categoryToID.set(t,n),this.IDToCategory.set(n,t),this.numCategories++,n}},{key:"decodedProperties",value:function decodedProperties(e){return[e]}},{key:"baseName",value:function baseName(e){return e}},{key:"sourcePropertyName",value:function sourcePropertyName(e){return e}},{key:"stats",value:function stats(e){return this.properties[e]}},{key:"codec",value:function codec(e){var t=this.baseName(e);return this.properties[t]&&this.properties[t].codec?this.properties[t].codec:new Mr}}]),Metadata}(),tu=function(e){function NumberCodec(){return p()(this,NumberCodec),R()(this,O()(NumberCodec).apply(this,arguments))}return B()(NumberCodec,e),_()(NumberCodec,[{key:"sourceToInternal",value:function sourceToInternal(e,t){return(isNaN(t)||null==t)&&(t=Qt),t}},{key:"internalToExternal",value:function internalToExternal(e,t){return t===Qt&&(t=null),t}},{key:"externalToInternal",value:function externalToInternal(e,t){return null===t&&(t=Qt),t}}]),NumberCodec}(Mr),ru=function(e){function MVTNumberCodec(){return p()(this,MVTNumberCodec),R()(this,O()(MVTNumberCodec).apply(this,arguments))}return B()(MVTNumberCodec,e),_()(MVTNumberCodec,[{key:"sourceToInternal",value:function sourceToInternal(e,t){var r=h()(t);if(null!==t&&"undefined"!==r&&"number"!==r)throw new Pe("MVT decoding error. Metadata property '".concat(this._baseName,"' is of type 'number' but the MVT tile contained a feature property of type '").concat(r,"': '").concat(t,"'"),De.MVT);return dt()(O()(MVTNumberCodec.prototype),"sourceToInternal",this).call(this,e,t)}}]),MVTNumberCodec}(tu),nu=function(e){function CategoryCodec(){return p()(this,CategoryCodec),R()(this,O()(CategoryCodec).apply(this,arguments))}return B()(CategoryCodec,e),_()(CategoryCodec,[{key:"sourceToInternal",value:function sourceToInternal(e,t){return e.categorizeString(this._baseName,t)}},{key:"internalToExternal",value:function internalToExternal(e,t){return e.IDToCategory.get(t)}},{key:"sourceToExternal",value:function sourceToExternal(e,t){return t}},{key:"externalToSource",value:function externalToSource(e,t){return t}}]),CategoryCodec}(Er),au=function(e){function MVTCategoryCodec(){return p()(this,MVTCategoryCodec),R()(this,O()(MVTCategoryCodec).apply(this,arguments))}return B()(MVTCategoryCodec,e),_()(MVTCategoryCodec,[{key:"sourceToInternal",value:function sourceToInternal(e,t){var r=h()(t);if(null!==t&&"undefined"!==r&&"string"!==r)throw new Pe("MVT decoding error. Metadata property '".concat(this._baseName,"' is of type 'category' but the MVT tile contained a feature property of type '").concat(r,"': '").concat(t,"'"),De.MVT);return dt()(O()(MVTCategoryCodec.prototype),"sourceToInternal",this).call(this,e,t)}}]),MVTCategoryCodec}(nu);var iu=function(e){function MVTMetadata(){return p()(this,MVTMetadata),R()(this,O()(MVTMetadata).apply(this,arguments))}return B()(MVTMetadata,e),_()(MVTMetadata,[{key:"setCodecs",value:function setCodecs(){var e=this;Object.keys(this.properties).forEach(function(t){var r=e.properties[t],n=r.type;"geometry"!==n&&(r.codec=function MVTCodecFactory(e,t,r){switch(t){case"number":return new ru(e,r);case"category":return new au(e,r);default:throw new Pe("MVT decoding error. Feature property value of type '".concat(t,"' cannot be decoded."),De.MVT)}}(e,n,t))})}}]),MVTMetadata}(eu),ou=r(20),su=function(){function DataframeCache(){p()(this,DataframeCache);this._cache=ou({max:256,length:function length(){return 1},maxAge:36e5,dispose:function dispose(e,t){t.then(function(e){e.empty||e.free()})}})}return _()(DataframeCache,[{key:"get",value:function get(e,t){var r=this._cache.get(e);if(r)return r;var n=t(e);return this._cache.set(e,n),n}},{key:"free",value:function free(){this._cache.reset()}}]),DataframeCache}();function wToR(e,t,r){return{x:(e-r.center.x)/r.scale,y:(t-r.center.y)/r.scale}}function rTiles(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.ceil,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=r(e);return"number"==typeof a?function wRectangleTiles(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=g()(t,4),a=n[0],i=n[1],o=n[2],s=n[3],u=1<<e,c=function clamp(e){return Math.min(Math.max(e,0),u-1)},l=c(Math.floor(u*(a+1)*.5))-r,f=c(Math.ceil(u*(o+1)*.5)-1)+r,h=c(Math.floor(u*(1-s)*.5))-r,d=c(Math.ceil(u*(1-i)*.5)-1)+r,p=[],m=l;m<=f;++m)for(var _=h;_<=d;++_)p.push({x:m,y:_,z:e});return p}(a,t,n):[]}var uu=function(){function TileClient(e){p()(this,TileClient),Array.isArray(e)||(e=[e]),this._templateURLs=e,this._nextGroupID=0,this._currentRequestGroupID=0,this._oldDataframes=[],this._cache=new su}return _()(TileClient,[{key:"bindLayer",value:function bindLayer(e){this._addDataframe=e}},{key:"requestData",value:function requestData(e,t,r){var n=rTiles(e,t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.ceil);return this._getTiles(n,r)}},{key:"free",value:function free(){this._cache.free(),this._cache=new su,this._oldDataframes=[]}},{key:"_getTileUrl",value:function _getTileUrl(e,t,r){var n=this._getSubdomainIndex(e,t);return this._templateURLs[n].replace("{x}",e).replace("{y}",t).replace("{z}",r)}},{key:"_getSubdomainIndex",value:function _getSubdomainIndex(e,t){return Math.abs(e+t)%this._templateURLs.length}},{key:"_getTiles",value:function(){var e=ot()(at.a.mark(function _callee(e,t){var r,n,a,i=this;return at.a.wrap(function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return this._nextGroupID++,r=this._nextGroupID,o.next=4,Promise.all(e.map(function(e){var r=e.x,n=e.y,a=e.z;return i._cache.get("".concat(r,",").concat(n,",").concat(a),function(){return i._requestDataframe(r,n,a,t)}).then(function(e){return e.orderID=r+n/1e3,e})}));case 4:if(n=o.sent,!(r<this._currentRequestGroupID)){o.next=7;break}return o.abrupt("return",!0);case 7:return this._currentRequestGroupID=r,this._oldDataframes.forEach(function(e){e.active=!1}),n.forEach(function(e){e.active=!0}),a=!isSetsEqual(new Set(n),new Set(this._oldDataframes)),this._oldDataframes=n,o.abrupt("return",a);case 13:case"end":return o.stop()}},_callee,this)}));return function _getTiles(t,r){return e.apply(this,arguments)}}()},{key:"_requestDataframe",value:function(){var e=ot()(at.a.mark(function _callee2(e,t,r,n){var a,i;return at.a.wrap(function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return a=this._getTileUrl(e,t,r),o.next=3,n(e,t,r,a);case 3:return(i=o.sent).empty||this._addDataframe(i),o.abrupt("return",i);case 6:case"end":return o.stop()}},_callee2,this)}));return function _requestDataframe(t,r,n,a){return e.apply(this,arguments)}}()}]),TileClient}(),cu=r(21),lu=r.n(cu),fu=function(e){function MVT(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new iu,n=arguments.length>2?arguments[2]:void 0;return p()(this,MVT),(t=R()(this,O()(MVT).call(this)))._templateURL=e,t._tileClient=new uu(e),t._initMetadata(r),t._initOptions(n),t._workerDispatch={},t._mID=0,t._workerName="MVT",t}return B()(MVT,e),_()(MVT,[{key:"_initMetadata",value:function _initMetadata(e){e instanceof eu||(e=new iu(e)),e.setCodecs(),this._metadata=e}},{key:"_initOptions",value:function _initOptions(e){void 0===e&&(e={layerID:void 0,viewportZoomToSourceZoom:Math.ceil,maxZoom:void 0}),e.viewportZoomToSourceZoom=e.viewportZoomToSourceZoom||Math.ceil,this._options=e}},{key:"_receiveMessageFromWorker",value:function _receiveMessageFromWorker(e){var t=e.data,r=t.mID,n=t.dataframe;n.empty||this._updateMetadataWith(n),this._workerDispatch[r](n)}},{key:"_updateMetadataWith",value:function _updateMetadataWith(e){Object.setPrototypeOf(e,$s.prototype);var t=e.metadata;this._metadata.numCategories=t.numCategories,this._metadata.categoryToID=t.categoryToID,this._metadata.IDToCategory=t.IDToCategory,this._metadata.geomType=t.geomType,e.metadata=this._metadata}},{key:"_clone",value:function _clone(){return new MVT(this._templateURL,JSON.parse(JSON.stringify(this._metadata)),this._options)}},{key:"bindLayer",value:function bindLayer(e){this._tileClient.bindLayer(e)}},{key:"requestMetadata",value:function(){var e=ot()(at.a.mark(function _callee(){return at.a.wrap(function _callee$(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._metadata);case 1:case"end":return e.stop()}},_callee,this)}));return function requestMetadata(){return e.apply(this,arguments)}}()},{key:"requestData",value:function requestData(e,t){var r=this._urlToDataframeTransformer.bind(this),n=this._viewportZoomToSourceZoom.bind(this);return this._tileClient.requestData(e,t,r,n)}},{key:"_urlToDataframeTransformer",value:function _urlToDataframeTransformer(e,t,r,n){var a=this;return new Promise(function(i){var o=a._validUrlForWorker(n);a._postMessageToWorker({x:e,y:t,z:r},o),a._metadataSent=!0,a._workerDispatch[a._mID]=i,a._mID++})}},{key:"_postMessageToWorker",value:function _postMessageToWorker(e,t){var r=e.x,n=e.y,a=e.z;this._worker.postMessage({x:r,y:n,z:a,url:t,layerID:this._options.layerID,metadata:this._metadataSent?void 0:this._metadata,mID:this._mID,workerName:this._workerName})}},{key:"_viewportZoomToSourceZoom",value:function _viewportZoomToSourceZoom(e){var t=this._options.maxZoom,r=this._options.viewportZoomToSourceZoom(e);return void 0===t?r:Math.min(r,t)}},{key:"_validUrlForWorker",value:function _validUrlForWorker(e){if("."===e[0]){var t=window.location.pathname.split("/");t.pop();var r=t.join("/");return"".concat(window.location.protocol,"//").concat(window.location.host,"/").concat(r,"/").concat(e)}return"/"===e[0]?"".concat(window.location.protocol,"//").concat(window.location.host).concat(e):e}},{key:"free",value:function free(){this._tileClient.free()}},{key:"_worker",get:function get(){return this._workerInstance||(this._workerInstance=new lu.a,this._workerInstance.onmessage=this._receiveMessageFromWorker.bind(this)),this._workerInstance}}]),MVT}(ds),hu=function(e){function WindshaftDateCodec(e,t){var r;p()(this,WindshaftDateCodec),r=R()(this,O()(WindshaftDateCodec).call(this,e,t));var n=e.stats(t).min;return r._min_ms=1e3*n,r._min_date=msToDate(r._min_ms),r}return B()(WindshaftDateCodec,e),_()(WindshaftDateCodec,[{key:"sourceToInternal",value:function sourceToInternal(e,t){return msToDate(1e3*t)-this._min_date}},{key:"internalToExternal",value:function internalToExternal(e,t){var r=t;return msToDate(r+=this._min_ms)}},{key:"externalToSource",value:function externalToSource(e,t){return t.getTime()/1e3}},{key:"sourceToExternal",value:function sourceToExternal(e,t){return function asDate(e){if(e instanceof Date)return e;return msToDate(1e3*e)}(t)}},{key:"inlineInternalMatch",value:function inlineInternalMatch(e,t){var r=t._min_ms-this._min_ms;return"(".concat(e,"-").concat(r.toFixed(20),")")}}]),WindshaftDateCodec}(Er);var du=function(e){function TimeRangeCodec(e,t){var r;p()(this,TimeRangeCodec),r=R()(this,O()(TimeRangeCodec).call(this,e,t));var n=e.stats(t),a=n.min,i=n.grouping&&n.grouping.timezone,o=util_timeRange({timeZone:i,iso:a});return r._min=o.startValue/1e3,r._timeZone=i,r}return B()(TimeRangeCodec,e),_()(TimeRangeCodec,[{key:"isRange",value:function isRange(){return!0}},{key:"sourceToInternal",value:function sourceToInternal(e,t){var r=this,n=util_timeRange({iso:t});return[n.startValue/1e3,n.endValue/1e3].map(function(e){return e-r._min})}},{key:"internalToExternal",value:function internalToExternal(e,t){var r=g()(t,2),n=r[0],a=r[1];return util_timeRange({start:1e3*(n+this._min),end:1e3*(a+this._min),timeZone:this._timeZone})}},{key:"externalToSource",value:function externalToSource(e,t){return castTimeRange(t,this._timeZone)._iso}},{key:"sourceToExternal",value:function sourceToExternal(e,t){return util_timeRange({iso:t,timeZone:this._timeZone})}},{key:"inlineInternalMatch",value:function inlineInternalMatch(e,t){var r=t._min.getTime()-this._min.getTime();return"(".concat(e,"-").concat(r.toFixed(20),")")}}]),TimeRangeCodec}(Er),pu=function(e){function CartoMapsAPIError(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mu.DEFAULT;return p()(this,CartoMapsAPIError),(t=R()(this,O()(CartoMapsAPIError).call(this,{message:e,type:r}))).name="CartoMapsAPIError",t}return B()(CartoMapsAPIError,e),CartoMapsAPIError}(G),mu={DEFAULT:"[Error]",SQL:"[SQL]",NOT_SUPPORTED:"[Not supported]",SECURITY:"[Security]"};var _u=function(e){function WindshaftMetadata(){var e,t;p()(this,WindshaftMetadata);for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return(t=R()(this,(e=O()(WindshaftMetadata)).call.apply(e,[this].concat(n)))).propertyKeys=[],t.baseNames={},Object.keys(t.properties).forEach(function(e){var r=t.properties[e];r.aggregations?Object.values(r.aggregations).forEach(function(r){t._addProperty(e,r)}):r.dimension?r.dimension.range?(r.dimension.range.forEach(function(r){t._addProperty(e,r,!1)}),t._addProperty(e,r.dimension.propertyName)):t._addProperty(e,r.dimension.propertyName):t._addProperty(e,e)}),t}return B()(WindshaftMetadata,e),_()(WindshaftMetadata,[{key:"_addProperty",value:function _addProperty(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.baseNames[t]=e,r&&this.propertyKeys.push(t)}},{key:"_dimensionInfo",value:function _dimensionInfo(e){var t=this.baseName(e)||e,r=this.properties[t],n=null;t!==e&&t!==e&&r.dimension&&(n=r.dimension);var a=r.type,i=n?function dimensionBaseType(e){return e.type}(n):a;return{baseName:t,column:r,dimension:n,dataframeType:n?function dimensionType(e,t){if(e.range)return"date";return e.type}(n):i,baseType:a,sourceType:i}}},{key:"baseName",value:function baseName(e){return this.baseNames[e]}},{key:"decodedProperties",value:function decodedProperties(e){var t=this._dimensionInfo(e).dimension;return t&&t.grouping&&t.range?t.range:dt()(O()(WindshaftMetadata.prototype),"decodedProperties",this).call(this,e)}},{key:"stats",value:function stats(e){var t=this._dimensionInfo(e).dimension;return t&&t.grouping?t:dt()(O()(WindshaftMetadata.prototype),"stats",this).call(this,e)}},{key:"setCodecs",value:function setCodecs(){!function setMetadataCodecs(e){Object.keys(e.properties).forEach(function(t){var r=e.properties[t],n=r.type;if("geometry"!==n){var a=r.dimension?r.dimension.type:null,i=a?r.dimension.propertyName:t,o="category"===a&&r.dimension.range?"timerange":a;r.codec=function windshaftCodecFactory(e,t,r){switch(t){case"number":return new tu(e,r);case"category":return new nu(e,r);case"date":return new hu(e,r);case"timerange":return new du(e,r);default:throw new pu("Windshaft MVT decoding error. Feature property value of type '".concat(t,"' cannot be decoded."),mu.NOT_SUPPORTED)}}(e,o||n,i||t)}})}(this)}},{key:"sourcePropertyName",value:function sourcePropertyName(e){var t=this.baseName(e),r=this.properties[t].dimension;return r&&r.range?r.propertyName:e}}]),WindshaftMetadata}(iu);var vu=function(){function AggregationFiltering(e){p()(this,AggregationFiltering),this._onlyAggregateFilters=e.exclusive}return _()(AggregationFiltering,[{key:"getFilters",value:function getFilters(e){var t={},r=this._and(e).filter(Boolean),n=!0,a=!1,i=void 0;try{for(var o,s=r[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value,c=u.property,l=t[c];if(l){if(!this._compatibleAndFilters(l,u.filters))return{};Object.assign(l[0],u.filters[0])}else t[c]=u.filters}}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return t}},{key:"_and",value:function _and(e){return e.isA(At)?this._and(e.a).concat(this._and(e.b)).filter(Boolean):[this._or(e)].filter(Boolean)}},{key:"_or",value:function _or(e){if(e.isA(zt)){var t=this._basicCondition(e.a),r=this._basicCondition(e.b);if(t&&r&&t.property===r.property)return t.filters=t.filters.concat(r.filters),t}return this._basicCondition(e)}},{key:"_removeBlend",value:function _removeBlend(e){return e.isA(Gt)&&e.originalMix.isA(ft)?e.b:e}},{key:"_basicCondition",value:function _basicCondition(e){return e=this._removeBlend(e),this._between(e)||this._equals(e)||this._notEquals(e)||this._lessThan(e)||this._lessThanOrEqualTo(e)||this._greaterThan(e)||this._greaterThanOrEqualTo(e)||this._in(e)||this._notIn(e)}},{key:"_value",value:function _value(e){if((e=this._removeBlend(e)).isA(Fr)||e.isA(yr)||e.isA(Kt))return e.value}},{key:"_between",value:function _between(e){if(e.isA(vt)){var t=this._aggregation(e.input),r=t&&this._value(e.lowerLimit),n=t&&r&&this._value(e.upperLimit);if(n)return t.filters.push({greater_than_or_equal_to:r,less_than_or_equal_to:n}),t}}},{key:"_in",value:function _in(e){var t=this;if(e.isA(pt)){var r=this._aggregation(e.input),n=e.list.elems.map(function(e){return t._value(e)}).filter(function(e){return null!==e});if(r&&n.length>0&&n.length===e.list.elems.length)return r.filters.push({in:n}),r}}},{key:"_notIn",value:function _notIn(e){var t=this;if(e.isA(_t)){var r=this._aggregation(e.input),n=e.list.elems.map(function(e){return t._value(e)}).filter(function(e){return null!==e});if(r&&n.length>0&&n.length===e.list.elems.length)return r.filters.push({not_in:n}),r}}},{key:"_equals",value:function _equals(e){return this._cmpOp(e,It,"equal")}},{key:"_notEquals",value:function _notEquals(e){return this._cmpOp(e,Lt,"not_equal")}},{key:"_lessThan",value:function _lessThan(e){return this._cmpOp(e,Nt,"less_than","greater_than")}},{key:"_lessThanOrEqualTo",value:function _lessThanOrEqualTo(e){return this._cmpOp(e,Rt,"less_than_or_equal_to","greater_than_or_equal_to")}},{key:"_greaterThan",value:function _greaterThan(e){return this._cmpOp(e,Pt,"greater_than","less_than")}},{key:"_greaterThanOrEqualTo",value:function _greaterThanOrEqualTo(e){return this._cmpOp(e,Dt,"greater_than_or_equal_to","less_than_or_equal_to")}},{key:"_aggregation",value:function _aggregation(e){if((e=this._removeBlend(e)).isA(ur)||e.isA(cr)||e.isA(lr)||e.isA(fr)||e.isA(hr)){var t=this._property(e.property);if(t)return t.property=e.propertyName,t}if(!this._onlyAggregateFilters)return this._property(e)}},{key:"_property",value:function _property(e){if((e=this._removeBlend(e)).isA(ir))return{property:e.name,filters:[]}}},{key:"_cmpOp",value:function _cmpOp(e,t,r,n){if(n=n||r,e.isA(t)){var a=this._aggregation(e.a),i=a&&this._value(e.b),o=r;if(i||(i=(a=this._aggregation(e.b))&&this._value(e.a),o=n),i){var s={};return s[o]=i,a.filters.push(s),a}}}},{key:"_compatibleAndFilters",value:function _compatibleAndFilters(e,t){if(0===e.length||0===t.length)return!0;if(1===e.length&&1===t.length){var r=e[0],n=t[0];if(1===Object.keys(r).length&&1===Object.keys(n).length){var a=Object.keys(r)[0],i=Object.keys(n)[0],o=["less_than","less_than_or_equal_to"],s=["greater_than","greater_than_or_equal_to"];return o.includes(a)&&s.includes(i)||o.includes(i)&&s.includes(a)}}return!1}}]),AggregationFiltering}(),yu=function(){function PreaggregationFiltering(){p()(this,PreaggregationFiltering)}return _()(PreaggregationFiltering,[{key:"getFilter",value:function getFilter(e){return this._filter(e)}},{key:"_filter",value:function _filter(e){return this._and(e)||this._or(e)||this._in(e)||this._notIn(e)||this._between(e)||this._equals(e)||this._notEquals(e)||this._lessThan(e)||this._lessThanOrEqualTo(e)||this._greaterThan(e)||this._greaterThanOrEqualTo(e)||this._blend(e)||null}},{key:"_and",value:function _and(e){if(e.isA(At)){var t=[this._filter(e.a),this._filter(e.b)].filter(Boolean).reduce(function(e,t){return e.concat(t)},[]);if(t.length)return 1===t.length?t[0]:{type:"and",left:t[0],right:t[1]}}}},{key:"_or",value:function _or(e){if(e.isA(zt)){var t=this._filter(e.a),r=this._filter(e.b);if(t&&r)return{type:"or",left:t,right:r}}}},{key:"_lessThan",value:function _lessThan(e){return this._cmpOp(e,Nt,"lessThan")}},{key:"_lessThanOrEqualTo",value:function _lessThanOrEqualTo(e){return this._cmpOp(e,Rt,"lessThanOrEqualTo")}},{key:"_greaterThan",value:function _greaterThan(e){return this._cmpOp(e,Pt,"greaterThan")}},{key:"_greaterThanOrEqualTo",value:function _greaterThanOrEqualTo(e){return this._cmpOp(e,Dt,"greaterThanOrEqualTo")}},{key:"_equals",value:function _equals(e){return this._cmpOp(e,It,"equals")}},{key:"_notEquals",value:function _notEquals(e){return this._cmpOp(e,Lt,"notEquals")}},{key:"_cmpOp",value:function _cmpOp(e,t,r){if(e.isA(t)){var n=this._property(e.a)||this._value(e.a),a=this._property(e.b)||this._value(e.b);if(n&&a)return{type:r,left:n,right:a}}}},{key:"_blend",value:function _blend(e){if(e.isA(Gt)&&e.originalMix.isA(ft))return this._filter(e.b)}},{key:"_property",value:function _property(e){if(e.isA(ir))return{type:"property",property:e.name}}},{key:"_value",value:function _value(e){if(e.isA(Fr)||e.isA(yr)||e.isA(Kt))return{type:"value",value:e.value}}},{key:"_in",value:function _in(e){var t=this;if(e.isA(pt)){var r=this._property(e.input),n=e.list.elems.map(function(e){return t._value(e)});if(r&&n.length>0&&n.length===e.list.elems.length)return{type:"in",property:r.property,values:n.map(function(e){return e.value})}}}},{key:"_notIn",value:function _notIn(e){var t=this;if(e.isA(_t)){var r=this._property(e.input),n=e.list.elems.map(function(e){return t._value(e)});if(r&&n.length>0&&n.length===e.list.elems.length)return{type:"notIn",property:r.property,values:n.map(function(e){return e.value})}}}},{key:"_between",value:function _between(e){if(e.isA(vt)){var t=this._property(e.input),r=this._value(e.lowerLimit),n=this._value(e.upperLimit);if(t&&r&&n)return{type:"between",property:t.property,lower:r.value,upper:n.value}}}}]),PreaggregationFiltering}();function getSQL(e){return e.type?"(".concat(gu[e.type](e),")"):sqlQ(e)}function sqlQ(e){return isFinite(e)?String(e):"'".concat(e.replace(/\'/g,"''"),"'")}function sqlId(e){return e.match(/^[a-z\d_]+$/)||(e='"'.concat(e.replace(/\"/g,'""'),'"')),e}function sqlSep(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return r.map(function(e){return getSQL(e)}).join(e)}var gu={and:function and(e){return sqlSep(" AND ",e.left,e.right)},or:function or(e){return sqlSep(" OR ",e.left,e.right)},between:function between(e){return"".concat(sqlId(e.property)," BETWEEN ").concat(sqlQ(e.lower)," AND ").concat(sqlQ(e.upper))},in:function _in(e){return"".concat(sqlId(e.property)," IN (").concat(sqlSep.apply(void 0,[","].concat(l()(e.values))),")")},notIn:function notIn(e){return"".concat(sqlId(e.property)," NOT IN (").concat(sqlSep.apply(void 0,[","].concat(l()(e.values))),")")},equals:function equals(e){return sqlSep(" = ",e.left,e.right)},notEquals:function notEquals(e){return sqlSep(" <> ",e.left,e.right)},lessThan:function lessThan(e){return sqlSep(" < ",e.left,e.right)},lessThanOrEqualTo:function lessThanOrEqualTo(e){return sqlSep(" <= ",e.left,e.right)},greaterThan:function greaterThan(e){return sqlSep(" > ",e.left,e.right)},greaterThanOrEqualTo:function greaterThanOrEqualTo(e){return sqlSep(" >= ",e.left,e.right)},property:function property(e){return sqlId(e.property)},value:function value(e){return sqlQ(e.value)}};function getAggregationFilters(e){return e&&e.aggregation}var bu=r(18),xu=function(){function WindshaftRequestHelper(e,t){p()(this,WindshaftRequestHelper),this._conf=e,this._mapConfig=t,this._auth=this._encodeParameter("api_key",this._conf.apiKey),this._client=this._encodeParameter("client","vl-".concat(bu.a))}return _()(WindshaftRequestHelper,[{key:"getLayerGroup",value:function(){var e=ot()(at.a.mark(function _callee(){var e,t;return at.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,fetch(this._makeHttpRequest());case 3:e=r.sent,r.next=9;break;case 6:throw r.prev=6,r.t0=r.catch(0),new pu("Failed to connect to Maps API with your user('".concat(this._conf.username,"')"));case 9:return r.next=11,e.json();case 11:return t=r.sent,e.ok||this._dealWithWindshaftErrors(e,t),r.abrupt("return",t);case 14:case"end":return r.stop()}},_callee,this,[[0,6]])}));return function getLayerGroup(){return e.apply(this,arguments)}}()},{key:"_makeHttpRequest",value:function _makeHttpRequest(){var e=[this._auth,this._client,this._encodeParameter("config",this._mapConfigPayload())],t=this._generateUrl(this._generateMapsApiUrl(),e);return t.length<2048?this._getRequest(t):this._postRequest()}},{key:"_dealWithWindshaftErrors",value:function _dealWithWindshaftErrors(e,t){if(401===e.status)throw new pu("Unauthorized access to Maps API: invalid combination of user('".concat(this._conf.username,"') and apiKey('").concat(this._conf.apiKey,"')"),mu.SECURITY);if(403===e.status)throw new pu("Unauthorized access to dataset: the provided apiKey('".concat(this._conf.apiKey,"') doesn't provide access to the requested data"),mu.SECURITY);throw new pu("".concat(JSON.stringify(t.errors)),mu.SQL)}},{key:"_mapConfigPayload",value:function _mapConfigPayload(){return JSON.stringify(this._mapConfig)}},{key:"_getRequest",value:function _getRequest(e){return new Request(e,{method:"GET",headers:{Accept:"application/json"}})}},{key:"_postRequest",value:function _postRequest(){var e=[this._auth,this._client];return new Request(this._generateUrl(this._generateMapsApiUrl(),e),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:this._mapConfigPayload()})}},{key:"_encodeParameter",value:function _encodeParameter(e,t){return"".concat(e,"=").concat(encodeURIComponent(t))}},{key:"_generateUrl",value:function _generateUrl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return"".concat(e,"?").concat(t.join("&"))}},{key:"_generateMapsApiUrl",value:function _generateMapsApiUrl(e){var t="".concat(this._conf.serverURL,"/api/v1/map");return e&&(t+=e),t}}]),WindshaftRequestHelper}(),wu=function(){function Windshaft(e){p()(this,Windshaft),this._source=e,this._exclusive=!0,this._MNS=null,this.inProgressInstantiations={}}return _()(Windshaft,[{key:"bindLayer",value:function bindLayer(e){this._addDataframe=e,this._mvtClient.bindLayer(e)}},{key:"_getInstantiationID",value:function _getInstantiationID(e,t){var r=e.MNS,n=e.resolution,a=e.filtering;return JSON.stringify({MNS:Se.simplify(r),resolution:n,filtering:t.backendFilters?a:null,options:t})}},{key:"getMetadata",value:function(){var e=ot()(at.a.mark(function _callee(e){var t,r;return at.a.wrap(function _callee$(n){for(;;)switch(n.prev=n.next){case 0:if(t=this._getServerInfoFrom(e),!this._needToInstantiateMap(t)){n.next=6;break}return n.next=4,this._repeatableInstantiate(t);case 4:r=n.sent,this._updateStateAfterInstantiating(r);case 6:return n.abrupt("return",this.metadata);case 7:case"end":return n.stop()}},_callee,this)}));return function getMetadata(t){return e.apply(this,arguments)}}()},{key:"_getServerInfoFrom",value:function _getServerInfoFrom(e){return{MNS:this._getMinNeededSchemaFrom(e),resolution:e.resolution.value,filtering:function getFiltering(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new vu(t),n={preaggregation:new yu(t).getFilter(e.filter),aggregation:r.getFilters(e.filter)};return n.preaggregation||n.aggregation?n:null}(e,{exclusive:this._exclusive})}}},{key:"_getMinNeededSchemaFrom",value:function _getMinNeededSchemaFrom(e){var t=e.getMinimumNeededSchema();return this._checkAcceptableMNS(t),this._forceIncludeCartodbId(t),t}},{key:"_forceIncludeCartodbId",value:function _forceIncludeCartodbId(e){e[Ks]||(e[Ks]=[{type:Ce}])}},{key:"requiresNewMetadata",value:function requiresNewMetadata(e){var t=this._getServerInfoFrom(e);return this._needToInstantiateMap(t)}},{key:"_checkAcceptableMNS",value:function _checkAcceptableMNS(e){Object.keys(e).forEach(function(t){var r=e[t],n=r.some(function(e){return e.type===Te}),a=r.some(function(e){return e.type===Ce});if(n&&a){var i=JSON.stringify(r.filter(function(e){return"aggregated"!==e.type}));throw new me("Incompatible combination of cluster aggregation usages (".concat(i,") with unaggregated usage for property '").concat(t,"'"),_e.INCORRECT_VALUE)}})}},{key:"getData",value:function getData(e,t){if(this._mvtClient)return this._mvtClient.requestData(e,t)}},{key:"_needToInstantiateMap",value:function _needToInstantiateMap(e){var t=e.MNS,r=e.resolution,n=e.filtering,a=Se.notEquals(this._MNS,t),i=this.resolution!==r,o=JSON.stringify(this.filtering)!==JSON.stringify(n),s=this.metadata&&this.metadata.featureCount>2e6;return a||i||o&&s}},{key:"_isInstantiated",value:function _isInstantiated(){return!!this.metadata}},{key:"_instantiationChoices",value:function _instantiationChoices(e){var t={backendFilters:!0};if(e&&e.featureCount>=0){var r=e.featureCount>2e6;t.backendFilters=r||!e.backendFiltersApplied}return t}},{key:"_instantiateUncached",value:function(){var e=ot()(at.a.mark(function _callee2(e){var t,r,n,a,i,o,s,u,c,l,f,h,d,p,m,_,v=arguments;return at.a.wrap(function _callee2$(y){for(;;)switch(y.prev=y.next){case 0:return t=v.length>1&&void 0!==v[1]?v[1]:{backendFilters:!0},r=v.length>2&&void 0!==v[2]?v[2]:null,n=e.MNS,a=e.resolution,i=e.filtering,y.next=5,this._generateAggregation(n,a);case 5:return o=y.sent,s=this._buildSelectClause(n),u=this._buildQuery(s),c="(".concat(u,") AS tmp"),l=t.backendFilters?i:null,f=!1,l&&this._requiresAggregation(n)&&(o.filters=getAggregationFilters(l),o.filters&&(f=!0),this._exclusive||(l=null)),l&&(h=this._buildQuery(s,l),f=f||h!==u,u=h),d=this._getConfig(),y.next=16,this._getInstantiationPromise(c,d,o,u,s,r,n);case 16:return p=y.sent,m=p.urlTemplates,(_=p.metadata).backendFiltersApplied=f,y.abrupt("return",{MNS:n,resolution:a,filtering:i,metadata:_,urlTemplates:m});case 21:case"end":return y.stop()}},_callee2,this)}));return function _instantiateUncached(t){return e.apply(this,arguments)}}()},{key:"_updateStateAfterInstantiating",value:function _updateStateAfterInstantiating(e){var t=e.MNS,r=e.resolution,n=e.filtering,a=e.metadata,i=e.urlTemplates;this._mvtClient&&this._mvtClient.free(),a.extent=2048,this._mvtClient=new fu(i,a),this._mvtClient._workerName="windshaft",this._mvtClient.bindLayer(this._addDataframe),this.urlTemplates=i,this.metadata=a,this._MNS=t,this.filtering=n,this.resolution=r,this._checkLayerMeta(t)}},{key:"_instantiate",value:function(){var e=ot()(at.a.mark(function _callee3(e,t,r){var n,a;return at.a.wrap(function _callee3$(i){for(;;)switch(i.prev=i.next){case 0:if(n=this._getInstantiationID(e,t),!this.inProgressInstantiations[n]){i.next=3;break}return i.abrupt("return",this.inProgressInstantiations[n]);case 3:return a=this._instantiateUncached(e,t,r),this.inProgressInstantiations[n]=a,i.abrupt("return",a);case 6:case"end":return i.stop()}},_callee3,this)}));return function _instantiate(t,r,n){return e.apply(this,arguments)}}()},{key:"_repeatableInstantiate",value:function(){var e=ot()(at.a.mark(function _callee4(e){var t,r,n,a=this;return at.a.wrap(function _callee4$(i){for(;;)switch(i.prev=i.next){case 0:return t=null,r=this._instantiationChoices(this.metadata),n=function finalChoices(e){return t=e.metadata,a._instantiationChoices(e.metadata)},i.abrupt("return",repeatablePromise(r,n,function(r){return a._instantiate(e,r,t)}));case 4:case"end":return i.stop()}},_callee4,this)}));return function _repeatableInstantiate(t){return e.apply(this,arguments)}}()},{key:"_checkLayerMeta",value:function _checkLayerMeta(e){if(!this._isAggregated()&&this._requiresAggregation(e))throw new pu("Aggregation not supported for this dataset",mu.NOT_SUPPORTED)}},{key:"_isAggregated",value:function _isAggregated(){return this.metadata&&this.metadata.isAggregated}},{key:"_requiresAggregation",value:function _requiresAggregation(e){return Object.values(e).some(function(e){return e.some(function(e){return e.type===Te})})}},{key:"_generateAggregation",value:function _generateAggregation(e,t){var r={columns:{},dimensions:{},placement:"centroid",resolution:t,threshold:1};return Object.keys(e).forEach(function(t){t!==Ks&&e[t].forEach(function(e){if("aggregated"===e.type)r.columns[Se.column.aggColumn(t,e.op)]={aggregate_function:e.op,aggregated_column:t};else if("dimension"===e.type){var n=e.dimension,a=n.group,i=n.format,o={column:t,group:a,format:i};r.dimensions[n.propertyName]=o}else r.dimensions[t]={column:t}})}),r}},{key:"_buildSelectClause",value:function _buildSelectClause(e){var t=Object.keys(e).concat(["the_geom_webmercator",Ks]);return t.filter(function(e,r){return t.indexOf(e)===r})}},{key:"_buildQuery",value:function _buildQuery(e,t){var r=e.map(function(e){return'"'.concat(e,'"')}).join(),n=t?function getSQLWhere(e){var t;return(e=e&&e.preaggregation)&&Object.keys(e).length>0&&(t=getSQL(e)),t?"WHERE "+t:""}(t):"";return"SELECT ".concat(r," FROM ").concat(this._source._getFromClause()," ").concat(n)}},{key:"_getConfig",value:function _getConfig(){return{apiKey:this._source._apiKey,username:this._source._username,serverURL:this._source._serverURL}}},{key:"free",value:function free(){this._mvtClient&&this._mvtClient.free()}},{key:"_getInstantiationPromise",value:function(){var e=ot()(at.a.mark(function _callee5(e,t,r,n,a,i,o){var s,u;return at.a.wrap(function _callee5$(e){for(;;)switch(e.prev=e.next){case 0:return s=this._getMapConfigAgg(r,n),i||this._completeMapConfigWithColumns(s,a),e.next=4,this._getLayerGroupFromWindshaft(t,s);case 4:return u=e.sent,e.abrupt("return",{urlTemplates:u.metadata.tilejson.vector.tiles,metadata:i||this._adaptMetadata(u.metadata.layers[0].meta,r,o)});case 6:case"end":return e.stop()}},_callee5,this)}));return function _getInstantiationPromise(t,r,n,a,i,o,s){return e.apply(this,arguments)}}()},{key:"_getMapConfigAgg",value:function _getMapConfigAgg(e,t){return{buffersize:{mvt:1},layers:[{type:"mapnik",options:{sql:t,aggregation:e,vector_extent:2048,vector_simplify_extent:2048,dates_as_numbers:!0}}]}}},{key:"_completeMapConfigWithColumns",value:function _completeMapConfigWithColumns(e,t){var r=["the_geom","the_geom_webmercator"],n=t.filter(function(e){return!r.includes(e)});e.layers[0].options.metadata={geometryType:!0,columnStats:{topCategories:32768,includeNulls:!0},dimensions:!0,sample:{num_rows:1e3,include_columns:n}}}},{key:"_getLayerGroupFromWindshaft",value:function(){var e=ot()(at.a.mark(function _callee6(e,t){var r;return at.a.wrap(function _callee6$(n){for(;;)switch(n.prev=n.next){case 0:return r=new xu(e,t),n.abrupt("return",r.getLayerGroup());case 2:case"end":return n.stop()}},_callee6,this)}));return function _getLayerGroupFromWindshaft(t,r){return e.apply(this,arguments)}}()},{key:"_adaptMetadata",value:function _adaptMetadata(e,t,r){e.datesAsNumbers=e.dates_as_numbers;var n=e.stats,a=e.aggregation,i=e.datesAsNumbers,o=n.hasOwnProperty("featureCount")?n.featureCount:n.estimatedFeatureCount,s=n.geometryType&&function adaptGeometryType(e){switch(e){case"ST_MultiPolygon":case"ST_Polygon":return ve.POLYGON;case"ST_Point":return ve.POINT;case"ST_MultiLineString":case"ST_LineString":return ve.LINE;default:throw new pu("Unimplemented geometry type '".concat(e,"'."),mu.NOT_SUPPORTED)}}(n.geometryType),u=n.columns;return Object.keys(t.columns).forEach(function(e){var r=t.columns[e].aggregated_column,n=t.columns[e].aggregate_function;u[r].aggregations||(u[r].aggregations={}),u[r].aggregations[n]=e,r!==e&&(u[e]=JSON.parse(JSON.stringify(u[r])))}),Object.keys(t.dimensions).forEach(function(e){var a=t.dimensions[e];if(n.dimensions&&n.dimensions[e].type){var i=n.dimensions[e],o=adaptColumnType(i.type),s=a.column,c=Ds()(a,["column"]);if(u[s].dimension)throw new pu("Multiple dimensions based on same column '".concat(s,"'."),mu.NOT_SUPPORTED);u[s].dimension={propertyName:e,grouping:0===Object.keys(c).length?void 0:i.params,type:o,min:i.min,max:i.max},r[s].some(function(e){return e.range})>0&&(u[s].dimension.range=["start","end"].map(function(t){return"".concat(e,"_").concat(t)}))}}),Object.values(u).map(function(e){e.type=adaptColumnType(e.type)}),Object.keys(u).forEach(function(e){var t=u[e];"category"===t.type&&t.categories?t.categories.forEach(function(e){e.name=e.category,delete e.category}):i&&i.includes(e)&&(t.type="date")}),s===ve.POINT&&(u._cdb_feature_count={type:"number"}),new _u({properties:u,featureCount:o,sample:n.sample,geomType:s,isAggregated:a.mvt,idProperty:Ks})}}]),Windshaft}();function adaptColumnType(e){return"string"===e?"category":e}function repeatablePromise(e,t,r){return _repeatablePromise.apply(this,arguments)}function _repeatablePromise(){return(_repeatablePromise=ot()(at.a.mark(function _callee7(e,t,r){var n,a,i;return at.a.wrap(function _callee7$(o){for(;;)switch(o.prev=o.next){case 0:return n=r(e),o.next=3,n;case 3:if(a=o.sent,i=t(a),JSON.stringify(e)!==JSON.stringify(i)){o.next=9;break}return o.abrupt("return",n);case 9:return o.abrupt("return",r(i));case 10:case"end":return o.stop()}},_callee7,this)}))).apply(this,arguments)}var ku=function(e){function BaseWindshaft(){var e;return p()(this,BaseWindshaft),(e=R()(this,O()(BaseWindshaft).call(this)))._client=new wu(qt()(qt()(e))),e}return B()(BaseWindshaft,e),_()(BaseWindshaft,[{key:"initialize",value:function initialize(e,t){this._initializeAuth(e),this._initializeConfig(t),this._initializeServerURL()}},{key:"_initializeAuth",value:function _initializeAuth(e){this._auth=e||function getDefaultAuth(){return xe}(),checkAuth(this._auth),this._apiKey=this._auth.apiKey,this._username=this._auth.username}},{key:"_initializeConfig",value:function _initializeConfig(e){this._config=e||function getDefaultConfig(){return we}(),checkConfig(this._config)}},{key:"_initializeServerURL",value:function _initializeServerURL(){var e=this._config&&this._config.serverURL||"https://{user}.carto.com";e=e.replace(/{user}/,this._username),this._serverURL=e}},{key:"bindLayer",value:function bindLayer(e){this._client.bindLayer(e)}},{key:"requiresNewMetadata",value:function requiresNewMetadata(e){return this._client.requiresNewMetadata(e)}},{key:"requestMetadata",value:function requestMetadata(e){return this._client.getMetadata(e)}},{key:"requestData",value:function requestData(e,t){return this._client.getData(e,t)}},{key:"free",value:function free(){this._client.free()}}]),BaseWindshaft}(ds),Tu=function(e){function Dataset(e,t,r){var n;return p()(this,Dataset),(n=R()(this,O()(Dataset).call(this)))._checkTableName(e),n._tableName=e,n.initialize(t,r),n}return B()(Dataset,e),_()(Dataset,[{key:"_getFromClause",value:function _getFromClause(){return this._tableName}},{key:"_clone",value:function _clone(){return new Dataset(this._tableName,this._auth,this._config)}},{key:"_checkTableName",value:function _checkTableName(e){if(ke.isUndefined(e))throw new me("'tableName'",_e.MISSING_REQUIRED);if(!ke.isString(e))throw new me("'tableName' property must be a string.",_e.INCORRECT_TYPE);if(""===e)throw new me("'tableName' property must be not empty.",_e.INCORRECT_VALUE)}}]),Dataset}(ku),Cu=function(){function GeoJSONGeometryTransformer(e){p()(this,GeoJSONGeometryTransformer),this._center=e}return _()(GeoJSONGeometryTransformer,[{key:"computePoint",value:function computePoint(e){var t=e[1],r=e[0],n=ke.projectToWebMercator({lat:t,lng:r}),a={scale:ke.WM_R,center:this._center};return wToR(n.x,n.y,a)}},{key:"computeLineString",value:function computeLineString(e,t){for(var r=[],n=0;n<e.length;n++){var a=this.computePoint(e[t?e.length-n-1:n]);r.push(a.x,a.y)}return r}},{key:"computeMultiLineString",value:function computeMultiLineString(e){for(var t=[],r=0;r<e.length;r++){var n=this.computeLineString(e[r]);n.length>0&&t.push(n)}return t}},{key:"computePolygon",value:function computePolygon(e){var t={flat:[],holes:[],clipped:[]},r=0,n=!1;if(e.length){n=this._isReversed(e[0]);var a=this.computeLineString(e[0],n);t.flat=t.flat.concat(a)}for(var i=1;i<e.length;i++){n!==this._isReversed(e[i])&&(r+=e[i-1].length,t.holes.push(r));var o=this.computeLineString(e[i],n);t.flat=t.flat.concat(o)}return t}},{key:"computeMultiPolygon",value:function computeMultiPolygon(e){for(var t=[],r=0;r<e.length;r++){var n=this.computePolygon(e[r]);n.flat.length>0&&t.push(n)}return t}},{key:"_isReversed",value:function _isReversed(e){for(var t,r=0,n=e[0],a=0;a<e.length-1;a++)r+=((t=e[a+1])[1]-n[1])*(t[0]+n[0]),n=t;return r>=0}}]),GeoJSONGeometryTransformer}(),Eu=Object.freeze({POINT:"Point",LINE_STRING:"LineString",MULTI_LINE_STRING:"MultiLineString",POLYGON:"Polygon",MULTI_POLYGON:"MultiPolygon"});function dataframeGeometryType(e){switch(e){case Eu.POINT:return ve.POINT;case Eu.LINE_STRING:case Eu.MULTI_LINE_STRING:return ve.LINE;case Eu.POLYGON:case Eu.MULTI_POLYGON:return ve.POLYGON;default:return""}}var Mu=function(e){function DateCodec(e,t){var r;p()(this,DateCodec),r=R()(this,O()(DateCodec).call(this,e,t));var n=e.stats(t).min;return r._min_date=castDate(n),r._min_ms=r._min_date.getTime(),r}return B()(DateCodec,e),_()(DateCodec,[{key:"sourceToInternal",value:function sourceToInternal(e,t){return castDate(t).getTime()-this._min_ms}},{key:"internalToExternal",value:function internalToExternal(e,t){var r=t;return msToDate(r+=this._min_ms)}},{key:"externalToSource",value:function externalToSource(e,t){return t.getTime()}},{key:"sourceToExternal",value:function sourceToExternal(e,t){return castDate(t)}},{key:"inlineInternalMatch",value:function inlineInternalMatch(e,t){var r=t._min_ms-this._min_ms;return"(".concat(e,"-").concat(r.toFixed(20),")")}}]),DateCodec}(Er);var Au=function(e){function GeoJSONMetadata(){return p()(this,GeoJSONMetadata),R()(this,O()(GeoJSONMetadata).apply(this,arguments))}return B()(GeoJSONMetadata,e),_()(GeoJSONMetadata,[{key:"setCodecs",value:function setCodecs(){var e=this;Object.keys(this.properties).forEach(function(t){var r=e.properties[t],n=r.type;"geometry"!==n&&(r.codec=function codecFactory(e,t,r){switch(t){case"number":return new tu(e,r);case"category":return new nu(e,r);case"date":return new Mu(e,r);default:throw new Pe("Feature property value of type '".concat(t,"' cannot be decoded."),De.NOT_SUPPORTED)}}(e,n,t))})}}]),GeoJSONMetadata}(eu),Su=function(){function GeoJSONMetadataBuilder(e,t){p()(this,GeoJSONMetadataBuilder),this._providedDateColumns=e,this._boundColumns=t,this._numFields=new Set,this._catFields=new Set,this._dateFields=new Set,this._properties={}}return _()(GeoJSONMetadataBuilder,[{key:"buildFrom",value:function buildFrom(e,t){this._addNumericColumnField(Ks);for(var r=[],n=this._requiredColumnsIn(e),a=0;a<t.length;a++){var i=t[a].properties;this._addPropertiesToMetadata(i,n),this._sampleFeatureOnMetadata(i,r,t.length)}this._calculateAvgForNumericFields();var o=new Au({properties:this._properties,featureCount:t.length,sample:r,geomType:this._dataframeGeomTypeFrom(t),idProperty:Ks});return o.setCodecs(),o}},{key:"getCurrentFields",value:function getCurrentFields(){return l()(this._numFields).concat(l()(this._catFields)).concat(l()(this._dateFields))}},{key:"_requiredColumnsIn",value:function _requiredColumnsIn(e){return new Set(Object.keys(Se.simplify(e.getMinimumNeededSchema())))}},{key:"_addPropertiesToMetadata",value:function _addPropertiesToMetadata(e,t){for(var r=Object.keys(e),n=0,a=r.length;n<a;n++){var i=r[n];if(t.has(i)&&!this._boundColumns.has(i)){var o=e[i];this._addPropertyToMetadata(i,o)}}}},{key:"_calculateAvgForNumericFields",value:function _calculateAvgForNumericFields(){var e=this;this._numFields.forEach(function(t){var r=e._properties[t];r.avg=r.sum/r.count})}},{key:"_dataframeGeomTypeFrom",value:function _dataframeGeomTypeFrom(e){var t="";return e.length>0&&(t=dataframeGeometryType(e[0].geometry.type)),t}},{key:"_sampleFeatureOnMetadata",value:function _sampleFeatureOnMetadata(e,t,r){if(r>1e3){var n=1e3/r;if(Math.random()>n)return}t.push(e)}},{key:"_addNumericPropertyToMetadata",value:function _addNumericPropertyToMetadata(e,t){if(this._catFields.has(e)||this._dateFields.has(e))throw new me("Unsupported GeoJSON: the property '".concat(e,"' has different types in different features."),_e.INCORRECT_TYPE);this._addNumericColumnField(e);var r=this._properties[e];r.min=Math.min(r.min,t),r.max=Math.max(r.max,t),r.sum+=t}},{key:"_addNumericColumnField",value:function _addNumericColumnField(e){this._numFields.has(e)||(this._numFields.add(e),this._properties[e]={type:"number",min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,avg:Number.NaN,sum:0,count:0})}},{key:"_addDatePropertyToMetadata",value:function _addDatePropertyToMetadata(e,t){if(this._catFields.has(e)||this._numFields.has(e))throw new Pe("Unsupported GeoJSON: the property '".concat(e,"' has different types in different features."),De.NOT_SUPPORTED);this._addDateColumnField(e);var r=this._properties[e],n=ke.castDate(t);r.min=r.min?ke.castDate(Math.min(r.min,n)):n,r.max=r.max?ke.castDate(Math.max(r.max,n)):n,r.sum+=t,r.count++}},{key:"_addDateColumnField",value:function _addDateColumnField(e){this._dateFields.has(e)||(this._dateFields.add(e),this._properties[e]={type:"date",min:null,max:null,avg:null,sum:0,count:0})}},{key:"_addPropertyToMetadata",value:function _addPropertyToMetadata(e,t){return this._providedDateColumns.has(e)?this._addDatePropertyToMetadata(e,t):Number.isFinite(t)?this._addNumericPropertyToMetadata(e,t):void(null!==t&&this._addCategoryPropertyToMetadata(e,t))}},{key:"_addCategoryPropertyToMetadata",value:function _addCategoryPropertyToMetadata(e,t){if(this._numFields.has(e)||this._dateFields.has(e))throw new Pe("Unsupported GeoJSON: the property '".concat(e,"' has different types in different features."),De.NOT_SUPPORTED);this._catFields.has(e)||(this._catFields.add(e),this._properties[e]={type:"category",categories:[]});var r=this._properties[e],n=r.categories.find(function(e){return e.name===t});n?n.frequency++:r.categories.push({name:t,frequency:1})}}]),GeoJSONMetadataBuilder}(),Iu=function(e){function GeoJSON(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p()(this,GeoJSON),(t=R()(this,O()(GeoJSON).call(this)))._initializeData(e),t._initializeMetadataHelpers(r),t}return B()(GeoJSON,e),_()(GeoJSON,[{key:"_initializeData",value:function _initializeData(e){this._checkData(e),this._data=e,this._features=this._featuresFromData(),this._geomType=this._getGeomType(),this._webMercatorCenter=this._getWebMercatorCoordsCenter(),this._geometryTransformer=new Cu(this._webMercatorCenter)}},{key:"_initializeMetadataHelpers",value:function _initializeMetadataHelpers(e){this._providedDateColumns=new Set(e.dateColumns),this._boundColumns=new Set,this._metadataBuilder=new Su(this._providedDateColumns,this._boundColumns)}},{key:"_checkData",value:function _checkData(e){if(ke.isUndefined(e))throw new me("'data'",_e.MISSING_REQUIRED);if(!ke.isObject(e))throw new me("'data' property must be an object.",_e.INCORRECT_TYPE)}},{key:"_featuresFromData",value:function _featuresFromData(){var e,t=this._data.type;if("FeatureCollection"===t)e=this._data.features;else{if("Feature"!==t)throw new me("'data' property must be a GeoJSON object.",_e.INCORRECT_VALUE);e=[this._data]}return this._initializePropertiesIn(e),e}},{key:"_getGeomType",value:function _getGeomType(){return this._features[0].geometry.type}},{key:"_getWebMercatorCoordsCenter",value:function _getWebMercatorCoordsCenter(){var e=this,t=0,r=0,n=0;return this._fetchFeatureGeometry({sample:10},function(a,i){var o=e._samplePoint(i),s=ke.projectToWebMercator({lng:o[0],lat:o[1]});t+=s.x,r+=s.y,n+=1}),n>1&&(t/=n,r/=n),{x:t,y:r}}},{key:"_getDataframeCenter",value:function _getDataframeCenter(){var e={scale:ke.WM_R,center:{x:0,y:0}},t=this._webMercatorCenter;return wToR(t.x,t.y,e)}},{key:"bindLayer",value:function bindLayer(e){this._addDataframe=e}},{key:"requestMetadata",value:function requestMetadata(e){return Promise.resolve(this._computeMetadata(e))}},{key:"requestData",value:function requestData(){var e=this;if(this._dataframe){var t=this._decodeUnboundProperties();this._dataframe.addProperties();var r=Object.keys(t);return r.forEach(function(t){e._boundColumns.add(t)}),Promise.resolve(r.length>0)}return this._dataframe=this._createNewDataframe(),Promise.resolve(!0)}},{key:"_createNewDataframe",value:function _createNewDataframe(){var e=new $s({active:!0,center:this._getDataframeCenter(),geom:this._decodeGeometry(),properties:this._decodeUnboundProperties(),scale:1,size:this._features.length,type:dataframeGeometryType(this._geomType),metadata:this._metadata});return this._boundColumns=new Set(Object.keys(e.properties)),this._addDataframe&&this._addDataframe(e),e}},{key:"requiresNewMetadata",value:function requiresNewMetadata(){return!1}},{key:"_clone",value:function _clone(){return new GeoJSON(this._data,{dateColumns:Array.from(this._providedDateColumns)})}},{key:"_initializePropertiesIn",value:function _initializePropertiesIn(e){for(var t=0;t<e.length;t++)e[t].properties=e[t].properties||{}}},{key:"_computeMetadata",value:function _computeMetadata(e){return this._metadata=this._metadataBuilder.buildFrom(e,this._features),this._metadata}},{key:"_decodeUnboundProperties",value:function _decodeUnboundProperties(){for(var e=this,t=this._getUnboundProperties(),r=Object.keys(t),n=function _loop(n){var a=e._features[n];r.forEach(function(r){r!==Ks||Number.isFinite(a.properties[Ks])||(a.properties[Ks]=-n),t[r][n]=e._metadata.codec(r).sourceToInternal(e._metadata,a.properties[r])})},a=0;a<this._features.length;a++)n(a);return t}},{key:"_getUnboundProperties",value:function _getUnboundProperties(){var e=this,t={};return this._metadataBuilder.getCurrentFields().forEach(function(r){e._boundColumns.has(r)||(t[r]=new Float32Array(e._features.length+1024))}),t}},{key:"_fetchFeatureGeometry",value:function _fetchFeatureGeometry(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=this._features.length,n=e.sample?Math.max(1,Math.floor(r/e.sample)):1,a=0;a<r;a+=n){var i=this._features[a];"Feature"===i.type&&t(a,i.geometry)}return null}},{key:"_allocGeometry",value:function _allocGeometry(){return"Point"===this._geomType?new Float32Array(6*this._features.length):[]}},{key:"_decodeGeometry",value:function _decodeGeometry(){var e=this,t=this._allocGeometry();return this._fetchFeatureGeometry({},function(r,n){var a=n.type,i=n.coordinates,o=dataframeGeometryType(a),s=dataframeGeometryType(e._geomType);if(o!==s)throw new me("multiple geometry types not supported: found '".concat(o,"' instead of '").concat(s,"'."),_e.INCORRECT_TYPE);if(a===Eu.POINT){var u=e._geometryTransformer.computePoint(i);t[6*r+0]=u.x,t[6*r+1]=u.y,t[6*r+2]=u.x,t[6*r+3]=u.y,t[6*r+4]=u.x,t[6*r+5]=u.y}else if(a===Eu.LINE_STRING){var c=e._geometryTransformer.computeLineString(i);t.push([c])}else if(a===Eu.MULTI_LINE_STRING){var l=e._geometryTransformer.computeMultiLineString(i);t.push(l)}else if(a===Eu.POLYGON){var f=e._geometryTransformer.computePolygon(i);t.push([f])}else if(a===Eu.MULTI_POLYGON){var h=e._geometryTransformer.computeMultiPolygon(i);t.push(h)}}),t}},{key:"_samplePoint",value:function _samplePoint(e){var t=e.type,r=e.coordinates;return t===Eu.POINT?r:t===Eu.LINE_STRING?r[0]:t===Eu.MULTI_LINE_STRING||t===Eu.POLYGON?r[0][0]:t===Eu.MULTI_POLYGON?r[0][0][0]:void 0}},{key:"free",value:function free(){}}]),GeoJSON}(ds),Pu=function(){function BigQueryTileCache(){p()(this,BigQueryTileCache);this._cache=ou({max:512,length:function length(){return 1},maxAge:36e5,dispose:function dispose(e,t){!1===t.empty&&t.free()}})}return _()(BigQueryTileCache,[{key:"get",value:function get(e){return this._cache.get(e)}},{key:"set",value:function set(e,t){this._cache.set(e,t)}},{key:"free",value:function free(){this._cache.reset()}}]),BigQueryTileCache}(),Du=function(){function BigQueryTileClient(){p()(this,BigQueryTileClient),this._nextGroupID=0,this._currentRequestGroupID=0,this._oldDataframes=[],this._cache=new Pu}return _()(BigQueryTileClient,[{key:"bindLayer",value:function bindLayer(e){this._addDataframe=e}},{key:"requestData",value:function requestData(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.ceil,a=arguments.length>4?arguments[4]:void 0,i=rTiles(e,t=this._filterViewport(t,a),n,0);return this._getTiles(i,r)}},{key:"free",value:function free(){this._cache.free(),this._cache=new Pu,this._oldDataframes=[]}},{key:"_getTiles",value:function(){var e=ot()(at.a.mark(function _callee(e,t){var r,n,a,i,o=this;return at.a.wrap(function _callee$(s){for(;;)switch(s.prev=s.next){case 0:if(this._nextGroupID++,r=this._nextGroupID,(n=e.filter(function(e){var t=e.x,r=e.y,n=e.z;return!o._cache.get("".concat(t,",").concat(r,",").concat(n))})).map(function(e){var t=e.x,r=e.y,n=e.z;return o._cache.set("".concat(t,",").concat(r,",").concat(n),{})}),!n.length){s.next=7;break}return s.next=7,this._requestDataframes(n,t);case 7:if(a=e.map(function(e){var t=e.x,r=e.y,n=e.z;return o._cache.get("".concat(t,",").concat(r,",").concat(n))}),!(r<this._currentRequestGroupID)){s.next=10;break}return s.abrupt("return",!0);case 10:return this._currentRequestGroupID=r,this._oldDataframes.forEach(function(e){e.active=!1}),a.forEach(function(e){e.active=!0}),i=!isSetsEqual(new Set(a),new Set(this._oldDataframes)),this._oldDataframes=a,s.abrupt("return",i);case 16:case"end":return s.stop()}},_callee,this)}));return function _getTiles(t,r){return e.apply(this,arguments)}}()},{key:"_requestDataframes",value:function(){var e=ot()(at.a.mark(function _callee2(e,t){var r,n,a,i,o,s;return at.a.wrap(function _callee2$(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,t(e);case 2:for(r=u.sent,n=0;n<r.length;n++)a=r[n],i=a.x,o=a.y,s=a.z,r[n].orderID=i+o/1e3,a.empty||this._addDataframe(a),this._cache.set("".concat(i,",").concat(o,",").concat(s),a);case 4:case"end":return u.stop()}},_callee2,this)}));return function _requestDataframes(t,r){return e.apply(this,arguments)}}()},{key:"_filterViewport",value:function _filterViewport(e,t){if(t){var r=this._localBounds(t);return[Math.max(e[0],r[0]),Math.max(e[1],r[1]),Math.min(e[2],r[2]),Math.min(e[3],r[3])]}return e}},{key:"_localBounds",value:function _localBounds(e){var t=projectToWebMercator({lng:e[0],lat:e[1]}),r=projectToWebMercator({lng:e[2],lat:e[3]});return[t.x/be,t.y/be,r.x/be,r.y/be]}}]),BigQueryTileClient}(),Nu=function(){function BigQueryClient(e,t){p()(this,BigQueryClient),this._projectId=e,this._token=t,this._activeJobs={}}return _()(BigQueryClient,[{key:"list",value:function(){var e=ot()(at.a.mark(function _callee(){return at.a.wrap(function _callee$(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetch("GET","jobs"));case 1:case"end":return e.stop()}},_callee,this)}));return function list(){return e.apply(this,arguments)}}()},{key:"insert",value:function(){var e=ot()(at.a.mark(function _callee2(){return at.a.wrap(function _callee2$(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetch("POST","jobs"));case 1:case"end":return e.stop()}},_callee2,this)}));return function insert(){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=ot()(at.a.mark(function _callee3(e){return at.a.wrap(function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.fetch("GET","jobs/".concat(e)));case 1:case"end":return t.stop()}},_callee3,this)}));return function get(t){return e.apply(this,arguments)}}()},{key:"cancel",value:function(){var e=ot()(at.a.mark(function _callee4(e){return at.a.wrap(function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.fetch("POST","jobs/".concat(e,"/cancel")));case 1:case"end":return t.stop()}},_callee4,this)}));return function cancel(t){return e.apply(this,arguments)}}()},{key:"query",value:function(){var e=ot()(at.a.mark(function _callee5(e){return at.a.wrap(function _callee5$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.fetch("POST","queries",{kind:"bigquery#queryRequest",query:e,useLegacySql:!1,timeoutMs:5e3,useQueryCache:!0}));case 1:case"end":return t.stop()}},_callee5,this)}));return function query(t){return e.apply(this,arguments)}}()},{key:"getQueryResults",value:function(){var e=ot()(at.a.mark(function _callee6(e){return at.a.wrap(function _callee6$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.fetch("GET","queries/".concat(e,"?timeoutMs=").concat(5e3)));case 1:case"end":return t.stop()}},_callee6,this)}));return function getQueryResults(t){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=ot()(at.a.mark(function _callee7(e){var t;return at.a.wrap(function _callee7$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.query(e);case 2:if(!(t=r.sent).error){r.next=5;break}throw Error("[".concat(t.error.status,"] ").concat(t.error.message));case 5:return r.abrupt("return",this._pollingQuery(t));case 6:case"end":return r.stop()}},_callee7,this)}));return function execute(t){return e.apply(this,arguments)}}()},{key:"_pollingQuery",value:function(){var e=ot()(at.a.mark(function _callee8(e){var t=this;return at.a.wrap(function _callee8$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise(function(r,n){if(e.jobComplete)r(e);else{var a=e.jobReference.jobId;t._updateJobTime(a),t._jobTimeout(a)?t._cancelJob(a,n):t._getJobResult(a,r)}}));case 1:case"end":return r.stop()}},_callee8,this)}));return function _pollingQuery(t){return e.apply(this,arguments)}}()},{key:"_jobTimeout",value:function _jobTimeout(e){return this._activeJobs[e]>=12e4}},{key:"_updateJobTime",value:function _updateJobTime(e){e in this._activeJobs?this._activeJobs[e]+=5e3:this._activeJobs[e]=5e3}},{key:"_cancelJob",value:function(){var e=ot()(at.a.mark(function _callee9(e,t){var r;return at.a.wrap(function _callee9$(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.cancel(e);case 2:r=n.sent,delete this._activeJobs[e],t(r);case 5:case"end":return n.stop()}},_callee9,this)}));return function _cancelJob(t,r){return e.apply(this,arguments)}}()},{key:"_getJobResult",value:function(){var e=ot()(at.a.mark(function _callee10(e,t){var r;return at.a.wrap(function _callee10$(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getQueryResults(e);case 2:(r=n.sent).jobComplete?t(r):t(this._pollingQuery(r));case 4:case"end":return n.stop()}},_callee10,this)}));return function _getJobResult(t,r){return e.apply(this,arguments)}}()},{key:"fetch",value:function(e){function fetch(t,r,n){return e.apply(this,arguments)}return fetch.toString=function(){return e.toString()},fetch}(function(){var e=ot()(at.a.mark(function _callee11(e,t,r){var n;return at.a.wrap(function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,fetch("".concat("https://bigquery.googleapis.com/bigquery/v2","/projects/").concat(this._projectId,"/").concat(t),{method:e,headers:{Authorization:"Bearer ".concat(this._token),"Content-Type":"application/json"},body:r&&JSON.stringify(r)});case 2:return n=a.sent,a.abrupt("return",n.json());case 4:case"end":return a.stop()}},_callee11,this)}));return function(t,r,n){return e.apply(this,arguments)}}())}]),BigQueryClient}(),Ru=0;function gilbert2d_tile(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:x,y:y},t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;if(t<1||r<1)throw"Invalid Gilbert rectangle. Got: Width (".concat(t,"). Height: (").concat(r,")");var n={x:e.x,y:e.y,counter:0},a={x:0,y:r},i={x:t,y:0};return t>r&&(a={x:t,y:0},i={x:0,y:r}),function gilbert2d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:x,y:y},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:x,y:y},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:x,y:y},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{counter:counter,x:x,y:y},a=Math.sign(t.x),i=Math.sign(t.y),o=Math.sign(r.x),s=Math.sign(r.y),u=Math.min(e.x,e.x+t.x-a+r.x-o),c=Math.max(e.x,e.x+t.x-a+r.x-o),l=Math.min(e.y,e.y+t.y-i+r.y-s),f=Math.max(e.y,e.y+t.y-i+r.y-s);if(n.x<u||n.x>c||n.y<l||n.y>f)return n.counter+=(c-u+1)*(f-l+1),-1;var h=Math.abs(t.x+t.y),d=Math.abs(r.x+r.y);if(1==h||1==d)return n.counter+=Math.abs(e.x-n.x+(e.y-n.y)),n.counter;var p={x:Math.floor(t.x/2),y:Math.floor(t.y/2)};if(2*h>3*d){Math.abs(p.x+p.y)%2&&h>2&&(p.x+=a,p.y+=i);var m=gilbert2d({x:e.x,y:e.y},p,r,n);return-1!==m?m:gilbert2d({x:e.x+p.x,y:e.y+p.y},{x:t.x-p.x,y:t.y-p.y},r,n)}var _={x:Math.floor(r.x/2),y:Math.floor(r.y/2)};Math.abs(_.x+_.y)%2&&d>2&&(_.x+=o,_.y+=s);var v=gilbert2d({x:e.x,y:e.y},_,p,n);if(-1!==v)return v;var g=gilbert2d({x:e.x+_.x,y:e.y+_.y},t,{x:r.x-_.x,y:r.y-_.y},n);return-1!==g?g:gilbert2d({x:e.x+(t.x-a)+(_.x-o),y:e.y+(t.y-i)+(_.y-s)},{x:-_.x,y:-_.y},{x:-(t.x-p.x),y:-(t.y-p.y)},n)}({x:0,y:0},a,i,n)}var Fu=function(){function GilbertPartition(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{zmin:zmin,zmax:zmax,zstep:zstep},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{xmin:xmin,xmax:xmax,ymin:ymin,ymax:ymax};if(p()(this,GilbertPartition),this.partition_count=parseInt(e),this.z_range={zmin:parseInt(t.zmin),zmax:parseInt(t.zmax),zstep:parseInt(t.zstep)},this.zmax_bbox={xmin:parseInt(r.xmin),xmax:parseInt(r.xmax),ymin:parseInt(r.ymin),ymax:parseInt(r.ymax)},!e||e<1)throw"Unexpected partition count. Expected a positive integer. Got ".concat(e);if(!this.z_range)throw"Missing z_range";if(isNaN(this.z_range.zmin)||isNaN(this.z_range.zmax)||isNaN(this.z_range.zstep))throw"Invalid z_range. Both zmin, zmax and zstep need to be defined. Got ".concat(JSON.stringify(t));if(this.z_range.zmin>this.z_range.zmax||this.z_range.zmin<0||this.zstep<1)throw"Invalid z_range received. Got (".concat(JSON.stringify(t),")");if(!this.zmax_bbox)throw"Missing zmax_bbox";if(isNaN(this.zmax_bbox.xmin)||isNaN(this.zmax_bbox.xmax)||isNaN(this.zmax_bbox.ymin)||isNaN(this.zmax_bbox.ymax))throw"Invalid zmax_bbox. All xmin, xmax, ymin and ymax need to be defined. Got (".concat(JSON.stringify(r),")");if(this.zmax_bbox.xmin>this.zmax_bbox.xmax||this.zmax_bbox.xmin<0||this.zmax_bbox.ymin>this.zmax_bbox.ymax||this.zmax_bbox.ymin<0)throw"Invalid bbox received. Got (".concat(JSON.stringify(r),")")}return _()(GilbertPartition,[{key:"getPartition",value:function getPartition(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{z:0,x:0,y:0},t=this.zmax_bbox.xmin>>this.z_range.zmax-e.z,r=this.zmax_bbox.xmax>>this.z_range.zmax-e.z,n=this.zmax_bbox.ymin>>this.z_range.zmax-e.z,a=this.zmax_bbox.ymax>>this.z_range.zmax-e.z;if(e.z<this.z_range.zmin||e.z>this.z_range.zmax||e.x<t||e.x>r||e.y<n||e.y>a)return Ru;var i=function partition_range_by_zoom(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{z:z,zmin:zmin,zmax:zmax,zstep:zstep};return function(){if(t.z<0||t.zmin<0||t.zmax<0||t.zstep<1||t.z<t.zmin||t.z>t.zmax||t.partition_count<1||t.z!=t.zmin&&(t.z-t.zmin)%t.zstep!=0)return{min:Ru,max:Ru};var r=t.zstep,n=t.zmax-t.zmin;n-=n%r;var a=t.z-t.zmin,i=a-r+1,o=e;if(0==n||1==o)return{min:1,max:o};var s,u=0;if(0==a)u=4*o/Math.pow(4,n+1),s=0;else{for(var c=i;c<=a;c++)u+=3*o/Math.pow(4,n-c+1);s=o/Math.pow(4,n-i+1)}var l=s+u;return{min:(s=Math.round(s))+1,max:Math.min(o,Math.max(Math.floor(l),s)+1)}}()}(this.partition_count,{z:e.z,zmin:this.z_range.zmin,zmax:this.z_range.zmax,zstep:this.z_range.zstep}),o=i.max-i.min+1;if(1==o)return i.min;var s=e.x-t,u=e.y-n,c=r-t+1,l=a-n+1,f=c*l,h=gilbert2d_tile({x:s,y:u},c,l);if(-1===h||h>=c*l)throw"Unexpected gilbert partition (".concat(h,") for tile ").concat(e.z,"/").concat(e.x,"/").concat(e.y," ")+"=> ".concat(s,"/").concat(u," : ").concat(c,", ").concat(l,")");return i.min+Math.floor(o*h/f)}}]),GilbertPartition}(),Ou=r(47),Lu=r(48),zu=null,Bu=function(){function BigQueryTilesetClient(e,t){p()(this,BigQueryTilesetClient),this._client=new Nu(e,t)}return _()(BigQueryTilesetClient,[{key:"fetchMetadata",value:function(){var e=ot()(at.a.mark(function _callee(e,t){var r,n,a,i;return at.a.wrap(function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return r="\n            SELECT option_value FROM `".concat(e,".INFORMATION_SCHEMA.TABLE_OPTIONS` \n            WHERE table_name='").concat(t,"' AND option_name = 'description'"),o.next=3,this._execute(r);case 3:if(n=o.sent,a={},!(n&&n.rows&&n.rows.length&&n.rows[0]&&n.rows[0].f&&n.rows[0].f.length&&n.rows[0].f[0]&&n.rows[0].f[0].v)){o.next=10;break}i=n.rows[0].f[0].v,a=JSON.parse(JSON.parse(i)),o.next=11;break;case 10:throw Error("Tileset metadata not available");case 11:return o.abrupt("return",a);case 12:case"end":return o.stop()}},_callee,this)}));return function fetchMetadata(t,r){return e.apply(this,arguments)}}()},{key:"fetchTiles",value:function(){var e=ot()(at.a.mark(function _callee2(e,t,r,n){var a,i,o,s,u,c,l,f,h,d,p;return at.a.wrap(function _callee2$(m){for(;;)switch(m.prev=m.next){case 0:return zu||(a=n.carto_partition,zu=initializePartitioner(a)),i=getParentQuadkeysFromTiles(e),o=i.length?"carto_partition IN (".concat(i,")"):"TRUE",s=e.map(function(e){return tileFilter(e)}).join(" OR "),u="\n            SELECT z, x, y, data\n            FROM `".concat(t,".").concat(r,"`\n            WHERE (").concat(o,") AND (").concat(s,")"),m.next=7,this._execute(u);case 7:if(c=m.sent,l=[],f=Object.assign(e,{}),!c||!c.rows){m.next=18;break}for(h=0;h<c.rows.length;h++)(d=c.rows[h]).f&&4===d.f.length&&function(){var e=parseInt(d.f[0].v),t=parseInt(d.f[1].v),r=parseInt(d.f[2].v),a="gzip"===n.compression?Object(Lu.inflate)(atob(d.f[3].v)):Object(Ou.decode)(d.f[3].v);l.push({z:e,x:t,y:r,buffer:a}),f=f.filter(function(n){return!(n.z===e&&n.x===t&&n.y===r)})}();if(console.log("".concat(l.length,"/").concat(c.totalRows)),!(c.totalRows>l.length)){m.next=18;break}return m.next=16,this.fetchTiles(f,t,r,n);case 16:p=m.sent,l=l.concat(p);case 18:return m.abrupt("return",l);case 19:case"end":return m.stop()}},_callee2,this)}));return function fetchTiles(t,r,n,a){return e.apply(this,arguments)}}()},{key:"_execute",value:function(){var e=ot()(at.a.mark(function _callee3(e){var t,r,n;return at.a.wrap(function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return console.log(">"),t=(new Date).getTime(),a.next=4,this._client.execute(e);case 4:return r=a.sent,n=(new Date).getTime(),console.log("<",n-t),a.abrupt("return",r);case 8:case"end":return a.stop()}},_callee3,this)}));return function _execute(t){return e.apply(this,arguments)}}()}]),BigQueryTilesetClient}();function initializePartitioner(e){if(1!==e.version)throw new Error("Unknown quadkey version");var t={zmin:e.zmin,zmax:e.zmax,zstep:e.zstep},r={xmin:e.xmin,xmax:e.xmax,ymin:e.ymin,ymax:e.ymax},n=e.partitions;return new Fu(n,t,r)}function getParentQuadkeysFromTiles(e){var t=new Set,r=!0,n=!1,a=void 0;try{for(var i,o=e[Symbol.iterator]();!(r=(i=o.next()).done);r=!0){var s=i.value;t.add(zu.getPartition({z:s.z,x:s.x,y:s.y}))}}catch(e){n=!0,a=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw a}}return l()(t).filter(function(e){return null!==e})}function tileFilter(e){return"(z = ".concat(e.z," AND x = ").concat(e.x," AND y = ").concat(e.y,")")}var Vu=function(e){function BigQueryTileset(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p()(this,BigQueryTileset),(t=R()(this,O()(BigQueryTileset).call(this)))._tilesetData=e,t._tilesetMetadata=r,t._tileClient=new Du,t._mID=0,t._workerDispatch={},t._workerName="BigQueryTileset",t}return B()(BigQueryTileset,e),_()(BigQueryTileset,[{key:"_initMetadata",value:function _initMetadata(e){(e=new iu(e)).setCodecs(),this._metadata=e}},{key:"_initOptions",value:function _initOptions(e){this._options=e}},{key:"_receiveMessageFromWorker",value:function _receiveMessageFromWorker(e){for(var t=e.data,r=t.mID,n=t.dataframes,a=0;a<n.length;a++){var i=n[a];i.empty||this._updateMetadataWith(i)}this._workerDispatch[r](n)}},{key:"_updateMetadataWith",value:function _updateMetadataWith(e){Object.setPrototypeOf(e,$s.prototype);var t=e.metadata;this._metadata.numCategories=t.numCategories,this._metadata.categoryToID=t.categoryToID,this._metadata.IDToCategory=t.IDToCategory,this._metadata.geomType=t.geomType,e.metadata=this._metadata}},{key:"_clone",value:function _clone(){return this}},{key:"bindLayer",value:function bindLayer(e){this._tileClient.bindLayer(e)}},{key:"requestMetadata",value:function(){var e=ot()(at.a.mark(function _callee(){return at.a.wrap(function _callee$(e){for(;;)switch(e.prev=e.next){case 0:if(this._metadata){e.next=3;break}return e.next=3,this.initMetadata();case 3:return e.abrupt("return",this._metadata);case 4:case"end":return e.stop()}},_callee,this)}));return function requestMetadata(){return e.apply(this,arguments)}}()},{key:"initMetadata",value:function(){var e=ot()(at.a.mark(function _callee2(){var e,t,r,n,a,i,o,s,u,c,l,f,h=this;return at.a.wrap(function _callee2$(d){for(;;)switch(d.prev=d.next){case 0:return e=new Bu(this._tilesetData.project,this._tilesetData.token),d.next=3,e.fetchMetadata(this._tilesetData.dataset,this._tilesetData.table);case 3:for(a in t=d.sent,this._tilesetMetadata=zr()({},t,this._tilesetMetadata),r={},n=this._tilesetMetadata.vector_layers[0].fields)i="String"===n[a]?"category":"number",r[a]={type:i};r.___id={type:"number"},o={idProperty:"___id",properties:r,extent:parseInt(this._tilesetMetadata.tile_extent)},s=parseInt(this._tilesetMetadata.minzoom),u=parseInt(this._tilesetMetadata.maxzoom),c={viewportZoomToSourceZoom:function viewportZoomToSourceZoom(e){return e>u?h._tilesetMetadata.extend_maxzoom_tiles?u:null:e<s?null:Math.ceil(e)}},this._tilesetMetadata.center&&(l=this._tilesetMetadata.center.split(","),this._tilesetMetadata.center={longitude:parseFloat(l[0]),latitude:parseFloat(l[1]),zoom:parseInt(l[2])}),this._tilesetMetadata.bounds&&(f=this._tilesetMetadata.bounds.split(","),this._tilesetMetadata.bounds=[parseFloat(f[0]),parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])]),this._initMetadata(o),this._initOptions(c);case 17:case"end":return d.stop()}},_callee2,this)}));return function initMetadata(){return e.apply(this,arguments)}}()},{key:"requestData",value:function requestData(e,t){var r=this._requestDataframes.bind(this),n=this._viewportZoomToSourceZoom.bind(this);return this._tileClient.requestData(e,t,r,n,this._tilesetMetadata.bounds)}},{key:"_requestDataframes",value:function(){var e=ot()(at.a.mark(function _callee3(e){var t=this;return at.a.wrap(function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise(function(r){t._postMessageToWorker(e),t._metadataSent=!0,t._workerDispatch[t._mID]=r,t._mID++}));case 1:case"end":return r.stop()}},_callee3,this)}));return function _requestDataframes(t){return e.apply(this,arguments)}}()},{key:"_postMessageToWorker",value:function _postMessageToWorker(e){this._worker.postMessage({tiles:e,tilesetData:this._tilesetData,tilesetMetadata:this._tilesetMetadata,metadata:this._metadataSent?void 0:this._metadata,mID:this._mID,workerName:this._workerName})}},{key:"_viewportZoomToSourceZoom",value:function _viewportZoomToSourceZoom(e){return this._options.viewportZoomToSourceZoom(e)}},{key:"free",value:function free(){this._tileClient.free()}},{key:"_worker",get:function get(){return this._workerInstance||(this._workerInstance=new lu.a,this._workerInstance.onmessage=this._receiveMessageFromWorker.bind(this)),this._workerInstance}}]),BigQueryTileset}(ds),Gu=function(e){function SQL(e,t,r){var n;return p()(this,SQL),(n=R()(this,O()(SQL).call(this)))._checkQuery(e),n._query=e,n.initialize(t,r),n}return B()(SQL,e),_()(SQL,[{key:"_getFromClause",value:function _getFromClause(){return"(".concat(this._query,") as _cdb_query_wrapper")}},{key:"_clone",value:function _clone(){return new SQL(this._query,this._auth,this._config)}},{key:"_checkQuery",value:function _checkQuery(e){if(ke.isUndefined(e))throw new me("'query'",_e.MISSING_REQUIRED);if(!ke.isString(e))throw new me("'query' property must be a string.",_e.INCORRECT_TYPE);if(""===e)throw new me("'query' property must be not empty.",_e.INCORRECT_VALUE);if(!e.match(/\bSELECT\b/i))throw new me("'query' property must be a SQL query.",_e.INCORRECT_VALUE)}}]),SQL}(ku),Uu=[];function on(e,t,r){var n=[];if("loaded"===e){var a=new Set(t);t.forEach(function(e){var t=function internalCallback(){a.delete(e),0===a.size&&r()};e.on("loaded",t),n.push(t)})}else{if("updated"!==e)throw new me("Event name '".concat(e,"' is not supported by \"carto.on\". Supported event names are: 'loaded' and 'updated'."),_e.INCORRECT_VALUE);var i=!1;t.forEach(function(e){var t=function internalCallback(){i||window.requestAnimationFrame(function(){i=!1,r()})};e.on("updated",t),n.push(t)})}Uu.push({eventName:e,layerList:t,callback:r,internalCallbacks:n})}function off(e,t,r){Uu.forEach(function(n){n.eventName===e&&n.layerList.every(function(e){return t.includes(e)})&&n.callback===r&&n.layerList.forEach(function(t){n.internalCallbacks.forEach(function(r){t.off(e,r)})})}),Uu=Uu.filter(function(n){return!(n.eventName===e&&n.layerList.every(function(e){return t.includes(e)})&&n.callback===r)})}var qu="https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json",ju="https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",Wu="https://basemaps.cartocdn.com/gl/positron-gl-style/style.json";r.d(t,"source",function(){return Hu}),r.d(t,"version",function(){return bu.a}),r.d(t,"on",function(){return on}),r.d(t,"off",function(){return off}),r.d(t,"isBrowserSupported",function(){return isBrowserSupported}),r.d(t,"unsupportedBrowserReasons",function(){return unsupportedBrowserReasons}),r.d(t,"setDefaultAuth",function(){return setDefaultAuth}),r.d(t,"setDefaultConfig",function(){return setDefaultConfig}),r.d(t,"expressions",function(){return s}),r.d(t,"Layer",function(){return Es}),r.d(t,"Viz",function(){return fs}),r.d(t,"Interactivity",function(){return Is}),r.d(t,"basemaps",function(){return u});var Hu={Dataset:Tu,SQL:Gu,GeoJSON:Iu,MVT:fu,BigQueryTileset:Vu};t.default={version:bu.a,on:on,off:off,setDefaultAuth:setDefaultAuth,setDefaultConfig:setDefaultConfig,source:Hu,expressions:s,Layer:Es,Viz:fs,Interactivity:Is,basemaps:u}}])});