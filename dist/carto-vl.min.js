/*!
 * CARTO VL js https://carto.com/
 * Version: 0.8.0
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.carto=t():e.carto=t()}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=50)}([function(e,t,r){!function(r){"use strict";var n=function(e,t){var r=new Error(e+" at character "+t);throw r.index=t,r.description=e,r},i=!0,a={"-":i,"!":i,"~":i,"+":i},s={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},o={$:i,_:i},c=function(e){var t,r=0;for(var n in e)(t=n.length)>r&&e.hasOwnProperty(n)&&(r=t);return r},u=c(a),f=c(s),h={true:!0,false:!1,null:null},l=function(e){return s[e]||0},d=function(e,t,r){return{type:"||"===e||"&&"===e?"LogicalExpression":"BinaryExpression",operator:e,left:t,right:r}},p=function(e){return e>=48&&e<=57},m=function(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!s[String.fromCharCode(e)]||o.hasOwnProperty(String.fromCharCode(e))},g=function(e){return e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e>=128&&!s[String.fromCharCode(e)]||o.hasOwnProperty(String.fromCharCode(e))},b=function(e){for(var t,r,i=0,o=e.charAt,c=e.charCodeAt,b=function(t){return o.call(e,t)},_=function(t){return c.call(e,t)},y=e.length,v=function(){for(var e=_(i);32===e||9===e||10===e||13===e;)e=_(++i)},x=function(){var e,t,r=T();return v(),63!==_(i)?r:(i++,(e=x())||n("Expected expression",i),v(),58===_(i)?(i++,(t=x())||n("Expected expression",i),{type:"ConditionalExpression",test:r,consequent:e,alternate:t}):void n("Expected :",i))},w=function(){v();for(var t=e.substr(i,f),r=t.length;r>0;){if(s.hasOwnProperty(t)&&(!m(_(i))||i+t.length<e.length&&!g(_(i+t.length))))return i+=r,t;t=t.substr(0,--r)}return!1},T=function(){var e,t,r,a,s,o,c,u;if(o=E(),!(t=w()))return o;for(s={value:t,prec:l(t)},(c=E())||n("Expected expression after "+t,i),a=[o,s,c];(t=w())&&0!==(r=l(t));){for(s={value:t,prec:r};a.length>2&&r<=a[a.length-2].prec;)c=a.pop(),t=a.pop().value,o=a.pop(),e=d(t,o,c),a.push(e);(e=E())||n("Expected expression after "+t,i),a.push(s,e)}for(e=a[u=a.length-1];u>1;)e=d(a[u-1].value,a[u-2],e),u-=2;return e},E=function(){var t,r,n;if(v(),t=_(i),p(t)||46===t)return C();if(39===t||34===t)return A();if(91===t)return F();for(n=(r=e.substr(i,u)).length;n>0;){if(a.hasOwnProperty(r)&&(!m(_(i))||i+r.length<e.length&&!g(_(i+r.length))))return i+=n,{type:"UnaryExpression",operator:r,argument:E(),prefix:!0};r=r.substr(0,--n)}return!(!m(t)&&40!==t)&&D()},C=function(){for(var e,t,r="";p(_(i));)r+=b(i++);if(46===_(i))for(r+=b(i++);p(_(i));)r+=b(i++);if("e"===(e=b(i))||"E"===e){for(r+=b(i++),"+"!==(e=b(i))&&"-"!==e||(r+=b(i++));p(_(i));)r+=b(i++);p(_(i-1))||n("Expected exponent ("+r+b(i)+")",i)}return t=_(i),m(t)?n("Variable names cannot start with a number ("+r+b(i)+")",i):46===t&&n("Unexpected period",i),{type:"Literal",value:parseFloat(r),raw:r}},A=function(){for(var e,t="",r=b(i++),a=!1;i<y;){if((e=b(i++))===r){a=!0;break}if("\\"===e)switch(e=b(i++)){case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=e}else t+=e}return a||n('Unclosed quote after "'+t+'"',i),{type:"Literal",value:t,raw:r+t+r}},S=function(){var t,r=_(i),a=i;for(m(r)?i++:n("Unexpected "+b(i),i);i<y&&(r=_(i),g(r));)i++;return t=e.slice(a,i),h.hasOwnProperty(t)?{type:"Literal",value:h[t],raw:t}:"this"===t?{type:"ThisExpression"}:{type:"Identifier",name:t}},I=function(e){for(var t,r,a=[],s=!1;i<y;){if(v(),(t=_(i))===e){s=!0,i++;break}44===t?i++:((r=x())&&"Compound"!==r.type||n("Expected comma",i),a.push(r))}return s||n("Expected "+String.fromCharCode(e),i),a},D=function(){var e,t;for(t=40===(e=_(i))?R():S(),v(),e=_(i);46===e||91===e||40===e;)i++,46===e?(v(),t={type:"MemberExpression",computed:!1,object:t,property:S()}):91===e?(t={type:"MemberExpression",computed:!0,object:t,property:x()},v(),93!==(e=_(i))&&n("Unclosed [",i),i++):40===e&&(t={type:"CallExpression",arguments:I(41),callee:t}),v(),e=_(i);return t},R=function(){i++;var e=x();if(v(),41===_(i))return i++,e;n("Unclosed (",i)},F=function(){return i++,{type:"ArrayExpression",elements:I(93)}},M=[];i<y;)59===(t=_(i))||44===t?i++:(r=x())?M.push(r):i<y&&n('Unexpected "'+b(i)+'"',i);return 1===M.length?M[0]:{type:"Compound",body:M}};b.version="0.3.4",b.toString=function(){return"JavaScript Expression Parser (JSEP) v"+b.version},b.addUnaryOp=function(e){return u=Math.max(e.length,u),a[e]=i,this},b.addBinaryOp=function(e,t){return f=Math.max(e.length,f),s[e]=t,this},b.addIdentifierChar=function(e){return o[e]=i,this},b.addLiteral=function(e,t){return h[e]=t,this},b.removeUnaryOp=function(e){return delete a[e],e.length===u&&(u=c(a)),this},b.removeAllUnaryOps=function(){return a={},u=0,this},b.removeIdentifierChar=function(e){return delete o[e],this},b.removeBinaryOp=function(e){return delete s[e],e.length===f&&(f=c(s)),this},b.removeAllBinaryOps=function(){return s={},f=0,this},b.removeLiteral=function(e){return delete h[e],this},b.removeAllLiterals=function(){return h={},this},void 0!==e&&e.exports?t=e.exports=b:t.parse=b}()},function(e){e.exports={a:"0.8.0"}},function(e,t){e.exports='#ifndef CIELAB_TO_SRGBA\n#define CIELAB_TO_SRGBA\n\nconst mat3 XYZ_2_RGB = (mat3(\n    3.2404542,-1.5371385,-0.4985314,\n    -0.9692660, 1.8760108, 0.0415560,\n    0.0556434,-0.2040259, 1.0572252\n));\nconst float SRGB_GAMMA = 1.0 / 2.2;\n\nvec3 rgb_to_srgb_approx(vec3 rgb) {\n    return pow(rgb, vec3(SRGB_GAMMA));\n}\n\nfloat f1(float t){\n    const float sigma = 6./29.;\n    if (t>sigma){\n        return t*t*t;\n    }else{\n        return 3.*sigma*sigma*(t-4./29.);\n    }\n}\n\nvec3 cielabtoxyz(vec3 c) {\n    const float xn = 95.047/100.;\n    const float yn = 100./100.;\n    const float zn = 108.883/100.;\n    return vec3(xn*f1((c.x+16.)/116.  + c.y/500. ),\n                yn*f1((c.x+16.)/116.),\n                zn*f1((c.x+16.)/116.  - c.z/200. )\n            );\n}\n\nvec3 xyztorgb(vec3 c){\n    return c * XYZ_2_RGB;\n}\n\nvec3 xyztosrgb(vec3 c) { // FIXME naming\n    return rgb_to_srgb_approx(xyztorgb(c));\n}\n\nvec4 cielabToSRGBA(vec4 cielab){\n    return vec4(xyztosrgb(cielabtoxyz(\n        vec3(\n            clamp(cielab.r, 0., 100.),\n            clamp(cielab.g, -128., 128.),\n            clamp(cielab.b, -128., 128.)\n        )\n    )), cielab.a);\n}\n#endif\n\n\n#ifndef SRGBA_TO_CIELAB\n#define SRGBA_TO_CIELAB\nvec4 sRGBToXYZ (vec4 srgba);\nvec4 sRGBToLinearRGB (vec4 srgba);\nfloat inverseGammaCorrection(float t);\nvec4 XYZToCieLab (vec4 xyza);\nfloat XYZToCieLabAux(float t);\n\nvec4 sRGBAToCieLAB(vec4 srgba){\n    return XYZToCieLab(sRGBToXYZ(srgba));\n}\n\n// Convert sRGB to CIE XYZ with the D65 white point\nvec4 sRGBToXYZ (vec4 srgba) {\n    // Poynton, "Frequently Asked Questions About Color," page 10\n    // Wikipedia: http://en.wikipedia.org/wiki/SRGB\n    // Wikipedia: http://en.wikipedia.org/wiki/CIE_1931_color_space\n    vec4 rgba = sRGBToLinearRGB(srgba);\n    return vec4(\n        (0.4123955889674142161 * rgba.r + 0.3575834307637148171 * rgba.g + 0.1804926473817015735 * rgba.b),\n        (0.2125862307855955516 * rgba.r + 0.7151703037034108499 * rgba.g + 0.07220049864333622685 * rgba.b),\n        (0.01929721549174694484 * rgba.r + 0.1191838645808485318 * rgba.g + 0.9504971251315797660 * rgba.b),\n        rgba.a\n    );\n}\n\nvec4 sRGBToLinearRGB (vec4 srgba) {\n    // http://en.wikipedia.org/wiki/SRGB\n    return vec4(\n        inverseGammaCorrection(srgba.r),\n        inverseGammaCorrection(srgba.g),\n        inverseGammaCorrection(srgba.b),\n        srgba.a\n    );\n}\n\nfloat inverseGammaCorrection(float t) {\n    return t <= 0.0404482362771076 ? t / 12.92 : pow((t + 0.055) / 1.055, 2.4);\n}\n\n\nfloat WHITEPOINT_D65_X = 0.950456;\nfloat WHITEPOINT_D65_Y = 1.0;\nfloat WHITEPOINT_D65_Z = 1.088754;\n\n// Convert CIE XYZ to CIE L*a*b* (CIELAB) with the D65 white point\nvec4 XYZToCieLab (vec4 xyza) {\n    // Wikipedia: http://en.wikipedia.org/wiki/Lab_color_space\n\n    float xn = WHITEPOINT_D65_X;\n    float yn = WHITEPOINT_D65_Y;\n    float zn = WHITEPOINT_D65_Z;\n\n    return vec4(\n        116. * XYZToCieLabAux(xyza.y / yn) - 16.,\n        500. * (XYZToCieLabAux(xyza.x / xn) - XYZToCieLabAux(xyza.y / yn)),\n        200. * (XYZToCieLabAux(xyza.y / yn) - XYZToCieLabAux(xyza.z / zn)),\n        xyza.a\n    );\n}\n\nfloat XYZToCieLabAux(float t) {\n    return t >= 8.85645167903563082e-3\n            ? pow(t, 0.333333333333333) : (841.0 / 108.0) * t + 4.0 / 29.0;\n}\n\n#endif\n'},function(e,t){e.exports="precision highp float;\nattribute vec2 vertex;\n\nvarying  vec2 uv;\n\nvoid main(void) {\n    uv = vertex*0.5+vec2(0.5);\n    gl_Position = vec4(vertex, 0.5, 1.);\n}\n"},function(e,t){e.exports="precision highp float;\n\nvarying vec2 uv;\n\nvec2 featureID;\n\n$propertyPreface\n$style_preface\n\nvoid main(void) {\n    featureID = abs(uv);\n    gl_FragColor = $style_inline;\n}\n"},function(e,t,r){e.exports=r(39)},function(e,t){var r,n,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var c,u=[],f=!1,h=-1;function l(){f&&c&&(f=!1,c.length?u=c.concat(u):h=-1,u.length&&d())}function d(){if(!f){var e=o(l);f=!0;for(var t=u.length;t;){for(c=u,u=[];++h<t;)c&&c[h].run();h=-1,t=u.length}c=null,f=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),1!==u.length||f||o(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M7.5 2c-.676-.01-.676 1.01 0 1H9v1.266L6.197 6.6 5.223 4H5.5c.676.01.676-1.01 0-1h-2c-.676-.01-.676 1.01 0 1h.652l.891 2.375A3.45 3.45 0 0 0 3.5 6C1.573 6 0 7.573 0 9.5S1.573 13 3.5 13 7 11.427 7 9.5c0-.67-.2-1.291-.53-1.824l2.821-2.35.463 1.16C8.71 7.094 8 8.211 8 9.5c0 1.927 1.573 3.5 3.5 3.5S15 11.427 15 9.5 13.427 6 11.5 6c-.283 0-.554.043-.818.107L10 4.402V2.5a.5.5 0 0 0-.5-.5h-2zm-4 5a2.48 2.48 0 0 1 1.555.553L3.18 9.115c-.511.427.128 1.195.64.77l1.875-1.563c.188.352.305.75.305 1.178C6 10.887 4.887 12 3.5 12S1 10.887 1 9.5 2.113 7 3.5 7zm8 0C12.887 7 14 8.113 14 9.5S12.887 12 11.5 12 9 10.887 9 9.5c0-.877.447-1.642 1.125-2.088l.91 2.274c.246.623 1.18.25.93-.372l-.908-2.27C11.2 7.02 11.348 7 11.5 7z"></path></svg>'},function(e,t){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M3 2v11h5v-3h3v3h1V2H3zm4 10H4v-2h3v2zm0-3H4V7h3v2zm0-3H4V4h3v2zm4 3H8V7h3v2zm0-3H8V4h3v2z"></path></svg>'},function(e,t){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M4 0C2.636 0 1 .743 1 2.746V12s0 1 1 1v1s0 1 1 1 1-1 1-1v-1h7v1s0 1 1 1 1-1 1-1v-1s1 0 1-1V2.746C14 .701 12.764 0 11.4 0H4zm.25 1.5h6.5a.25.25 0 1 1 0 .5h-6.5a.25.25 0 1 1 0-.5zM3 3h9c1 0 1 .967 1 .967V7s0 1-1 1H3C2 8 2 7 2 7V4s0-1 1-1zm0 7a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm9 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"></path></svg>'},function(e,t){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M14 7a1.5 1.5 0 0 0-1.15-1.45l-1.39-3.24A.5.5 0 0 0 11 2H4a.5.5 0 0 0-.44.28L2.15 5.54A1.5 1.5 0 0 0 1 7v3.5h1v1a1 1 0 1 0 2 0v-1h7v1a1 1 0 1 0 2 0v-1h1V7zM4.3 3h6.4l1.05 2.5h-8.5L4.3 3zM3 9a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm9 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"></path></svg>'},function(e,t){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M14 7.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"></path></svg>'},function(e,t){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M7.5 0a7.5 7.5 0 1 1 0 15 7.5 7.5 0 0 1 0-15zm0 1.667a5.833 5.833 0 1 0 0 11.666 5.833 5.833 0 0 0 0-11.666z"></path></svg>'},function(e,t){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M2.64 1.27L7.5 6.13l4.84-4.84A.92.92 0 0 1 13 1a1 1 0 0 1 1 1 .9.9 0 0 1-.27.66L8.84 7.5l4.89 4.89A.9.9 0 0 1 14 13a1 1 0 0 1-1 1 .92.92 0 0 1-.69-.27L7.5 8.87l-4.85 4.85A.92.92 0 0 1 2 14a1 1 0 0 1-1-1 .9.9 0 0 1 .27-.66L6.16 7.5 1.27 2.61A.9.9 0 0 1 1 2a1 1 0 0 1 1-1c.24.003.47.1.64.27z"></path></svg>'},function(e,t){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M2 13.748c0 .138.112.25.25.25h3.749v-3h3v3h3.749a.25.25 0 0 0 .25-.25v-5.75H2v5.75zm11.93-7.17l-.932-.82V2a1 1 0 1 0-2 0v2L7.681 1.09a.25.25 0 0 0-.353-.011l-.011.011-6.25 5.463a.25.25 0 0 0 .18.42L3 7h10.747a.25.25 0 0 0 .183-.421z"></path></svg>'},function(e,t){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M6.65 2C5.43 2 4.48 3.38 4.11 3.82a.49.49 0 0 0-.11.32v4.4a.44.44 0 0 0 .72.36 3 3 0 0 1 1.93-1.17C8.06 7.73 8.6 9 10.07 9a5.28 5.28 0 0 0 2.73-1.09.49.49 0 0 0 .2-.4V2.45a.44.44 0 0 0-.62-.45 5.75 5.75 0 0 1-2.31 1.06C8.6 3.08 8.12 2 6.65 2zM2.5 3a1 1 0 1 1 0-2 1 1 0 0 1 0 2zM3 4v9.48a.5.5 0 0 1-1 0V4a.5.5 0 0 1 1 0z"></path></svg>'},function(e,t){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M7.5 0C5.068 0 2.23 1.486 2.23 5.27c0 2.568 4.054 8.244 5.27 9.73 1.081-1.486 5.27-7.027 5.27-9.73C12.77 1.487 9.932 0 7.5 0z"></path></svg>'},function(e,t){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path data-name="Layer 7" d="M7.5 14.941l-.4-.495c-.973-1.189-4.9-6.556-4.9-9.16A5.066 5.066 0 0 1 7.036 0q.222-.01.445 0a5.066 5.066 0 0 1 5.286 4.836q.01.225 0 .45c0 2.213-2.669 6.111-4.678 8.851zM7.481.986a4.077 4.077 0 0 0-4.3 4.3c0 1.832 2.759 6.038 4.286 8.034 1.25-1.71 4.315-5.989 4.315-8.034a4.077 4.077 0 0 0-4.3-4.3z"></path></svg>'},function(e,t){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M7 1c-.6 0-1 .4-1 1v4H2c-.6 0-1 .4-1 1v1c0 .6.4 1 1 1h4v4c0 .6.4 1 1 1h1c.6 0 1-.4 1-1V9h4c.6 0 1-.4 1-1V7c0-.6-.4-1-1-1H9V2c0-.6-.4-1-1-1H7z" fill="#010101"></path></svg>'},function(e,t){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M13 14H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h11a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1z"></path></svg>'},function(e,t){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M12.7 2.3v10.4H2.3V2.3h10.4M13 1H2a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h11a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1z"></path></svg>'},function(e,t){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M7.5 0l-2 5h-5l4 3.5-2 6 5-3.5 5 3.5-2-6 4-3.5h-5l-2-5z"></path></svg>'},function(e,t){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M7.5 3.19l1.07 2.68.25.63h3l-2 1.75-.5.44.23.63 1 3.13-2.48-1.77-.57-.4-.57.4-2.52 1.77 1-3.13.21-.63-.5-.44-2-1.75h3l.25-.63L7.5 3.19M7.5.5l-2 5h-5l4 3.5-2 6 5-3.5 5 3.5-2-6 4-3.5h-5l-2-5z" fill="#010101"></path></svg>'},function(e,t){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M7.538 2c-.294 0-.488.177-.615.385l-5.846 9.538C1 12 1 12.153 1 12.308c0 .538.385.692.692.692h11.616c.384 0 .692-.154.692-.692 0-.154 0-.231-.077-.385l-5.77-9.538C8.029 2.177 7.789 2 7.539 2z"></path></svg>'},function(e,t){e.exports='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"><path d="M7.524 1.5a.77.77 0 0 0-.69.395l-5.5 9.87C1.022 12.307 1.395 13 2 13h11c.605 0 .978-.692.666-1.236l-5.5-9.869a.773.773 0 0 0-.642-.395zM7.5 3.9l4.127 7.47H3.373L7.5 3.9z"></path></svg>'},function(e,t,r){"use strict";e.exports=b;var n,i=r(42),a=r(44),s=r(48),o=(n="function"==typeof Symbol?function(e){return Symbol(e)}:function(e){return"_"+e})("max"),c=n("length"),u=n("lengthCalculator"),f=n("allowStale"),h=n("maxAge"),l=n("dispose"),d=n("noDisposeOnSet"),p=n("lruList"),m=n("cache");function g(){return 1}function b(e){if(!(this instanceof b))return new b(e);"number"==typeof e&&(e={max:e}),e||(e={});var t=this[o]=e.max;(!t||"number"!=typeof t||t<=0)&&(this[o]=1/0);var r=e.length||g;"function"!=typeof r&&(r=g),this[u]=r,this[f]=e.stale||!1,this[h]=e.maxAge||0,this[l]=e.dispose,this[d]=e.noDisposeOnSet||!1,this.reset()}function _(e,t,r,n){var i=r.value;v(e,i)&&(w(e,r),e[f]||(i=void 0)),i&&t.call(n,i.value,i.key,e)}function y(e,t,r){var n=e[m].get(t);if(n){var i=n.value;v(e,i)?(w(e,n),e[f]||(i=void 0)):r&&e[p].unshiftNode(n),i&&(i=i.value)}return i}function v(e,t){if(!t||!t.maxAge&&!e[h])return!1;var r=Date.now()-t.now;return t.maxAge?r>t.maxAge:e[h]&&r>e[h]}function x(e){if(e[c]>e[o])for(var t=e[p].tail;e[c]>e[o]&&null!==t;){var r=t.prev;w(e,t),t=r}}function w(e,t){if(t){var r=t.value;e[l]&&e[l](r.key,r.value),e[c]-=r.length,e[m].delete(r.key),e[p].removeNode(t)}}Object.defineProperty(b.prototype,"max",{set:function(e){(!e||"number"!=typeof e||e<=0)&&(e=1/0),this[o]=e,x(this)},get:function(){return this[o]},enumerable:!0}),Object.defineProperty(b.prototype,"allowStale",{set:function(e){this[f]=!!e},get:function(){return this[f]},enumerable:!0}),Object.defineProperty(b.prototype,"maxAge",{set:function(e){(!e||"number"!=typeof e||e<0)&&(e=0),this[h]=e,x(this)},get:function(){return this[h]},enumerable:!0}),Object.defineProperty(b.prototype,"lengthCalculator",{set:function(e){"function"!=typeof e&&(e=g),e!==this[u]&&(this[u]=e,this[c]=0,this[p].forEach(function(e){e.length=this[u](e.value,e.key),this[c]+=e.length},this)),x(this)},get:function(){return this[u]},enumerable:!0}),Object.defineProperty(b.prototype,"length",{get:function(){return this[c]},enumerable:!0}),Object.defineProperty(b.prototype,"itemCount",{get:function(){return this[p].length},enumerable:!0}),b.prototype.rforEach=function(e,t){t=t||this;for(var r=this[p].tail;null!==r;){var n=r.prev;_(this,e,r,t),r=n}},b.prototype.forEach=function(e,t){t=t||this;for(var r=this[p].head;null!==r;){var n=r.next;_(this,e,r,t),r=n}},b.prototype.keys=function(){return this[p].toArray().map(function(e){return e.key},this)},b.prototype.values=function(){return this[p].toArray().map(function(e){return e.value},this)},b.prototype.reset=function(){this[l]&&this[p]&&this[p].length&&this[p].forEach(function(e){this[l](e.key,e.value)},this),this[m]=new i,this[p]=new s,this[c]=0},b.prototype.dump=function(){return this[p].map(function(e){if(!v(this,e))return{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}},this).toArray().filter(function(e){return e})},b.prototype.dumpLru=function(){return this[p]},b.prototype.inspect=function(e,t){var r="LRUCache {",n=!1;this[f]&&(r+="\n  allowStale: true",n=!0);var i=this[o];i&&i!==1/0&&(n&&(r+=","),r+="\n  max: "+a.inspect(i,t),n=!0);var s=this[h];s&&(n&&(r+=","),r+="\n  maxAge: "+a.inspect(s,t),n=!0);var l=this[u];l&&l!==g&&(n&&(r+=","),r+="\n  length: "+a.inspect(this[c],t),n=!0);var d=!1;return this[p].forEach(function(e){d?r+=",\n  ":(n&&(r+=",\n"),d=!0,r+="\n  ");var i=a.inspect(e.key).split("\n").join("\n  "),o={value:e.value};e.maxAge!==s&&(o.maxAge=e.maxAge),l!==g&&(o.length=e.length),v(this,e)&&(o.stale=!0),o=a.inspect(o,t).split("\n").join("\n  "),r+=i+" => "+o}),(d||n)&&(r+="\n"),r+="}"},b.prototype.set=function(e,t,r){var n=(r=r||this[h])?Date.now():0,i=this[u](t,e);if(this[m].has(e)){if(i>this[o])return w(this,this[m].get(e)),!1;var a=this[m].get(e).value;return this[l]&&(this[d]||this[l](e,a.value)),a.now=n,a.maxAge=r,a.value=t,this[c]+=i-a.length,a.length=i,this.get(e),x(this),!0}var s=new function(e,t,r,n,i){this.key=e,this.value=t,this.length=r,this.now=n,this.maxAge=i||0}(e,t,i,n,r);return s.length>this[o]?(this[l]&&this[l](e,t),!1):(this[c]+=s.length,this[p].unshift(s),this[m].set(e,this[p].head),x(this),!0)},b.prototype.has=function(e){return!!this[m].has(e)&&!v(this,this[m].get(e).value)},b.prototype.get=function(e){return y(this,e,!0)},b.prototype.peek=function(e){return y(this,e,!1)},b.prototype.pop=function(){var e=this[p].tail;return e?(w(this,e),e.value):null},b.prototype.del=function(e){w(this,this[m].get(e))},b.prototype.load=function(e){this.reset();for(var t=Date.now(),r=e.length-1;r>=0;r--){var n=e[r],i=n.e||0;if(0===i)this.set(n.k,n.v);else{var a=i-t;a>0&&this.set(n.k,n.v,a)}}},b.prototype.prune=function(){var e=this;this[m].forEach(function(t,r){y(e,r,!1)})}},function(e,t,r){e.exports=function(){return r(49)('/*!\n * CARTO VL js https://carto.com/\n * Version: 0.8.0\n * \n */!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=8)}([function(t,e,r){"use strict";var n=r(1);function i(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(s,this,e),this.length=this._features.length}function s(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){var e=null,r=t.readVarint()+t.pos;for(;t.pos<r;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(r))}t.exports=i,i.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,e,this.extent,this._keys,this._values)}},function(t,e,r){"use strict";var n=r(6);function i(t,e,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=i,t.readFields(s,this,e)}function s(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){var r=t.readVarint()+t.pos;for(;t.pos<r;){var n=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[n]=i}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function o(t){for(var e,r,n=0,i=0,s=t.length,o=s-1;i<s;o=i++)e=t[i],n+=((r=t[o]).x-e.x)*(e.y+r.y);return n}t.exports=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,i=1,s=0,o=0,a=0,u=[];t.pos<r;){if(s<=0){var h=t.readVarint();i=7&h,s=h>>3}if(s--,1===i||2===i)o+=t.readSVarint(),a+=t.readSVarint(),1===i&&(e&&u.push(e),e=[]),e.push(new n(o,a));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&u.push(e),u},i.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,n=0,i=0,s=0,o=1/0,a=-1/0,u=1/0,h=-1/0;t.pos<e;){if(n<=0){var c=t.readVarint();r=7&c,n=c>>3}if(n--,1===r||2===r)i+=t.readSVarint(),s+=t.readSVarint(),i<o&&(o=i),i>a&&(a=i),s<u&&(u=s),s>h&&(h=s);else if(7!==r)throw new Error("unknown command "+r)}return[o,u,a,h]},i.prototype.toGeoJSON=function(t,e,r){var n,s,a=this.extent*Math.pow(2,r),u=this.extent*t,h=this.extent*e,c=this.loadGeometry(),f=i.types[this.type];function l(t){for(var e=0;e<t.length;e++){var r=t[e],n=180-360*(r.y+h)/a;t[e]=[360*(r.x+u)/a-180,360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90]}}switch(this.type){case 1:var p=[];for(n=0;n<c.length;n++)p[n]=c[n][0];l(c=p);break;case 2:for(n=0;n<c.length;n++)l(c[n]);break;case 3:for(c=function(t){var e=t.length;if(e<=1)return[t];for(var r,n,i=[],s=0;s<e;s++){var a=o(t[s]);0!==a&&(void 0===n&&(n=a<0),n===a<0?(r&&i.push(r),r=[t[s]]):r.push(t[s]))}r&&i.push(r);return i}(c),n=0;n<c.length;n++)for(s=0;s<c[n].length;s++)l(c[n][s])}1===c.length?c=c[0]:f="Multi"+f;var d={type:"Feature",geometry:{type:f,coordinates:c},properties:this.properties};return"id"in this&&(d.id=this.id),d}},function(t,e,r){t.exports.VectorTile=r(5),t.exports.VectorTileFeature=r(1),t.exports.VectorTileLayer=r(0)},function(t,e,r){"use strict";t.exports=i;var n=r(7);function i(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;function s(t){return t.type===i.Bytes?t.readVarint()+t.pos:t.pos+1}function o(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function a(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=t;i--)r.buf[i+n]=r.buf[i]}function u(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function h(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function c(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function f(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function l(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function p(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function d(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function y(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function x(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function g(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function v(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function m(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}i.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,s=this.pos;this.type=7&n,t(i,e,this),this.pos===s&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=g(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=m(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=g(this.buf,this.pos)+4294967296*g(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=g(this.buf,this.pos)+4294967296*m(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(t,e,r){var n,i,s=r.buf;if(i=s[r.pos++],n=(112&i)>>4,i<128)return o(t,n,e);if(i=s[r.pos++],n|=(127&i)<<3,i<128)return o(t,n,e);if(i=s[r.pos++],n|=(127&i)<<10,i<128)return o(t,n,e);if(i=s[r.pos++],n|=(127&i)<<17,i<128)return o(t,n,e);if(i=s[r.pos++],n|=(127&i)<<24,i<128)return o(t,n,e);if(i=s[r.pos++],n|=(1&i)<<31,i<128)return o(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,r){var n="",i=e;for(;i<r;){var s,o,a,u=t[i],h=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c>r)break;1===c?u<128&&(h=u):2===c?128==(192&(s=t[i+1]))&&(h=(31&u)<<6|63&s)<=127&&(h=null):3===c?(s=t[i+1],o=t[i+2],128==(192&s)&&128==(192&o)&&((h=(15&u)<<12|(63&s)<<6|63&o)<=2047||h>=55296&&h<=57343)&&(h=null)):4===c&&(s=t[i+1],o=t[i+2],a=t[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&((h=(15&u)<<18|(63&s)<<12|(63&o)<<6|63&a)<=65535||h>=1114112)&&(h=null)),null===h?(h=65533,c=1):h>65535&&(h-=65536,n+=String.fromCharCode(h>>>10&1023|55296),h=56320|1023&h),n+=String.fromCharCode(h),i+=c}return n}(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var r=s(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===i.Varint)for(;this.buf[this.pos++]>127;);else if(e===i.Bytes)this.pos=this.readVarint()+this.pos;else if(e===i.Fixed32)this.pos+=4;else{if(e!==i.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),v(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),v(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),v(this.buf,-1&t,this.pos),v(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),v(this.buf,-1&t,this.pos),v(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,n;t>=0?(r=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,n=n+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn\'t fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos]=127&t}(r,0,e),function(t,e){var r=(7&t)<<4;if(e.buf[e.pos++]|=r|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var n,i,s=0;s<e.length;s++){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){n>56319||s+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):i=n;continue}if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(t[r++]=239,t[r++]=191,t[r++]=189,i=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=63&n|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&a(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),n.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),n.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;n>=128&&a(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,r){this.writeTag(t,i.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){this.writeMessage(t,u,e)},writePackedSVarint:function(t,e){this.writeMessage(t,h,e)},writePackedBoolean:function(t,e){this.writeMessage(t,l,e)},writePackedFloat:function(t,e){this.writeMessage(t,c,e)},writePackedDouble:function(t,e){this.writeMessage(t,f,e)},writePackedFixed32:function(t,e){this.writeMessage(t,p,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,d,e)},writePackedFixed64:function(t,e){this.writeMessage(t,y,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,x,e)},writeBytesField:function(t,e){this.writeTag(t,i.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,i.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,i.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,i.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},function(t,e,r){"use strict";function n(t,e,r){r=r||2;var n,a,u,h,c,p,y,x=e&&e.length,g=x?e[0]*r:t.length,v=i(t,0,g,r,!0),m=[];if(!v)return m;if(x&&(v=function(t,e,r,n){var o,a,u,h,c,p=[];for(o=0,a=e.length;o<a;o++)u=e[o]*n,h=o<a-1?e[o+1]*n:t.length,(c=i(t,u,h,n,!1))===c.next&&(c.steiner=!0),p.push(d(c));for(p.sort(f),o=0;o<p.length;o++)l(p[o],r),r=s(r,r.next);return r}(t,e,v,r)),t.length>80*r){n=u=t[0],a=h=t[1];for(var w=r;w<g;w+=r)c=t[w],p=t[w+1],c<n&&(n=c),p<a&&(a=p),c>u&&(u=c),p>h&&(h=p);y=0!==(y=Math.max(u-n,h-a))?1/y:0}return o(v,m,r,n,a,y),m}function i(t,e,r,n,i){var s,o;if(i===F(t,e,r,n)>0)for(s=e;s<r;s+=n)o=_(s,t[s],t[s+1],o);else for(s=r-n;s>=e;s-=n)o=_(s,t[s],t[s+1],o);return o&&v(o,o.next)&&(M(o),o=o.next),o}function s(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!v(n,n.next)&&0!==g(n.prev,n,n.next))n=n.next;else{if(M(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function o(t,e,r,n,i,f,l){if(t){!l&&f&&function(t,e,r,n){var i=t;do{null===i.z&&(i.z=p(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,s,o,a,u,h=1;do{for(r=t,t=null,s=null,o=0;r;){for(o++,n=r,a=0,e=0;e<h&&(a++,n=n.nextZ);e++);for(u=h;a>0||u>0&&n;)0!==a&&(0===u||!n||r.z<=n.z)?(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,u--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;r=n}s.nextZ=null,h*=2}while(o>1)}(i)}(t,n,i,f);for(var d,y,x=t;t.prev!==t.next;)if(d=t.prev,y=t.next,f?u(t,n,i,f):a(t))e.push(d.i/r),e.push(t.i/r),e.push(y.i/r),M(t),t=y.next,x=y.next;else if((t=y)===x){l?1===l?o(t=h(t,e,r),e,r,n,i,f,2):2===l&&c(t,e,r,n,i,f):o(s(t),e,r,n,i,f,1);break}}}function a(t){var e=t.prev,r=t,n=t.next;if(g(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(y(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&g(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function u(t,e,r,n){var i=t.prev,s=t,o=t.next;if(g(i,s,o)>=0)return!1;for(var a=i.x<s.x?i.x<o.x?i.x:o.x:s.x<o.x?s.x:o.x,u=i.y<s.y?i.y<o.y?i.y:o.y:s.y<o.y?s.y:o.y,h=i.x>s.x?i.x>o.x?i.x:o.x:s.x>o.x?s.x:o.x,c=i.y>s.y?i.y>o.y?i.y:o.y:s.y>o.y?s.y:o.y,f=p(a,u,e,r,n),l=p(h,c,e,r,n),d=t.prevZ,x=t.nextZ;d&&d.z>=f&&x&&x.z<=l;){if(d!==t.prev&&d!==t.next&&y(i.x,i.y,s.x,s.y,o.x,o.y,d.x,d.y)&&g(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,x!==t.prev&&x!==t.next&&y(i.x,i.y,s.x,s.y,o.x,o.y,x.x,x.y)&&g(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;d&&d.z>=f;){if(d!==t.prev&&d!==t.next&&y(i.x,i.y,s.x,s.y,o.x,o.y,d.x,d.y)&&g(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;x&&x.z<=l;){if(x!==t.prev&&x!==t.next&&y(i.x,i.y,s.x,s.y,o.x,o.y,x.x,x.y)&&g(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function h(t,e,r){var n=t;do{var i=n.prev,s=n.next.next;!v(i,s)&&m(i,n,n.next,s)&&w(i,s)&&w(s,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(s.i/r),M(n),M(n.next),n=t=s),n=n.next}while(n!==t);return n}function c(t,e,r,n,i,a){var u=t;do{for(var h=u.next.next;h!==u.prev;){if(u.i!==h.i&&x(u,h)){var c=b(u,h);return u=s(u,u.next),c=s(c,c.next),o(u,e,r,n,i,a),void o(c,e,r,n,i,a)}h=h.next}u=u.next}while(u!==t)}function f(t,e){return t.x-e.x}function l(t,e){if(e=function(t,e){var r,n=e,i=t.x,s=t.y,o=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var a=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>o){if(o=a,a===i){if(s===n.y)return n;if(s===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===o)return r.prev;var u,h=r,c=r.x,f=r.y,l=1/0;n=r.next;for(;n!==h;)i>=n.x&&n.x>=c&&i!==n.x&&y(s<f?i:o,s,c,f,s<f?o:i,s,n.x,n.y)&&((u=Math.abs(s-n.y)/(i-n.x))<l||u===l&&n.x>r.x)&&w(n,t)&&(r=n,l=u),n=n.next;return r}(t,e)){var r=b(e,t);s(r,r.next)}}function p(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function d(t){var e=t,r=t;do{e.x<r.x&&(r=e),e=e.next}while(e!==t);return r}function y(t,e,r,n,i,s,o,a){return(i-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(n-a)-(r-o)*(e-a)>=0&&(r-o)*(s-a)-(i-o)*(n-a)>=0}function x(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&m(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&w(t,e)&&w(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,s=(t.y+e.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&i<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)}function g(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function v(t,e){return t.x===e.x&&t.y===e.y}function m(t,e,r,n){return!!(v(t,e)&&v(r,n)||v(t,n)&&v(r,e))||g(t,e,r)>0!=g(t,e,n)>0&&g(r,n,t)>0!=g(r,n,e)>0}function w(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function b(t,e){var r=new T(t.i,t.x,t.y),n=new T(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,s.next=n,n.prev=s,n}function _(t,e,r,n){var i=new T(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function M(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function T(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function F(t,e,r,n){for(var i=0,s=e,o=r-n;s<r;s+=n)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}t.exports=n,t.exports.default=n,n.deviation=function(t,e,r,n){var i=e&&e.length,s=i?e[0]*r:t.length,o=Math.abs(F(t,0,s,r));if(i)for(var a=0,u=e.length;a<u;a++){var h=e[a]*r,c=a<u-1?e[a+1]*r:t.length;o-=Math.abs(F(t,h,c,r))}var f=0;for(a=0;a<n.length;a+=3){var l=n[a]*r,p=n[a+1]*r,d=n[a+2]*r;f+=Math.abs((t[l]-t[d])*(t[p+1]-t[l+1])-(t[l]-t[p])*(t[d+1]-t[l+1]))}return 0===o&&0===f?0:Math.abs((f-o)/o)},n.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var s=0;s<t[i].length;s++)for(var o=0;o<e;o++)r.vertices.push(t[i][s][o]);i>0&&(n+=t[i-1].length,r.holes.push(n))}return r}},function(t,e,r){"use strict";var n=r(0);function i(t,e,r){if(3===t){var i=new n(r,r.readVarint()+r.pos);i.length&&(e[i.name]=i)}}t.exports=function(t,e){this.layers=t.readFields(i,{},e)}},function(t,e,r){"use strict";function n(t,e){this.x=t,this.y=e}t.exports=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=e*this.x-r*this.y,i=r*this.x+e*this.y;return this.x=n,this.y=i,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),i=e.x+r*(this.x-e.x)-n*(this.y-e.y),s=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=i,this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(t){return t instanceof n?t:Array.isArray(t)?new n(t[0],t[1]):t}},function(t,e){e.read=function(t,e,r,n,i){var s,o,a=8*i-n-1,u=(1<<a)-1,h=u>>1,c=-7,f=r?i-1:0,l=r?-1:1,p=t[e+f];for(f+=l,s=p&(1<<-c)-1,p>>=-c,c+=a;c>0;s=256*s+t[e+f],f+=l,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=n;c>0;o=256*o+t[e+f],f+=l,c-=8);if(0===s)s=1-h;else{if(s===u)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,n),s-=h}return(p?-1:1)*o*Math.pow(2,s-n)},e.write=function(t,e,r,n,i,s){var o,a,u,h=8*s-i-1,c=(1<<h)-1,f=c>>1,l=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:s-1,d=n?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),(e+=o+f>=1?l/u:l*Math.pow(2,1-f))*u>=2&&(o++,u/=2),o+f>=c?(a=0,o=c):o+f>=1?(a=(e*u-1)*Math.pow(2,i),o+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;t[r+p]=255&a,p+=d,a/=256,i-=8);for(o=o<<i|a,h+=i;h>0;t[r+p]=255&o,p+=d,o/=256,h-=8);t[r+p-d]|=128*y}},function(t,e,r){"use strict";r.r(e);var n=r(2),i=r(3);function s(t,e,r){return{center:{x:(t+.5)/Math.pow(2,r)*2-1,y:2*(1-(e+.5)/Math.pow(2,r))-1},scale:1/Math.pow(2,r)}}function o([t,e],[r,n]){return[t-r,e-n]}function a([t,e],[r,n]){return t*r+e*n}function u([t,e]){return[-e,t]}function h(t,e){const r=function(t,e){const r=Math.hypot(t,e);return[t/r,e/r]}(t[0]-e[0],t[1]-e[1]);return[-r[1],r[0]]}function c(t,e){const r=[t[1],-t[0]],n=[-e[1],e[0]],i=n[0]*r[1]-n[1]*r[0],s=n[0]*r[0]+n[1]*r[1],o=Math.abs(i);return{turnLeft:i>0,joinNormal:!(o<.866&&s>.5)&&f([(r[0]+n[0])/o,(r[1]+n[1])/o])}}function f(t){return[-t[0],-t[1]]}function l(t,e,r){return(t.x-r.x)*(e.y-r.y)-(e.x-r.x)*(t.y-r.y)}function p(t,e){return t.x===e.x&&t.y===e.y}function d(t,e,r){switch(r){case"line":return function(t,e){const r=t,n=t.length;for(let t=0;t<n;t+=2)e.minx=Math.min(e.minx,r[t+0]),e.miny=Math.min(e.miny,r[t+1]),e.maxx=Math.max(e.maxx,r[t+0]),e.maxy=Math.max(e.maxy,r[t+1]);return e}(t,e);case"polygon":return function(t,e){const[r,n]=[t.flat,t.holes[0]||t.flat.length/2];for(let t=0;t<n;t++)e.minx=Math.min(e.minx,r[2*t+0]),e.miny=Math.min(e.miny,r[2*t+1]),e.maxx=Math.max(e.maxx,r[2*t+0]),e.maxy=Math.max(e.maxy,r[2*t+1]);return e}(t,e)}}var y={intersect:function(t,e,r,n){const i=t,s=r,h=o(e,t),c=o(n,r),f=u(h),l=u(c),p=a(o(s,i),l)/a(h,l),d=a(o(i,s),f)/a(c,f);if(p>=0&&p<=1&&d>=0&&d<=1)return[i[0]+p*h[0],i[1]+p*h[1]]},sub:o,dot:a,perpendicular:u,getLineNormal:h,getJoinNormal:c,neg:f,halfPlaneSign:l,pointInTriangle:function(t,e,r,n){if(p(e,r)||p(r,n)||p(n,e))return!1;const i=l(t,e,r)<0,s=l(t,r,n)<0,o=l(t,n,e)<0;return i===s&&s===o},equalPoints:p,pointInCircle:function(t,e,r){const n=t.x-e.x,i=t.y-e.y;return n*n+i*i<=r*r},pointInRectangle:function(t,e){if(null===e)return!1;const r=t.x.toFixed(2),n=t.y.toFixed(2);return e.minx<=r&&r<=e.maxx&&e.miny<=n&&n<=e.maxy}};class x{constructor(){this.flat=[],this.holes=[],this.clipped=[],this.clippedType=[]}}function g(t,e){let r=[];return t.map(t=>{let n=[];t.map(t=>{n.push([2*t.x/e-1,2*(1-t.y/e)-1])}),r.push(...function(t){let e=[];const r=[];function n(t){let e=0;for(let r=0;r<w;r++)e|=m[r].inside(t)?0:1<<r;return e}function i(t,e,r){for(let i=0;i<w;i++){const s=1<<i;if(r&s){const o=m[i].intersect(t,e);return r=n(o)&~s,[o,r]}}}let s=t[0],o=n(s);for(let a=1;a<t.length;++a){let u=t[a],h=n(u);const c=h,f=u;for(;;){if(!(o|h)){e.push(...s),h!==c?(e.push(...u),a<t.length-1&&(r.push(e),e=[])):a===t.length-1&&e.push(...u);break}if(o&h)break;o?[s,o]=i(s,u,o):[u,h]=i(s,u,h)}s=f,o=c}(e=function(t){const e=[];let r,n;for(let i=0;i<t.length;i+=2){const s=t[i],o=t[i+1];s===r&&o===n||(e.push(s,o),r=s,n=o)}return e}(e)).length>0&&r.push(e);return r}(n))}),r}function v(t,e){let r,n=null,i=[];return t.forEach(t=>{let s=function(t){let e=0;for(let r=0;r<t.length;r++){let n=(r+1)%t.length;e+=t[r].x*t[n].y,e-=t[n].x*t[r].y}return e/2}(t);if(0===s)return;void 0===r&&(r=s>0);const o=r?s>0:s<0,a=function(t,e){return t.map(t=>{let r=t.x,n=t.y;return[r=2*r/e-1,n=2*(1-n/e)-1]})}(t,e);o&&(n&&i.push(n),n=new x),n=function(t,e,r){let n={};for(let e=0;e<w;e++){const r=[],i={},s=(t,e,r=-1)=>{let s=0;e>=0&&(s=n[e]||0),r>=0&&(s|=1<<r),s&&(i[t]=s)};for(let n=0;n<t.length-1;n++){const i=t[n],o=t[n+1],a=m[e].inside(i),u=m[e].inside(o);if(a&&u)s(r.length,n+1),r.push(o);else if(a){const t=m[e].intersect(i,o);s(r.length,n+1,e),r.push(t)}else if(u){const t=m[e].intersect(i,o);s(r.length,n,e),r.push(t),s(r.length,n+1),r.push(o)}}r.length&&(i[0]&&(i[r.length]=i[0]),r.push(r[0])),t=r,n=i}t.length>=4&&(r&&e.holes.push(e.flat.length/2),t.forEach(t=>{e.flat.push(t[0],t[1])}),Object.keys(n).forEach(t=>{e.clipped.push(2*Number(t)),e.clippedType.push(n[t])}));return e}(a,n,!o)}),n&&i.push(n),i}const m=[{inside:t=>t[0]<=1,intersect:(t,e)=>y.intersect(t,e,[1,-100],[1,100])},{inside:t=>t[1]<=1,intersect:(t,e)=>y.intersect(t,e,[-100,1],[100,1])},{inside:t=>t[0]>=-1,intersect:(t,e)=>y.intersect(t,e,[-1,-100],[-1,100])},{inside:t=>t[1]>=-1,intersect:(t,e)=>y.intersect(t,e,[-100,-1],[100,-1])}],w=m.length;class b{constructor({properties:t,featureCount:e,sample:r,geomType:n,isAggregated:i,idProperty:s}={properties:{}}){this.properties=t,this.featureCount=e,this.sample=r,this.geomType=n,this.isAggregated=i,this.idProperty=s||"cartodb_id",this.categoryToID=new Map,this.IDToCategory=new Map,this.numCategories=0,Object.values(t).map(t=>{t.categories=t.categories||[],t.categories.map(e=>this.categorizeString(t,e.name,!0))}),this.propertyKeys=Object.keys(this.properties)}categorizeString(t,e,r=!1){return void 0===e&&(e=null),this.categoryToID.has(e)?this.categoryToID.get(e):(r||this.properties[t].categories.push({name:e,frequency:Number.NaN}),this.categoryToID.set(e,this.numCategories),this.IDToCategory.set(this.numCategories,e),this.numCategories++,this.numCategories-1)}propertyNames(t){const e=this.properties[t];return e.aggregations?Object.keys(e.aggregations).map(t=>e.aggregations[t]):[t]}}function _(t,e,r,n,i){let s,o,a,u,l,p;if(t.length>=4){u=h(s=[t[0],t[1]],o=[t[2],t[3]]);for(let d=4;d<=t.length;d+=2){if((p=!(i&&i(d)))&&(e.vertices[r]=s[0],e.normals[r++]=-u[0],e.vertices[r]=s[1],e.normals[r++]=-u[1],e.vertices[r]=s[0],e.normals[r++]=u[0],e.vertices[r]=s[1],e.normals[r++]=u[1],e.vertices[r]=o[0],e.normals[r++]=u[0],e.vertices[r]=o[1],e.normals[r++]=u[1],e.vertices[r]=s[0],e.normals[r++]=-u[0],e.vertices[r]=s[1],e.normals[r++]=-u[1],e.vertices[r]=o[0],e.normals[r++]=u[0],e.vertices[r]=o[1],e.normals[r++]=u[1],e.vertices[r]=o[0],e.normals[r++]=-u[0],e.vertices[r]=o[1],e.normals[r++]=-u[1]),d<=t.length-2?a=[t[d],t[d+1]]:n&&(a=[t[2],t[3]]),a&&(l=h(o,a),p)){let{turnLeft:t,joinNormal:i}=c(u,l),s=t?u:f(l),a=t?l:f(u);e.vertices[r]=o[0],e.normals[r++]=0,e.vertices[r]=o[1],e.normals[r++]=n?1e-37:0,e.vertices[r]=o[0],e.normals[r++]=s[0],e.vertices[r]=o[1],e.normals[r++]=s[1],e.vertices[r]=o[0],e.normals[r++]=a[0],e.vertices[r]=o[1],e.normals[r++]=a[1],i&&(e.vertices[r]=o[0],e.normals[r++]=i[0],e.vertices[r]=o[1],e.normals[r++]=i[1],e.vertices[r]=o[0],e.normals[r++]=a[0],e.vertices[r]=o[1],e.normals[r++]=a[1],e.vertices[r]=o[0],e.normals[r++]=s[0],e.vertices[r]=o[1],e.normals[r++]=s[1])}s=o,o=a,u=l,a=null}}return r}function M(t,e){const r=new Float32Array(e);return r.set(t),r}const T=24;let F=0,V={vertices:new Float32Array(1048576),normals:new Float32Array(1048576)};function N(t){const e=F+t;if(e>V.vertices.length){const t=2*e;V.vertices=M(V.vertices,t),V.normals=M(V.normals,t)}}var P=r(4);const S=2,I=24;let O=0,E={vertices:new Float32Array(2097152),normals:new Float32Array(2097152)};function k(t){const e=O+t;if(e>E.vertices.length){const t=2*e;E.vertices=M(E.vertices,t),E.normals=M(E.normals,t)}}function A(t,e){E.vertices[O]=t[e],E.normals[O++]=0,E.vertices[O]=t[e+1],E.normals[O++]=0}function B(t,e,r){return!!(t.clipped.includes(e)&&t.clipped.includes(r)&&t.clippedType[t.clipped.indexOf(e)]&t.clippedType[t.clipped.indexOf(r)])}class D extends Error{constructor(t){if(!t||!t.message)throw Error("Invalid CartoError, a message is mandatory");super(t.message),this.name="CartoError",this.originalError=t}}class C extends D{constructor(t){super({message:t}),this.name="CartoRuntimeError"}}const Z={NOT_SUPPORTED:"[Not supported]:",WEB_GL:"[WebGL]:",MVT:"[MVT]:"};function $(t,e){switch(t){case"point":return function(t){return{verticesArrayBuffer:t,vertices:new Float32Array(t),breakpoints:[]}}(e);case"line":return function(t){let e=[],r=new Map;F=0;for(let n=0;n<t.length;n++){const i=t[n];for(let t=0;t<i.length;t++)N(T*i[t].length),F=_(i[t],V,F);r.set(e.length,0===e.length?{start:0,end:F}:{start:r.get(e.length-1).end,end:F}),e.push(F)}const n=new ArrayBuffer(4*F),i=new ArrayBuffer(4*F),s=new Float32Array(n),o=new Float32Array(i);for(let t=0;t<F;t++)s[t]=V.vertices[t],o[t]=V.normals[t];return{vertices:s,normals:o,verticesArrayBuffer:n,normalsArrayBuffer:i,featureIDToVertexIndex:r,breakpoints:e}}(e);case"polygon":return function(t){let e=[],r=new Map;O=0;for(let n=0;n<t.length;n++){const i=t[n];for(let t=0;t<i.length;t++){const e=i[t],r=P(e.flat,e.holes);k(S*r.length+I*e.flat.length);for(let t=0;t<r.length;t++)A(e.flat,2*r[t]);O=_(e.flat,E,O,!0,t=>e.holes.includes((t-2)/2)||B(e,t-4,t-2))}r.set(e.length,0===e.length?{start:0,end:O}:{start:r.get(e.length-1).end,end:O}),e.push(O)}const n=new ArrayBuffer(4*O),i=new ArrayBuffer(4*O),s=new Float32Array(n),o=new Float32Array(i);for(let t=0;t<O;t++)s[t]=E.vertices[t],o[t]=E.normals[t];return{vertices:s,normals:o,verticesArrayBuffer:n,normalsArrayBuffer:i,featureIDToVertexIndex:r,breakpoints:e}}(e);default:throw new C(`${Z.NOT_SUPPORTED} Unimplemented geometry type: \'${t}\'.`)}}class L{constructor({center:t,scale:e,geom:r,properties:n,type:i,active:s,size:o,metadata:a}){this.active=s,this.center=t,this.properties=n,this.scale=e,this.type=i,this.decodedGeom=$(i,r),this.numVertex="point"===i?3*o:this.decodedGeom.vertices.length/2,this.numFeatures="point"===i?o:this.decodedGeom.breakpoints.length||this.numVertex,this.propertyTex=[],this.metadata=a,this.propertyCount=0,this._aabb=function(t,e){switch(e){case"point":return[];case"line":case"polygon":const r=[];for(let n=0;n<t.length;n++){const i=t[n];let s={minx:Number.POSITIVE_INFINITY,miny:Number.POSITIVE_INFINITY,maxx:Number.NEGATIVE_INFINITY,maxy:Number.NEGATIVE_INFINITY};for(let t=0;t<i.length;t++)s=d(i[t],s,e);s.minx===Number.POSITIVE_INFINITY&&(s=null),r.push(s)}return r}}(r,i)}}class R extends D{constructor(t){super({message:t}),this.name="CartoValidationError"}}const G={MISSING_REQUIRED:"[Missing required property]:",INCORRECT_TYPE:"[Property with an incorrect type]:",INCORRECT_VALUE:"[Incorrect value]:",TOO_MANY_ARGS:"[Too many arguments]:"},j=1024,z={point:1,line:2,polygon:3},Y={UNKNOWN:"unknown",POINT:"point",LINE:"line",POLYGON:"polygon"},U={1:Y.POINT,2:Y.LINE,3:Y.POLYGON};class q{onmessage(t){this.processEvent(t).then(t=>{const e=[];t.dataframe.empty||(e.push(this._propertiesArrayBuffer),e.push(t.dataframe.decodedGeom.verticesArrayBuffer),t.dataframe.decodedGeom.normalsArrayBuffer&&e.push(t.dataframe.decodedGeom.normalsArrayBuffer)),postMessage(t,e)})}async processEvent(t){const e=t.data;e.metadata&&(Object.setPrototypeOf(e.metadata,b.prototype),this.metadata=e.metadata);const r=await this._requestDataframe(e.x,e.y,e.z,e.url,e.layerID,this.metadata);return{mID:e.mID,dataframe:r}}async _requestDataframe(t,e,r,n,i,s){const o=await fetch(n);return await this.urlToDataframeTransformer(o,t,e,r,i,s)}async urlToDataframeTransformer(t,e,r,o,a,u){const h=await t.arrayBuffer();if(0===h.byteLength||"null"===t)return{empty:!0};const c=new n.VectorTile(new i(h));if(Object.keys(c.layers).length>1&&!a)throw new R(`${G.MISSING_REQUIRED} LayerID parameter wasn\'t specified and the MVT tile contains multiple layers: ${JSON.stringify(Object.keys(c.layers))}.`);const f=c.layers[a||Object.keys(c.layers)[0]];if(!f)return{empty:!0};const{geometries:l,properties:p,numFeatures:d}=this._decodeMVTLayer(f,u,4096),y=s(e,r,o);return this._generateDataFrame(y,l,p,d,u.geomType,u)}_decodeMVTLayer(t,e,r){if(!t.length)return{properties:[],geometries:{},numFeatures:0};switch(e.geomType||(e.geomType=this._autoDiscoverType(t)),e.geomType){case Y.POINT:const n=new ArrayBuffer(2*t.length*3*4);return this._decode(t,e,r,n);case Y.LINE:return this._decode(t,e,r,[],g);case Y.POLYGON:return this._decode(t,e,r,[],v);default:throw new R(`${G.INCORRECT_TYPE} MVT: invalid geometry type \'${e.geomType}\'`)}}_autoDiscoverType(t){const e=t.feature(0).type;switch(e){case z.point:return Y.POINT;case z.line:return Y.LINE;case z.polygon:return Y.POLYGON;default:throw new R(`${G.INCORRECT_TYPE} MVT: invalid geometry type \'${e}\'`)}}_decode(t,e,r,n,i){let s,o=0;n&&(s=new Float32Array(n));const{properties:a,propertyNames:u}=this._initializePropertyArrays(e,t.length);for(let h=0;h<t.length;h++){const c=t.feature(h);this._checkType(c,e.geomType);const f=c.loadGeometry();if(i){const t=i(f,r);n.push(t)}else{const t=2*f[0][0].x/r-1,e=2*(1-f[0][0].y/r)-1;if(t<-1||t>=1||e<-1||e>=1)continue;s[6*o+0]=t,s[6*o+1]=e,s[6*o+2]=t,s[6*o+3]=e,s[6*o+4]=t,s[6*o+5]=e}if(void 0===c.properties[e.idProperty])throw new C(`${Z.MVT} MVT feature with undefined idProperty \'${e.idProperty}\'`);this._decodeProperties(e,u,a,c,o),o++}return{properties:a,geometries:n,numFeatures:o}}_checkType(t,e){const r=t.type,n=U[r];if(n!==e)throw new C(`${Z.MVT} MVT: mixed geometry types in the same layer. Layer has type: ${e} but feature was ${n}`)}_initializePropertyArrays(t,e){const r=this._getPropertyNamesFrom(t);return{propertyNames:r,properties:this._getPropertiesFor(r,e)}}_getPropertyNamesFrom(t){const e=[];for(let r=0;r<t.propertyKeys.length;r++){const n=t.propertyKeys[r];"geometry"!==t.properties[n].type&&e.push(...t.propertyNames(n))}return e}_getPropertiesFor(t,e){const r={},n=Math.ceil(e/j)*j,i=new ArrayBuffer(4*n*t.length);this._propertiesArrayBuffer=i;for(let e=0;e<t.length;e++){r[t[e]]=new Float32Array(i,4*e*n,n)}return r}_decodeProperties(t,e,r,n,i){const s=e.length;for(let o=0;o<s;o++){const s=e[o],a=n.properties[s];r[s][i]=this.decodeProperty(t,s,a)}}decodeProperty(t,e,r){const n=t.properties[e].type;if("string"==typeof r){if("category"!==n)throw new C(`${Z.MVT} MVT decoding error. Metadata property \'${e}\' is of type \'${n}\' but the MVT tile contained a feature property of type \'string\': \'${r}\'`);return t.categorizeString(e,r)}if("number"==typeof r){if("number"!==n)throw new C(`${Z.MVT} MVT decoding error. Metadata property \'${e}\' is of type \'${n}\' but the MVT tile contained a feature property of type \'number\': \'${r}\'`);return r}if(null===r||void 0===r)return Number.NaN;throw new C(`${Z.MVT} MVT decoding error. Feature property value of type \'${typeof r}\' cannot be decoded.`)}_generateDataFrame(t,e,r,n,i,s){return new L({active:!1,center:t.center,geom:e,properties:r,scale:t.scale,size:n,type:i,metadata:s})}}function W(t){const e={};return Object.keys(t).sort().forEach(r=>{let n=[...new Set(t[r].map(t=>JSON.stringify(t)))];n.sort(),n=n.map(t=>JSON.parse(t)),e[r]=n}),e}const J=new RegExp("^_cdb_agg_[a-zA-Z0-9]+_");var K={column:{isAggregated:function(t){return t.startsWith("_cdb_agg_")},getBase:function(t){return t.replace(J,"")},getAggFN:function(t){let e=t.substr("_cdb_agg_".length);return e.substr(0,e.indexOf("_"))},aggColumn:(t,e)=>`_cdb_agg_${e}_${t}`},equals:function(t,e){return!(!t||!e)&&JSON.stringify(W(t))===JSON.stringify(W(e))},union:function(t,e){const r={};return new Set(Object.keys(t).concat(Object.keys(e))).forEach(n=>{const i=t[n]||[],s=e[n]||[],o=[...i,...s];r[n]=o}),r},IDENTITY:{},simplify:W};class Q extends D{constructor(t){super({message:t}),this.name="CartoMapsAPIError"}}const H={NOT_SUPPORTED:"[Not supported]:",SECURITY:"[Security]:"};const X={MVT:new q,windshaft:new class extends q{decodeProperty(t,e,r){const n=K.column.getBase(e),i=t.properties[n];if(i)switch(i.type){case"date":return function(t,e){const r=new Date;r.setTime(1e3*e);const{min:n,max:i}=t;return(r-n)/(i.getTime()-n.getTime())}(i,r);case"category":return t.categorizeString(n,r);case"number":return r;default:throw new Q(`${H.NOT_SUPPORTED} Windshaft MVT decoding error. Feature property value of type \'${typeof r}\' cannot be decoded.`)}}}};onmessage=function(t){return X[t.data.workerName].onmessage(t)}}]);',"/dist/02d8fff3a506335484b9.worker.js")}},function(e,t,r){"use strict";function n(e,t,r){r=r||2;var n,o,c,u,f,d,m,g=t&&t.length,b=g?t[0]*r:e.length,_=i(e,0,b,r,!0),y=[];if(!_)return y;if(g&&(_=function(e,t,r,n){var s,o,c,u,f,d=[];for(s=0,o=t.length;s<o;s++)c=t[s]*n,u=s<o-1?t[s+1]*n:e.length,(f=i(e,c,u,n,!1))===f.next&&(f.steiner=!0),d.push(p(f));for(d.sort(h),s=0;s<d.length;s++)l(d[s],r),r=a(r,r.next);return r}(e,t,_,r)),e.length>80*r){n=c=e[0],o=u=e[1];for(var v=r;v<b;v+=r)f=e[v],d=e[v+1],f<n&&(n=f),d<o&&(o=d),f>c&&(c=f),d>u&&(u=d);m=0!==(m=Math.max(c-n,u-o))?1/m:0}return s(_,y,r,n,o,m),y}function i(e,t,r,n,i){var a,s;if(i===C(e,t,r,n)>0)for(a=t;a<r;a+=n)s=w(a,e[a],e[a+1],s);else for(a=r-n;a>=t;a-=n)s=w(a,e[a],e[a+1],s);return s&&_(s,s.next)&&(T(s),s=s.next),s}function a(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!_(n,n.next)&&0!==b(n.prev,n,n.next))n=n.next;else{if(T(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function s(e,t,r,n,i,h,l){if(e){!l&&h&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=d(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,a,s,o,c,u=1;do{for(r=e,e=null,a=null,s=0;r;){for(s++,n=r,o=0,t=0;t<u&&(o++,n=n.nextZ);t++);for(c=u;o>0||c>0&&n;)0!==o&&(0===c||!n||r.z<=n.z)?(i=r,r=r.nextZ,o--):(i=n,n=n.nextZ,c--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;r=n}a.nextZ=null,u*=2}while(s>1)}(i)}(e,n,i,h);for(var p,m,g=e;e.prev!==e.next;)if(p=e.prev,m=e.next,h?c(e,n,i,h):o(e))t.push(p.i/r),t.push(e.i/r),t.push(m.i/r),T(e),e=m.next,g=m.next;else if((e=m)===g){l?1===l?s(e=u(e,t,r),t,r,n,i,h,2):2===l&&f(e,t,r,n,i,h):s(a(e),t,r,n,i,h,1);break}}}function o(e){var t=e.prev,r=e,n=e.next;if(b(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(m(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&b(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function c(e,t,r,n){var i=e.prev,a=e,s=e.next;if(b(i,a,s)>=0)return!1;for(var o=i.x<a.x?i.x<s.x?i.x:s.x:a.x<s.x?a.x:s.x,c=i.y<a.y?i.y<s.y?i.y:s.y:a.y<s.y?a.y:s.y,u=i.x>a.x?i.x>s.x?i.x:s.x:a.x>s.x?a.x:s.x,f=i.y>a.y?i.y>s.y?i.y:s.y:a.y>s.y?a.y:s.y,h=d(o,c,t,r,n),l=d(u,f,t,r,n),p=e.prevZ,g=e.nextZ;p&&p.z>=h&&g&&g.z<=l;){if(p!==e.prev&&p!==e.next&&m(i.x,i.y,a.x,a.y,s.x,s.y,p.x,p.y)&&b(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,g!==e.prev&&g!==e.next&&m(i.x,i.y,a.x,a.y,s.x,s.y,g.x,g.y)&&b(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&m(i.x,i.y,a.x,a.y,s.x,s.y,p.x,p.y)&&b(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;g&&g.z<=l;){if(g!==e.prev&&g!==e.next&&m(i.x,i.y,a.x,a.y,s.x,s.y,g.x,g.y)&&b(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function u(e,t,r){var n=e;do{var i=n.prev,a=n.next.next;!_(i,a)&&y(i,n,n.next,a)&&v(i,a)&&v(a,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(a.i/r),T(n),T(n.next),n=e=a),n=n.next}while(n!==e);return n}function f(e,t,r,n,i,o){var c=e;do{for(var u=c.next.next;u!==c.prev;){if(c.i!==u.i&&g(c,u)){var f=x(c,u);return c=a(c,c.next),f=a(f,f.next),s(c,t,r,n,i,o),void s(f,t,r,n,i,o)}u=u.next}c=c.next}while(c!==e)}function h(e,t){return e.x-t.x}function l(e,t){if(t=function(e,t){var r,n=t,i=e.x,a=e.y,s=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var o=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=i&&o>s){if(s=o,o===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===s)return r.prev;var c,u=r,f=r.x,h=r.y,l=1/0;n=r.next;for(;n!==u;)i>=n.x&&n.x>=f&&i!==n.x&&m(a<h?i:s,a,f,h,a<h?s:i,a,n.x,n.y)&&((c=Math.abs(a-n.y)/(i-n.x))<l||c===l&&n.x>r.x)&&v(n,e)&&(r=n,l=c),n=n.next;return r}(e,t)){var r=x(t,e);a(r,r.next)}}function d(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(e){var t=e,r=e;do{t.x<r.x&&(r=t),t=t.next}while(t!==e);return r}function m(e,t,r,n,i,a,s,o){return(i-s)*(t-o)-(e-s)*(a-o)>=0&&(e-s)*(n-o)-(r-s)*(t-o)>=0&&(r-s)*(a-o)-(i-s)*(n-o)>=0}function g(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&y(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&v(e,t)&&v(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)}function b(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function _(e,t){return e.x===t.x&&e.y===t.y}function y(e,t,r,n){return!!(_(e,t)&&_(r,n)||_(e,n)&&_(r,t))||b(e,t,r)>0!=b(e,t,n)>0&&b(r,n,e)>0!=b(r,n,t)>0}function v(e,t){return b(e.prev,e,e.next)<0?b(e,t,e.next)>=0&&b(e,e.prev,t)>=0:b(e,t,e.prev)<0||b(e,e.next,t)<0}function x(e,t){var r=new E(e.i,e.x,e.y),n=new E(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function w(e,t,r,n){var i=new E(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function T(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function E(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(e,t,r,n){for(var i=0,a=t,s=r-n;a<r;a+=n)i+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return i}e.exports=n,e.exports.default=n,n.deviation=function(e,t,r,n){var i=t&&t.length,a=i?t[0]*r:e.length,s=Math.abs(C(e,0,a,r));if(i)for(var o=0,c=t.length;o<c;o++){var u=t[o]*r,f=o<c-1?t[o+1]*r:e.length;s-=Math.abs(C(e,u,f,r))}var h=0;for(o=0;o<n.length;o+=3){var l=n[o]*r,d=n[o+1]*r,p=n[o+2]*r;h+=Math.abs((e[l]-e[p])*(e[d+1]-e[l+1])-(e[l]-e[d])*(e[p+1]-e[l+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},n.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var s=0;s<t;s++)r.vertices.push(e[i][a][s]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r}},function(e,t){e.exports="precision highp float;\nattribute vec2 vertex;\n\nvarying  vec2 uv;\n\nvoid main(void) {\n    uv = vertex*0.5+vec2(0.5);\n    gl_Position = vec4(vertex, 0.5, 1.);\n}\n"},function(e,t){e.exports="precision highp float;\n\nvarying  vec2 uv;\n\nuniform sampler2D aaTex;\n\nvoid main(void) {\n    vec4 aa = texture2D(aaTex, uv);\n    gl_FragColor = aa;\n}\n"},function(e,t){e.exports="vec2 encodeWidth(float x) {\n    if (!(x<=0. || x>=0.) ){\n        // Convert NaN widths to `0`\n        // Do not remove this, some GPUs will convert NaN floats to 1. when\n        // packing the shader output to a RGBA UNSIGNED BYTE textures\n        x = 0.;\n    }\n    float high, low;\n    x = clamp(x, 0., 1023.);\n    high = floor(x/4.);\n    low = (x-high*4.)/4.;\n    return vec2(high/255., low);\n}\n\n$width_preface\n"},function(e,t){e.exports="precision highp float;\n\nattribute vec2 vertexPosition;\nattribute vec2 featureID;\n\nuniform vec2 vertexScale;\nuniform vec2 vertexOffset;\nuniform float orderMinWidth;\nuniform float orderMaxWidth;\nuniform float devicePixelRatio;\nuniform vec2 resolution;\nuniform vec2 normalScale;\n\nuniform sampler2D colorTex;\nuniform sampler2D widthTex;\nuniform sampler2D filterTex;\n//TODO order bucket texture\n\nvarying highp vec2 featureIDVar;\nvarying highp vec4 color;\nvarying highp vec2 pointCoord;\n\nfloat decodeWidth(vec2 enc) {\n  return enc.x*(255.*4.) + 4.*enc.y;\n}\n\n$symbolPlacement_preface\n$propertyPreface\n$transform_preface\n\nvec2 transform(vec2 p){\n    return $transform_inline(p*resolution)/resolution;\n}\n\nvoid main(void) {\n    featureIDVar = abs(featureID);\n    color = texture2D(colorTex, abs(featureID));\n    float filtering = texture2D(filterTex, abs(featureID)).a;\n    color.a *= filtering;\n\n    float size = decodeWidth(texture2D(widthTex, abs(featureID)).rg);\n    float fillSize = size;\n\n    vec4 p = vec4(vertexScale*vertexPosition-vertexOffset, 0.5, 1.);\n    float sizeNormalizer = (size +2.)/size;\n    vec2 size2 = (2.*size+4.)*normalScale;\n\n    if (featureID.y<0.){\n        pointCoord = vec2(0.866025, -0.5)*2.*sizeNormalizer;\n        p.xy += transform(size2*vec2(0.866025, -0.5));\n    }else if (featureID.x<0.){\n        pointCoord = vec2(-0.866025, -0.5)*2.*sizeNormalizer;\n        p.xy += transform(size2*vec2(-0.866025, -0.5));\n    }else{\n        pointCoord = vec2(0., 1.)*2.*sizeNormalizer;\n        p.xy += transform(vec2(0.,size2.y));\n    }\n    pointCoord.y = -pointCoord.y;\n\n\n    p.xy += ($symbolPlacement_inline)*size/resolution;\n\n\n    vec4 noOverrideColor = vec4(0.);\n    if (size==0. || (color.a==0. && color != noOverrideColor) || size<orderMinWidth || size>=orderMaxWidth){\n        p.x=10000.;\n    }\n    gl_Position  = p;\n}\n"},function(e,t){e.exports="precision highp float;\n\nvarying highp vec2 featureIDVar;\nvarying highp vec4 color;\nvarying highp vec2 pointCoord;\n\n$symbol_preface\n$propertyPreface\n\nvoid main(void) {\n    vec2 featureID = abs(featureIDVar);\n    vec2 imageUV = pointCoord*0.5+vec2(0.5);\n    vec4 symbolColor = $symbol_inline;\n    vec4 noOverrideColor = vec4(0.);\n\n    vec4 c;\n    if (color != noOverrideColor){\n        c = color * vec4(vec3(1), symbolColor.a);\n    }else{\n        c = symbolColor;\n    }\n    if (imageUV!=clamp(imageUV, 0.,1.)){\n        c.a = 0.;\n    }\n\n    gl_FragColor = vec4(c.rgb*c.a, c.a);\n}\n"},function(e,t){e.exports="precision highp float;\n\nattribute vec2 vertexPosition;\nattribute vec2 featureID;\n\nuniform vec2 vertexScale;\nuniform vec2 vertexOffset;\nuniform float orderMinWidth;\nuniform float orderMaxWidth;\nuniform vec2 normalScale;\nuniform vec2 resolution;\n\nuniform sampler2D colorTex;\nuniform sampler2D widthTex;\nuniform sampler2D strokeColorTex;\nuniform sampler2D strokeWidthTex;\nuniform sampler2D filterTex;\n//TODO order bucket texture\n\nvarying highp vec4 color;\nvarying highp vec4 stroke;\nvarying highp float dp;\nvarying highp float fillScale;\nvarying highp float strokeScale;\nvarying highp vec2 pointCoord;\n\nfloat decodeWidth(vec2 enc) {\n  return enc.x*(255.*4.) + 4.*enc.y;\n}\n\n$propertyPreface\n$transform_preface\n\nvec2 transform(vec2 p){\n    return $transform_inline(p*resolution)/resolution;\n}\n\nvoid main(void) {\n  color = texture2D(colorTex, abs(featureID));\n  stroke = texture2D(strokeColorTex, abs(featureID));\n  float filtering = texture2D(filterTex, abs(featureID)).a;\n  color.a *= filtering;\n  stroke.a *= filtering;\n  float size = decodeWidth(texture2D(widthTex, abs(featureID)).rg);\n  float fillSize = size;\n  float strokeSize = decodeWidth(texture2D(strokeWidthTex, abs(featureID)).rg);\n  size += strokeSize;\n  fillScale = min(size / fillSize, 1.);\n  strokeScale = size / max(0.001, (fillSize - strokeSize));\n  if (fillScale == strokeScale) {\n    stroke.a = 0.;\n  }\n  dp = 1.0 / (size + 1.);\n  float sizeNormalizer = (size +1.)/size;\n\n\n  vec4 p = vec4(vertexScale * vertexPosition - vertexOffset, 0.5, 1.);\n\n  vec2 size2 = (2.*size+4.)*normalScale;\n\n    if (featureID.y<0.){\n        pointCoord = vec2(0.866025, -0.5)*2.*sizeNormalizer;\n        p.xy += transform(size2*vec2(0.866025, -0.5));\n    }else if (featureID.x<0.){\n        pointCoord = vec2(-0.866025, -0.5)*2.*sizeNormalizer;\n        p.xy += transform(size2*vec2(-0.866025, -0.5));\n    }else{\n        pointCoord = vec2(0., 1.)*2.*sizeNormalizer;\n        p.xy += transform(vec2(0.,size2.y));\n    }\n\n  if (size == 0. || (stroke.a == 0. && color.a == 0.) || size < orderMinWidth || size >= orderMaxWidth) {\n    p.x = 10000.;\n  }\n\n  gl_Position = p;\n}\n"},function(e,t){e.exports="precision highp float;\n\nvarying lowp vec4 color;\nvarying lowp vec4 stroke;\nvarying highp float dp;\nvarying highp float fillScale;\nvarying highp float strokeScale;\nvarying highp vec2 pointCoord;\n\nfloat distanceAntialias(vec2 p){\n    return 1. - smoothstep(1.-dp*1.4142, 1.+dp*1.4142, length(p));\n}\n\nvoid main(void) {\n    vec2 p = pointCoord;\n    vec4 c = color;\n\n    vec4 s = stroke;\n\n    c.a *= distanceAntialias(p*fillScale);\n    c.rgb*=c.a;\n\n    s.a *= distanceAntialias(p);\n    s.a *= 1.-distanceAntialias((strokeScale)*p);\n    s.rgb*=s.a;\n\n    c=s+(1.-s.a)*c;\n\n    gl_FragColor = c;\n}\n"},function(e,t){e.exports="precision highp float;\n\nattribute vec2 vertexPosition;\nattribute vec2 featureID;\nattribute vec2 normal;\n\nuniform vec2 vertexScale;\nuniform vec2 vertexOffset;\nuniform vec2 normalScale;\nuniform vec2 resolution;\n\nuniform sampler2D colorTex;\nuniform sampler2D widthTex;\nuniform sampler2D filterTex;\n\nvarying lowp vec4 color;\n\nfloat decodeWidth(vec2 enc) {\n  return enc.x*(255.*4.) + 4.*enc.y;\n}\n\n$propertyPreface\n$transform_preface\n\nvoid main(void) {\n    color = texture2D(colorTex, featureID);\n    float filtering = texture2D(filterTex, featureID).a;\n    color.a *= filtering;\n    color.rgb *= color.a;\n    float size = decodeWidth(texture2D(widthTex, featureID).rg);\n\n    // 64 is computed based on RTT_WIDTH and the depth buffer precision\n    // 64 = 2^(BUFFER_BITS)/RTT_WIDTH = 2^16/1024 = 64\n    float z = featureID.y * 63. / 64. + featureID.x / (64.);\n\n    // Set z range (-1, 1)\n    z = z * 2. - 1.;\n\n    vec4 p = vec4(vertexScale*(vertexPosition)+normalScale*normal*size-vertexOffset, z, 1.);\n    p.xy = $transform_inline(p.xy*resolution)/resolution;\n    if (size==0. || color.a==0.){\n        p.x=10000.;\n    }\n    gl_Position  = p;\n}\n"},function(e,t){e.exports="precision highp float;\n\nvarying lowp vec4 color;\n\nvoid main(void) {\n    gl_FragColor = color;\n}\n"},function(e,t){e.exports="precision mediump float;\n\nattribute vec2 vertexPosition;\nattribute vec2 featureID;\nattribute vec2 normal;\n\nuniform vec2 vertexScale;\nuniform vec2 vertexOffset;\nuniform vec2 normalScale;\nuniform vec2 resolution;\n\nuniform sampler2D colorTex;\nuniform sampler2D strokeColorTex;\nuniform sampler2D strokeWidthTex;\nuniform sampler2D filterTex;\n\nvarying lowp vec4 color;\n\nfloat decodeWidth(vec2 enc) {\n  return enc.x*(255.*4.) + 4.*enc.y;\n}\n\n$propertyPreface\n$transform_preface\n\nvoid main(void) {\n    // 64 is computed based on RTT_WIDTH and the depth buffer precision\n    // 64 = 2^(BUFFER_BITS)/RTT_WIDTH = 2^16/1024 = 64\n    float z = featureID.y * 63. / 64. + featureID.x / 64.;\n\n    vec4 c;\n    if (normal == vec2(0.)){\n        c = texture2D(colorTex, featureID);\n    }else{\n        z = mod(z + (z > 0.5 ? -1./64. : 1./64.), 1.);\n        c = texture2D(strokeColorTex, featureID);\n    }\n    z = 2.*z - 1.;\n    float filtering = texture2D(filterTex, featureID).a;\n    c.a *= filtering;\n    float size = decodeWidth(texture2D(strokeWidthTex, featureID).rg);\n\n    vec4 p = vec4(vertexScale*(vertexPosition)+normalScale*normal*size-vertexOffset, z, 1.);\n    p.xy = $transform_inline(p.xy*resolution)/resolution;\n\n    if (c.a==0.){\n        p.x=10000.;\n    }\n    color = vec4(c.rgb*c.a, c.a);\n    gl_Position  = p;\n}\n"},function(e,t){e.exports="precision lowp float;\n\nvarying lowp vec4 color;\n\nvoid main(void) {\n    gl_FragColor = color;\n}\n"},function(e,t,r){var n,i;!function(){var a={Burg:{2:["#ffc6c4","#672044"],3:["#ffc6c4","#cc607d","#672044"],4:["#ffc6c4","#e38191","#ad466c","#672044"],5:["#ffc6c4","#ee919b","#cc607d","#9e3963","#672044"],6:["#ffc6c4","#f29ca3","#da7489","#b95073","#93345d","#672044"],7:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],tags:["quantitative"]},BurgYl:{2:["#fbe6c5","#70284a"],3:["#fbe6c5","#dc7176","#70284a"],4:["#fbe6c5","#ee8a82","#c8586c","#70284a"],5:["#fbe6c5","#f2a28a","#dc7176","#b24b65","#70284a"],6:["#fbe6c5","#f4b191","#e7807d","#d06270","#a44360","#70284a"],7:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],tags:["quantitative"]},RedOr:{2:["#f6d2a9","#b13f64"],3:["#f6d2a9","#ea8171","#b13f64"],4:["#f6d2a9","#f19c7c","#dd686c","#b13f64"],5:["#f6d2a9","#f3aa84","#ea8171","#d55d6a","#b13f64"],6:["#f6d2a9","#f4b28a","#ef9177","#e3726d","#cf5669","#b13f64"],7:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],tags:["quantitative"]},OrYel:{2:["#ecda9a","#ee4d5a"],3:["#ecda9a","#f7945d","#ee4d5a"],4:["#ecda9a","#f3ad6a","#f97b57","#ee4d5a"],5:["#ecda9a","#f1b973","#f7945d","#f86f56","#ee4d5a"],6:["#ecda9a","#f0c079","#f5a363","#f98558","#f76856","#ee4d5a"],7:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],tags:["quantitative"]},Peach:{2:["#fde0c5","#eb4a40"],3:["#fde0c5","#f59e72","#eb4a40"],4:["#fde0c5","#f8b58b","#f2855d","#eb4a40"],5:["#fde0c5","#f9c098","#f59e72","#f17854","#eb4a40"],6:["#fde0c5","#fac7a1","#f7ac80","#f38f65","#f0704f","#eb4a40"],7:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],tags:["quantitative"]},PinkYl:{2:["#fef6b5","#e15383"],3:["#fef6b5","#ffa679","#e15383"],4:["#fef6b5","#ffc285","#fa8a76","#e15383"],5:["#fef6b5","#ffd08e","#ffa679","#f67b77","#e15383"],6:["#fef6b5","#ffd795","#ffb77f","#fd9576","#f37378","#e15383"],7:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],tags:["quantitative"]},Mint:{2:["#e4f1e1","#0d585f"],3:["#e4f1e1","#63a6a0","#0d585f"],4:["#e4f1e1","#89c0b6","#448c8a","#0d585f"],5:["#E4F1E1","#9CCDC1","#63A6A0","#337F7F","#0D585F"],6:["#e4f1e1","#abd4c7","#7ab5ad","#509693","#2c7778","#0d585f"],7:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],tags:["quantitative"]},BluGrn:{2:["#c4e6c3","#1d4f60"],3:["#c4e6c3","#4da284","#1d4f60"],4:["#c4e6c3","#6dbc90","#36877a","#1d4f60"],5:["#c4e6c3","#80c799","#4da284","#2d7974","#1d4f60"],6:["#c4e6c3","#8dce9f","#5fb28b","#3e927e","#297071","#1d4f60"],7:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],tags:["quantitative"]},DarkMint:{2:["#d2fbd4","#123f5a"],3:["#d2fbd4","#559c9e","#123f5a"],4:["#d2fbd4","#7bbcb0","#3a7c89","#123f5a"],5:["#d2fbd4","#8eccb9","#559c9e","#2b6c7f","#123f5a"],6:["#d2fbd4","#9cd5be","#6cafa9","#458892","#266377","#123f5a"],7:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],tags:["quantitative"]},Emrld:{2:["#d3f2a3","#074050"],3:["#d3f2a3","#4c9b82","#074050"],4:["#d3f2a3","#6cc08b","#217a79","#074050"],5:["#d3f2a3","#82d091","#4c9b82","#19696f","#074050"],6:["#d3f2a3","#8fda94","#60b187","#35877d","#145f69","#074050"],7:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],tags:["quantitative"]},ag_GrnYl:{2:["#245668","#EDEF5D"],3:["#245668","#39AB7E","#EDEF5D"],4:["#245668","#0D8F81","#6EC574","#EDEF5D"],5:["#245668","#04817E","#39AB7E","#8BD16D","#EDEF5D"],6:["#245668","#09787C","#1D9A81","#58BB79","#9DD869","#EDEF5D"],7:["#245668","#0F7279","#0D8F81","#39AB7E","#6EC574","#A9DC67","#EDEF5D"],tags:["aggregation"]},BluYl:{2:["#f7feae","#045275"],3:["#f7feae","#46aea0","#045275"],4:["#f7feae","#7ccba2","#089099","#045275"],5:["#f7feae","#9bd8a4","#46aea0","#058092","#045275"],6:["#f7feae","#ace1a4","#68bfa1","#2a9c9c","#02778e","#045275"],7:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],tags:["quantitative"]},Teal:{2:["#d1eeea","#2a5674"],3:["#d1eeea","#68abb8","#2a5674"],4:["#d1eeea","#85c4c9","#4f90a6","#2a5674"],5:["#d1eeea","#96d0d1","#68abb8","#45829b","#2a5674"],6:["#d1eeea","#a1d7d6","#79bbc3","#599bae","#3f7994","#2a5674"],7:["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],tags:["quantitative"]},TealGrn:{2:["#b0f2bc","#257d98"],3:["#b0f2bc","#4cc8a3","#257d98"],4:["#b0f2bc","#67dba5","#38b2a3","#257d98"],5:["#b0f2bc","#77e2a8","#4cc8a3","#31a6a2","#257d98"],6:["#b0f2bc","#82e6aa","#5bd4a4","#3fbba3","#2e9ea1","#257d98"],7:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],tags:["quantitative"]},Purp:{2:["#f3e0f7","#63589f"],3:["#f3e0f7","#b998dd","#63589f"],4:["#f3e0f7","#d1afe8","#9f82ce","#63589f"],5:["#f3e0f7","#dbbaed","#b998dd","#9178c4","#63589f"],6:["#f3e0f7","#e0c2ef","#c8a5e4","#aa8bd4","#8871be","#63589f"],7:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],tags:["quantitative"]},PurpOr:{3:["#f9ddda","#ce78b3","#573b88"],4:["#f9ddda","#e597b9","#ad5fad","#573b88"],5:["#f9ddda","#eda8bd","#ce78b3","#9955a8","#573b88"],6:["#f9ddda","#f0b2c1","#dd8ab6","#bb69b0","#8c4fa4","#573b88"],7:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],tags:["quantitative"]},Sunset:{2:["#f3e79b","#5c53a5"],3:["#f3e79b","#eb7f86","#5c53a5"],4:["#f3e79b","#f8a07e","#ce6693","#5c53a5"],5:["#f3e79b","#fab27f","#eb7f86","#b95e9a","#5c53a5"],6:["#f3e79b","#fabc82","#f59280","#dc6f8e","#ab5b9e","#5c53a5"],7:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],tags:["quantitative"]},Magenta:{2:["#f3cbd3","#6c2167"],3:["#f3cbd3","#ca699d","#6c2167"],4:["#f3cbd3","#dd88ac","#b14d8e","#6c2167"],5:["#f3cbd3","#e498b4","#ca699d","#a24186","#6c2167"],6:["#f3cbd3","#e7a2b9","#d67ba5","#bc5894","#983a81","#6c2167"],7:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],tags:["quantitative"]},SunsetDark:{2:["#fcde9c","#7c1d6f"],3:["#fcde9c","#e34f6f","#7c1d6f"],4:["#fcde9c","#f0746e","#dc3977","#7c1d6f"],5:["#fcde9c","#f58670","#e34f6f","#d72d7c","#7c1d6f"],6:["#fcde9c","#f89872","#ec666d","#df4273","#c5287b","#7c1d6f"],7:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],tags:["quantitative"]},ag_Sunset:{2:["#4b2991","#edd9a3"],3:["#4b2991","#ea4f88","#edd9a3"],4:["#4b2991","#c0369d","#fa7876","#edd9a3"],5:["#4b2991","#a52fa2","#ea4f88","#fa9074","#edd9a3"],6:["#4b2991","#932da3","#d43f96","#f7667c","#f89f77","#edd9a3"],7:["#4b2991","#872ca2","#c0369d","#ea4f88","#fa7876","#f6a97a","#edd9a3"],tags:["aggregation"]},BrwnYl:{2:["#ede5cf","#541f3f"],3:["#ede5cf","#c1766f","#541f3f"],4:["#ede5cf","#d39c83","#a65461","#541f3f"],5:["#ede5cf","#daaf91","#c1766f","#95455a","#541f3f"],6:["#ede5cf","#ddba9b","#cd8c7a","#b26166","#8a3c56","#541f3f"],7:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],tags:["quantitative"]},ArmyRose:{2:["#929b4f","#db8195"],3:["#a3ad62","#fdfbe4","#df91a3"],4:["#929b4f","#d9dbaf","#f3d1ca","#db8195"],5:["#879043","#c1c68c","#fdfbe4","#ebb4b8","#d8758b"],6:["#7f883b","#b0b874","#e3e4be","#f6ddd1","#e4a0ac","#d66d85"],7:["#798234","#a3ad62","#d0d3a2","#fdfbe4","#f0c6c3","#df91a3","#d46780"],tags:["diverging"]},Fall:{2:["#3d5941","#ca562c"],3:["#3d5941","#f6edbd","#ca562c"],4:["#3d5941","#b5b991","#edbb8a","#ca562c"],5:["#3d5941","#96a07c","#f6edbd","#e6a272","#ca562c"],6:["#3d5941","#839170","#cecea2","#f1cf9e","#e19464","#ca562c"],7:["#3d5941","#778868","#b5b991","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},Geyser:{2:["#008080","#ca562c"],3:["#008080","#f6edbd","#ca562c"],4:["#008080","#b4c8a8","#edbb8a","#ca562c"],5:["#008080","#92b69e","#f6edbd","#e6a272","#ca562c"],6:["#008080","#7eab98","#ced7b1","#f1cf9e","#e19464","#ca562c"],7:["#008080","#70a494","#b4c8a8","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},Temps:{2:["#009392","#cf597e"],3:["#009392","#e9e29c","#cf597e"],4:["#009392","#9ccb86","#eeb479","#cf597e"],5:["#009392","#71be83","#e9e29c","#ed9c72","#cf597e"],6:["#009392","#52b684","#bcd48c","#edc783","#eb8d71","#cf597e"],7:["#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"],tags:["diverging"]},TealRose:{2:["#009392","#d0587e"],3:["#009392","#f1eac8","#d0587e"],4:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],5:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],6:["#009392","#72aaa1","#b1c7b3","#e5b9ad","#d98994","#d0587e"],7:["#009392","#72aaa1","#b1c7b3","#f1eac8","#e5b9ad","#d98994","#d0587e"],tags:["diverging"]},Tropic:{2:["#009B9E","#C75DAB"],3:["#009B9E","#F1F1F1","#C75DAB"],4:["#009B9E","#A7D3D4","#E4C1D9","#C75DAB"],5:["#009B9E","#7CC5C6","#F1F1F1","#DDA9CD","#C75DAB"],6:["#009B9E","#5DBCBE","#C6DFDF","#E9D4E2","#D99BC6","#C75DAB"],7:["#009B9E","#42B7B9","#A7D3D4","#F1F1F1","#E4C1D9","#D691C1","#C75DAB"],tags:["diverging"]},Earth:{2:["#A16928","#2887a1"],3:["#A16928","#edeac2","#2887a1"],4:["#A16928","#d6bd8d","#b5c8b8","#2887a1"],5:["#A16928","#caa873","#edeac2","#98b7b2","#2887a1"],6:["#A16928","#c29b64","#e0cfa2","#cbd5bc","#85adaf","#2887a1"],7:["#A16928","#bd925a","#d6bd8d","#edeac2","#b5c8b8","#79a7ac","#2887a1"],tags:["diverging"]},Antique:{2:["#855C75","#D9AF6B","#7C7C7C"],3:["#855C75","#D9AF6B","#AF6458","#7C7C7C"],4:["#855C75","#D9AF6B","#AF6458","#736F4C","#7C7C7C"],5:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#7C7C7C"],6:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#7C7C7C"],7:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#7C7C7C"],8:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#7C7C7C"],9:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#7C7C7C"],10:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#7C7C7C"],11:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#467378","#7C7C7C"],tags:["qualitative"]},Bold:{2:["#7F3C8D","#11A579","#A5AA99"],3:["#7F3C8D","#11A579","#3969AC","#A5AA99"],4:["#7F3C8D","#11A579","#3969AC","#F2B701","#A5AA99"],5:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#A5AA99"],6:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#A5AA99"],7:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#A5AA99"],8:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#A5AA99"],9:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#A5AA99"],10:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#A5AA99"],11:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#4b4b8f","#A5AA99"],tags:["qualitative"]},Pastel:{2:["#66C5CC","#F6CF71","#B3B3B3"],3:["#66C5CC","#F6CF71","#F89C74","#B3B3B3"],4:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#B3B3B3"],5:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#B3B3B3"],6:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#B3B3B3"],7:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#B3B3B3"],8:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#B3B3B3"],9:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B3B3B3"],10:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#B3B3B3"],11:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"],tags:["qualitative"]},Prism:{2:["#5F4690","#1D6996","#666666"],3:["#5F4690","#1D6996","#38A6A5","#666666"],4:["#5F4690","#1D6996","#38A6A5","#0F8554","#666666"],5:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#666666"],6:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#666666"],7:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#666666"],8:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#666666"],9:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#666666"],10:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#666666"],11:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#994E95","#666666"],tags:["qualitative"]},Safe:{2:["#88CCEE","#CC6677","#888888"],3:["#88CCEE","#CC6677","#DDCC77","#888888"],4:["#88CCEE","#CC6677","#DDCC77","#117733","#888888"],5:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#888888"],6:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#888888"],7:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#888888"],8:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#888888"],9:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#888888"],10:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#888888"],11:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#6699CC","#888888"],tags:["qualitative","colorblind"]},Vivid:{2:["#E58606","#5D69B1","#A5AA99"],3:["#E58606","#5D69B1","#52BCA3","#A5AA99"],4:["#E58606","#5D69B1","#52BCA3","#99C945","#A5AA99"],5:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#A5AA99"],6:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#A5AA99"],7:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#A5AA99"],8:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#A5AA99"],9:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#A5AA99"],10:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#A5AA99"],11:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#CC3A8E","#A5AA99"],tags:["qualitative"]}},s={Blues:{tags:["quantitative"]},BrBG:{tags:["diverging"]},Greys:{tags:["quantitative"]},PiYG:{tags:["diverging"]},PRGn:{tags:["diverging"]},Purples:{tags:["quantitative"]},RdYlGn:{tags:["diverging"]},Spectral:{tags:["diverging"]},YlOrBr:{tags:["quantitative"]},YlGn:{tags:["quantitative"]},YlGnBu:{tags:["quantitative"]},YlOrRd:{tags:["quantitative"]}},o=r(40);for(var c in o){var u=o[c],f={};for(var h in u)f[h]=u[h];c in s&&(f.tags=s[c].tags),a["cb_"+c]=f}void 0===(i="function"==typeof(n=a)?n.call(t,r,t,e):n)||(e.exports=i)}()},function(e,t,r){e.exports=r(41)},function(e,t,r){var n,i;void 0===(i="function"==typeof(n={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}})?n.call(t,r,t,e):n)||(e.exports=i)},function(e,t,r){(function(t){"pseudomap"===t.env.npm_package_name&&"test"===t.env.npm_lifecycle_script&&(t.env.TEST_PSEUDOMAP="true"),"function"!=typeof Map||t.env.TEST_PSEUDOMAP?e.exports=r(43):e.exports=Map}).call(this,r(6))},function(e,t){var r=Object.prototype.hasOwnProperty;function n(e){if(!(this instanceof n))throw new TypeError("Constructor PseudoMap requires 'new'");if(this.clear(),e)if(e instanceof n||"function"==typeof Map&&e instanceof Map)e.forEach(function(e,t){this.set(t,e)},this);else{if(!Array.isArray(e))throw new TypeError("invalid argument");e.forEach(function(e){this.set(e[0],e[1])},this)}}function i(e,t){return e===t||e!=e&&t!=t}function a(e,t){for(var n=0,a="_"+t,s=a;r.call(e,s);s=a+n++)if(i(e[s].key,t))return e[s]}e.exports=n,n.prototype.forEach=function(e,t){t=t||this,Object.keys(this._data).forEach(function(r){"size"!==r&&e.call(t,this._data[r].value,this._data[r].key)},this)},n.prototype.has=function(e){return!!a(this._data,e)},n.prototype.get=function(e){var t=a(this._data,e);return t&&t.value},n.prototype.set=function(e,t){!function(e,t,n){for(var a=0,s="_"+t,o=s;r.call(e,o);o=s+a++)if(i(e[o].key,t))return void(e[o].value=n);e.size++,e[o]=new function(e,t,r){this.key=e,this.value=t,this._index=r}(t,n,o)}(this._data,e,t)},n.prototype.delete=function(e){var t=a(this._data,e);t&&(delete this._data[t._index],this._data.size--)},n.prototype.clear=function(){var e=Object.create(null);e.size=0,Object.defineProperty(this,"_data",{value:e,enumerable:!1,configurable:!0,writable:!1})},Object.defineProperty(n.prototype,"size",{get:function(){return this._data.size},set:function(e){},enumerable:!0,configurable:!0}),n.prototype.values=n.prototype.keys=n.prototype.entries=function(){throw new Error("iterators are not implemented in this version")}},function(e,t,r){(function(e,n){var i=/%[sdj%]/g;t.format=function(e){if(!b(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(o(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,a=n.length,s=String(e).replace(i,function(e){if("%%"===e)return"%";if(r>=a)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),c=n[r];r<a;c=n[++r])m(c)||!v(c)?s+=" "+c:s+=" "+o(c);return s},t.deprecate=function(r,i){if(_(e.process))return function(){return t.deprecate(r,i).apply(this,arguments)};if(!0===n.noDeprecation)return r;var a=!1;return function(){if(!a){if(n.throwDeprecation)throw new Error(i);n.traceDeprecation?console.trace(i):console.error(i),a=!0}return r.apply(this,arguments)}};var a,s={};function o(e,r){var n={seen:[],stylize:u};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),p(r)?n.showHidden=r:r&&t._extend(n,r),_(n.showHidden)&&(n.showHidden=!1),_(n.depth)&&(n.depth=2),_(n.colors)&&(n.colors=!1),_(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=c),f(n,e,n.depth)}function c(e,t){var r=o.styles[t];return r?"["+o.colors[r][0]+"m"+e+"["+o.colors[r][1]+"m":e}function u(e,t){return e}function f(e,r,n){if(e.customInspect&&r&&T(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var i=r.inspect(n,e);return b(i)||(i=f(e,i,n)),i}var a=function(e,t){if(_(t))return e.stylize("undefined","undefined");if(b(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(g(t))return e.stylize(""+t,"number");if(p(t))return e.stylize(""+t,"boolean");if(m(t))return e.stylize("null","null")}(e,r);if(a)return a;var s=Object.keys(r),o=function(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(r)),w(r)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return h(r);if(0===s.length){if(T(r)){var c=r.name?": "+r.name:"";return e.stylize("[Function"+c+"]","special")}if(y(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(x(r))return e.stylize(Date.prototype.toString.call(r),"date");if(w(r))return h(r)}var u,v="",E=!1,C=["{","}"];(d(r)&&(E=!0,C=["[","]"]),T(r))&&(v=" [Function"+(r.name?": "+r.name:"")+"]");return y(r)&&(v=" "+RegExp.prototype.toString.call(r)),x(r)&&(v=" "+Date.prototype.toUTCString.call(r)),w(r)&&(v=" "+h(r)),0!==s.length||E&&0!=r.length?n<0?y(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),u=E?function(e,t,r,n,i){for(var a=[],s=0,o=t.length;s<o;++s)S(t,String(s))?a.push(l(e,t,r,n,String(s),!0)):a.push("");return i.forEach(function(i){i.match(/^\d+$/)||a.push(l(e,t,r,n,i,!0))}),a}(e,r,n,o,s):s.map(function(t){return l(e,r,n,o,t,E)}),e.seen.pop(),function(e,t,r){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(u,v,C)):C[0]+v+C[1]}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function l(e,t,r,n,i,a){var s,o,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?o=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(o=e.stylize("[Setter]","special")),S(n,i)||(s="["+i+"]"),o||(e.seen.indexOf(c.value)<0?(o=m(r)?f(e,c.value,null):f(e,c.value,r-1)).indexOf("\n")>-1&&(o=a?o.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+o.split("\n").map(function(e){return"   "+e}).join("\n")):o=e.stylize("[Circular]","special")),_(s)){if(a&&i.match(/^\d+$/))return o;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+o}function d(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return"number"==typeof e}function b(e){return"string"==typeof e}function _(e){return void 0===e}function y(e){return v(e)&&"[object RegExp]"===E(e)}function v(e){return"object"==typeof e&&null!==e}function x(e){return v(e)&&"[object Date]"===E(e)}function w(e){return v(e)&&("[object Error]"===E(e)||e instanceof Error)}function T(e){return"function"==typeof e}function E(e){return Object.prototype.toString.call(e)}function C(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(_(a)&&(a=n.env.NODE_DEBUG||""),e=e.toUpperCase(),!s[e])if(new RegExp("\\b"+e+"\\b","i").test(a)){var r=n.pid;s[e]=function(){var n=t.format.apply(t,arguments);console.error("%s %d: %s",e,r,n)}}else s[e]=function(){};return s[e]},t.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=d,t.isBoolean=p,t.isNull=m,t.isNullOrUndefined=function(e){return null==e},t.isNumber=g,t.isString=b,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=_,t.isRegExp=y,t.isObject=v,t.isDate=x,t.isError=w,t.isFunction=T,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=r(46);var A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function S(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",function(){var e=new Date,t=[C(e.getHours()),C(e.getMinutes()),C(e.getSeconds())].join(":");return[e.getDate(),A[e.getMonth()],t].join(" ")}(),t.format.apply(t,arguments))},t.inherits=r(47),t._extend=function(e,t){if(!t||!v(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,r(45),r(6))},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t){function r(e){var t=this;if(t instanceof r||(t=new r),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach(function(e){t.push(e)});else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)t.push(arguments[n]);return t}function n(e,t){e.tail=new a(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function i(e,t){e.head=new a(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function a(e,t,r,n){if(!(this instanceof a))return new a(e,t,r,n);this.list=n,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}e.exports=r,r.Node=a,r.create=r,r.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,r=e.prev;t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),e.list.length--,e.next=null,e.prev=null,e.list=null},r.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},r.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},r.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)n(this,arguments[e]);return this.length},r.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)i(this,arguments[e]);return this.length},r.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},r.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},r.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,n=0;null!==r;n++)e.call(t,r.value,n,this),r=r.next},r.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,n=this.length-1;null!==r;n--)e.call(t,r.value,n,this),r=r.prev},r.prototype.get=function(e){for(var t=0,r=this.head;null!==r&&t<e;t++)r=r.next;if(t===e&&null!==r)return r.value},r.prototype.getReverse=function(e){for(var t=0,r=this.tail;null!==r&&t<e;t++)r=r.prev;if(t===e&&null!==r)return r.value},r.prototype.map=function(e,t){t=t||this;for(var n=new r,i=this.head;null!==i;)n.push(e.call(t,i.value,this)),i=i.next;return n},r.prototype.mapReverse=function(e,t){t=t||this;for(var n=new r,i=this.tail;null!==i;)n.push(e.call(t,i.value,this)),i=i.prev;return n},r.prototype.reduce=function(e,t){var r,n=this.head;if(arguments.length>1)r=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");n=this.head.next,r=this.head.value}for(var i=0;null!==n;i++)r=e(r,n.value,i),n=n.next;return r},r.prototype.reduceReverse=function(e,t){var r,n=this.tail;if(arguments.length>1)r=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");n=this.tail.prev,r=this.tail.value}for(var i=this.length-1;null!==n;i--)r=e(r,n.value,i),n=n.prev;return r},r.prototype.toArray=function(){for(var e=new Array(this.length),t=0,r=this.head;null!==r;t++)e[t]=r.value,r=r.next;return e},r.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,r=this.tail;null!==r;t++)e[t]=r.value,r=r.prev;return e},r.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=0,a=this.head;null!==a&&i<e;i++)a=a.next;for(;null!==a&&i<t;i++,a=a.next)n.push(a.value);return n},r.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=this.length,a=this.tail;null!==a&&i>t;i--)a=a.prev;for(;null!==a&&i>e;i--,a=a.prev)n.push(a.value);return n},r.prototype.reverse=function(){for(var e=this.head,t=this.tail,r=e;null!==r;r=r.prev){var n=r.prev;r.prev=r.next,r.next=n}return this.head=t,this.tail=e,this}},function(e,t,r){"use strict";var n=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var r;try{(r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),r=r.getBlob()}catch(t){r=new Blob([e])}return new Worker(n.createObjectURL(r))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(!t)throw Error("Inline worker is not supported");return new Worker(t)}}},function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"colorShaderGLSL",function(){return Z}),r.d(n,"filterShaderGLSL",function(){return Q}),r.d(n,"widthShaderGLSL",function(){return K});var i={};r.r(i),r.d(i,"symbolShaderGLSL",function(){return re});var a={};r.r(a),r.d(a,"transition",function(){return gn}),r.d(a,"nin",function(){return _n}),r.d(a,"in",function(){return bn}),r.d(a,"between",function(){return yn}),r.d(a,"mul",function(){return vn}),r.d(a,"div",function(){return xn}),r.d(a,"add",function(){return wn}),r.d(a,"sub",function(){return Tn}),r.d(a,"pow",function(){return En}),r.d(a,"mod",function(){return Cn}),r.d(a,"greaterThan",function(){return An}),r.d(a,"greaterThanOrEqualTo",function(){return Sn}),r.d(a,"lessThan",function(){return In}),r.d(a,"lessThanOrEqualTo",function(){return Dn}),r.d(a,"equals",function(){return Rn}),r.d(a,"notEquals",function(){return Fn}),r.d(a,"and",function(){return Mn}),r.d(a,"or",function(){return Nn}),r.d(a,"gt",function(){return On}),r.d(a,"gte",function(){return $n}),r.d(a,"lt",function(){return Pn}),r.d(a,"lte",function(){return Bn}),r.d(a,"eq",function(){return Ln}),r.d(a,"neq",function(){return kn}),r.d(a,"blend",function(){return Un}),r.d(a,"buckets",function(){return zn}),r.d(a,"cielab",function(){return Vn}),r.d(a,"clusterAvg",function(){return Gn}),r.d(a,"clusterMax",function(){return qn}),r.d(a,"clusterMin",function(){return jn}),r.d(a,"clusterMode",function(){return Wn}),r.d(a,"clusterSum",function(){return Yn}),r.d(a,"clusterCount",function(){return Xn}),r.d(a,"constant",function(){return Hn}),r.d(a,"image",function(){return Zn}),r.d(a,"svg",function(){return Qn}),r.d(a,"hex",function(){return Kn}),r.d(a,"hsl",function(){return Jn}),r.d(a,"hsla",function(){return ei}),r.d(a,"hsv",function(){return ti}),r.d(a,"hsva",function(){return ri}),r.d(a,"cubic",function(){return ni}),r.d(a,"ilinear",function(){return ii}),r.d(a,"linear",function(){return ai}),r.d(a,"list",function(){return si}),r.d(a,"namedColor",function(){return oi}),r.d(a,"now",function(){return ci}),r.d(a,"number",function(){return ui}),r.d(a,"opacity",function(){return fi}),r.d(a,"asc",function(){return hi}),r.d(a,"desc",function(){return li}),r.d(a,"noOrder",function(){return di}),r.d(a,"width",function(){return pi}),r.d(a,"reverse",function(){return mi}),r.d(a,"property",function(){return gi}),r.d(a,"prop",function(){return gi}),r.d(a,"globalQuantiles",function(){return bi}),r.d(a,"viewportQuantiles",function(){return _i}),r.d(a,"globalEqIntervals",function(){return yi}),r.d(a,"viewportEqIntervals",function(){return vi}),r.d(a,"globalStandardDev",function(){return xi}),r.d(a,"viewportStandardDev",function(){return wi}),r.d(a,"ramp",function(){return Ti}),r.d(a,"rgb",function(){return Ei}),r.d(a,"rgba",function(){return Ci}),r.d(a,"category",function(){return Ai}),r.d(a,"time",function(){return Si}),r.d(a,"date",function(){return Si}),r.d(a,"top",function(){return Ii}),r.d(a,"fade",function(){return Di}),r.d(a,"animation",function(){return Ri}),r.d(a,"log",function(){return Fi}),r.d(a,"sqrt",function(){return Mi}),r.d(a,"sin",function(){return Ni}),r.d(a,"cos",function(){return Oi}),r.d(a,"tan",function(){return $i}),r.d(a,"sign",function(){return Pi}),r.d(a,"abs",function(){return Bi}),r.d(a,"isNaN",function(){return Li}),r.d(a,"not",function(){return ki}),r.d(a,"floor",function(){return Ui}),r.d(a,"ceil",function(){return zi}),r.d(a,"variable",function(){return Vi}),r.d(a,"var",function(){return Vi}),r.d(a,"viewportAvg",function(){return Gi}),r.d(a,"viewportMax",function(){return qi}),r.d(a,"viewportMin",function(){return ji}),r.d(a,"viewportSum",function(){return Wi}),r.d(a,"viewportCount",function(){return Yi}),r.d(a,"viewportPercentile",function(){return Xi}),r.d(a,"viewportHistogram",function(){return Hi}),r.d(a,"viewportFeatures",function(){return Zi}),r.d(a,"globalAvg",function(){return Qi}),r.d(a,"globalMax",function(){return Ki}),r.d(a,"globalMin",function(){return Ji}),r.d(a,"globalSum",function(){return ea}),r.d(a,"globalCount",function(){return ta}),r.d(a,"globalPercentile",function(){return ra}),r.d(a,"zoom",function(){return na}),r.d(a,"scaled",function(){return ia}),r.d(a,"zoomrange",function(){return aa}),r.d(a,"placement",function(){return sa}),r.d(a,"translate",function(){return oa}),r.d(a,"rotate",function(){return ca}),r.d(a,"alphaNormalize",function(){return ua}),r.d(a,"HOLD",function(){return fa}),r.d(a,"TRUE",function(){return ha}),r.d(a,"FALSE",function(){return la}),r.d(a,"PI",function(){return da}),r.d(a,"E",function(){return pa}),r.d(a,"BICYCLE",function(){return ma}),r.d(a,"BUILDING",function(){return ga}),r.d(a,"BUS",function(){return ba}),r.d(a,"CAR",function(){return _a}),r.d(a,"CIRCLE",function(){return ya}),r.d(a,"CIRCLE_OUTLINE",function(){return va}),r.d(a,"CROSS",function(){return xa}),r.d(a,"FLAG",function(){return wa}),r.d(a,"HOUSE",function(){return Ta}),r.d(a,"MARKER",function(){return Ea}),r.d(a,"MARKER_OUTLINE",function(){return Ca}),r.d(a,"PLUS",function(){return Aa}),r.d(a,"SQUARE",function(){return Sa}),r.d(a,"SQUARE_OUTLINE",function(){return Ia}),r.d(a,"STAR",function(){return Da}),r.d(a,"STAR_OUTLINE",function(){return Ra}),r.d(a,"TRIANGLE",function(){return Fa}),r.d(a,"TRIANGLE_OUTLINE",function(){return Ma}),r.d(a,"ALIGN_CENTER",function(){return Na}),r.d(a,"ALIGN_BOTTOM",function(){return Oa}),r.d(a,"palettes",function(){return zt}),r.d(a,"Asc",function(){return Ft}),r.d(a,"Desc",function(){return Mt});const s=Math.PI/180,o=6378137,c=o*Math.PI,u=2*c;function f(e){return void 0===e}function h(e){return"string"==typeof e}function l(e){const t=typeof e;return null!==e&&("object"===t||"function"===t)}function d(e){if(e instanceof Date)return e;if("number"==typeof e){const t=e;return(e=new Date(0)).setUTCMilliseconds(t),e}return new Date(e)}function p(e){let t=e.lat*s;return{x:e.lng*s*o,y:Math.log(Math.tan(t/2+Math.PI/4))*o}}var m={WM_R:c,WM_2R:u,isUndefined:f,isString:h,isNumber:function(e){return"number"==typeof e},isObject:l,castDate:d,isSetsEqual:function(e,t){return e.size===t.size&&[...e].every(e=>t.has(e))},equalArrays:function(e,t){if(e&&t&&e.length===t.length){for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}},projectToWebMercator:p,computeMapZoom:function(e){const t=e.getBounds(),r=t.getNorthWest(),n=t.getSouthWest();return(p(r).y-p(n).y)/u},computeMapCenter:function(e){const t=p(e.getCenter());return{x:t.x/c,y:t.y/c}},computeMatrixZoom:function(e){return-2*e[15]/e[5]},computeMatrixCenter:function(e){return{x:-(1+2*e[12]/e[0]),y:+(1+2*e[13]/e[5])}}};class g extends Error{constructor(e){if(!e||!e.message)throw Error("Invalid CartoError, a message is mandatory");super(e.message),this.name="CartoError",this.originalError=e}}class b extends g{constructor(e){super({message:e}),this.name="CartoValidationError"}}const _={MISSING_REQUIRED:"[Missing required property]:",INCORRECT_TYPE:"[Property with an incorrect type]:",INCORRECT_VALUE:"[Incorrect value]:",TOO_MANY_ARGS:"[Too many arguments]:"};let y,v;function x(e){w(e),y=e}function w(e){if(f(e))throw new b(`${_.MISSING_REQUIRED} 'auth'`);if(!l(e))throw new b(`${_.INCORRECT_TYPE} 'auth' property must be an object.`);e.username=e.user,function(e){if(f(e))throw new b(`${_.MISSING_REQUIRED} 'apiKey'`);if(!h(e))throw new b(`${_.INCORRECT_TYPE} 'apiKey' property must be a string.`);if(""===e)throw new b(`${_.INCORRECT_VALUE} 'apiKey' property must be not empty.`)}(e.apiKey),function(e){if(f(e))throw new b(`${_.MISSING_REQUIRED} 'username'`);if(!h(e))throw new b(`${_.INCORRECT_TYPE} 'username' property must be a string.`);if(""===e)throw new b(`${_.INCORRECT_VALUE} 'username' property must be not empty.`)}(e.username)}function T(e){E(e),v=e}function E(e){if(e){if(!l(e))throw new b(`${_.INCORRECT_TYPE} 'config' property must be an object.`);!function(e){if(!h(e))throw new b(`${_.INCORRECT_TYPE} 'serverURL' property must be a string.`)}(e.serverURL)}}const C={};function A(e,t){const r={};return new Set(Object.keys(e).concat(Object.keys(t))).forEach(n=>{const i=e[n]||[],a=t[n]||[],s=[...i,...a];r[n]=s}),r}function S(e){const t={};return Object.keys(e).sort().forEach(r=>{let n=[...new Set(e[r].map(e=>JSON.stringify(e)))];n.sort(),n=n.map(e=>JSON.parse(e)),t[r]=n}),t}const I=new RegExp("^_cdb_agg_[a-zA-Z0-9]+_"),D="_cdb_feature_count",R={isAggregated:function(e){return e.startsWith("_cdb_agg_")},getBase:function(e){return e.replace(I,"")},getAggFN:function(e){let t=e.substr("_cdb_agg_".length);return t.substr(0,t.indexOf("_"))},aggColumn:(e,t)=>`_cdb_agg_${t}_${e}`};var F={column:R,equals:function(e,t){return!(!e||!t)&&JSON.stringify(S(e))===JSON.stringify(S(t))},union:A,IDENTITY:C,simplify:S};class M{constructor(){this.caches=new WeakMap}get(e,t){if(this.caches.has(e)){return this.caches.get(e)[t]}}set(e,t,r){if(this.caches.has(e)){this.caches.get(e)[t]=r}else{let n={};n[t]=r,this.caches.set(e,n)}}has(e,t){return void 0!==this.get(e,t)}}class N extends g{constructor(e){super({message:e}),this.name="CartoRuntimeError"}}const O={NOT_SUPPORTED:"[Not supported]:",WEB_GL:"[WebGL]:",MVT:"[MVT]:"};let $=1;const P=new M,B=new M;function L(e,t,r){const n=t+r;if(B.has(e,n))return B.get(e,n);const i={},a=k(e,t,e.VERTEX_SHADER),s=k(e,r,e.FRAGMENT_SHADER);if(i.program=e.createProgram(),e.attachShader(i.program,a),e.attachShader(i.program,s),e.linkProgram(i.program),e.deleteShader(a),e.deleteShader(s),!e.getProgramParameter(i.program,e.LINK_STATUS))throw new N(`${O.WEB_GL} Unable to link the shader program: ${e.getProgramInfoLog(i.program)}.`);return i.programID=$++,B.set(e,n,i),i}function k(e,t,r){if(P.has(e,t))return P.get(e,t);const n=e.createShader(r);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS)){const r=e.getShaderInfoLog(n);throw e.deleteShader(n),new N(`${O.WEB_GL} An error occurred compiling the shaders: ${r}\nSource:\n${t}`)}return P.set(e,t,n),n}var U=r(29),z=r.n(U),V=r(28),G=r.n(V);var q=r(30),j=r.n(q),W=r(4),Y=r.n(W),X=r(3),H=r.n(X);const Z={vertexShader:`${H.a}`,fragmentShader:`${Y.a}`.replace("$style_inline","$color_inline").replace("$style_preface","$color_preface")},Q={vertexShader:`${H.a}`,fragmentShader:`${Y.a}`.replace("$style_inline","vec4($filter_inline)").replace("$style_preface","$filter_preface")},K={vertexShader:`${H.a}`,fragmentShader:`${Y.a}`.replace("$style_inline","vec4(encodeWidth($width_inline), vec2(0.))").replace("$style_preface",`${j.a}`)};var J=r(32),ee=r.n(J),te=r(31);const re={vertexShader:`${r.n(te).a}`,fragmentShader:`${ee.a}`};var ne={styler:n,symbolizer:i,AABlender:class{constructor(e){Object.assign(this,L(e,G.a,z.a)),this.vertexAttribute=e.getAttribLocation(this.program,"vertex"),this.readTU=e.getUniformLocation(this.program,"aaTex")}}};class ie{constructor(){this._ids=new Map}getID(e){if(this._ids.has(e))return this._ids.get(e);const t=this._ids.size;return this._ids.set(e,t),t}}function ae(e,t,r,n){let i={};const a=e=>(void 0===i[e]&&(i[e]=Object.keys(i).length),`texture2D(propertyTex${i[e]}, abs(featureID)).a`);let s={};const o=new ie;Object.keys(r).forEach(e=>{const t=r[e];t._setUID(o);const n=t._applyToShaderSource(a);s[e+"_preface"]=n.preface,s[e+"_inline"]=n.inline}),s.propertyPreface=Object.keys(i).map(e=>`uniform sampler2D propertyTex${i[e]};`).join("\n");const c=function(e,t,r){let n=t.vertexShader,i=t.fragmentShader;Object.keys(r).forEach(e=>{n=n.replace("$"+e,r[e]),i=i.replace("$"+e,r[e])});const a=L(e,n,i);return a.vertexPositionAttribute=e.getAttribLocation(a.program,"vertexPosition"),a.featureIdAttr=e.getAttribLocation(a.program,"featureID"),a.normalAttr=e.getAttribLocation(a.program,"normal"),a.vertexScaleUniformLocation=e.getUniformLocation(a.program,"vertexScale"),a.vertexOffsetUniformLocation=e.getUniformLocation(a.program,"vertexOffset"),a.colorTexture=e.getUniformLocation(a.program,"colorTex"),a.strokeColorTexture=e.getUniformLocation(a.program,"strokeColorTex"),a.strokeWidthTexture=e.getUniformLocation(a.program,"strokeWidthTex"),a.widthTexture=e.getUniformLocation(a.program,"widthTex"),a.orderMinWidth=e.getUniformLocation(a.program,"orderMinWidth"),a.orderMaxWidth=e.getUniformLocation(a.program,"orderMaxWidth"),a.filterTexture=e.getUniformLocation(a.program,"filterTex"),a.normalScale=e.getUniformLocation(a.program,"normalScale"),a.resolution=e.getUniformLocation(a.program,"resolution"),a}(e,t,s);return Object.keys(i).map(t=>{i[t]=e.getUniformLocation(c.program,`propertyTex${i[t]}`)}),Object.values(r).forEach(t=>{t._postShaderCompile(c.program,e)}),c.textureIds||(c.textureIds=new Map),c.textureIds.set(n,i),c._codes=s,c._template=t,c}class se extends g{constructor(e){super({message:e}),this.name="CartoParsingError"}}function oe(e){return function({x:e,y:t,z:r,a:n}){const i=ue,a=fe,s=he,o=e=>e>=.008856451679035631?Math.pow(e,.333333333333333):841/108*e+4/29;return{l:116*o(t/a)-16,a:500*(o(e/i)-o(t/a)),b:200*(o(t/a)-o(r/s)),alpha:n}}(function(e){const{r:t,g:r,b:n,a:i}=function({r:e,g:t,b:r,a:n}){const i=e=>e<=.0404482362771076?e/12.92:Math.pow((e+.055)/1.055,2.4);return{r:i(e),g:i(t),b:i(r),a:n}}(e);return{x:.41239558896741424*t+.3575834307637148*r+.18049264738170157*n,y:.21258623078559555*t+.7151703037034108*r+.07220049864333623*n,z:.019297215491746945*t+.11918386458084854*r+.9504971251315798*n,a:i}}(e))}function ce(e){return function({x:e,y:t,z:r,a:n}){const i=Te(3.2406*e-1.5372*t-.4986*r,0,1),a=Te(-.9689*e+1.8758*t+.0415*r,0,1),s=Te(.0557*e-.204*t+1.057*r,0,1);return function({r:e,g:t,b:r,a:n}){const i=e=>e<=.0031306684425005883?12.92*e:1.055*Math.pow(e,.4166666666666667)-.055;return{r:i(e),g:i(t),b:i(r),a:n}}({r:i,g:a,b:s,a:n})}(function({l:e,a:t,b:r,alpha:n}){const i=e=>e>=.20689655172413793?e*e*e:108/841*(e-4/29);return{x:ue*i((e+16)/116+t/500),y:fe*i((e+16)/116),z:he*i((e+16)/116-r/200),a:n}}(e))}const ue=.950456,fe=1,he=1.088754;function le(e,t,r){if(e.length>t)throw new b(`${_.TOO_MANY_ARGS} Expression '${r}' accepts ${t} arguments, but ${e.length} were passed.`)}function de(e){return Ce(e)?ui(e):"string"==typeof e?Ai(e):Array.isArray(e)?si(e):e}function pe(e){let t=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(e);if(t)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:1};if(t=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(e))return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:parseInt(t[4]+t[4],16)/255};if(t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e))return{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16),a:1};if(t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e))return{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16),a:parseInt(t[4],16)/255};throw new se("Invalid hexadecimal color")}function me(e){return{1:"first",2:"second",3:"third",4:"fourth"}[e]||String(e)}function ge(e,t,r){return`${e}(): invalid ${me(r+1)} parameter '${t}'`}function be(e,t,r,n){if(!(n instanceof Ae))throw new b(`${_.INCORRECT_TYPE} ${ge(e,t,r)}\n        '${n}' is not of type "carto.expressions.Base"`)}function _e(e,t,r,n,i){if(be(e,t,r,i),Array.isArray(n)){if(!n.some(e=>i.type===e))throw new b(`${_.INCORRECT_TYPE} ${ge(e,t,r)}\n            expected type was one of ${n.join()}, actual type was '${i.type}'`)}else i.type!==n&&function(e,t,r,n,i){throw new b(`${_.INCORRECT_TYPE} ${ge(e,t,r)}\n    expected type was '${n}', actual type was '${i}'`)}(e,t,r,n,i.type)}function ye(e,t,r,n,i){be(e,t,r,i),i.isA(n)||function(e,t,r,n){throw new b(`${_.INCORRECT_TYPE} ${ge(e,t,r)}\n    expected type was instance of '${n.name}'`)}(e,t,r,n)}function ve(e,t,r,n){Ce(n)||function(e,t,r,n){throw new b(`${_.INCORRECT_TYPE} ${ge(e,t,r)}\n    type of '${n}' is ${typeof n}, 'number' was expected`)}(e,t,r,n)}function xe(e,t,r,n){"string"!=typeof n&&function(e,t,r,n){throw new b(`${_.INCORRECT_TYPE} ${ge(e,t,r)}\n    expected type was 'string', but ${n}' is not a string`)}(e,t,r,n)}function we(e,t,r,n){if(n.isFeatureDependent())throw new b(`${_.INCORRECT_VALUE} ${ge(e,t,r)}\n        parameter cannot be feature dependent`)}function Te(e,t,r){return Math.min(Math.max(e,t),r)}function Ee(e,t,r){return"number"==typeof e?e*(1-r)+t*r:function(e,t,r){const n=oe({r:e.r/255,g:e.g/255,b:e.b/255,a:e.a}),i=oe({r:t.r/255,g:t.g/255,b:t.b/255,a:t.a}),a=ce({l:(1-r)*n.l+r*i.l,a:(1-r)*n.a+r*i.a,b:(1-r)*n.b+r*i.b,alpha:(1-r)*n.alpha+r*i.alpha});return{r:Math.round(255*a.r),g:Math.round(255*a.g),b:Math.round(255*a.b),a:a.a}}(e,t,r)}function Ce(e){return Number.isFinite(e)||e===1/0||e===-1/0||Number.isNaN(e)}class Ae{constructor(e){this._initializeChildren(e),this._addParentToChildren(),this.preface="",this._shaderBindings=new Map,this.expressionName=function(e){if(e.toUpperCase()===e)return e.toLowerCase();return e.charAt(0).toLowerCase()+e.slice(1)}(this.constructor.name)}eval(e){throw new N("Unimplemented")}toString(){return`${this.expressionName}(${this._getChildren().map(e=>e.toString()).join(", ")})`}isAnimated(){return this._getChildren().some(e=>e.isAnimated())}blendTo(e,t=500){e=de(e);const r=this.parent,n=Un(this,e,gn(t));return r.replaceChild(this,n),n.notify(),e}isA(e){return this instanceof e}notify(){this.parent.notify()}accumViewportAgg(e){this._getChildren().forEach(t=>t.accumViewportAgg(e))}loadImages(){return Promise.all(this._getChildren().map(e=>e.loadImages()))}_bindMetadata(e){this._getChildren().forEach(t=>t._bindMetadata(e))}_initializeChildren(e){Array.isArray(e)?this._initializeChildrenArray(e):this._initializeChildrenObject(e)}_initializeChildrenArray(e){if(this.maxParameters&&this.maxParameters<e.length)throw new b(`${_.TOO_MANY_ARGS} Extra parameters, got ${e.length} but maximum is ${this.maxParameters}`);this.childrenNames=[],e.map((e,t)=>{const r=`${e.type}-${t}`;this.childrenNames.push(r),this[r]=de(e)})}_initializeChildrenObject(e){if(this.childrenNames=Object.keys(e),this.maxParameters&&this.maxParameters<this.childrenNames.length)throw new b(`${_.TOO_MANY_ARGS} Extra parameters, got ${this.childrenNames.length} but maximum is ${this.maxParameters}`);Object.keys(e).map(t=>{this[t]=de(e[t])})}_addParentToChildren(){this._getChildren().map(e=>{e.parent=this})}_setUID(e){this._uid=e.getID(this),this._getChildren().map(t=>t._setUID(e))}_dataReady(){this._getChildren().map(e=>e._dataReady())}isFeatureDependent(){return this._getChildren().some(e=>e.isFeatureDependent())}_prefaceCode(e){return e?`\n${this._buildGLSLCode(e)}\n`:""}_buildGLSLCode(e){return`\n            #ifndef DEF_${this._uid}\n            #define DEF_${this._uid}\n            ${e}\n            #endif`}_getDependencies(){return this._getChildren().map(e=>e._getDependencies()).reduce((e,t)=>e.concat(t),[])}_resolveAliases(e){this._getChildren().map(t=>t._resolveAliases(e))}_setGenericGLSL(e,t){this.inlineMaker=e,this.preface=t||""}_applyToShaderSource(e){const t=this.childrenNames.map(t=>this[t]._applyToShaderSource(e));let r={};return t.map((e,t)=>{r[this.childrenNames[t]]=e.inline}),{preface:this._prefaceCode(t.map(e=>e.preface).reduce((e,t)=>e+t,"")+this.preface),inline:this.inlineMaker(r,e)}}_postShaderCompile(e,t){this.childrenNames.forEach(r=>this[r]._postShaderCompile(e,t))}get value(){return this.eval()}_getBinding(e){return this._shaderBindings.has(e)||this._shaderBindings.set(e,{}),this._shaderBindings.get(e)}_resetViewportAgg(e){this._getChildren().forEach(t=>t._resetViewportAgg(e))}_setTimestamp(e){this.childrenNames.forEach(t=>this[t]._setTimestamp(e))}_preDraw(...e){this.childrenNames.forEach(t=>this[t]._preDraw(...e))}replaceChild(e,t){this[this.childrenNames.find(t=>this[t]===e)]=t,t.parent=this,t.notify=e.notify}_blendFrom(e,t=500,r=null){if(this.default&&e.default)return;e=de(e);const n=this.parent,i=Un(e,this,gn(t),r);n.replaceChild(this,i),i.notify()}_getChildren(){return this.childrenNames.map(e=>this[e])}_getMinimumNeededSchema(){return this._getChildren().map(e=>e._getMinimumNeededSchema()).reduce(A,C)}}class Se extends Ae{constructor(e){if(le(arguments,1,"transition"),ve("transition","duration",0,e),e<0){const e=ge("transition","duration",0);throw new b(`${_.INCORRECT_VALUE} ${e} 'duration' must be greater than or equal to 0.`)}super({}),this.aTime=Date.now(),this.bTime=this.aTime+Number(e),this.type="number"}eval(){const e=Date.now();return this.mix=(e-this.aTime)/(this.bTime-this.aTime),Math.min(this.mix,1)}isAnimated(){return!this.mix||this.mix<=1}_applyToShaderSource(){return{preface:this._prefaceCode(`uniform float anim${this._uid};\n`),inline:`anim${this._uid}`}}_postShaderCompile(e,t){this._getBinding(e).uniformLocation=t.getUniformLocation(e,`anim${this._uid}`)}_preDraw(e,t,r){const n=Date.now();this.mix=(n-this.aTime)/(this.bTime-this.aTime),this.mix>1?r.uniform1f(this._getBinding(e).uniformLocation,1):r.uniform1f(this._getBinding(e).uniformLocation,this.mix)}}const Ie=Re("in",function(e){if(0===e.length)return()=>"0.";return t=>`((${e.map((e,r)=>`(${t.input} == ${t.list[r]})`).join(" || ")})? 1.: 0.)`},(e,t)=>t.some(t=>t===e)?1:0);const De=Re("nin",function(e){if(0===e.length)return()=>"1.";return t=>`((${e.map((e,r)=>`(${t.input} != ${t.list[r]})`).join(" && ")})? 1.: 0.)`},(e,t)=>t.some(t=>t===e)?0:1);function Re(e,t,r){return class extends Ae{constructor(r,n){le(arguments,2,e),r=de(r),n=de(n),be(e,"input",0,r),be(e,"list",1,n),super({input:r,list:n}),this.inlineMaker=t(this.list.elems),this.type="number"}eval(e){return r(this.input.eval(e),this.list.eval(e))}_bindMetadata(t){super._bindMetadata(t),_e(e,"input",0,"category",this.input),_e(e,"list",1,"category-list",this.list)}}}class Fe extends Ae{constructor(e,t,r){le(arguments,3,"between"),super({input:e=de(e),lowerLimit:t=de(t),upperLimit:r=de(r)}),this.type="number",this.inlineMaker=(e=>`((${e.input} >= ${e.lowerLimit} &&  ${e.input} <= ${e.upperLimit}) ? 1. : 0.)`)}eval(e){const t=this.input.eval(e),r=this.lowerLimit.eval(e),n=this.upperLimit.eval(e);return t>=r&&t<=n?1:0}_bindMetadata(e){super._bindMetadata(e),_e("between","input",0,"number",this.input),_e("between","lowerLimit",1,"number",this.lowerLimit),_e("between","upperLimit",2,"number",this.upperLimit)}}const Me=0,Ne=1,Oe=2,$e=4,Pe=8,Be=16,Le=Ke("mul",Ne|Oe|$e|Be,(e,t)=>e*t,(e,t)=>`(${e} * ${t})`),ke=Ke("div",Ne|Oe|$e|Be,(e,t)=>e/t,(e,t)=>`(${e} / ${t})`),Ue=Ke("add",Ne|$e|Be,(e,t)=>e+t,(e,t)=>`(${e} + ${t})`),ze=Ke("sub",Ne|$e|Be,(e,t)=>e-t,(e,t)=>`(${e} - ${t})`),Ve=Ke("mod",Ne,(e,t)=>e%t,(e,t)=>`mod(${e}, ${t})`),Ge=Ke("pow",Ne,(e,t)=>Math.pow(e,t),(e,t)=>`pow(${e}, ${t})`),qe=Ke("greaterThan",Ne,(e,t)=>e>t?1:0,(e,t)=>`(${e}>${t}? 1.:0.)`),je=Ke("greaterThanOrEqualTo",Ne,(e,t)=>e>=t?1:0,(e,t)=>`(${e}>=${t}? 1.:0.)`),We=Ke("lessThan",Ne,(e,t)=>e<t?1:0,(e,t)=>`(${e}<${t}? 1.:0.)`),Ye=Ke("lessThanOrEqualTo",Ne,(e,t)=>e<=t?1:0,(e,t)=>`(${e}<=${t}? 1.:0.)`),Xe=Ke("equals",Ne|Pe,(e,t)=>e===t?1:0,(e,t)=>`(${e}==${t}? 1.:0.)`),He=Ke("notEquals",Ne|Pe,(e,t)=>e!==t?1:0,(e,t)=>`(${e}!=${t}? 1.:0.)`),Ze=Ke("or",Ne,(e,t)=>Math.min(e+t,1),(e,t)=>`min(${e} + ${t}, 1.)`),Qe=Ke("and",Ne,(e,t)=>Math.min(e*t,1),(e,t)=>`min(${e} * ${t}, 1.)`);function Ke(e,t,r,n){return class extends Ae{constructor(t,i){if(le(arguments,2,e),Number.isFinite(t)&&Number.isFinite(i))return ui(r(t,i));const a=function(e,t){if(e.type&&t.type)return"number"===e.type&&"number"===t.type?Ne:"number"===e.type&&"color"===t.type?Oe:"color"===e.type&&"number"===t.type?Oe:"color"===e.type&&"color"===t.type?$e:"category"===e.type&&"category"===t.type?Pe:"image"===e.type&&"color"===t.type||"image"===e.type&&"color"===t.type||"image"===e.type&&"image"===t.type||"color"===e.type&&"image"===t.type?Be:Me;{if(!e.type&&!t.type)return;const r=e.type||t.type;if("color"===r)return Oe}}(t=de(t),i=de(i));super({a:t,b:i}),this.expressionName=e,this.type=Je(a),this.inlineMaker=(e=>n(e.a,e.b))}get value(){return this.eval()}eval(e){return r(this.a.eval(e),this.b.eval(e))}_bindMetadata(r){super._bindMetadata(r);const[n,i]=[this.a,this.b],a=function(e,t){return e.type&&t.type?"number"===e.type&&"number"===t.type?Ne:"number"===e.type&&"color"===t.type?Oe:"color"===e.type&&"number"===t.type?Oe:"color"===e.type&&"color"===t.type?$e:"category"===e.type&&"category"===t.type?Pe:"image"===e.type&&"color"===t.type||"image"===e.type&&"color"===t.type||"image"===e.type&&"image"===t.type||"color"===e.type&&"image"===t.type?Be:Me:void 0}(n,i);if(a===Me||!(a&t))throw new b(`${_.INCORRECT_TYPE} ${e}(): invalid parameter types\n'x' type was ${n.type}, 'y' type was ${i.type}`);this.type=Je(a)}}}function Je(e){switch(e){case Ne:return"number";case Oe:case $e:return"color";case Pe:return"number";case Be:return"image";default:return}}class et extends Ae{constructor(e,t,r,n){le(arguments,4,"blend"),e=de(e),t=de(t),r=de(r),be("blend","a",0,e),be("blend","b",1,t),be("blend","mix",2,r),e.type&&t.type&&tt(e,t);const i=r;n&&(r=n(r)),super({a:e,b:t,mix:r}),this.originalMix=i,e.type&&t.type&&(this.type=e.type),this.inlineMaker=(e=>`mix(${e.a}, ${e.b}, clamp(${e.mix}, 0., 1.))`)}eval(e){const t=Te(this.mix.eval(e),0,1);return Ee(this.a.eval(e),this.b.eval(e),t)}replaceChild(e,t){e===this.mix&&(this.originalMix=t),super.replaceChild(e,t)}_bindMetadata(e){super._bindMetadata(e),tt(this.a,this.b),_e("blend","mix",2,"number",this.mix),this.type=this.a.type}_preDraw(...e){super._preDraw(...e),this.originalMix.isA(Se)&&!this.originalMix.isAnimated()&&(this.parent.replaceChild(this,this.b),this.notify())}}function tt(e,t){if(e.type!==t.type||!["number","color","image","placement"].includes(e.type))throw new b(`${_.INCORRECT_TYPE} blend(): invalid parameter types\n\t'a' type was '${e.type}'\n\t'b' type was '${t.type}'`)}const rt="DEFAULT_RAMP_OTHERS",nt="(-1.)",it=-1,at="CARTO_VL_OTHERS",st={othersLabel:at,samples:10};class ot extends Ae{constructor(e){le(arguments,1,"category"),xe("category","categoryName",0,e),super({}),this.expr=e,this.type="category"}get value(){return this.expr}eval(){return this.expr}isAnimated(){return!1}_bindMetadata(e){this._metadata=e}_applyToShaderSource(){return{preface:this._prefaceCode(`uniform float cat${this._uid};\n`),inline:`cat${this._uid}`}}_postShaderCompile(e,t){this._getBinding(e).uniformLocation=t.getUniformLocation(e,`cat${this._uid}`)}_preDraw(e,t,r){const n=this._metadata.categoryToID.get(this.expr);r.uniform1f(this._getBinding(e).uniformLocation,n)}}var ct=r(2),ut=r.n(ct);class ft extends Ae{constructor(e){if(le(arguments,1,"property"),xe("property","name",0,e),""===e)throw new b(`${_.INCORRECT_VALUE} property(): invalid parameter, zero-length string`);super({}),this.name=e,this.expressionName=e,super._setGenericGLSL((e,t)=>t(this.name))}isFeatureDependent(){return!0}get value(){return this.eval()}eval(e){if(!e)throw new b(`${_.MISSING_REQUIRED} A property needs to be evaluated in a 'feature'.`);return e[this.name]}toString(){return`$${this.expressionName}`}get categories(){return"category"===this.type?this._metadata.properties[this.name].categories:void 0}_bindMetadata(e){const t=e.properties[this.name];if(!t)throw new b(`${_.MISSING_REQUIRED} Property '${this.name}' does not exist`);this._metadata=e,this.type=t.type,"category"!==this.type||this.numCategories||Object.defineProperty(this,"numCategories",{get:function(){return t.categories.length}})}_applyToShaderSource(e){return{preface:"",inline:e(this.name)}}_getMinimumNeededSchema(){return{[this.name]:[{type:"unaggregated"}]}}}class ht extends Ae{constructor({property:e,expressionName:t,aggName:r,aggType:n}){be(t,"property",0,e),super({property:e}),this._aggName=r,this._expressionName=t,this.type=n}get name(){return this.property.name}get aggName(){return this._aggName}get numCategories(){return this.property.numCategories}get categories(){return this.property.categories}eval(e){return e[R.aggColumn(this.property.name,this._aggName)]}_bindMetadata(e){super._bindMetadata(e),ye(this._expressionName,"property",0,ft,this.property),_e(this._expressionName,"property",0,this.type,this.property)}_resolveAliases(){}_applyToShaderSource(e){return{preface:"",inline:`${e(R.aggColumn(this.property.name,this._aggName))}`}}_postShaderCompile(){}_getMinimumNeededSchema(){return{[this.property.name]:[{type:"aggregated",op:this._aggName}]}}}class lt extends ht{constructor(e){le(arguments,1,"clusterAvg"),super({property:e,expressionName:"clusterAvg",aggName:"avg",aggType:"number"})}}class dt extends ht{constructor(e){le(arguments,1,"clusterMax"),super({property:e,expressionName:"clusterMax",aggName:"max",aggType:"number"})}}class pt extends ht{constructor(e){le(arguments,1,"clusterMin"),super({property:e,expressionName:"clusterMin",aggName:"min",aggType:"number"})}}class mt extends ht{constructor(e){le(arguments,1,"clusterMode"),super({property:e,expressionName:"clusterMode",aggName:"mode",aggType:"category"})}}class gt extends ht{constructor(e){le(arguments,1,"clusterSum"),super({property:e,expressionName:"clusterSum",aggName:"sum",aggType:"number"})}}class bt extends Ae{constructor(e){le(arguments,1,"constant"),ve("constant","x",0,e),super({}),this.expr=e,this.type="number",this.inlineMaker=(()=>`(${e.toFixed(20)})`)}toString(){return this.expr}get value(){return this.eval()}eval(){return this.expr}}class _t extends Ae{constructor(e){le(arguments,1,"hex"),xe("hex","hexadecimalColor",0,e),super({}),this.type="color";try{this.color=pe(e)}catch(e){const t=ge("hex","hexadecimalColor",0);throw new b(`${_.INCORRECT_VALUE} ${t} \nInvalid hexadecimal color string`)}this.hexadecimalColor=e,this.inlineMaker=(()=>`vec4(${(this.color.r/255).toFixed(4)}, ${(this.color.g/255).toFixed(4)}, ${(this.color.b/255).toFixed(4)}, ${this.color.a.toFixed(4)})`)}toString(){return this.hexadecimalColor}get value(){return this.eval()}eval(){return this.color}}const yt=xt("hsl",!1),vt=xt("hsla",!0);function xt(e,t){return class extends Ae{constructor(r,n,i,a){le(arguments,4,"hsla"),[r,n,i,a]=[r,n,i,a].map(de);const s={h:r,s:n,l:i};t&&(be(e,"a",3,a),s.a=a),be(e,"h",0,r),be(e,"s",1,n),be(e,"l",2,i),super(s),this.type="color"}get value(){return this.eval()}eval(e){const r=(t,r=!1)=>"category"===t.type?t.eval(e)/(r?t.numCategories+1:t.numCategories):t.eval(e);return((r,n,i)=>{const a={r:Math.abs(6*r-3)-1,g:2-Math.abs(6*r-2),b:2-Math.abs(6*r-4),a:t?this.a.eval(e):1},s=(1-Math.abs(2*i-1))*n;return a.r=Te(a.r,0,1),a.g=Te(a.g,0,1),a.b=Te(a.b,0,1),a.r=255*((a.r-.5)*s+i),a.g=255*((a.g-.5)*s+i),a.b=255*((a.b-.5)*s+i),a})(Te(r(this.h,!0),0,1),Te(r(this.s),0,1),Te(r(this.l),0,1))}_bindMetadata(e){super._bindMetadata(e),r("h",0,this.h),r("s",1,this.s),r("l",2,this.l),t&&_e("hsla","a",3,"number",this.a);const n=(e,t=!1)=>"category"===e.type?`/${t?e.numCategories+1:e.numCategories}.`:"";super._setGenericGLSL(e=>`vec4(HSLtoRGB(vec3(\n                    ${e.h}${n(this.h,!0)},\n                    clamp(${e.s}${n(this.s)}, 0., 1.),\n                    clamp(${e.l}${n(this.l)}, 0., 1.)\n                )), ${t?`clamp(${e.a}, 0., 1.)`:"1."})`,"\n    #ifndef HSL2RGB\n    #define HSL2RGB\n    vec3 HSLtoRGB(vec3 HSL) {\n      float R = abs(HSL.x * 6. - 3.) - 1.;\n      float G = 2. - abs(HSL.x * 6. - 2.);\n      float B = 2. - abs(HSL.x * 6. - 4.);\n      float C = (1. - abs(2. * HSL.z - 1.)) * HSL.y;\n      vec3 RGB = clamp(vec3(R,G,B), 0., 1.);\n      return (RGB - 0.5) * C + HSL.z;\n    }\n    #endif\n    ")}};function r(t,r,n){if(be(e,t,r,n),"number"!==n.type&&"category"!==n.type&&void 0!==n.type)throw new b(`${_.INCORRECT_TYPE} ${e}(): invalid parameter\n\t${t} type was: '${n.type}'`)}}const wt=Et("hsv",!1),Tt=Et("hsva",!0);function Et(e,t){return class extends Ae{constructor(r,n,i,a){le(arguments,t?4:3,e);const s={h:r=de(r),s:n=de(n),v:i=de(i)};t&&(a=de(a),be(e,"a",3,a),s.a=a),be(e,"h",0,r),be(e,"s",1,n),be(e,"v",2,i),super(s),this.type="color"}get value(){return this.eval()}eval(e){const r=(t,r=!1)=>"category"===t.type?t.eval(e)/(r?t.numCategories+1:t.numCategories):t.eval(e);return((r,n,i)=>{const a={r:Math.abs(6*r-3)-1,g:2-Math.abs(6*r-2),b:2-Math.abs(6*r-4),a:t?Te(this.a.eval(e),0,1):1};return a.r=Te(a.r,0,1),a.g=Te(a.g,0,1),a.b=Te(a.b,0,1),a.r=((a.r-1)*n+1)*i*255,a.g=((a.g-1)*n+1)*i*255,a.b=((a.b-1)*n+1)*i*255,a})(Te(r(this.h,!0),0,1),Te(r(this.s),0,1),Te(r(this.v),0,1))}_bindMetadata(e){super._bindMetadata(e),r("h",0,this.h),r("s",1,this.s),r("v",2,this.v),t&&_e("hsva","a",3,"number",this.a);const n=(e,t=!1)=>"category"===e.type?`/${t?e.numCategories+1:e.numCategories}.`:"";super._setGenericGLSL(e=>`vec4(HSVtoRGB(vec3(\n                    ${e.h}${n(this.h,!0)},\n                    clamp(${e.s}${n(this.s)}, 0.,1.),\n                    clamp(${e.v}${n(this.v)}, 0.,1.)\n                )), ${t?`clamp(${e.a}, 0.,1.)`:"1."})`,"\n    #ifndef HSV2RGB\n    #define HSV2RGB\n    vec3 HSVtoRGB(vec3 HSV) {\n      float R = abs(HSV.x * 6. - 3.) - 1.;\n      float G = 2. - abs(HSV.x * 6. - 2.);\n      float B = 2. - abs(HSV.x * 6. - 4.);\n      vec3 RGB = clamp(vec3(R,G,B), 0., 1.);\n      return ((RGB - 1.) * HSV.y + 1.) * HSV.z;\n    }\n    #endif\n    ")}};function r(t,r,n){if(be(e,t,r,n),"number"!==n.type&&"category"!==n.type&&void 0!==n.type)throw new b(`${_.INCORRECT_TYPE} ${e}(): invalid parameter\n\t${t} type was: '${n.type}'`)}}function Ct(e,t,r,n){const i=class extends Ae{constructor(t){le(arguments,1,e),super({m:t=de(t)})}eval(e){return n(this.m.eval(e))}_bindMetadata(e){if(super._bindMetadata(e),"number"!==this.m.type)throw new b(`${_.INCORRECT_TYPE} Blending cannot be performed by '${this.m.type}'`);this.type="number",this._setGenericGLSL(e=>t(e.m),r)}};return i.type="interpolator",i}class At extends Ae{constructor(e,t,r){le(arguments,3,"linear"),e=de(e),void 0===t&&void 0===r&&(t=Ji(e),r=Ki(e)),t=de(t),r=de(r),be("linear","input",0,e),be("linear","min",1,t),be("linear","max",2,r),super({input:e,min:t,max:r}),this.type="number"}eval(e){if("date"===this.input.type){const t=this.input.eval(e),r=this.min.eval().getTime(),n=this.max.eval().getTime(),i=this._metadata,a=i.properties[this.input.name].min.getTime(),s=i.properties[this.input.name].max.getTime()-a,o=(r-a)/s;return(t-o)/((n-a)/s-o)}const t=this.input.eval(e),r=this.min.eval(e);return(t-r)/(this.max.eval(e)-r)}_bindMetadata(e){if(super._bindMetadata(e),"date"===this.input.type){const t=this.min.eval().getTime(),r=this.max.eval().getTime();this._metadata=e;const n=e.properties[this.input.name].min.getTime(),i=e.properties[this.input.name].max.getTime()-n,a=(t-n)/i,s=(r-n)/i;this.inlineMaker=(e=>`((${e.input}-(${a.toFixed(20)}))/(${(s-a).toFixed(20)}))`)}else _e("linear","input",0,"number",this.input),_e("linear","min",1,"number",this.min),_e("linear","max",2,"number",this.max),this.inlineMaker=(e=>`((${e.input}-${e.min})/(${e.max}-${e.min}))`)}getLegendData(e){const t=this.min.eval(),r=this.max.eval(),n=1/(e.samples-1),i=this.toString(),a=[];for(let i=0;a.length<e.samples;i+=n){const e=Te(i,0,1),n=i*(r-t)+t;a.push({key:n,value:e})}return{data:a,min:t,max:r,name:i}}}const St=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","transparent","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];class It extends Ae{constructor(e){if(le(arguments,1,"namedColor"),xe("namedColor","colorName",0,e),!St.includes(e.toLowerCase())){const t=ge("namedColor","colorName",0);throw new b(`${_.INCORRECT_VALUE} ${t}\nInvalid color name:  '${e}'`)}super({}),this.type="color",this.name=e,this.expressionName=e,this.color=function(e){if(Dt[e])return Dt[e];const t=document.createElement("div");t.style.backgroundColor=e,document.body.appendChild(t);const r=getComputedStyle(t).backgroundColor;document.body.removeChild(t);const n=/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/.exec(r),i={r:Number(n[1]),g:Number(n[2]),b:Number(n[3]),a:n[4]||1};return Dt[e]=i,i}(this.name),this.inlineMaker=(()=>`vec4(${(this.color.r/255).toFixed(4)}, ${(this.color.g/255).toFixed(4)}, ${(this.color.b/255).toFixed(4)}, ${1..toFixed(4)})`)}get value(){return this.eval()}eval(){return this.color}toString(){return this.expressionName}}const Dt={};class Rt extends Ae{constructor(e){le(arguments,1,"number"),ve("number","x",0,e),super({}),this.expr=e,this.type="number"}get value(){return this.eval()}eval(){return this.expr}toString(){return`${this.expr}`}isAnimated(){return!1}_applyToShaderSource(){return{preface:this._prefaceCode(`uniform float number${this._uid};`),inline:`number${this._uid}`}}_postShaderCompile(e,t){this._getBinding(e).uniformLocation=t.getUniformLocation(e,`number${this._uid}`)}_preDraw(e,t,r){r.uniform1f(this._getBinding(e).uniformLocation,this.expr)}}class Ft extends Ae{constructor(e){le(arguments,1,"asc"),super({}),ye("asc","by",0,Nt,e),this.type="orderer"}}class Mt extends Ae{constructor(e){le(arguments,1,"desc"),super({}),ye("desc","by",0,Nt,e),this.type="orderer"}}class Nt extends Ae{constructor(){le(arguments,1,"width"),super({}),this.type="propertyReference"}}var Ot=r(5);const $t=Bt("rgb",!1),Pt=Bt("rgba",!0);function Bt(e,t){return class extends Ae{constructor(r,n,i,a){le(arguments,4,"rgba"),[r,n,i,a]=[r,n,i,a].map(de),be(e,"r",0,r),be(e,"g",1,n),be(e,"b",2,i);const s={r:r,g:n,b:i};t&&(be(e,"a",3,a),s.a=a),super(s),this.type="color",this.inlineMaker=(e=>`vec4(${e.r}/255., ${e.g}/255., ${e.b}/255., ${t?e.a:"1."})`)}get value(){return this.eval()}eval(e){return{r:this.r.eval(e),g:this.g.eval(e),b:this.b.eval(e),a:t?this.a.eval(e):1}}_bindMetadata(r){super._bindMetadata(r),_e(e,"r",0,"number",this.r),_e(e,"g",1,"number",this.g),_e(e,"b",2,"number",this.b),t&&_e("rgba","a",3,"number",this.a)}}}const Lt=2;class kt extends Ae{constructor(e,t){super({}),this.type="palette",this.childType="color",this.name=e,this.subPalettes=new Proxy(t,{get:(e,t)=>{if("symbol"!=typeof t&&Number.isSafeInteger(Number(t))&&Array.isArray(e[t]))return e[t].map(pe)}}),this.expressionName=e,this.tags=t.tags}getColors(e){const t=this._getBestSubPalette(e);if(this.isQualitative()){return{colors:t,othersColor:t.pop()}}return{colors:t,othersColor:null}}toString(){return this.expressionName}_getBestSubPalette(e){e=e<=Lt?Lt:e;const t=this.getLongestSubPalette();return(e<t.length?[...this.subPalettes[e]]:[...t]).map(e=>new Pt(Hn(e.r),Hn(e.g),Hn(e.b),Hn(e.a)))}getLongestSubPalette(){const e=this.subPalettes;for(let t=20;t>=0;t--)if(e[t])return e[t]}isQualitative(){return this.tags.includes("qualitative")}isQuantitative(){return this.tags.includes("quantitative")}}const Ut={};Object.keys(Ot).map(e=>{Ut[`${e.toUpperCase()}`]=new kt(e,Ot[e])});var zt=Ut;class Vt extends kt{constructor(e){super(e.name,e.subPalettes),this.type="palette",this._originalPalette=e,this.tags=e.tags,this.subPalettes=new Proxy(e.subPalettes,{get:(e,t)=>Number.isFinite(Number(t))&&Array.isArray(e[t])?this._reversePalette(e[t]):e[t]})}getLongestSubPalette(){return this._reversePalette(this._originalPalette.getLongestSubPalette())}_reversePalette(e){if(this.isQualitative()){const t=[...e],r=t.pop();return[...t.reverse(),r]}return[...e].reverse()}}class Gt extends Ae{constructor(e){if(super({array:e}),be("reverseList","array",0,e),this.array.elems){const e=this.array.elems[0].type;this.type=`${e}-list`}}_bindMetadata(e){this.array._bindMetadata(e),_e("reverse","array",0,["palette","number-list","category-list","color-list","time-list","image-list"],this.array),this.type=this.array.type,this.childType=this.array.childType,super._bindMetadata(e)}get elems(){return[...this.array.elems].reverse()}get value(){return this.elems.map(e=>e.value)}eval(e){return this.elems.map(t=>t.eval(e))}}let qt=0;class jt extends Ae{constructor(e,t){if(t<=1)throw new RangeError(`The number of 'buckets' must be >=2, but ${t} was used.`);const r=function(e,t){const r=[];for(let n=0;n<t-1;n++)e[`arg${n}`]=ui(0),r.push(e[`arg${n}`]);return r}(e,t);super(e),this.classifierUID=qt++,this.numCategories=t,this.numCategoriesWithoutOthers=t,this.breakpoints=r,this.type="category"}toString(){return`${this.expressionName}(${this.input.toString()}, ${this.numCategories})`}eval(e){const t=this.input.eval(e),r=this.breakpoints.findIndex(e=>t<=e.expr),n=this.numCategories-1||1;return-1===r?1:r/n}getBreakpointList(){return this._genBreakpoints(),this.breakpoints.map(e=>e.expr)}_genBreakpoints(){}_applyToShaderSource(e){const t=this.childrenNames.map(t=>this[t]._applyToShaderSource(e));let r={};t.map((e,t)=>{r[this.childrenNames[t]]=e.inline});const n=`classifier${this.classifierUID}`,i=this.numCategories-1||1,a=`float ${n}(float x){\n            ${this.breakpoints.map((e,t)=>`${t>0?"else":""} if (x<(${r[`arg${t}`]})){\n                return ${(t/i).toFixed(20)};\n            }`).join("")}\n            return 1.;\n        }`;return{preface:this._prefaceCode(t.map(e=>e.preface).reduce((e,t)=>e+t,"")+a),inline:`${n}(${r.input})`}}_preDraw(e,t,r){this._genBreakpoints(),super._preDraw(e,t,r)}getLegendData(){const e=this.getBreakpointList(),t=e.length,r=this.toString(),n=[];for(let r=0;r<=t;r++){const i=[e[r-1]||Number.NEGATIVE_INFINITY,e[r]||Number.POSITIVE_INFINITY],a=r/t;n.push({key:i,value:a})}return{name:r,data:n}}}const Wt=e=>{let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t/e.length},Yt=e=>{const t=Wt(e),r=Wt(((e,t)=>{let r=[];for(let n=0;n<e.length;n++){const i=e[n]-t;r.push(i*i)}return r})(e,t));return Math.sqrt(r)};function Xt(e,t,r,n){let i,a=[],s=[];let o=r%2==0?0:1;do{const r=o*(t*n);a.push(e+r),s.push(e-r),(i=[...new Set(a.concat(s))]).sort((e,t)=>e-t),o++}while(i.length<r-1);return i}var Ht=r(7),Zt=r.n(Ht),Qt=r(8),Kt=r.n(Qt),Jt=r(9),er=r.n(Jt),tr=r(10),rr=r.n(tr),nr=r(11),ir=r.n(nr),ar=r(12),sr=r.n(ar),or=r(13),cr=r.n(or),ur=r(14),fr=r.n(ur),hr=r(15),lr=r.n(hr),dr=r(16),pr=r.n(dr),mr=r(17),gr=r.n(mr),br=r(18),_r=r.n(br),yr=r(19),vr=r.n(yr),xr=r(20),wr=r.n(xr),Tr=r(21),Er=r.n(Tr),Cr=r(22),Ar=r.n(Cr),Sr=r(23),Ir=r.n(Sr),Dr=r(24),Rr=r.n(Dr),Fr={bicycle:Zt.a,building:Kt.a,bus:er.a,car:rr.a,circle:ir.a,circleOutline:sr.a,cross:cr.a,house:fr.a,flag:lr.a,marker:pr.a,markerOutline:gr.a,plus:_r.a,square:vr.a,squareOutline:wr.a,star:Er.a,starOutline:Ar.a,triangle:Ir.a,triangleOutline:Rr.a};const Mr=256;class Nr extends Ae{constructor(e){le(arguments,1,"categoryIndex"),be("categoryIndex","property",0,e=de(e)),super({property:e}),this._numTranslatedCategories=null,this.type="category",this._translatePixels=new Float32Array(Mr*Mr),this._translateArray=[],this._numTranslatedCategories=0,this._numTranslatedCategoriesGL=0}get numCategories(){return this._metadata.properties[this.property.name].categories.length}get numCategoriesWithoutOthers(){return this.numCategories}_bindMetadata(e){super._bindMetadata(e),_e("categoryIndex","property",0,"category",this.property),this._metadata=e,this._calcTranslated()}eval(e){const t=this.property.eval(e),r=this._metadata.categoryToID.get(t);return this._translateArray[r]}_preDraw(e,t,r){r.activeTexture(r.TEXTURE0+t.freeTexUnit),this._numTranslatedCategoriesGL!==this.numCategories?(this._numTranslatedCategoriesGL=this.numCategories,this._calcTranslated(),this._translateTexture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this._translateTexture),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,Mr,Mr,0,r.ALPHA,r.FLOAT,this._translatePixels),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)):r.bindTexture(r.TEXTURE_2D,this._translateTexture),r.uniform1i(this._getBinding(e).texRampTranslateLoc,t.freeTexUnit),t.freeTexUnit++}_applyToShaderSource(e){const t=Mr.toFixed(20),r=this.property._applyToShaderSource(e);return{inline:`ramp_translate${this._uid}(${r.inline})`,preface:`\n                    uniform sampler2D texRampTranslate${this._uid};\n                    float ramp_translate${this._uid}(float s){\n                        vec2 v = vec2(mod(s, ${t}), floor(s / ${t}));\n                        return texture2D(texRampTranslate${this._uid}, v/${t}).a;\n                    }`}}_postShaderCompile(e,t){this._getBinding(e).texRampTranslateLoc=t.getUniformLocation(e,`texRampTranslate${this._uid}`)}_calcTranslated(){const e=this._metadata.properties[this.property.name],t=this.numCategories;if(this._numTranslatedCategories!==t){this._numTranslatedCategories=t;for(let r=0;r<t;r++){const n=this._metadata.categoryToID.get(e.categories[r].name),i=r/(t-1),a={x:n%Mr,y:Math.floor(n/Mr)};this._translatePixels[Mr*a.y+a.x]=i,this._translateArray.push(i)}}}getLegendData(){const e=this._metadata.properties[this.property.name].categories,t=e.length,r=t-1,n=[];for(let i=0;i<t;i++){const t=e[i].name,a=i/r;n.push({key:t,value:a})}return{data:n}}}class Or extends Ae{_bindMetadata(e){super._bindMetadata(e),this.numImages=this.elems.length,this._getChildren().forEach((e,t)=>_e("imageArray",`imageArray[${t}]`,0,"image",e))}eval(e){return this.elems.map(t=>t.eval(e))}_applyToShaderSource(){return{preface:this._prefaceCode(`\n                uniform sampler2D atlas${this._uid};\n\n                vec4 atlas${this._uid}Fn(vec2 imageUV, float category) {\n                    return texture2D(atlas${this._uid}, imageUV/16. + vec2(mod(category, 16.), floor(category/16.))/16. ).rgba;\n                }\n            `),inline:`atlas${this._uid}Fn`}}_postShaderCompile(e,t){this._getBinding(e).texLoc=t.getUniformLocation(e,`atlas${this._uid}`)}_preDraw(e,t,r){this.init=!0;for(let e=0;e<this.numImages;e++){const t=this[`image-${e}`];this.init=this.init&&t.canvas}if(this.init&&!this.texture){const e=4096,n=256;r.activeTexture(r.TEXTURE0+t.freeTexUnit),this.texture=r.createTexture(),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.bindTexture(r.TEXTURE_2D,this.texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,e,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);let i=0,a=0;for(let t=0;t<this.numImages;t++){const s=this[`image-${t}`];r.texSubImage2D(r.TEXTURE_2D,0,i,a,r.RGBA,r.UNSIGNED_BYTE,s.canvas),(i+=n)+n>e&&(i=0,a+=n)}r.generateMipmap(r.TEXTURE_2D)}this.texture&&(r.activeTexture(r.TEXTURE0+t.freeTexUnit),r.bindTexture(r.TEXTURE_2D,this.texture),r.uniform1i(this._getBinding(e).texLoc,t.freeTexUnit),t.freeTexUnit++)}}class $r extends Ae{constructor(e){le(arguments,1,"image"),xe("image","url",0,e),super({}),this.type="image",this.canvas=null,this.url=e,this._promise=new Promise((e,t)=>{this.image=new window.Image,this.image.onload=(()=>{this.canvas=function(e){const t=document.createElement("canvas");t.width=256,t.height=256;const r=t.getContext("2d"),n=Math.max(e.width,e.height),i=e.width/n*256,a=e.height/n*256;return r.drawImage(e,1+(256-i)/2,1+(256-a)/2,i-2,a-2),t}(this.image),this.image=null,e()}),this.image.onerror=t,this.image.crossOrigin="anonymous",this.image.src=this.url})}loadImages(){return this.count=this.count+1||1,this._promise}eval(){return this.url}_free(e){this.texture&&e.deleteTexture(this.texture)}_applyToShaderSource(){return{preface:this._prefaceCode(`uniform sampler2D texSprite${this._uid};`),inline:`texture2D(texSprite${this._uid}, imageUV).rgba`}}_postShaderCompile(e,t){this._getBinding(e)._texLoc=t.getUniformLocation(e,`texSprite${this._uid}`)}_preDraw(e,t,r){!this.init&&this.canvas&&(this.init=!0,r.activeTexture(r.TEXTURE0+t.freeTexUnit),this.texture=r.createTexture(),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.bindTexture(r.TEXTURE_2D,this.texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,this.canvas),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.generateMipmap(r.TEXTURE_2D),this.canvas=null),this.texture&&(r.activeTexture(r.TEXTURE0+t.freeTexUnit),r.bindTexture(r.TEXTURE_2D,this.texture),r.uniform1i(this._getBinding(e)._texLoc,t.freeTexUnit),t.freeTexUnit++)}}class Pr extends $r{constructor(e){le(arguments,1,"svg"),super(`data:image/svg+xml,${encodeURIComponent(e)}`)}}const Br=new Pr(Fr.circle);class Lr extends Ae{_bindMetadata(e){Ae.prototype._bindMetadata.call(this,e),this.type=this.palette.childType,_e("ramp","input",0,"category",this.input),ye("ramp","palette",1,Or,this.palette),this.others===rt?this.others=Br:_e("ramp","others",2,"image",this.others),this.input.isA(ft)&&(this.input=new Nr(this.input),this.input._bindMetadata(e)),this.others._bindMetadata(e),this.childrenNames.push("others")}eval(e){const t=this.input.eval(e);return this._calcEval(t)}_calcEval(e){const t=Math.round(e*(this.input.numCategoriesWithoutOthers-1));return this.palette.eval()[t]||this.others.eval()}getLegend(e){const t=Object.assign({},st,e),r=this.input.type,n=this.input.getLegendData(t),i=n.data.map(({key:e,value:t})=>({key:e,value:t=this._calcEval(t)}));return{type:r,...n,data:i}}_applyToShaderSource(e){const t=this.input._applyToShaderSource(e),r=this.palette._applyToShaderSource(e),n=this.others._applyToShaderSource(e);return{preface:this._prefaceCode(`\n                uniform float rampImageMultiplier${this._uid};\n\n                ${t.preface}\n                ${r.preface}\n                ${n.preface}\n\n                vec4 rampImage${this._uid}(vec2 imageUV, float index){\n                    if (index == ${nt}){\n                        return ${n.inline};\n                    }\n                    return ${r.inline}(imageUV, rampImageMultiplier${this._uid}*index);\n                }\n            `),inline:`rampImage${this._uid}(imageUV, ${t.inline})`}}_postShaderCompile(e,t){super._postShaderCompile(e,t),this._getBinding(e)._multiplierLoc=t.getUniformLocation(e,`rampImageMultiplier${this._uid}`)}_preDraw(e,t,r){super._preDraw(e,t,r),r.uniform1f(this._getBinding(e)._multiplierLoc,this.input.numCategoriesWithoutOthers-1)}}class kr extends Ae{_bindMetadata(e){const t=new bt(1),r=new It("gray");super._bindMetadata(e),this.type=this.palette.childType,this.others===rt?this.others="number-list"===this.palette.type?t:r:_e("ramp","others",2,this.palette.childType,this.others),this.input.isA(ft)&&(this.input="number"===this.input.type?new At(this.input):new Nr(this.input),this.input._bindMetadata(e)),_e("ramp","input",0,["number","category"],this.input),this.others._bindMetadata(e),this.childrenNames.push("others"),this._metadata=e}eval(e){const t=this.input.eval(e);return this._calcEval(t,e)}_calcEval(e,t){const{palette:r,others:n}=this._getPalette(),i=this.palette.isA(kt)?r.map(e=>e.eval(t)):this.palette.eval(t);if(e===it)return n.eval(t);const a=i.length-1,s=Math.floor(e*a),o=Math.ceil(e*a),c=function(e){return e-Math.floor(e)}(e*a);return Ee(i[s],i[o],c)}getLegend(e){const t=Object.assign({},st,e),r=this.input.type,n=this.input.getLegendData(t),i=n.data.map(({key:e,value:t})=>({key:e,value:t=this._calcEval(t,void 0)}));return{type:r,...n,data:i}}_applyToShaderSource(e){const t=this.input._applyToShaderSource(e),{palette:r,others:n}=this._getPalette(),i=r.map(t=>t._applyToShaderSource(e)),a=n._applyToShaderSource(e),s="number-list"===this.palette.type?function(e){return Ur(e.map(e=>e.inline))}(i):function(e){return`cielabToSRGBA(${Ur(e.map(e=>`sRGBAToCieLAB(${e.inline})`))})`}(i),o="number-list"===this.palette.type?"float":"vec4",c=`ramp_color${this._uid}(${t.inline})`;return{preface:this._prefaceCode(`\n            ${t.preface}\n            ${ut.a}\n            ${i.map(e=>e.preface).join("\n")}\n            ${a.preface}\n\n            ${o} ramp_color${this._uid}(float x){\n                return x==${nt}\n                    ? ${a.inline}\n                    : ${s};\n            }`),inline:c}}_getPalette(){return this.palette.isA(kt)?this._getColorPalette():{palette:this.palette.elems,others:this.others}}_getColorPalette(){const e=this.palette.getColors(this.input.numCategoriesWithoutOthers);return{palette:e.colors,others:this._defaultOthers&&e.othersColor?e.othersColor:this.others}}}function Ur(e,t=0){const r=e[t];return t===e.length-1?r:function(e,t,r,n){const i=(r/(n-1)).toFixed(20),a=(1/(n-1)).toFixed(20);return`mix(${e}, ${t}, ${`clamp((x - ${i})/${a}, 0., 1.)`})`}(r,Ur(e,t+1),t,e.length)}class zr extends Ae{get value(){return this.elems.map(e=>e.value)}eval(e){return this.elems.map(t=>t.eval(e))}_applyToShaderSource(e){const t=this.elems.map(t=>t._applyToShaderSource(e));return{preface:t.map(e=>e.preface).join("\n"),inline:t.map(e=>e.inline)}}}class Vr extends Ae{_bindMetadata(e){super._bindMetadata(e),this._getChildren().forEach((e,t)=>_e("ListTransformation",`ListTransformation[${t}]`,0,"transformation",e)),this.type="transformation"}eval(e){return this.elems.map(t=>t.eval(e))}_applyToShaderSource(e){const t=this.elems.map(t=>t._applyToShaderSource(e));return{preface:this._prefaceCode(`\n                ${t.map(e=>e.preface).join("\n")}\n\n                vec2 listTransform${this._uid}(vec2 p) {\n                    ${t.map(e=>`p = ${e.inline}(p);`).join("\n")}\n                    return p;\n                }\n            `),inline:`listTransform${this._uid}`}}}const Gr=["number","category","color","time","image","transformation"];class qr extends Ae{constructor(e){le(arguments,1,"time"),super({}),this.type="time",this.date=d(e),this.inlineMaker=(()=>void 0)}get value(){return this.eval()}eval(){return this.date}isAnimated(){return!1}}const jr=16;const Wr=.15,Yr=void 0;class Xr extends Ae{constructor(e=Yr,t=Yr){le(arguments,2,"fade");let r=de(e===Yr?Wr:e),n=t===Yr?r:de(t);be("fade","param1",0,r),be("fade","param2",1,n),super({fadeIn:r,fadeOut:n}),this.type="fade",this.inlineMaker=(e=>({in:e.fadeIn,out:e.fadeOut}))}_bindMetadata(e){super._bindMetadata(e),_e("fade","param1",0,"number",this.fadeIn),_e("fade","param2",1,"number",this.fadeOut)}}let Hr=new Set,Zr=new Set;const Qr=un("log",e=>Math.log(e),e=>`log(${e})`),Kr=un("sqrt",e=>Math.sqrt(e),e=>`sqrt(${e})`),Jr=un("sin",e=>Math.sin(e),e=>`sin(${e})`),en=un("cos",e=>Math.cos(e),e=>`cos(${e})`),tn=un("tan",e=>Math.tan(e),e=>`tan(${e})`),rn=un("sign",e=>Math.sign(e),e=>`sign(${e})`),nn=un("abs",e=>Math.abs(e),e=>`abs(${e})`),an=un("isNaN",e=>Number.isNaN(e)?1:0,e=>`((${e} <= 0.0 || 0.0 <= ${e}) ? 0. : 1.)`),sn=un("not",e=>1-e,e=>`(1.0 - ${e})`),on=un("floor",e=>Math.floor(e),e=>`floor(${e})`),cn=un("ceil",e=>Math.ceil(e),e=>`ceil(${e})`);function un(e,t,r){return class extends Ae{constructor(t){le(arguments,1,e),super({a:t=de(t)}),this.type="number",this.expressionName=e,this.inlineMaker=(e=>r(e.a))}get value(){return this.eval()}eval(e){return t(this.a.eval(e))}_bindMetadata(t){if(super._bindMetadata(t),_e(e,"x",0,"number",this.a),"number"!==this.a.type)throw new b(`${_.INCORRECT_TYPE} Unary operation cannot be performed to '${this.a.type}'`)}}}class fn extends Ae{constructor(){super({})}}class hn extends Ae{constructor({property:e}){super({property:de(e),_impostor:ui(0)}),this._isViewport=!0,this.type="number",this.inlineMaker=(e=>e._impostor)}isFeatureDependent(){return!1}_bindMetadata(e){super._bindMetadata(e)}_getMinimumNeededSchema(){return this.property._getMinimumNeededSchema()}_preDraw(...e){this._impostor.expr=this.eval(),super._preDraw(...e)}}function ln(e,t){return t.y-e.y==0?e.x.localeCompare(t.x):t.y-e.y}class dn extends Ae{constructor({property:e,name:t,type:r}){super({_value:ui(0)}),this.property=de(e),this._name=t,this.type=r,super.inlineMaker=(e=>e._value)}isFeatureDependent(){return!1}get value(){return this._value.expr}eval(){return this._value.expr}_bindMetadata(e){if(super._bindMetadata(e),this.property._bindMetadata(e),void 0===e.properties[this.property.name][this._name])throw new b(`${_.MISSING_REQUIRED} Metadata ${this._name} for property ${this.property.name} is not defined`);this._value.expr=e.properties[this.property.name][this._name]}_getMinimumNeededSchema(){return{[this.property.name]:[]}}}class pn extends Ae{constructor(e,t){le(arguments,2,"placement"),super({x:e=de(e),y:t=de(t)}),this.inlineMaker=(e=>`vec2(${e.x}, ${e.y})`),this.type="placement"}eval(e){return[this.x.eval(e),this.y.eval(e)]}_bindMetadata(e){super._bindMetadata(e),_e("placement","x",0,"number",this.x),_e("placement","y",1,"number",this.y)}}class mn extends Ae{constructor(e,t){le(arguments,2,"translate"),super({x:e=de(e),y:t=de(t)}),this.type="transformation"}_applyToShaderSource(e){const t=this.x._applyToShaderSource(e),r=this.y._applyToShaderSource(e);return{preface:this._prefaceCode(`\n                ${t.preface}\n                ${r.preface}\n\n                vec2 translate${this._uid}(vec2 p){\n                    return p+vec2(${t.inline}, ${r.inline});\n                }`),inline:`translate${this._uid}`}}eval(e){return[this.x.eval(e),this.y.eval(e)]}_bindMetadata(e){super._bindMetadata(e),_e("translate","x",0,"number",this.x),_e("translate","y",1,"number",this.y)}}const gn=(...e)=>new Se(...e),bn=(...e)=>new Ie(...e),_n=(...e)=>new De(...e),yn=(...e)=>new Fe(...e),vn=(...e)=>new Le(...e),xn=(...e)=>new ke(...e),wn=(...e)=>new Ue(...e),Tn=(...e)=>new ze(...e),En=(...e)=>new Ge(...e),Cn=(...e)=>new Ve(...e),An=(...e)=>new qe(...e),Sn=(...e)=>new je(...e),In=(...e)=>new We(...e),Dn=(...e)=>new Ye(...e),Rn=(...e)=>new Xe(...e),Fn=(...e)=>new He(...e),Mn=(...e)=>new Qe(...e),Nn=(...e)=>new Ze(...e),On=An,$n=Sn,Pn=In,Bn=Dn,Ln=Rn,kn=Fn,Un=(...e)=>new et(...e),zn=(...e)=>new class extends Ae{constructor(e,t){le(arguments,2,"buckets"),super({input:e=de(e),list:t=de(t)}),this.numCategories=null,this.numCategoriesWithoutOthers=null,this.type="category"}eval(e){const t=this.input.eval(e),r=this.numCategoriesWithoutOthers-1||1;if("category"===this.input.type){for(let n=0;n<this.list.elems.length;n++)if(t===this.list.elems[n].eval(e))return n/r;return it}for(let n=0;n<this.list.elems.length;n++)if(t<this.list.elems[n].eval(e))return n/r;return 1}_bindMetadata(e){if(super._bindMetadata(e),"number"!==this.input.type&&"category"!==this.input.type)throw new b(`${_.INCORRECT_TYPE} buckets(): invalid first parameter type\n\t'input' type was ${this.input.type}`);_e("buckets","list",1,["number-list","category-list"],this.list),this.list.elems.map((e,t)=>{if(this.input.type!==e.type)throw new b(`${_.INCORRECT_TYPE} buckets(): invalid ${me(t+1)} parameter type`+`\n\texpected type was ${this.input.type}\n\tactual type was ${e.type}`);if("number"!==e.type&&"category"!==e.type)throw new b(`${_.INCORRECT_TYPE} buckets(): invalid ${me(t+1)} parameter type\n\ttype was ${e.type}`)}),this.numCategories=this.list.elems.length+1,this.numCategoriesWithoutOthers="category"===this.input.type?this.numCategories-1:this.numCategories}_applyToShaderSource(e){let t={};this.childrenNames.map(t=>this[t]._applyToShaderSource(e)).map((e,r)=>{t[this.childrenNames[r]]=e});const r=`buckets${this._uid}`,n="category"===this.input.type?"==":"<",i=this.numCategoriesWithoutOthers-1||1,a=`float ${r}(float x){\n            ${this.list.elems.map((e,r)=>`${r>0?"else":""} if (x${n}(${t.list.inline[r]})){\n                return ${r}./${i.toFixed(20)};\n            }`).join("")}\n            return ${"category"===this.input.type?nt:(this.numCategories-1).toFixed(20)};\n        }`;return{preface:this._prefaceCode(t.input.preface+t.list.preface+a),inline:`${r}(${t.input.inline})`}}getLegendData(e){const t=this.toString(),r=this.list.elems.map(e=>e.eval());return{data:"number"===this.input.type?function(e){const t=[];for(let r=0;r<=e.length;r++){const n=r-1>=0?e[r-1]:Number.NEGATIVE_INFINITY,i=r<e.length?e[r]:Number.POSITIVE_INFINITY,a=[n,i],s=r/e.length;t.push({key:a,value:s})}return t}(r):function(e,t){const r=e.length-1,n=e.map((e,t)=>{const n=e,i=t/r;return{key:n,value:i}});return n.push({key:t.othersLabel,value:it}),n}(r,e),name:t}}}(...e),Vn=(...e)=>new class extends Ae{constructor(e,t,r){le(arguments,3,"cielab"),e=de(e),t=de(t),r=de(r),be("cielab","l",0,e),be("cielab","a",1,t),be("cielab","b",2,r),super({l:e,a:t,b:r}),this.type="color",this._setGenericGLSL(e=>`cielabToSRGBA(vec4(${e.l}, ${e.a}, ${e.b}, 1.))`,ut.a)}_bindMetadata(e){super._bindMetadata(e),_e("cielab","l",0,"number",this.l),_e("cielab","a",1,"number",this.a),_e("cielab","b",2,"number",this.b)}}(...e),Gn=(...e)=>new lt(...e),qn=(...e)=>new dt(...e),jn=(...e)=>new pt(...e),Wn=(...e)=>new mt(...e),Yn=(...e)=>new gt(...e),Xn=(...e)=>new class extends Ae{constructor(){le(arguments,0,"clusterCount"),super({}),this.type="number",this._hasClusterFeatureCount=!1}eval(e){return Number(e[D])||1}_bindMetadata(e){super._bindMetadata(e),this._hasClusterFeatureCount=void 0!==e.properties[D]}_applyToShaderSource(e){return{preface:"",inline:this._hasClusterFeatureCount?e(D):"1."}}}(...e),Hn=(...e)=>new bt(...e),Zn=(...e)=>new $r(...e),Qn=(...e)=>new Pr(...e),Kn=(...e)=>new _t(...e),Jn=(...e)=>new yt(...e),ei=(...e)=>new vt(...e),ti=(...e)=>new wt(...e),ri=(...e)=>new Tt(...e),ni=(...e)=>new class extends(Ct("cubic",e=>`cubicEaseInOut(${e})`,"\n    #ifndef CUBIC\n    #define CUBIC\n    float cubicEaseInOut(float p){\n        if (p < 0.5) {\n            return 4. * p * p * p;\n        }else {\n            float f = ((2. * p) - 2.);\n            return 0.5 * f * f * f + 1.;\n        }\n    }\n    #endif\n",e=>e)){}(...e),ii=(...e)=>new class extends(Ct("iLinear",e=>e,void 0,e=>e)){}(...e),ai=(...e)=>new At(...e),si=(...e)=>new class extends Ae{constructor(e){if(le(arguments,1,"list"),!e)throw new b(`${_.MISSING_REQUIRED} list(): invalid parameters: must receive at least one argument.`);if(Array.isArray(e)||(e=[e]),!(e=e.map(de)).length)throw new b(`${_.MISSING_REQUIRED} list(): invalid parameters: must receive at least one argument.`);e.map((e,t)=>{be("list",`item[${t}]`,t,e)}),super(e),this.elems=e}_bindMetadata(e){if(super._bindMetadata(e),this._setTypes(),-1===Gr.indexOf(this.childType))throw new b(`${_.INCORRECT_TYPE} list(): invalid parameters type: ${this.childType}.`);switch(this.elems.map((e,t)=>{if(be("list",`item[${t}]`,t,e),e.type!==this.childType)throw new b(`${_.INCORRECT_TYPE} list(): invalid ${me(t+1)} parameter type, invalid argument type combination.`)}),this.elems[0].type){case"image":Object.setPrototypeOf(this,Or.prototype);break;case"transformation":Object.setPrototypeOf(this,Vr.prototype);break;default:Object.setPrototypeOf(this,zr.prototype)}return this._bindMetadata(e)}_setTypes(){this.childType=this.elems[0].type,this.type=`${this.childType}-list`}}(...e),oi=(...e)=>new It(...e),ci=(...e)=>new class extends Ae{constructor(){le(arguments,0,"now"),super({now:ui(0)}),this.type="number",super.inlineMaker=(e=>e.now)}get value(){return this.eval()}eval(){return this.now.expr}isAnimated(){return!0}_setTimestamp(e){this.now.expr=e}}(...e),ui=(...e)=>new Rt(...e),fi=(...e)=>new class extends Ae{constructor(e,t){le(arguments,2,"opacity"),Number.isFinite(t)&&(t=ui(t)),be("opacity","color",0,e),be("opacity","alpha",1,t),super({color:e,alpha:t}),this.type="color",this.inlineMaker=(e=>`vec4((${e.color}).rgb, ${e.alpha})`)}get value(){return this.eval()}eval(e){const t=this.color.eval(e),r=this.alpha.eval(e);return t.a=r,t}_bindMetadata(e){super._bindMetadata(e),_e("opacity","color",0,"color",this.color),_e("opacity","alpha",1,"number",this.alpha)}}(...e),hi=(...e)=>new Ft(...e),li=(...e)=>new Mt(...e),di=(...e)=>new class extends Ae{constructor(){le(arguments,0,"noOrder"),super({}),this.type="orderer"}}(...e),pi=(...e)=>new Nt(...e),mi=function(e){return le(arguments,1,"reverse"),"palette"===(e=de(e)).type?new Vt(e):new Gt(e)},gi=(...e)=>new ft(...e),bi=(...e)=>new class extends jt{constructor(e,t){le(arguments,2,"globalQuantiles"),ye("globalQuantiles","input",0,ft,e&&(e.property||e)),ve("globalQuantiles","buckets",1,t),super({input:e},t)}_bindMetadata(e){super._bindMetadata(e),be("globalQuantiles","input",0,this.input),_e("globalQuantiles","input",0,"number",this.input);const t=e.sample.map(e=>e[this.input.name]);t.sort((e,t)=>e-t),this.breakpoints.map((e,r)=>{const n=(r+1)/this.numCategories;e.expr=t[Math.floor(n*t.length)]})}}(...e),_i=(...e)=>new class extends jt{constructor(e,t){le(arguments,2,"viewportQuantiles"),ve("viewportQuantiles","buckets",1,t),super({input:e,_histogram:Hi(e)},t)}_bindMetadata(e){super._bindMetadata(e),_e("viewportQuantiles","input",0,["number"],this.input)}_genBreakpoints(){const e=this._histogram.value,t=e.length,r=e[0].x[0],n=e[t-1].x[1];let i=0;const a=e.map(({y:e})=>i+=e);let s=0;const o=a[t-1];let c=[];this.breakpoints.map((e,i)=>{for(;s<t&&!(a[s]>(i+1)/this.numCategories*o);s++);const u=s/t*(n-r)+r;c.push(u),e.expr=u})}}(...e),yi=(...e)=>new class extends jt{constructor(e,t){le(arguments,2,"globalEqIntervals"),ye("globalEqIntervals","input",0,ft,e&&(e.property||e)),ve("globalEqIntervals","buckets",1,t),super({input:e},t)}_bindMetadata(e){super._bindMetadata(e),be("globalEqIntervals","input",0,this.input),_e("globalEqIntervals","input",0,"number",this.input);const{min:t,max:r}=e.properties[this.input.name];this.min=t,this.max=r,this.breakpoints.map((e,n)=>{const i=(n+1)/this.numCategories;e.expr=t+(r-t)*i})}}(...e),vi=(...e)=>new class extends jt{constructor(e,t){le(arguments,2,"viewportEqIntervals"),ve("viewportEqIntervals","buckets",1,t),super({input:e,_min:ji(e),_max:qi(e)},t)}_bindMetadata(e){super._bindMetadata(e),_e("viewportEqIntervals","input",0,["number"],this.input)}_genBreakpoints(){const e=this._min.eval(),t=this._max.eval();this.breakpoints.map((r,n)=>{const i=(n+1)/this.numCategories;r.expr=e+(t-e)*i})}}(...e),xi=(...e)=>new class extends jt{constructor(e,t,r=1){if(le(arguments,3,"globalStandardDev"),ye("globalStandardDev","input",0,ft,e&&(e.property||e)),ve("globalStandardDev","buckets",1,t),ve("globalStandardDev","classSize",2,r),r<=0)throw new RangeError(`The 'classSize must be > 0.0, but '${r}' was used.`);super({input:e},t),this._classSize=r,this._sample=[]}_bindMetadata(e){super._bindMetadata(e),be("globalStandardDev","input",0,this.input),_e("globalStandardDev","input",0,"number",this.input);const t=e.sample.map(e=>e[this.input.name]),r=Xt(Wt(t),Yt(t),this.numCategories,this._classSize);this.breakpoints.forEach((e,t)=>{e.expr=r[t]})}}(...e),wi=(...e)=>new class extends jt{constructor(e,t,r=1){if(le(arguments,3,"viewportStandardDev"),ve("viewportStandardDev","buckets",1,t),ve("viewportStandardDev","classSize",2,r),r<=0)throw new RangeError(`The 'classSize' must be > 0.0, but '${r}' was used.`);super({input:e,_histogram:Hi(e)},t),this._classSize=r}_bindMetadata(e){super._bindMetadata(e),_e("viewportStandardDev","input",0,["number"],this.input)}_genBreakpoints(){const e=this._averageFrom(this._histogram.value),t=Xt(e,this._standardDevFrom(this._histogram.value,e),this.numCategories,this._classSize);this.breakpoints.forEach((e,r)=>{e.expr=t[r]})}_averageFrom(e){let t=0,r=0;return e.forEach(({x:e,y:n})=>{t+=n;const i=(e[0]+e[1])/2;r+=i*n}),r/t}_standardDevFrom(e,t){let r=0,n=0;e.forEach(({x:e,y:i})=>{r+=i;const a=(e[0]+e[1])/2-t;n+=i*a*a});const i=n/r;return Math.sqrt(i)}}(...e),Ti=(...e)=>new class extends Ae{constructor(e,t,r=rt){le(arguments,3,"ramp"),e=de(e),t=de(t),be("ramp","input",0,e),be("ramp","palette",1,t),r!==rt&&be("ramp","others",2,r),super({input:e,palette:t}),this.palette=t,this.others=r,this._defaultOthers=r===rt}_bindMetadata(e){switch(super._bindMetadata(e),this.palette.type){case"image-list":Object.setPrototypeOf(this,Lr.prototype);break;default:Object.setPrototypeOf(this,kr.prototype)}return this._bindMetadata(e)}}(...e),Ei=(...e)=>new $t(...e),Ci=(...e)=>new Pt(...e),Ai=(...e)=>new ot(...e),Si=(...e)=>new qr(...e),Ii=(...e)=>new class extends Ae{constructor(e,t){le(arguments,2,"top"),t=de(t),ye("top","property",0,ft,e);const r={property:e,buckets:t};for(let e=0;e<jr;e++)r[`_top${e}`]=ui(0);super(r),this.type="category"}eval(e){const t=[...this._metadata.properties[this.property.name].categories].sort((e,t)=>t.frequency-e.frequency),r=this.property.eval(e),n=t.findIndex(e=>e.name===r),i=this.numCategoriesWithoutOthers-1||1;return n>=this.numBuckets||-1===n?it:n/i}_bindMetadata(e){super._bindMetadata(e),_e("top","property",0,"category",this.property),we("top","buckets",1,this.buckets),_e("top","buckets",1,"number",this.buckets),this._metadata=e,this._textureBuckets=null}get numCategories(){return this.numBuckets+1}get numCategoriesWithoutOthers(){return this.numCategories-1}get numBuckets(){let e=Math.round(this.buckets.eval());if(e>this.property.numCategories&&(e=this.property.numCategories),e>jr){const t=this.buckets.eval();setTimeout(()=>{throw new b(`${_.INCORRECT_VALUE} top() function has a limit of ${jr} buckets but '${t}' buckets were specified.`)}),e=0}return e}_applyToShaderSource(e){const t={};return this.childrenNames.forEach(r=>{t[r]=this[r]._applyToShaderSource(e)}),{preface:this._prefaceCode(Object.values(t).map(e=>e.preface).join("")+`\n            uniform float numCategoriesWithoutOthers${this._uid};\n\n            float top${this._uid}(float id){\n                float r;\n                if (${t._top0.inline} == id){\n                    r = 0.;\n                } else if (${t._top1.inline} == id){\n                    r = 1.;\n                } else if (${t._top2.inline} == id){\n                    r = 2.;\n                } else if (${t._top3.inline} == id){\n                    r = 3.;\n                } else if (${t._top4.inline} == id){\n                    r = 4.;\n                } else if (${t._top5.inline} == id){\n                    r = 5.;\n                } else if (${t._top6.inline} == id){\n                    r = 6.;\n                } else if (${t._top7.inline} == id){\n                    r = 7.;\n                } else if (${t._top8.inline} == id){\n                    r = 8.;\n                } else if (${t._top9.inline} == id){\n                    r = 9.;\n                } else if (${t._top10.inline} == id){\n                    r = 10.;\n                } else if (${t._top11.inline} == id){\n                    r = 11.;\n                } else if (${t._top12.inline} == id){\n                    r = 12.;\n                } else if (${t._top13.inline} == id){\n                    r = 13.;\n                } else if (${t._top14.inline} == id){\n                    r = 14.;\n                } else if (${t._top15.inline} == id){\n                    r = 15.;\n                }else{\n                    return ${nt};\n                }\n                return r/(numCategoriesWithoutOthers${this._uid}-1.);\n            }`),inline:`top${this._uid}(${t.property.inline})`}}_postShaderCompile(e,t){this._numCategoriesLoc=t.getUniformLocation(e,`numCategoriesWithoutOthers${this._uid}`),super._postShaderCompile(e,t)}_preDraw(e,t,r){const n=this.numBuckets,i=[...this._metadata.properties[this.property.name].categories].sort((e,t)=>t.frequency-e.frequency);for(let e=0;e<jr;e++)this[`_top${e}`].expr=Number.POSITIVE_INFINITY;i.forEach((e,t)=>{t<n&&(this[`_top${t}`].expr=this._metadata.categoryToID.get(e.name))}),r.uniform1f(this._numCategoriesLoc,this.numCategoriesWithoutOthers),super._preDraw(e,t,r)}getLegendData(){const e=[...this._metadata.properties[this.property.name].categories].sort((e,t)=>t.frequency-e.frequency),t=this.numBuckets,r=[],n=this.toString(),i=this.numCategoriesWithoutOthers-1||1;return e.forEach((e,n)=>{if(n<t){const t=e.name,a=n/i;r.push({key:t,value:a})}}),r.push({key:at,value:it}),{name:n,data:r}}}(...e),Di=(...e)=>new Xr(...e),Ri=(...e)=>new class extends Ae{constructor(e,t=10,r=new Xr){le(arguments,3,"animation"),t=de(t);const n=e=de(e);e.isA(ft)&&(e=ai(e,Ji(e),Ki(e))),super({_input:e,progress:ui(0),fade:r,duration:t}),this.type="number",this._originalInput=n,this._paused=!1,this.preface="\n        #ifndef ANIMATION\n        #define ANIMATION\n\n        float animation(float _input, float progress, float duration, float fadeIn, float fadeOut){\n            float x = 0.;\n\n            // Check for NaN\n            if (_input <= 0.0 || 0.0 <= _input){\n                x = 1. - clamp(abs(_input - progress) * duration / (_input > progress ? fadeIn: fadeOut), 0., 1.);\n            }\n\n            return x;\n        }\n\n        #endif\n    ",this.inlineMaker=(e=>`animation(${e._input}, ${e.progress}, ${e.duration}, ${e.fade.in}, ${e.fade.out})`)}isAnimated(){return!this.paused}_dataReady(){if(Hr.has(this)&&(Hr.delete(this),Zr.add(this)),Zr.has(this)){if((Hr=new Set([...Hr].filter(e=>{for(;e.parent;)e=e.parent;return!!e._getRootExpressions}))).size>0)return;[...Zr.values()].map(e=>{"default"===e._paused&&e.play()}),Zr.clear()}}_postShaderCompile(e,t){Hr.add(this),this._paused||(this._paused="default"),super._postShaderCompile(e,t)}_setTimestamp(e){if(super._setTimestamp(e),this._paused&&void 0===this._lastTime)return;let t=0;const r=1/this.duration.value;void 0!==this._lastTime&&(t=e-this._lastTime),this._lastTime=e,this._paused||(this.progress.expr=(this.progress.expr+r*t)%1)}eval(e){const t=this._input.eval(e);if(Number.isNaN(t))return 0;const r=this.progress.value,n=this.duration.value,i=this.fade.fadeIn.eval(e),a=this.fade.fadeOut.eval(e);return 1-Te(Math.abs(t-r)*n/(t>r?i:a),0,1)}getProgressValue(){const e=this.progress.eval(),t=this._input.min.eval(),r=this._input.max.eval();if(!(t instanceof Date))return e*(r-t)+t;const n=t.getTime(),i=r.getTime();return new Date((1-e)*n+i*e)}setTimestamp(e){const t=d(e),r=this._input.min.eval(),n=this._input.max.eval();if(t.getTime()<r)throw new RangeError("animation.setTimestamp requires the date parameter to be higher than the lower limit");if(t.getTime()>n)throw new RangeError("animation.setTimestamp requires the date parameter to be lower than the higher limit");this.progress.expr=(t.getTime()-r)/(n-r)}getProgressPct(){return this.progress.value}setProgressPct(e){if((e=Number.parseFloat(e))<0||e>1)throw new TypeError(`animation.setProgressPct requires a number between 0 and 1 as parameter but got: ${e}`);this.progress.expr=e}pause(){this._paused=!0}play(){this._paused=!1}stop(){this.progress.expr=0,this._paused=!0}_bindMetadata(e){this._originalInput._bindMetadata(e),this.duration._bindMetadata(e),_e("animation","input",0,["number","date"],this._originalInput),_e("animation","duration",1,"number",this.duration),super._bindMetadata(e),_e("animation","input",0,"number",this._input),_e("animation","fade",2,"fade",this.fade),we("animation","duration",1,this.duration)}}(...e),Fi=(...e)=>new Qr(...e),Mi=(...e)=>new Kr(...e),Ni=(...e)=>new Jr(...e),Oi=(...e)=>new en(...e),$i=(...e)=>new tn(...e),Pi=(...e)=>new rn(...e),Bi=(...e)=>new nn(...e),Li=(...e)=>new an(...e),ki=(...e)=>new sn(...e),Ui=(...e)=>new on(...e),zi=(...e)=>new cn(...e),Vi=(...e)=>(function(e){if(le(arguments,1,"variable"),xe("variable","name",0,e),""===e)throw new b(`${_.INCORRECT_VALUE} variable(): invalid parameter, zero-length string`);let t;const r=r=>{if(!r[e])throw new b(`${_.MISSING_REQUIRED} variable() with name '${e}' doesn't exist`);t=r[e]},n=()=>[t];let i={set:(e,r,n)=>{if("parent"===r)e[r]=n;else if("notify"===r)e[r]=n;else{if(!t||!t[r])return!1;t[r]=n}return!0},get:(e,i)=>"parent"===i?e[i]:"_resolveAliases"===i?r:"_getDependencies"===i?n:"notify"===i?e[i]:"blendTo"===i?e[i]:t&&t[i]?function(e){return e&&"[object Function]"==={}.toString.call(e)}(t[i])?t[i].bind(t):t[i]:e[i]};return new Proxy(new fn,i)})(...e),Gi=(...e)=>new class extends hn{constructor(e){le(arguments,1,"viewportAvg"),super({property:e}),this._sum=0,this._count=0}get value(){return this._sum/this._count}eval(){return this.value}accumViewportAgg(e){const t=this.property.eval(e);Number.isNaN(t)||(this._count++,this._sum+=t)}_resetViewportAgg(){this._sum=0,this._count=0}}(...e),qi=(...e)=>new class extends hn{constructor(e){le(arguments,1,"viewportMax"),super({property:e}),this._value=Number.NEGATIVE_INFINITY}get value(){return this._value}eval(){return this.value}accumViewportAgg(e){const t=this.property.eval(e);Number.isNaN(t)||(this._value=Math.max(this._value,t))}_resetViewportAgg(){this._value=Number.NEGATIVE_INFINITY}}(...e),ji=(...e)=>new class extends hn{constructor(e){le(arguments,1,"viewportMin"),super({property:e}),this._value=Number.POSITIVE_INFINITY}get value(){return this._value}eval(){return this.value}accumViewportAgg(e){const t=this.property.eval(e);Number.isNaN(t)||(this._value=Math.min(this._value,t))}_resetViewportAgg(){this._value=Number.POSITIVE_INFINITY}}(...e),Wi=(...e)=>new class extends hn{constructor(e){le(arguments,1,"viewportSum"),super({property:e}),this._value=0}get value(){return this._value}eval(){return this.value}accumViewportAgg(e){const t=this.property.eval(e);Number.isNaN(t)||(this._value=this._value+t)}_resetViewportAgg(){this._value=0}}(...e),Yi=(...e)=>new class extends hn{constructor(){le(arguments,1,"viewportCount"),super({property:ui(0)}),this._value=0}get value(){return this._value}eval(){return this.value}accumViewportAgg(){this._value++}_resetViewportAgg(){this._value=0}}(...e),Xi=(...e)=>new class extends hn{constructor(e,t){le(arguments,2,"viewportPercentile"),super({property:e,_impostor:ui(0)}),this._isViewport=!0,this.percentile=de(t),this.type="number",super.inlineMaker=(e=>e.impostor)}get value(){return this.eval()}eval(e){if(null===this._value){const t=Te(function(e,t){return Math.floor(e/100*t)}(this.percentile.eval(e),this._array.length),0,this._array.length-1);this._array.sort((e,t)=>e-t),this._value=this._array[t]}return this._value}_getMinimumNeededSchema(){return this.property._getMinimumNeededSchema()}_resetViewportAgg(){this._value=null,this._array=[]}accumViewportAgg(e){const t=this.property.eval(e);this._array.push(t)}_preDraw(...e){this.impostor.expr=this.eval(),super._preDraw(...e)}}(...e),Hi=(...e)=>new class extends Ae{constructor(e,t=1,r=1e3){le(arguments,3,"viewportHistogram"),super({x:de(e),weight:de(t)}),this.type="histogram",this._size=r,this._isViewport=!0,this.inlineMaker=(()=>null)}accumViewportAgg(e){const t=this.x.eval(e);if(void 0!==t){const r=this.weight.eval(e),n=this._histogram.get(t)||0;this._histogram.set(t,n+r)}}get value(){return null===this._cached?this._histogram?(this._cached="number"===this.x.type?function(e,t){const r=[...e],n=r.length;let i=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;for(let e=0;e<n;e++){const t=r[e][0];i=Math.min(i,t),a=Math.max(a,t)}const s=Array(t).fill(0),o=a-i,c=t-1;for(let e=0;e<n;e++){const n=r[e][0],a=r[e][1],u=Math.min(Math.floor(t*(n-i)/o),c);s[u]+=a}return s.map((e,r)=>({x:[i+r/t*o,i+(r+1)/t*o],y:e}))}(this._histogram,this._size):function(e){return[...e].map(([e,t])=>({x:e,y:t})).sort(ln)}(this._histogram),this._cached):null:this._cached}eval(){return this.value}_bindMetadata(e){super._bindMetadata(e),this._metadata=e}_resetViewportAgg(e){e&&this._bindMetadata(e),this._cached=null,this._histogram=new Map}}(...e),Zi=(...e)=>new class extends Ae{constructor(...e){super(function(e){let t=0;const r={};return e.forEach(e=>{r["p"+ ++t]=e}),r}(e=e.map(e=>de(e)))),this.expr=[],this.type="featureList",this._isViewport=!0,this._requiredProperties=e,this._FeatureProxy=null}_applyToShaderSource(){throw new N("'viewportFeatures' cannot be used in visualizations.")}isFeatureDependent(){return!1}get value(){return this.expr}eval(){return this.expr}_resetViewportAgg(){if(!this._FeatureProxy){if(!this._requiredProperties.every(e=>e.isA(ft)))throw new b(`${_.INCORRECT_TYPE} viewportFeatures arguments can only be properties`);const e=Object.keys(F.simplify(this._getMinimumNeededSchema()));this._FeatureProxy=this.genViewportFeatureClass(e)}this.expr=[]}accumViewportAgg(e){this.expr.push(new this._FeatureProxy(e))}genViewportFeatureClass(e){const t=class{constructor(e){this._feature=e}};return e.forEach(e=>{Object.defineProperty(t.prototype,e,{get:function(){return this._feature[e]}})}),t}}(...e),Qi=(...e)=>new class extends dn{constructor(e){le(arguments,1,"globalAvg"),super({property:e,name:"avg",type:"number"})}}(...e),Ki=(...e)=>new class extends dn{constructor(e){le(arguments,1,"globalMax"),super({property:e,name:"max",type:"number"})}}(...e),Ji=(...e)=>new class extends dn{constructor(e){le(arguments,1,"globalMin"),super({property:e,name:"min",type:"number"})}}(...e),ea=(...e)=>new class extends dn{constructor(e){le(arguments,1,"globalSum"),super({property:e,name:"sum"})}}(...e),ta=(...e)=>new class extends dn{constructor(e){le(arguments,1,"globalCount"),super({property:e,name:"count",type:"number"})}}(...e),ra=(...e)=>new class extends Ae{constructor(e,t){if(le(arguments,2,"globalPercentile"),!Number.isFinite(t))throw new b(`${_.INCORRECT_TYPE} 'percentile' must be a fixed literal number`);super({_value:ui(0)}),this.property=e,this.percentile=t}isFeatureDependent(){return!1}get value(){return this._value.expr}_bindMetadata(e){super._bindMetadata(e),this.property._bindMetadata(e),this.type="number",super.inlineMaker=(e=>e._value);const t=e.sample.map(e=>e[this.property.name]);t.sort((e,t)=>e-t);const r=this.percentile/100;this._value.expr=t[Math.floor(r*t.length)]}_getMinimumNeededSchema(){return this.property._getMinimumNeededSchema()}}(...e),na=(...e)=>new class extends Ae{constructor(){le(arguments,0,"zoom"),super({zoom:ui(0)}),this.type="number",super.inlineMaker=(e=>e.zoom)}eval(){return this.zoom.expr}_preDraw(e,t,r){this.zoom.expr=t.zoomLevel,this.zoom._preDraw(e,t,r)}}(...e),ia=(...e)=>new class extends Ae{constructor(e,t=0){e=de(e),t=de(t),super({scale:xn(vn(e,0),En(2,t))}),this.type="number",this.inlineMaker=(e=>e.scale)}eval(){return this.scale.eval()}_bindMetadata(e){_e("scaled","width",0,"number",this.scale.a.a),_e("scaled","zoomlevel",1,"number",this.scale.b),super._bindMetadata(e)}_preDraw(e,t,r){this.scale.a.b.expr=Math.pow(2,t.zoomLevel),super._preDraw(e,t,r)}}(...e),aa=(...e)=>new class extends Ae{constructor(e){e=de(e),super({}),be("zoomrange","zoomBreakpointList",0,e),this.zoomBreakpointList=e,this.type="number",this.inlineMaker=(e=>e._impostor)}_bindMetadata(e){if(this.zoomBreakpointList._bindMetadata(e),_e("zoomrange","zoomBreakpointList",0,"number-list",this.zoomBreakpointList),this.zoomBreakpointList.elems.length<2)throw new b(`${_.INCORRECT_VALUE} zoomrange() function must receive a list with at least two elements.`);const t=[...this.zoomBreakpointList.elems];this._impostor=function e(t,r,n){if(1===t.length)return 1;const i=t[0],a=t[1];return t.shift(),Un(r/n,e(t,r+1,n),ai(En(2,na()),En(2,i),En(2,a)))}(t,0,t.length-1),this.childrenNames.push("_impostor"),super._bindMetadata(e)}eval(e){return this._impostor.eval(e)}}(...e),sa=(...e)=>new pn(...e),oa=(...e)=>new mn(...e),ca=(...e)=>new class extends Ae{constructor(e){le(arguments,1,"rotate"),super({angle:e=de(e)}),this.type="transformation"}_applyToShaderSource(e){const t=this.angle._applyToShaderSource(e);return{preface:this._prefaceCode(`\n                ${t.preface}\n\n                #ifndef DEGREES_TO_RADIANS\n                #define DEGREES_TO_RADIANS\n                float degreesToRadians(float degrees){\n                    return degrees/360.*2.*3.14159265359;\n                }\n                #endif\n                \n                vec2 rotate${this._uid}(vec2 p){\n                    float angle = degreesToRadians(${t.inline});\n                    mat2 M = mat2(cos(angle), -sin(angle),\n                                  sin(angle),  cos(angle));\n                    return M * p;\n                }`),inline:`rotate${this._uid}`}}eval(e){return[0,0]}_bindMetadata(e){super._bindMetadata(e),_e("rotate","angle",0,"number",this.angle)}}(...e),ua=(...e)=>new class extends Ae{constructor(e,t){le(arguments,2,"alphaNormalize"),be("alphaNormalize","input",0,e),be("alphaNormalize","normalizer",1,t),super({_impostor:fi(e,xn(t,Ki(t)))}),this._input=e,this._normalizer=t,this.type="color",this.inlineMaker=(e=>e._impostor)}_bindMetadata(e){this._input._bindMetadata(e),this._normalizer._bindMetadata(e),_e("alphaNormalize","input",0,"color",this._input),_e("alphaNormalize","normalizer",1,"number",this._normalizer),ye("alphaNormalize","normalizer",1,ft,this._normalizer),super._bindMetadata(e)}get value(){return this.eval()}eval(e){return this._impostor.eval(e)}}(...e),fa=new bt(Number.MAX_SAFE_INTEGER),ha=new bt(1),la=new bt(0),da=new bt(Math.PI),pa=new bt(Math.E),ma=new Pr(Fr.bicycle),ga=new Pr(Fr.building),ba=new Pr(Fr.bus),_a=new Pr(Fr.car),ya=new Pr(Fr.circle),va=new Pr(Fr.circleOutline),xa=new Pr(Fr.cross),wa=new Pr(Fr.flag),Ta=new Pr(Fr.house),Ea=new Pr(Fr.marker),Ca=new Pr(Fr.markerOutline),Aa=new Pr(Fr.plus),Sa=new Pr(Fr.square),Ia=new Pr(Fr.squareOutline),Da=new Pr(Fr.star),Ra=new Pr(Fr.starOutline),Fa=new Pr(Fr.triangle),Ma=new Pr(Fr.triangleOutline),Na=new pn(Hn(0),Hn(0)),Oa=new pn(Hn(0),Hn(1));var $a=r(0),Pa=r.n($a);const Ba=[],La={};Object.keys(a).filter(e=>e[0]===e[0].toLowerCase()).map(e=>{La[e.toLocaleLowerCase()]=a[e]}),La.true=ha,La.false=la,La.align_center=Na,La.align_bottom=Oa,La.pi=da,La.e=pa,La.hold=fa,La.bicycle=ma,La.building=ga,La.bus=ba,La.car=_a,La.circle=ya,La.circle_outline=va,La.cross=xa,La.flag=wa,La.house=Ta,La.marker=Ea,La.marker_outline=Ca,La.plus=Aa,La.square=Sa,La.square_outline=Ia,La.star=Da,La.star_outline=Ra,La.triangle=Fa,La.triangle_outline=Ma;const ka=Ae.prototype.blendTo;function Ua(e){Ga();const t=de(Va(Pa()(e)));return qa(),t}function za(e,t){if(":"!==t.operator)throw new se("Invalid syntax.");t.left.name.length&&"@"===t.left.name[0]&&(t.left.name="__cartovl_variable_"+t.left.name.substr(1));let r=t.left.name;if(!r)throw new se("Invalid syntax.");if(r.startsWith("__cartovl_variable_")){if((r=t.left.name.substr("__cartovl_variable_".length))in e.variables)throw new se(`Variable '${r}' is already defined.`);e.variables[r]=de(Va(t.right))}else{if(r in e)throw new se(`Property '${r}' is already defined.`);const n=Va(t.right);e[r]="resolution"===r?n:de(n)}}function Va(e){if("CallExpression"===e.type)return function(e){const t=e.callee.name.toLowerCase();if(Ba.includes(t))return e.arguments.map(e=>Va(e))[0];const r=e.arguments.map(e=>Va(e));if(La[t])return La[t](...r);throw new se(`Invalid function name '${e.callee.name}'.`)}(e);if("Literal"===e.type)return e.value;if("ArrayExpression"===e.type)return e.elements.map(e=>Va(e));if("BinaryExpression"===e.type)return function(e){const t=Va(e.left),r=Va(e.right);switch(e.operator.toLowerCase()){case"*":return vn(t,r);case"/":return xn(t,r);case"+":return wn(t,r);case"-":return Tn(t,r);case"%":return Cn(t,r);case"^":return En(t,r);case">":return An(t,r);case">=":return Sn(t,r);case"<":return In(t,r);case"<=":return Dn(t,r);case"==":return Rn(t,r);case"!=":return Fn(t,r);case"and":return Mn(t,r);case"or":return Nn(t,r);case"in":return bn(t,r);case"nin":return _n(t,r);default:throw new se(`Invalid binary operator '${e.operator}'.`)}}(e);if("UnaryExpression"===e.type)return function(e){switch(e.operator){case"-":return vn(-1,Va(e.argument));case"+":return Va(e.argument);default:throw new se(`Invalid unary operator '${e.operator}'.`)}}(e);if("Identifier"===e.type)return function(e){if(e.name.length&&"@"===e.name[0]&&(e.name="__cartovl_variable_"+e.name.substr(1)),e.name.startsWith("__cartovl_variable_"))return Vi(e.name.substr("__cartovl_variable_".length));if("#"===e.name[0])return new _t(e.name);if("$"===e.name[0])return gi(e.name.substring(1));if(zt[e.name.toUpperCase()])return zt[e.name.toUpperCase()];if(La[e.name.toLowerCase()])return La[e.name.toLowerCase()];if(St.includes(e.name.toLowerCase()))return new It(e.name.toLowerCase());throw new se(`Invalid expression '${JSON.stringify(e)}'.`)}(e);throw new se(`Invalid expression '${JSON.stringify(e)}'.`)}function Ga(){Pa.a.addBinaryOp(":",0),Pa.a.addBinaryOp("^",11),Pa.a.addBinaryOp("or",1),Pa.a.addBinaryOp("OR",1),Pa.a.addBinaryOp("and",2),Pa.a.addBinaryOp("AND",2),Pa.a.addBinaryOp("in",13),Pa.a.addBinaryOp("IN",1),Pa.a.addBinaryOp("nin",13),Pa.a.addBinaryOp("NIN",13),Pa.a.addIdentifierChar("@"),Pa.a.addIdentifierChar("#"),Pa.a.removeLiteral("true"),Pa.a.removeLiteral("false")}function qa(){Pa.a.removeBinaryOp("in"),Pa.a.removeBinaryOp("IN"),Pa.a.removeBinaryOp("nin"),Pa.a.removeBinaryOp("NIN"),Pa.a.removeBinaryOp("and"),Pa.a.removeBinaryOp("AND"),Pa.a.removeBinaryOp("or"),Pa.a.removeBinaryOp("OR"),Pa.a.removeBinaryOp("^"),Pa.a.removeBinaryOp(":"),Pa.a.removeIdentifierChar("@"),Pa.a.removeIdentifierChar("#"),Pa.a.addLiteral("true"),Pa.a.addLiteral("false")}Ae.prototype.blendTo=function(e,...t){return"string"==typeof e&&(e=Ua(e)),ka.bind(this)(e,...t)};var ja=r(33),Wa=r.n(ja),Ya=r(34),Xa=r.n(Ya),Ha=r(35),Za=r.n(Ha),Qa=r(36),Ka=r.n(Qa),Ja=r(37),es=r.n(Ja),ts=r(38),rs=r.n(ts);const ns=()=>bs(Ei(0,0,0)),is=()=>bs(ui(1)),as=()=>bs(Ei(0,0,0)),ss=()=>bs(ui(0)),os=()=>bs(di()),cs=()=>bs(Hn(1)),us=()=>bs(new Pr(Fr.circle)),fs=()=>bs(new pn(Hn(0),Hn(1))),hs=()=>bs(new mn(Hn(0),Hn(0))),ls=()=>1,ds=0,ps=256,ms=["color","width","strokeColor","strokeWidth","order","filter","symbol","symbolPlacement","transform","resolution","variables"];class gs{constructor(e){const t=this._getVizDefinition(e);this._checkVizSpec(t),Object.keys(t).forEach(e=>{this._defineProperty(e,t[e])}),Object.keys(t).includes("variables")||this._defineProperty("variables",{}),this.updated=!0,this._changeCallback=null,this._updateRootExpressionList(),this._updateRootExpressions(),this._resolveAliases(),this._validateAliasDAG()}get geometryType(){return this._geomType}loadImages(){return Promise.all(this._getRootExpressions().map(e=>e.loadImages()))}_defineProperty(e,t){if(!ms.includes(e))return;Object.defineProperty(this,e,{get:()=>this["_"+e],set:t=>{"resolution"!==e&&(t=de(t)),this["_"+e]=t,this._changed()}});let r=t;if("variables"===e){let e=!1;r=new Proxy({},{get:(e,t)=>e[t],set:(t,r,n)=>(n=de(n),t[r]=n,this["__cartovl_variable_"+r]=n,e&&this._changed(),!0)}),Object.keys(t).map(e=>{r[e]=t[e]}),e=!0}this["_"+e]=r}_getRootExpressions(){return this._rootExpressions}_getRootStyleExpressions(){return this._rootStyleExpressions}_updateRootExpressions(){this._getRootExpressions().forEach(e=>{e.parent=this,e.notify=this._changed.bind(this)})}isAnimated(){return this._getRootStyleExpressions().some(e=>e.isAnimated())}onChange(e){this._changeCallback=e}_changed(){this._updateRootExpressionList(),this._resolveAliases(),this._validateAliasDAG(),this._changeCallback&&this._changeCallback(this)}_updateRootExpressionList(){this._rootExpressions=[this.color,this.width,this.strokeColor,this.strokeWidth,this.order,this.filter,this.symbol,this.symbolPlacement,this.transform,...Object.values(this.variables)],this._rootStyleExpressions=[this.color,this.width,this.strokeColor,this.strokeWidth,this.order,this.filter,this.symbol,this.symbolPlacement,this.transform]}getMinimumNeededSchema(){return this._getRootExpressions().filter(e=>e&&e._getMinimumNeededSchema).map(e=>e._getMinimumNeededSchema()).reduce(F.union,F.IDENTITY)}setDefaultsIfRequired(e){if(this._geomType=e,this._appliedDefaults)return;let t=this._getDefaultGeomStyle(e);t&&(this._appliedDefaults=!0,this.color.default&&(this.color=t.COLOR_EXPRESSION()),this.width.default&&(this.width=t.WIDTH_EXPRESSION()),this.strokeColor.default&&(this.strokeColor=t.STROKE_COLOR_EXPRESSION()),this.strokeWidth.default&&(this.strokeWidth=t.STROKE_WIDTH_EXPRESSION()),this._updateRootExpressions())}_getDefaultGeomStyle(e){return"point"===e?{COLOR_EXPRESSION:()=>bs(Kn("#EE4D5A")),WIDTH_EXPRESSION:()=>bs(ui(7)),STROKE_COLOR_EXPRESSION:()=>bs(Kn("#FFF")),STROKE_WIDTH_EXPRESSION:()=>bs(ui(1))}:"line"===e?{COLOR_EXPRESSION:()=>bs(Kn("#4CC8A3")),WIDTH_EXPRESSION:()=>bs(ui(1.5)),STROKE_COLOR_EXPRESSION:()=>bs(Kn("#FFF")),STROKE_WIDTH_EXPRESSION:()=>bs(ui(1))}:"polygon"===e?{COLOR_EXPRESSION:()=>bs(Kn("#826DBA")),WIDTH_EXPRESSION:()=>bs(ui(1)),STROKE_COLOR_EXPRESSION:()=>bs(Kn("#FFF")),STROKE_WIDTH_EXPRESSION:()=>bs(ui(1))}:void 0}_resolveAliases(){this._getRootExpressions().forEach(e=>{e._resolveAliases(this.variables)})}_validateAliasDAG(){const e=new Set,t=new Set,r=n=>{if(!e.has(n)){if(t.has(n))throw new N("Viz contains a circular dependency");t.add(n),n._getDependencies().forEach(r),e.add(n)}},n=this._getRootExpressions().map(e=>e._getDependencies()).reduce((e,t)=>[...e,...t],[]);for(;n.length;)r(n.pop())}compileShaders(e,t){this._getRootExpressions().forEach(e=>e._bindMetadata(t)),function(e){const t={color:"color",strokeColor:"color",width:"number",strokeWidth:"number",order:"orderer",filter:"number",symbol:"image",symbolPlacement:"placement",transform:"transformation"};Object.keys(t).forEach(r=>{const n=e[r].type,i=t[r];if(n!==i)throw new b(`${_.INCORRECT_TYPE} Viz property '${r}': must be of type '${i}' but it was of type '${n}'`)})}(this),this.colorShader=ae(e,ne.styler.colorShaderGLSL,{color:this.color},this),this.widthShader=ae(e,ne.styler.widthShaderGLSL,{width:this.width},this),this.strokeColorShader=ae(e,ne.styler.colorShaderGLSL,{color:this.strokeColor},this),this.strokeWidthShader=ae(e,ne.styler.widthShaderGLSL,{width:this.strokeWidth},this),this.filterShader=ae(e,ne.styler.filterShaderGLSL,{filter:this.filter},this),this.symbol.default||(this.symbolShader=ae(e,ne.symbolizer.symbolShaderGLSL,{symbol:this.symbol,symbolPlacement:this.symbolPlacement,transform:this.transform},this)),this._geomType&&"point"!==this._geomType||(this.pointShader=ae(e,{vertexShader:Wa.a,fragmentShader:Xa.a},{transform:this.transform},this)),this._geomType&&"line"!==this._geomType||(this.lineShader=ae(e,{vertexShader:Za.a,fragmentShader:Ka.a},{transform:this.transform},this)),this._geomType&&"polygon"!==this._geomType||(this.polygonShader=ae(e,{vertexShader:es.a,fragmentShader:rs.a},{transform:this.transform},this))}replaceChild(e,t){if(Object.values(this.variables).includes(e)){const r=Object.keys(this.variables).find(t=>this.variables[t]===e);this.variables[r]=t,t.parent=this,t.notify=e.notify}else if(e===this.color)this.color=t,t.parent=this,t.notify=e.notify;else if(e===this.width)this.width=t,t.parent=this,t.notify=e.notify;else if(e===this.strokeColor)this.strokeColor=t,t.parent=this,t.notify=e.notify;else if(e===this.strokeWidth)this.strokeWidth=t,t.parent=this,t.notify=e.notify;else if(e===this.filter)this.filter=t,t.parent=this,t.notify=e.notify;else if(e===this.symbol)this.symbol=t,t.parent=this,t.notify=e.notify;else if(e===this.symbolPlacement)this.symbolPlacement=t,t.parent=this,t.notify=e.notify;else{if(e!==this.transform)throw new N("No child found");this.transform=t,t.parent=this,t.notify=e.notify}}_getVizDefinition(e){if(m.isUndefined(e))return this._setDefaults({});if(m.isObject(e))return this._setDefaults(e);if(m.isString(e))return this._setDefaults(function(e){Ga();const t=Pa()(function(e){const t={singleQuote:!1,doubleQuote:!1,blockComment:!1,lineComment:!1,escape:0};for(let r=0,n=(e=("_"+e+"_").split("")).length;r<n;r++)if(t.singleQuote)"\\"===e[r]?t.escape++:"'"===e[r]&&t.escape%2==0&&(t.singleQuote=!1,t.escape=0);else if(t.doubleQuote)"\\"===e[r]?t.escape++:'"'===e[r]&&t.escape%2==0&&(t.doubleQuote=!1,t.escape=0);else if(t.blockComment)"*"===e[r]&&"/"===e[r+1]&&(e[r+1]="",t.blockComment=!1),e[r]="";else if(t.lineComment)"\n"!==e[r+1]&&"\r"!==e[r+1]||(t.lineComment=!1),r+1<n&&(e[r]="");else if(t.doubleQuote='"'===e[r],t.singleQuote="'"===e[r],"/"===e[r]){if("*"===e[r+1]){e[r]="",t.blockComment=!0;continue}if("/"===e[r+1]){e[r]="",t.lineComment=!0;continue}}return e.join("").slice(1,-1)}(e));let r={variables:{}};return"Compound"===t.type?t.body.map(e=>za(r,e)):za(r,t),qa(),r}(e));throw new b(`${_.INCORRECT_VALUE} viz 'definition' should be a vizSpec object or a valid viz string.`)}_setDefaults(e){if(m.isUndefined(e.color)){const t=Ci(0,0,0,0);e.color=m.isUndefined(e.symbol)?ns():t}return m.isUndefined(e.width)&&(e.width=is()),m.isUndefined(e.strokeColor)&&(e.strokeColor=as()),m.isUndefined(e.strokeWidth)&&(e.strokeWidth=ss()),m.isUndefined(e.order)&&(e.order=os()),m.isUndefined(e.filter)&&(e.filter=cs()),m.isUndefined(e.resolution)&&(e.resolution=ls()),m.isUndefined(e.symbol)&&(e.symbol=us()),m.isUndefined(e.symbolPlacement)&&(e.symbolPlacement=fs()),m.isUndefined(e.transform)&&(e.transform=hs()),e.variables=e.variables||{},e}_checkVizSpec(e){if(e.width=de(e.width),e.strokeWidth=de(e.strokeWidth),e.symbolPlacement=de(e.symbolPlacement),e.transform=de(e.transform),e.symbol=de(e.symbol),e.filter=de(e.filter),!m.isNumber(e.resolution))throw new b(`${_.INCORRECT_TYPE} 'resolution' property must be a number.`);if(e.resolution<=ds)throw new b(`${_.INCORRECT_VALUE} 'resolution' must be greater than ${ds}.`);if(e.resolution>=ps)throw new b(`${_.INCORRECT_VALUE} 'resolution' must be less than ${ps}.`);["color","strokeColor","width","strokeWidth","order","filter","symbol","symbolPlacement","transform"].forEach(t=>{if(!(e[t]instanceof Ae))throw new b(`${_.INCORRECT_TYPE} '${t}' parameter is not a valid viz Expresion.`)});for(let t in e)-1===ms.indexOf(t)&&console.warn(`Property '${t}' is not supported`)}toString(){const e=Object.keys(this.variables).map(e=>`@${e}: ${this.variables[e].toString()}\n`);return`color: ${this.color.toString()}\n            strokeColor: ${this.strokeColor.toString()}\n            width: ${this.width.toString()}\n            strokeWidth: ${this.strokeWidth.toString()}\n            filter: ${this.filter.toString()}\n            order: ${this.order.toString()}\n            symbol: ${this.symbol.toString()}\n            symbolPlacement: ${this.symbolPlacement.toString()}\n            offset: ${this.offset.toString()}\n            ${e}`.replace(/ {4}/g,"")}}function bs(e){return e.default=!0,e}const _s=Object.freeze({VISIBLE:"visible",HIDDEN:"none"});class ys{constructor(e){if("string"==typeof(e=e||{}).container){const t=window.document.getElementById(e.container);if(!t)throw new b(`${_.MISSING_REQUIRED} Container '${e.container}' not found.`);this._container=t}this._background=e.background||"",this._layers=new Set,this._hiddenLayers=new Set,this._canvas=this._createCanvas(),this._container.appendChild(this._canvas),this._gl=this._canvas.getContext("webgl"),this._matrix=this._createMatrix(),this._resizeCanvas(this._containerDimensions())}on(e,t){"load"===e&&t&&t()}addLayer(e,t){this._layers.has(e)||this._layers.add(e),e.onAdd(this,this._gl),window.requestAnimationFrame(this._update.bind(this))}removeLayer(e){this._layers.has(e)&&this._layers.remove(e),e.onRemove(this)}getZoom(){return 0}getCenter(){return{lat:0,lng:0}}getBounds(){return{getNorthWest:()=>({lat:85,lng:-180}),getSouthWest:()=>({lat:-85.1,lng:-180})}}changeVisibility(e){switch(e.visibility){case _s.VISIBLE:this.show(e);break;case _s.HIDDEN:this.hide(e)}}hide(e){this._layers.has(e)&&(this._layers.delete(e),this._hiddenLayers.add(e))}show(e){this._hiddenLayers.has(e)&&(this._hiddenLayers.delete(e),this._layers.add(e))}_update(e){if(this.lastFrame===e)return;this.lastFrame=e,this._drawBackground(this._background);let t=!0,r=!1;this._layers.forEach(e=>{const n=e.hasDataframes(),i=e.isAnimated();(n||i)&&e.render(this._gl,this._matrix),t=t&&n,r=r||i}),t&&!r||window.requestAnimationFrame(this._update.bind(this))}_drawBackground(e){switch(e){case"black":this._gl.clearColor(0,0,0,1),this._gl.clear(this._gl.COLOR_BUFFER_BIT);break;case"red":this._gl.clearColor(1,0,0,1),this._gl.clear(this._gl.COLOR_BUFFER_BIT);break;case"green":this._gl.clearColor(0,1,0,1),this._gl.clear(this._gl.COLOR_BUFFER_BIT);break;case"blue":this._gl.clearColor(0,0,1,1),this._gl.clear(this._gl.COLOR_BUFFER_BIT)}}_createCanvas(){const e=window.document.createElement("canvas");return e.className="canvas",e.style.position="absolute",e}_containerDimensions(){let e=0,t=0;return this._container&&(e=this._container.offsetWidth||400,t=this._container.offsetHeight||300),{width:e,height:t}}_resizeCanvas(e){const t=window.devicePixelRatio||1;this._canvas.width=t*e.width,this._canvas.height=t*e.height,this._canvas.style.width=`${e.width}px`,this._canvas.style.height=`${e.height}px`}_createMatrix(){const e=new Array(16);return e[0]=-2,e[5]=-2,e[12]=1,e[13]=1,e[15]=1,e}triggerRepaint(){}}var vs=function(e){return e=e||Object.create(null),{on:function(t,r){(e[t]||(e[t]=[])).push(r)},off:function(t,r){e[t]&&e[t].splice(e[t].indexOf(r)>>>0,1)},emit:function(t,r){(e[t]||[]).slice().map(function(e){e(r)}),(e["*"]||[]).slice().map(function(e){e(t,r)})}}};class xs{}const ws=Date.now(),Ts=.5,Es=1024;class Cs{constructor(e){if(e){if(this.gl=e.getContext("webgl"),!this.gl)throw new N(`${O.WEB_GL} WebGL 1 is unsupported`);this._initGL(this.gl)}this._center={x:0,y:0},this._zoom=1,this.RTT_WIDTH=Es,this.dataframes=[]}initialize(e){this._initGL(e)}setCenter(e){this._center.x=e.x,this._center.y=e.y}setZoom(e){this._zoom=e}getBounds(){const e=this._zoom*this._getAspect(),t=this._zoom;return[this._center.x-e,this._center.y-t,this._center.x+e,this._center.y+t]}_initGL(e){if(this.gl=e,!e.getExtension("OES_texture_float"))throw new N(`${O.WEB_GL} WebGL extension 'OES_texture_float' is unsupported`);const t=e.getParameter(e.MAX_RENDERBUFFER_SIZE);if(t<Es)throw new N(`${O.WEB_GL} WebGL parameter 'gl.MAX_RENDERBUFFER_SIZE' is below the requirement: ${t} < ${Es}`);this._initShaders(),this.auxFB=e.createFramebuffer(),this.bigTriangleVBO=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.bigTriangleVBO);const r=new Float32Array([10,-10,0,10,-10,-10]);e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW),this.zeroTex=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.zeroTex),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),this._AATex=e.createTexture(),this._AAFB=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindTexture(e.TEXTURE_2D,this.zeroTex)}_getAspect(){return this.gl?this.gl.canvas.width/this.gl.canvas.height:1}_runViewportAggregations(e){const t=e.getActiveDataframes(),r=e.viz,n=this._getViewportExpressions(r._getRootExpressions());if(!n.length)return;const i=t.length?t[0].metadata:null;n.forEach(e=>e._resetViewportAgg(i));const a=n.length,s=new Set,o=this.gl.canvas.width/this.gl.canvas.height,c=1/this._zoom;t.forEach(e=>{const t=e.getViewportAABB(c,this._center,o);for(let o=0;o<e.numFeatures;o++){const c=e.properties[i.idProperty][o];if(s.has(c))continue;if(!e.inViewport(o,r,t))continue;s.add(c);const u=this._featureFromDataFrame(e,o,i);if(!(r.filter.eval(u)<Ts))for(let e=0;e<a;e++)n[e].accumViewportAgg(u)}})}_getViewportExpressions(e){const t=[];return e.map(function e(r){r._isViewport?t.push(r):r._getChildren().map(e)}),t}_featureFromDataFrame(e,t,r){return e.getFeature(t)}renderLayer(e,t){const r=e.getActiveDataframes(),n=e.viz,i=this.gl,a=this._getAspect();if(this._runViewportAggregations(e),!r.length)return;n._getRootExpressions().map(e=>e._dataReady()),i.enable(i.CULL_FACE),i.disable(i.BLEND),i.disable(i.DEPTH_TEST),i.disable(i.STENCIL_TEST),i.depthMask(!1),i.bindFramebuffer(i.FRAMEBUFFER,this.auxFB);const s=(e,r,a,s)=>{const o=a.textureIds.get(n);i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,r,0),i.viewport(0,0,Es,e.height),i.clear(i.COLOR_BUFFER_BIT),i.useProgram(a.program),t.freeTexUnit=Object.keys(o).length,s._setTimestamp((Date.now()-ws)/1e3),s._preDraw(a.program,t,i),Object.keys(o).forEach((t,r)=>{i.activeTexture(i.TEXTURE0+r),i.bindTexture(i.TEXTURE_2D,e.getPropertyTexture(t)),i.uniform1i(o[t],r)}),i.enableVertexAttribArray(a.vertexAttribute),i.bindBuffer(i.ARRAY_BUFFER,this.bigTriangleVBO),i.vertexAttribPointer(a.vertexAttribute,2,i.FLOAT,!1,0,0),i.drawArrays(i.TRIANGLES,0,3),i.disableVertexAttribArray(a.vertexAttribute)};if(r.map(e=>s(e,e.texColor,n.colorShader,n.color)),r.map(e=>s(e,e.texWidth,n.widthShader,n.width)),r.map(e=>s(e,e.texStrokeColor,n.strokeColorShader,n.strokeColor)),r.map(e=>s(e,e.texStrokeWidth,n.strokeWidthShader,n.strokeWidth)),r.map(e=>s(e,e.texFilter,n.filterShader,n.filter)),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.enable(i.BLEND),i.bindFramebuffer(i.FRAMEBUFFER,null),i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight),"point"!==e.type){const e=(window.devicePixelRatio||1)>=2?1:2;i.bindFramebuffer(i.FRAMEBUFFER,this._AAFB);const[t,r]=[i.drawingBufferWidth,i.drawingBufferHeight];if(t!==this._width||r!==this._height){i.bindTexture(i.TEXTURE_2D,this._AATex),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t*e,r*e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this._AATex,0);const n=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,n),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,t*e,r*e),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,n),[this._width,this._height]=[t,r]}i.viewport(0,0,t*e,r*e),i.clear(i.COLOR_BUFFER_BIT)}const o=1/this._zoom,{orderingMins:c,orderingMaxs:u}=function(e){const t=e.viz.order;let r=[0],n=[1030];t.isA(Ft)?(r=Array.from({length:64},(e,t)=>2*(63-t)),n=Array.from({length:64},(e,t)=>0===t?1030:2*(63-t+1))):t.isA(Mt)&&(r=Array.from({length:64},(e,t)=>2*t),n=Array.from({length:64},(e,t)=>63===t?1030:2*(t+1)));return{orderingMins:r,orderingMaxs:n}}(e);"line"!==r[0].type&&"polygon"!==r[0].type||(i.clearDepth(1),i.depthRange(0,1),i.depthFunc(i.NOTEQUAL),i.depthMask(!0),i.enable(i.DEPTH_TEST));const f=e=>r.forEach(r=>{let s=0,f=null;if(f=n.symbol.default?"point"===r.type?n.pointShader:"line"===r.type?n.lineShader:n.polygonShader:n.symbolShader,i.useProgram(f.program),i.uniform1f(f.orderMinWidth,c[e]),i.uniform1f(f.orderMaxWidth,u[e]),i.uniform2f(f.vertexScaleUniformLocation,o/a*r.scale,o*r.scale),i.uniform2f(f.vertexOffsetUniformLocation,o/a*(this._center.x-r.center.x),o*(this._center.y-r.center.y)),i.uniform2f(f.normalScale,1/i.canvas.clientWidth,1/i.canvas.clientHeight),r.vertexScale=[o/a*r.scale,o*r.scale],r.vertexOffset=[o/a*(this._center.x-r.center.x),o*(this._center.y-r.center.y)],i.enableVertexAttribArray(f.vertexPositionAttribute),i.bindBuffer(i.ARRAY_BUFFER,r.vertexBuffer),i.vertexAttribPointer(f.vertexPositionAttribute,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(f.featureIdAttr),i.bindBuffer(i.ARRAY_BUFFER,r.featureIDBuffer),i.vertexAttribPointer(f.featureIdAttr,2,i.FLOAT,!1,0,0),"line"!==r.type&&"polygon"!==r.type||(i.enableVertexAttribArray(f.normalAttr),i.bindBuffer(i.ARRAY_BUFFER,r.normalBuffer),i.vertexAttribPointer(f.normalAttr,2,i.FLOAT,!1,0,0)),i.activeTexture(i.TEXTURE0+s),i.bindTexture(i.TEXTURE_2D,r.texColor),i.uniform1i(f.colorTexture,s),s++,i.activeTexture(i.TEXTURE0+s),i.bindTexture(i.TEXTURE_2D,r.texWidth),i.uniform1i(f.widthTexture,s),s++,i.activeTexture(i.TEXTURE0+s),i.bindTexture(i.TEXTURE_2D,r.texFilter),i.uniform1i(f.filterTexture,s),s++,i.uniform2f(f.resolution,i.canvas.width,i.canvas.height),n.symbol.default)"line"!==r.type&&(i.activeTexture(i.TEXTURE0+s),i.bindTexture(i.TEXTURE_2D,r.texStrokeColor),i.uniform1i(f.strokeColorTexture,s),s++,i.activeTexture(i.TEXTURE0+s),i.bindTexture(i.TEXTURE_2D,r.texStrokeWidth),i.uniform1i(f.strokeWidthTexture,s),s++);else{const e=n.symbolShader.textureIds.get(n);t.freeTexUnit=s+Object.keys(e).length,n.symbol._setTimestamp((Date.now()-ws)/1e3),n.symbol._preDraw(n.symbolShader.program,t,i),n.symbolPlacement._setTimestamp((Date.now()-ws)/1e3),n.symbolPlacement._preDraw(n.symbolShader.program,t,i),s=t.freeTexUnit,Object.keys(e).forEach(t=>{i.activeTexture(i.TEXTURE0+s),i.bindTexture(i.TEXTURE_2D,r.getPropertyTexture(t)),i.uniform1i(e[t],s),s++})}if("line"!==r.type&&"polygon"!==r.type||i.clear(i.DEPTH_BUFFER_BIT),!n.transform.default){const e=f.textureIds.get(n);t.freeTexUnit=s+Object.keys(e).length,n.transform._setTimestamp((Date.now()-ws)/1e3),n.transform._preDraw(f.program,t,i),s=t.freeTexUnit,Object.keys(e).forEach(t=>{i.activeTexture(i.TEXTURE0+s),i.bindTexture(i.TEXTURE_2D,r.getPropertyTexture(t)),i.uniform1i(e[t],s),s++}),i.uniform2f(f.resolution,i.canvas.width,i.canvas.height)}i.drawArrays(i.TRIANGLES,0,r.numVertex),i.disableVertexAttribArray(f.vertexPositionAttribute),i.disableVertexAttribArray(f.featureIdAttr),"line"!==r.type&&"polygon"!==r.type||(i.disableVertexAttribArray(f.normalAttr),i.disable(i.DEPTH_TEST))});c.map((e,t)=>{f(t)}),"point"!==e.type&&(i.bindFramebuffer(i.FRAMEBUFFER,null),i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight),i.useProgram(this._aaBlendShader.program),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this._AATex),i.uniform1i(this._aaBlendShader.readTU,0),i.enableVertexAttribArray(this._aaBlendShader.vertexAttribute),i.bindBuffer(i.ARRAY_BUFFER,this.bigTriangleVBO),i.vertexAttribPointer(this._aaBlendShader.vertexAttribute,2,i.FLOAT,!1,0,0),i.drawArrays(i.TRIANGLES,0,3),i.disableVertexAttribArray(this._aaBlendShader.vertexAttribute)),i.disable(i.CULL_FACE)}_initShaders(){this._aaBlendShader=new ne.AABlender(this.gl)}}class As{constructor(e,t,r,n,i,a){this._propertyName=e,this._properties=t,this._viz=r,this.blendTo=function(e,t,r,n,i,a){return function(s,o=500){if("string"==typeof s&&(s=Ua(s)),r[t]&&r[t][e])return void r[t][e].a.blendTo(s,o);const c=Un(s,n[e],Un(1,Fn(gi(a),t),gn(o)));i(t,e,c,r),n.replaceChild(n[e],c),n[e].notify()}}(e,t[a],n,r,i,a),this.reset=function(e,t,r,n,i){return function(a=500){r[t]&&r[t][e]&&(r[t][e].replaceChild(r[t][e].mix,Un(Fn(gi(i),t),gn(0),gn(a))),n[e].notify(),r[t][e]=void 0)}}(e,t[a],n,r,a)}get value(){return this._viz[this._propertyName].eval(this._properties)}}class Ss{constructor(e,t,r,n,i){const a={};Object.keys(t.variables).map(s=>{a[s]=new As(`__cartovl_variable_${s}`,e,t,r,n,i)}),this.id=e[i],this.color=new As("color",e,t,r,n,i),this.width=new As("width",e,t,r,n,i),this.strokeColor=new As("strokeColor",e,t,r,n,i),this.strokeWidth=new As("strokeWidth",e,t,r,n,i),this.symbol=new As("symbol",e,t,r,n,i),this.symbolPlacement=new As("symbolPlacement",e,t,r,n,i),this.variables=a}reset(e=500){this.color.reset(e),this.width.reset(e),this.strokeColor.reset(e),this.strokeWidth.reset(e),this.symbol.reset(e),this.symbolPlacement.reset(e);for(let t in this.variables)this.variables[t].reset(e)}}class Is{constructor(){this.dataframes=[],this.renderer=null,this.viz=null,this.type=null,this.customizedFeatures={},this.idProperty=null}addDataframe(e){this.type&&this._checkDataframeType(e),this.type=e.type,this.renderer&&e.bindRenderer(this.renderer),this.dataframes.push(e),this.idProperty=e.metadata.idProperty}setRenderer(e){this.renderer=e,this.dataframes.forEach(t=>t.bindRenderer(e))}setViz(e){this.viz=e}getActiveDataframes(){this.dataframes=this.dataframes.filter(e=>!e.freed);let e=this.dataframes.filter(e=>e.active&&e.numVertex);return e.length&&void 0!==e[0].orderID&&(e=e.sort((e,t)=>e.orderID-t.orderID)),e}hasDataframes(){return this.getActiveDataframes().length>0}getNumFeatures(){return this.getActiveDataframes().map(e=>e.numFeatures).reduce((e,t)=>e+t,0)}_checkDataframeType(e){if(this.type!==e.type)throw new b(`${_.INCORRECT_TYPE} Layer dataframes must always be of the same type`)}getFeaturesAtPosition(e){return this.viz?[].concat(...this.getActiveDataframes().map(t=>t.getFeaturesAtPosition(e,this.viz))).map(e=>new Ss(e,this.viz,this.customizedFeatures,this.trackFeatureViz,this.idProperty)):[]}trackFeatureViz(e,t,r,n){n[e]=n[e]||{},n[e][t]=r}freeDataframes(){this.dataframes.map(e=>e.free()),this.dataframes=[],this.type=null}}const Ds=new WeakMap;class Rs{constructor(e,t,r){this._checkId(e),this._checkSource(t),this._checkViz(r),this._init(e,t,r)}_init(e,t,r){r._boundLayer=this,this._context=new Promise(e=>{this._contextInitialize=e}),this.id=e,this.type="custom",this.metadata=null,this._state="init",this._visible=!0,this._isLoaded=!1,this._matrix=null,this._fireUpdateOnNextRender=!1,this._emitter=vs(),this._oldDataframes=new Set,this._renderLayer=new Is,this._atomicChangeUID=0,this.update(t,r)}get visibility(){return this._visible?_s.VISIBLE:_s.HIDDEN}get visible(){return this._visible}on(e,t){return this._emitter.on(e,t)}off(e,t){return this._emitter.off(e,t)}addTo(e,t){const r=/Style is not done loading/;try{e.addLayer(this,t)}catch(n){if(!r.test(n))throw new N(`Error adding layer to map: ${n}`);e.on("load",()=>{e.addLayer(this,t)})}}remove(){this.map&&this.map.removeLayer(this.id)}async update(e,t){void 0===t&&(t=this._viz),this._checkSource(e),this._checkViz(t),e=e._clone(),this._atomicChangeUID++;const r=this._atomicChangeUID,n=t.loadImages(),i=await e.requestMetadata(t);if(await n,await this._context,this._atomicChangeUID>r)throw new N("Another atomic change was done before this one committed (1)");if(this.metadata=i,e.bindLayer(this._onDataframeAdded.bind(this),this._onDataLoaded.bind(this)),this._source!==e&&this._freeSource(),this._source=e,this.requestData(),t.setDefaultsIfRequired(this.metadata.geomType),await this._context,this._atomicChangeUID>r)throw new N("Another atomic change was done before this one committed (2)");this._viz&&this._viz.onChange(null),t.setDefaultsIfRequired(this._renderLayer.type),this._viz=t,t.onChange(this._vizChanged.bind(this)),this._compileShaders(t,i),this._needRefresh()}async blendToViz(e,t=400,r=ni){return this._checkViz(e),e.setDefaultsIfRequired(this.metadata.geomType),this._viz&&!this._source.requiresNewMetadata(e)&&(Object.keys(this._viz.variables).map(t=>{e.variables[t]=this._viz.variables[t]}),e.color._blendFrom(this._viz.color,t,r),e.strokeColor._blendFrom(this._viz.strokeColor,t,r),e.width._blendFrom(this._viz.width,t,r),e.strokeWidth._blendFrom(this._viz.strokeWidth,t,r),e.filter._blendFrom(this._viz.filter,t,r)),this._vizChanged(e).then(()=>{this._viz&&this._viz.onChange(null),e.setDefaultsIfRequired(this._renderLayer.type),this._viz=e,this._viz.onChange(this._vizChanged.bind(this))})}get viz(){return this._viz}show(){this.map.setLayoutProperty(this.id,"visibility","visible"),this._visible=!0,this.requestData()}hide(){this.map.setLayoutProperty(this.id,"visibility","none"),this._visible=!1,this._fire("updated")}async requestMetadata(e){if(e=e||this._viz)return this._source.requestMetadata(e)}async requestData(e){this._setZoomCenter(e),this.metadata&&this._visible&&(this._source.requestData(this._getZoom(),this._getViewport()),this._fireUpdateOnNextRender=!0)}hasDataframes(){return this._renderLayer.hasDataframes()}getNumFeatures(){return this._renderLayer.getNumFeatures()}getFeaturesAtPosition(e){return this._visible?this._renderLayer.getFeaturesAtPosition(e).map(this._addLayerIdToFeature.bind(this)):[]}isAnimated(){return this._viz&&this._viz.isAnimated()}onAdd(e,t){this.gl=t,this.map=e,this.renderer=function(e,t){if(!Ds.get(e)){const r=new Cs;r.initialize(t),Ds.set(e,r)}return Ds.get(e)}(e,t),this._renderLayer.setRenderer(this.renderer),this._contextInitialize()}onRemove(e,t){}prerender(e,t){m.equalArrays(this._matrix,t)||(this._matrix=t,this.requestData(t))}render(e,t){this._paintLayer(),this.isAnimated()&&this._needRefresh()}_paintLayer(){if(this._viz&&this._viz.colorShader){this._renderLayer.setViz(this._viz),this.renderer.renderLayer(this._renderLayer,{zoomLevel:this.map.getZoom()});const e=!m.isSetsEqual(this._oldDataframes,new Set(this._renderLayer.getActiveDataframes()));(this.isAnimated()||this._fireUpdateOnNextRender||e)&&(this._oldDataframes=new Set(this._renderLayer.getActiveDataframes()),this._fireUpdateOnNextRender=!1,this._fire("updated")),this._isLoaded||"dataLoaded"!==this._state||(this._isLoaded=!0,this._fire("loaded"))}}_fire(e,t){try{return this._emitter.emit(e,t)}catch(e){console.error(e)}}_onDataframeAdded(e){e.setFreeObserver(()=>{this._needRefresh()}),this._renderLayer.addDataframe(e),this._viz&&this._viz.setDefaultsIfRequired(e.type),this._needRefresh()}_needRefresh(){this.map.triggerRepaint()}_onDataLoaded(){this._state="dataLoaded",this._needRefresh()}_addLayerIdToFeature(e){return e.layerId=this.id,e}_compileShaders(e,t){e.compileShaders(this.gl,t)}async _vizChanged(e){return this._cache?this._cache:(this._cache=this._requestVizChanges(e).then(()=>{this._cache=null}),this._cache)}async _requestVizChanges(e){if(await this._context,!this._source)throw new b(`${_.MISSING_REQUIRED} a 'source' is required before changing the viz.`);const t=this._source,r=e.loadImages(),n=await t.requestMetadata(e);if(await r,this._source!==t)throw new N("A source change was made before the metadata was retrieved, therefore, metadata is stale and it cannot be longer consumed");return this.metadata=n,this._compileShaders(e,this.metadata),this._needRefresh(),this.requestData()}_checkId(e){if(m.isUndefined(e))throw new b(`${_.MISSING_REQUIRED} 'id'`);if(!m.isString(e))throw new b(`${_.INCORRECT_TYPE} 'id' property must be a string.`);if(""===e)throw new b(`${_.INCORRECT_VALUE} 'id' property must be not empty.`)}_checkSource(e){if(m.isUndefined(e))throw new b(`${_.MISSING_REQUIRED} 'source'`);if(!(e instanceof xs))throw new b(`${_.INCORRECT_TYPE} The given object is not a valid 'source'. See "carto.source.Base".`)}_checkViz(e){if(m.isUndefined(e))throw new b(`${_.MISSING_REQUIRED} 'viz'`);if(!(e instanceof gs))throw new b(`${_.INCORRECT_TYPE} The given object is not a valid 'viz'. See "carto.Viz".`);if(e._boundLayer&&e._boundLayer!==this)throw new b(`${_.INCORRECT_VALUE} The given Viz object is already bound to another layer. Vizs cannot be shared between different layers.`)}_setZoomCenter(e){let t,r;e?(t=m.computeMatrixZoom(e),r=m.computeMatrixCenter(e)):(t=m.computeMapZoom(this.map),r=m.computeMapCenter(this.map)),this.renderer.setZoom(t),this.renderer.setCenter(r)}_getViewport(){return this.renderer.getBounds()}_getZoom(){return this.map.getZoom()}_freeSource(){this._source&&this._source.free(),this._renderLayer.freeDataframes()}}function Fs(e,t,r){return{x:(e-r.center.x)/r.scale,y:(t-r.center.y)/r.scale}}function Ms(e,t,r=Math.ceil){return function(e,t){const[r,n,i,a]=t,s=1<<e,o=e=>Math.min(Math.max(e,0),s-1),c=o(Math.floor(s*(r+1)*.5)),u=o(Math.ceil(s*(i+1)*.5)-1),f=o(Math.floor(s*(1-a)*.5)),h=o(Math.ceil(s*(1-n)*.5)-1);let l=[];for(let t=c;t<=u;++t)for(let r=f;r<=h;++r)l.push({x:t,y:r,z:e});return l}(r(e),t)}const Ns=["featureClick","featureClickOut","featureEnter","featureHover","featureLeave"];class Os{constructor(e,t={autoChangePointer:!0}){e instanceof Rs&&(e=[e]),function(e){if(!Array.isArray(e))throw new b(`${_.INCORRECT_TYPE} Invalid layer list, parameter must be an array of "carto.Layer" objects.`);if(!e.length)throw new b(`${_.INCORRECT_VALUE} Invalid argument, layer list must not be empty.`);if(!e.every(e=>e instanceof Rs))throw new b(`${_.INCORRECT_TYPE} Invalid layer, layer must be an instance of "carto.Layer".`)}(e),this._init(e,t)}on(e,t){return $s(e),this._numListeners[e]=(this._numListeners[e]||0)+1,this._emitter.on(e,t)}off(e,t){return $s(e),this._numListeners[e]=this._numListeners[e]-1,this._emitter.off(e,t)}_init(e,t){return this._emitter=vs(),this._layerList=e,this._prevHoverFeatures=[],this._prevClickFeatures=[],this._numListeners={},Promise.all(e.map(e=>e._context)).then(()=>{!function(e){if(!e.every(t=>t.map===e[0].map))throw new b(`${_.INCORRECT_VALUE} Invalid argument, all layers must belong to the same map.`)}(e),this._subscribeToLayerEvents(e),this._subscribeToMapEvents(e[0].map)}).then(()=>{t.autoChangePointer&&this._setInteractiveCursor()})}_setInteractiveCursor(){const e=this._layerList[0].map;e.__carto_interacivities||(e.__carto_interacivities=new Set),this.on("featureHover",t=>{t.features.length?e.__carto_interacivities.add(this):e.__carto_interacivities.delete(this),e.getCanvas().style.cursor=e.__carto_interacivities.size>0?"pointer":""})}_subscribeToMapEvents(e){e.on("mousemove",this._onMouseMove.bind(this)),e.on("click",this._onClick.bind(this))}_subscribeToLayerEvents(e){e.forEach(e=>{e.on("updated",this._onLayerUpdated.bind(this))})}_onLayerUpdated(){this._onMouseMove(this._mouseEvent,!0)}_onMouseMove(e,t){if(this._mouseEvent=e,!e||!this._numListeners.featureEnter&&!this._numListeners.featureHover&&!this._numListeners.featureLeave)return;const r=this._createFeatureEvent(e),n=r.features,i=this._getDiffFeatures(this._prevHoverFeatures,n),a=this._getDiffFeatures(n,this._prevHoverFeatures);i.length>0&&this._fireEvent("featureLeave",{coordinates:r.coordinates,position:r.position,features:i}),a.length>0&&this._fireEvent("featureEnter",{coordinates:r.coordinates,position:r.position,features:a}),this._prevHoverFeatures=n,(!t||t&&(i.length||a.length))&&this._fireEvent("featureHover",r)}_onClick(e){if(!this._numListeners.featureClick&&!this._numListeners.featureClickOut)return;const t=this._createFeatureEvent(e),r=t.features,n=this._getDiffFeatures(this._prevClickFeatures,r);n.length>0&&this._fireEvent("featureClickOut",{coordinates:t.coordinates,position:t.position,features:n}),this._prevClickFeatures=t.features,this._fireEvent("featureClick",t)}_createFeatureEvent(e){const t=this._getFeaturesAtPosition(e.lngLat);return{coordinates:e.lngLat,position:e.point,features:t}}_fireEvent(e,t){this._emitter.emit(e,t)}_getFeaturesAtPosition(e){const t=p(e),r=Fs(t.x,t.y,{scale:c,center:{x:0,y:0}});return[].concat(...this._layerList.map(e=>e.getFeaturesAtPosition(r)))}_getDiffFeatures(e,t){const r=this._getFeatureIDs(t);return e.filter(e=>!r.includes(e.id))}_getFeatureIDs(e){return e.map(e=>e.id)}}function $s(e){if(!Ns.includes(e))throw new b(`${_.INCORRECT_VALUE} Unrecognized event: '${e}'. Available events: ${Ns.join(", ")}.`)}var Ps=r(1);function Bs(e,t){const r=function(e,t){const r=Math.hypot(e,t);return[e/r,t/r]}(e[0]-t[0],e[1]-t[1]);return[-r[1],r[0]]}function Ls(e,t){const r=[e[1],-e[0]],n=[-t[1],t[0]],i=n[0]*r[1]-n[1]*r[0],a=n[0]*r[0]+n[1]*r[1],s=Math.abs(i);return{turnLeft:i>0,joinNormal:!(s<.866&&a>.5)&&ks([(r[0]+n[0])/s,(r[1]+n[1])/s])}}function ks(e){return[-e[0],-e[1]]}function Us(e,t,r,n){if(Vs(t,r)||Vs(r,n)||Vs(n,t))return!1;const i=zs(e,t,r)<0,a=zs(e,r,n)<0,s=zs(e,n,t)<0;return i===a&&a===s}function zs(e,t,r){return(e.x-r.x)*(t.y-r.y)-(t.x-r.x)*(e.y-r.y)}function Vs(e,t){return e.x===t.x&&e.y===t.y}function Gs(e,t,r){const n=e.x-t.x,i=e.y-t.y;return n*n+i*i<=r*r}function qs(e,t){if(null===t)return!1;const r=e.x.toFixed(2),n=e.y.toFixed(2);return t.minx<=r&&r<=t.maxx&&t.miny<=n&&n<=t.maxy}function js(e,t,r){switch(r){case"line":return function(e,t){const r=e,n=e.length;for(let e=0;e<n;e+=2)t.minx=Math.min(t.minx,r[e+0]),t.miny=Math.min(t.miny,r[e+1]),t.maxx=Math.max(t.maxx,r[e+0]),t.maxy=Math.max(t.maxy,r[e+1]);return t}(e,t);case"polygon":return function(e,t){const[r,n]=[e.flat,e.holes[0]||e.flat.length/2];for(let e=0;e<n;e++)t.minx=Math.min(t.minx,r[2*e+0]),t.miny=Math.min(t.miny,r[2*e+1]),t.maxx=Math.max(t.maxx,r[2*e+0]),t.maxy=Math.max(t.maxy,r[2*e+1]);return t}(e,t)}}const Ws="separatingLineFound",Ys="separatingLineNotFound";function Xs(e,t){const r=[{x:t.minx,y:t.miny},{x:t.minx,y:t.maxy},{x:t.maxx,y:t.miny},{x:t.maxx,y:t.maxy}];return function(e,t){if(t[0].x<e.minx&&t[1].x<e.minx&&t[2].x<e.minx)return Ws;if(t[0].y<e.miny&&t[1].y<e.miny&&t[2].y<e.miny)return Ws;if(t[0].x>e.maxx&&t[1].x>e.maxx&&t[2].x>e.maxx)return Ws;if(t[0].y>e.maxy&&t[1].y>e.maxy&&t[2].y>e.maxy)return Ws;return Ys}(t,e)!==Ws&&function(e,t){for(let r=0;r<3;r++)for(let n=0;n<t.length;n++){const i=zs(t[n],e[r],e[(r+1)%3]);if(i>0)break;if(3===n)return Ws}return Ys}(e,r)!==Ws}function Hs(e,t,r,n,i){let a,s,o,c,u,f;if(e.length>=4){c=Bs(a=[e[0],e[1]],s=[e[2],e[3]]);for(let h=4;h<=e.length;h+=2){if((f=!(i&&i(h)))&&(t.vertices[r]=a[0],t.normals[r++]=-c[0],t.vertices[r]=a[1],t.normals[r++]=-c[1],t.vertices[r]=a[0],t.normals[r++]=c[0],t.vertices[r]=a[1],t.normals[r++]=c[1],t.vertices[r]=s[0],t.normals[r++]=c[0],t.vertices[r]=s[1],t.normals[r++]=c[1],t.vertices[r]=a[0],t.normals[r++]=-c[0],t.vertices[r]=a[1],t.normals[r++]=-c[1],t.vertices[r]=s[0],t.normals[r++]=c[0],t.vertices[r]=s[1],t.normals[r++]=c[1],t.vertices[r]=s[0],t.normals[r++]=-c[0],t.vertices[r]=s[1],t.normals[r++]=-c[1]),h<=e.length-2?o=[e[h],e[h+1]]:n&&(o=[e[2],e[3]]),o&&(u=Bs(s,o),f)){let{turnLeft:e,joinNormal:i}=Ls(c,u),a=e?c:ks(u),o=e?u:ks(c);t.vertices[r]=s[0],t.normals[r++]=0,t.vertices[r]=s[1],t.normals[r++]=n?1e-37:0,t.vertices[r]=s[0],t.normals[r++]=a[0],t.vertices[r]=s[1],t.normals[r++]=a[1],t.vertices[r]=s[0],t.normals[r++]=o[0],t.vertices[r]=s[1],t.normals[r++]=o[1],i&&(t.vertices[r]=s[0],t.normals[r++]=i[0],t.vertices[r]=s[1],t.normals[r++]=i[1],t.vertices[r]=s[0],t.normals[r++]=o[0],t.vertices[r]=s[1],t.normals[r++]=o[1],t.vertices[r]=s[0],t.normals[r++]=a[0],t.vertices[r]=s[1],t.normals[r++]=a[1])}a=s,s=o,c=u,o=null}}return r}function Zs(e,t){const r=new Float32Array(t);return r.set(e),r}const Qs=24;let Ks=0,Js={vertices:new Float32Array(1048576),normals:new Float32Array(1048576)};function eo(e){const t=Ks+e;if(t>Js.vertices.length){const e=2*t;Js.vertices=Zs(Js.vertices,e),Js.normals=Zs(Js.normals,e)}}var to=r(27);const ro=2,no=24;let io=0,ao={vertices:new Float32Array(2097152),normals:new Float32Array(2097152)};function so(e){const t=io+e;if(t>ao.vertices.length){const e=2*t;ao.vertices=Zs(ao.vertices,e),ao.normals=Zs(ao.normals,e)}}function oo(e,t){ao.vertices[io]=e[t],ao.normals[io++]=0,ao.vertices[io]=e[t+1],ao.normals[io++]=0}function co(e,t,r){return!!(e.clipped.includes(t)&&e.clipped.includes(r)&&e.clippedType[e.clipped.indexOf(t)]&e.clippedType[e.clipped.indexOf(r)])}function uo(e,t){switch(e){case"point":return function(e){return{verticesArrayBuffer:e,vertices:new Float32Array(e),breakpoints:[]}}(t);case"line":return function(e){let t=[],r=new Map;Ks=0;for(let n=0;n<e.length;n++){const i=e[n];for(let e=0;e<i.length;e++)eo(Qs*i[e].length),Ks=Hs(i[e],Js,Ks);r.set(t.length,0===t.length?{start:0,end:Ks}:{start:r.get(t.length-1).end,end:Ks}),t.push(Ks)}const n=new ArrayBuffer(4*Ks),i=new ArrayBuffer(4*Ks),a=new Float32Array(n),s=new Float32Array(i);for(let e=0;e<Ks;e++)a[e]=Js.vertices[e],s[e]=Js.normals[e];return{vertices:a,normals:s,verticesArrayBuffer:n,normalsArrayBuffer:i,featureIDToVertexIndex:r,breakpoints:t}}(t);case"polygon":return function(e){let t=[],r=new Map;io=0;for(let n=0;n<e.length;n++){const i=e[n];for(let e=0;e<i.length;e++){const t=i[e],r=to(t.flat,t.holes);so(ro*r.length+no*t.flat.length);for(let e=0;e<r.length;e++)oo(t.flat,2*r[e]);io=Hs(t.flat,ao,io,!0,e=>t.holes.includes((e-2)/2)||co(t,e-4,e-2))}r.set(t.length,0===t.length?{start:0,end:io}:{start:r.get(t.length-1).end,end:io}),t.push(io)}const n=new ArrayBuffer(4*io),i=new ArrayBuffer(4*io),a=new Float32Array(n),s=new Float32Array(i);for(let e=0;e<io;e++)a[e]=ao.vertices[e],s[e]=ao.normals[e];return{vertices:a,normals:s,verticesArrayBuffer:n,normalsArrayBuffer:i,featureIDToVertexIndex:r,breakpoints:t}}(t);default:throw new N(`${O.NOT_SUPPORTED} Unimplemented geometry type: '${e}'.`)}}class fo{constructor({center:e,scale:t,geom:r,properties:n,type:i,active:a,size:s,metadata:o}){this.active=a,this.center=e,this.properties=n,this.scale=t,this.type=i,this.decodedGeom=uo(i,r),this.numVertex="point"===i?3*s:this.decodedGeom.vertices.length/2,this.numFeatures="point"===i?s:this.decodedGeom.breakpoints.length||this.numVertex,this.propertyTex=[],this.metadata=o,this.propertyCount=0,this._aabb=function(e,t){switch(t){case"point":return[];case"line":case"polygon":const r=[];for(let n=0;n<e.length;n++){const i=e[n];let a={minx:Number.POSITIVE_INFINITY,miny:Number.POSITIVE_INFINITY,maxx:Number.NEGATIVE_INFINITY,maxy:Number.NEGATIVE_INFINITY};for(let e=0;e<i.length;e++)a=js(i[e],a,t);a.minx===Number.POSITIVE_INFINITY&&(a=null),r.push(a)}return r}}(r,i)}}const ho=32,lo=new Map,po={INSIDE:1,OUTSIDE:-1,INTERSECTS:0};class mo extends fo{get widthScale(){return this.renderer?2/this.renderer.gl.canvas.clientHeight/this.scale*this.renderer._zoom:1}setFreeObserver(e){this.freeObserver=e}bindRenderer(e){const t=e.gl;this.renderer=e;const r=this.decodedGeom.vertices,n=this.decodedGeom.breakpoints;this.addProperties(this.properties);const i=this.renderer.RTT_WIDTH,a=Math.ceil(this.numFeatures/i);this.height=a,this.vertexBuffer=t.createBuffer(),this.featureIDBuffer=t.createBuffer(),this.texColor=this._createStyleDataframeTexture(this.numFeatures),this.texWidth=this._createStyleDataframeTexture(this.numFeatures),this.texStrokeColor=this._createStyleDataframeTexture(this.numFeatures),this.texStrokeWidth=this._createStyleDataframeTexture(this.numFeatures),this.texFilter=this._createStyleDataframeTexture(this.numFeatures);const s=new Float32Array(r.length);let o=0,c={},u={};for(let e=0;e<this.numFeatures;e++)c[e]=e%i/(i-1),u[e]=a>1?Math.floor(e/i)/(a-1):.5;if(n.length)for(let e=0;e<r.length;e+=2){for(;e===n[o];)o++;s[e+0]=c[o],s[e+1]=u[o]}else for(let e=0;e<r.length;e+=6)s[e+0]=c[o],s[e+1]=u[o],0===s[e+0]&&(s[e+0]+=1/65536),0===s[e+1]&&(s[e+1]+=1/65536),s[e+2]=-s[e+0],s[e+3]=s[e+1],s[e+4]=s[e+0],s[e+5]=-s[e+1],o++;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),this.decodedGeom.normals&&(this.normalBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.normalBuffer),t.bufferData(t.ARRAY_BUFFER,this.decodedGeom.normals,t.STATIC_DRAW)),t.bindBuffer(t.ARRAY_BUFFER,this.featureIDBuffer),t.bufferData(t.ARRAY_BUFFER,s,t.STATIC_DRAW)}getFeaturesAtPosition(e,t){switch(this.type){case"point":return this._getPointsAtPosition(e,t);case"line":return this._getFeaturesFromTriangles("line",e,t);case"polygon":return this._getFeaturesFromTriangles("polygon",e,t);default:return[]}}getViewportAABB(e,t,r){return this._getBounds(e,t,r)}inViewport(e,t,r){const n=this.getFeature(e);let i=1;if(!t.transform.default){const e=t.transform.eval(n),i=this.widthScale/2;(r={minx:r.minx,miny:r.miny,maxx:r.maxx,maxy:r.maxy}).minx-=e[0]*i,r.maxx-=e[0]*i,r.miny-=e[1]*i,r.maxy-=e[1]*i}switch(this.type){case"point":return this._isPointInViewport(e,r);case"line":return i=this._computeLineWidthScale(n,t),this._isPolygonInViewport(e,r,i);case"polygon":return i=this._computePolygonWidthScale(n,t),this._isPolygonInViewport(e,r,i);default:return!1}}getPropertyTexture(e){if(this.propertyTex[e])return this.propertyTex[e];const t=this.properties[e],r=this.renderer.gl,n=this.renderer.RTT_WIDTH,i=Math.ceil(this.numFeatures/n);return this.height=i,this.propertyTex[e]=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.propertyTex[e]),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,n,i,0,r.ALPHA,r.FLOAT,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),this.propertyTex[e]}free(){if(this.propertyTex){const e=this.renderer.gl;this.propertyTex.map(t=>e.deleteTexture(t)),e.deleteTexture(this.texColor),e.deleteTexture(this.texStrokeColor),e.deleteTexture(this.texWidth),e.deleteTexture(this.texStrokeWidth),e.deleteTexture(this.texFilter),e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.featureIDBuffer)}const e=this.freeObserver;Object.keys(this).map(e=>{this[e]=null}),this.freed=!0,e&&e(this)}_isPointInViewport(e,t){const{minx:r,maxx:n,miny:i,maxy:a}=t,s=this.decodedGeom.vertices[6*e+0],o=this.decodedGeom.vertices[6*e+1];return s>r&&s<n&&o>i&&o<a}_isPolygonInViewport(e,t,r){const n=this._aabb[e],i=this._compareAABBs(n,t,r),a=this.decodedGeom.vertices,s=this.decodedGeom.normals;if(i===po.INTERSECTS){const n=this.decodedGeom.featureIDToVertexIndex.get(e);return function(e,t,r,n,i,a){for(let s=r;s<n;s+=6){const r=[{x:e[s+0]+t[s+0]*i,y:e[s+1]+t[s+1]*i},{x:e[s+2]+t[s+2]*i,y:e[s+3]+t[s+3]*i},{x:e[s+4]+t[s+4]*i,y:e[s+5]+t[s+5]*i},{x:e[s+0]+t[s+0]*i,y:e[s+1]+t[s+1]*i}];if(Xs(r,a))return!0}return!1}(a,s,n.start,n.end,r,t)}return i===po.INSIDE}_compareAABBs(e,t,r){if(null===e)return po.OUTSIDE;const n={minx:e.minx-r,miny:e.miny-r,maxx:e.maxx+r,maxy:e.maxy+r};switch(!0){case function(e,t){return e.minx>=t.minx&&e.maxx<=t.maxx&&e.miny>=t.miny&&e.maxy<=t.maxy}(n,t):return po.INSIDE;case function(e,t){return e.minx>t.maxx||e.miny>t.maxy||e.maxx<t.minx||e.maxy<t.miny}(n,t):return po.OUTSIDE;default:return po.INTERSECTS}}_getBounds(e,t,r){return this.vertexScale=[e/r*this.scale,e*this.scale],this.vertexOffset=[e/r*(t.x-this.center.x),e*(t.y-this.center.y)],{minx:(-1+this.vertexOffset[0])/this.vertexScale[0],maxx:(1+this.vertexOffset[0])/this.vertexScale[0],miny:(-1+this.vertexOffset[1])/this.vertexScale[1],maxy:(1+this.vertexOffset[1])/this.vertexScale[1]}}_getPointsAtPosition(e,t){const r=Fs(e.x,e.y,{center:this.center,scale:this.scale}),n=this.decodedGeom.vertices,i=[],a=this.widthScale/2;for(let e=0;e<n.length;e+=6){const s=e/6,o={x:n[e],y:n[e+1]},c=this.getFeature(s);if(this._isFeatureFiltered(c,t.filter))continue;const u=this._computePointWidthScale(c,t);if(!t.symbol.default){const e=t.symbolPlacement.eval(c);o.x+=e[0]*u,o.y+=e[1]*u}if(!t.transform.default){const e=t.transform.eval(c);o.x+=e[0]*a,o.y+=e[1]*a}Gs(r,o,u)&&i.push(this.getFeature(s))}return i}_getFeaturesFromTriangles(e,t,r){const n=Fs(t.x,t.y,{center:this.center,scale:this.scale}),i=this.decodedGeom.vertices,a=this.decodedGeom.normals,s=this.decodedGeom.breakpoints,o=[];let c,u=-1;const f=this.widthScale/2;let h;for(let t=0;t<i.length;t+=6){if(0===t||t>=s[u]){u++;const i=this.getFeature(u);let a={x:0,y:0};if(!r.transform.default){const e=r.transform.eval(i);a.x=e[0]*f,a.y=e[1]*f}if(!qs(h={x:n.x-a.x,y:n.y-a.y},this._aabb[u])||this._isFeatureFiltered(i,r.filter)){t=s[u]-6;continue}c="line"===e?this._computeLineWidthScale(i,r):this._computePolygonWidthScale(i,r)}Us(h,{x:i[t+0]+a[t+0]*c,y:i[t+1]+a[t+1]*c},{x:i[t+2]+a[t+2]*c,y:i[t+3]+a[t+3]*c},{x:i[t+4]+a[t+4]*c,y:i[t+5]+a[t+5]*c})&&(o.push(this.getFeature(u)),t=s[u]-6)}return o}_isFeatureFiltered(e,t){return t.eval(e)<.5}_genFeatureClass(){if(lo.has(this.metadata))return void(this._cls=lo.get(this.metadata));const e=class{constructor(e,t){this._index=e,this._dataframe=t}},t=this.metadata,r={};for(let e=0;e<this.metadata.propertyKeys.length;e++){const n=this.metadata.propertyKeys[e];r[n]={get:function(){const e=this._index;return"category"===t.properties[n].type?t.IDToCategory.get(this._dataframe.properties[n][e]):this._dataframe.properties[n][e]}}}Object.defineProperties(e.prototype,r),lo.set(this.metadata,e),this._cls=e}_getFeatureProperty(e,t){return"category"===this.metadata.properties[t].type?this.metadata.IDToCategory.get(this.properties[t][e]):this.properties[t][e]}getFeature(e){if(this.cachedFeatures||(this.cachedFeatures=new Array(this.numFeatures)),void 0!==this.cachedFeatures[e])return this.cachedFeatures[e];this._cls||this._genFeatureClass();const t=new this._cls(e,this);return this.cachedFeatures[e]=t,t}_addProperty(e){Object.keys(this.propertyTex).length<ho&&this.getPropertyTexture(e)}addProperties(e){for(let e=0;e<this.metadata.propertyKeys.length;e++){const t=this.metadata.propertyKeys[e];this._addProperty(t)}this._genFeatureClass()}_createStyleDataframeTexture(e){const t=this.renderer.gl,r=this.renderer.RTT_WIDTH,n=Math.ceil(e/r),i=t.createTexture();return t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r,n,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),i}_computePointWidthScale(e,t){return(Math.min(t.width.eval(e),1024)+Math.min(t.strokeWidth.eval(e),1024))/2*this.widthScale}_computeLineWidthScale(e,t){return Math.min(t.width.eval(e),1024)/2*this.widthScale}_computePolygonWidthScale(e,t){return Math.min(t.strokeWidth.eval(e),1024)/2*this.widthScale}}class go{constructor({properties:e,featureCount:t,sample:r,geomType:n,isAggregated:i,idProperty:a}={properties:{}}){this.properties=e,this.featureCount=t,this.sample=r,this.geomType=n,this.isAggregated=i,this.idProperty=a||"cartodb_id",this.categoryToID=new Map,this.IDToCategory=new Map,this.numCategories=0,Object.values(e).map(e=>{e.categories=e.categories||[],e.categories.map(t=>this.categorizeString(e,t.name,!0))}),this.propertyKeys=Object.keys(this.properties)}categorizeString(e,t,r=!1){return void 0===t&&(t=null),this.categoryToID.has(t)?this.categoryToID.get(t):(r||this.properties[e].categories.push({name:t,frequency:Number.NaN}),this.categoryToID.set(t,this.numCategories),this.IDToCategory.set(this.numCategories,t),this.numCategories++,this.numCategories-1)}propertyNames(e){const t=this.properties[e];return t.aggregations?Object.keys(t.aggregations).map(e=>t.aggregations[e]):[e]}}var bo=r(25);class _o{constructor(){this._cache=bo({max:256,length:()=>1,maxAge:36e5,dispose:(e,t)=>{t.then(e=>{e.empty||e.free()})}})}get(e,t){const r=this._cache.get(e);if(r)return r;const n=t(e);return this._cache.set(e,n),n}free(){this._cache.reset()}}class yo{constructor(e){Array.isArray(e)||(e=[e]),this._templateURLs=e,this._requestGroupID=0,this._oldDataframes=[],this._cache=new _o}bindLayer(e,t){this._addDataframe=e,this._dataLoadedCallback=t}requestData(e,t,r,n=Math.ceil){const i=Ms(e,t,n);this._getTiles(i,r)}free(){this._cache.free(),this._cache=new _o,this._oldDataframes=[]}_getTileUrl(e,t,r){const n=this._getSubdomainIndex(e,t);return this._templateURLs[n].replace("{x}",e).replace("{y}",t).replace("{z}",r)}_getSubdomainIndex(e,t){return Math.abs(e+t)%this._templateURLs.length}_getTiles(e,t){this._requestGroupID++;let r=[],n=e.length;const i=this._requestGroupID;e.forEach(({x:e,y:a,z:s})=>{this._cache.get(`${e},${a},${s}`,()=>this._requestDataframe(e,a,s,t)).then(t=>{t.orderID=e+a/1e3,t.empty?n--:r.push(t),r.length===n&&i===this._requestGroupID&&(this._oldDataframes.forEach(e=>{e.active=!1}),r.map(e=>{e.active=!0}),this._oldDataframes=r,this._dataLoadedCallback())})})}async _requestDataframe(e,t,r,n){const i=this._getTileUrl(e,t,r),a=await n(e,t,r,i);return a.empty||this._addDataframe(a),a}}var vo=r(26),xo=r.n(vo);class wo extends xs{constructor(e,t=new go,r={layerID:void 0,viewportZoomToSourceZoom:Math.ceil,maxZoom:void 0}){super(),this._templateURL=e,t instanceof go||(t=new go(t)),this._metadata=t,this._tileClient=new yo(e),this._options=r,this._options.viewportZoomToSourceZoom=this._options.viewportZoomToSourceZoom||Math.ceil,this._workerDispatch={},this._mID=0,this._workerName="MVT"}get _worker(){return this._workerInstance||(this._workerInstance=new xo.a,this._workerInstance.onmessage=(e=>{const t=e.data.mID,r=e.data.dataframe,n=r.metadata;r.empty||(Object.setPrototypeOf(r,mo.prototype),this._metadata.numCategories=n.numCategories,this._metadata.categoryToID=n.categoryToID,this._metadata.IDToCategory=n.IDToCategory,this._metadata.geomType=n.geomType,r.metadata=this._metadata),this._workerDispatch[t](r)})),this._workerInstance}_clone(){return new wo(this._templateURL,JSON.parse(JSON.stringify(this._metadata)),this._options)}bindLayer(e,t){this._tileClient.bindLayer(e,t)}async requestMetadata(){return this._metadata}requestData(e,t){return this._tileClient.requestData(e,t,(e,t,r,n)=>new Promise(i=>{if("."===n[0]){let e=window.location.pathname.split("/");e.pop();const t=e.join("/");n=`${window.location.protocol}//${window.location.host}/${t}/${n}`}else"/"===n[0]&&(n=`${window.location.protocol}//${window.location.host}${n}`);this._worker.postMessage({x:e,y:t,z:r,url:n,layerID:this._options.layerID,metadata:this._metadataSent?void 0:this._metadata,mID:this._mID,workerName:this._workerName}),this._metadataSent=!0,this._workerDispatch[this._mID]=i,this._mID++}),e=>void 0===this._options.maxZoom?this._options.viewportZoomToSourceZoom(e):Math.min(this._options.viewportZoomToSourceZoom(e),this._options.maxZoom))}free(){this._tileClient.free()}}class To{constructor(e){this._onlyAggregateFilters=e.exclusive}getFilters(e){let t={},r=this._and(e).filter(Boolean);for(let e of r){let r=e.property,n=t[r];if(n){if(!this._compatibleAndFilters(n,e.filters))return{};Object.assign(n[0],e.filters[0])}else t[r]=e.filters}return t}_and(e){return e.isA(Qe)?this._and(e.a).concat(this._and(e.b)).filter(Boolean):[this._or(e)].filter(Boolean)}_or(e){if(e.isA(Ze)){let t=this._basicCondition(e.a),r=this._basicCondition(e.b);if(t&&r&&t.property===r.property)return t.filters=t.filters.concat(r.filters),t}return this._basicCondition(e)}_removeBlend(e){return e.isA(et)&&e.originalMix.isA(Se)?e.b:e}_basicCondition(e){return e=this._removeBlend(e),this._between(e)||this._equals(e)||this._notEquals(e)||this._lessThan(e)||this._lessThanOrEqualTo(e)||this._greaterThan(e)||this._greaterThanOrEqualTo(e)||this._in(e)||this._notIn(e)}_value(e){if((e=this._removeBlend(e)).isA(Rt)||e.isA(bt)||e.isA(ot))return e.expr}_between(e){if(e.isA(Fe)){let t=this._aggregation(e.input),r=t&&this._value(e.lowerLimit),n=t&&r&&this._value(e.upperLimit);if(n)return t.filters.push({greater_than_or_equal_to:r,less_than_or_equal_to:n}),t}}_in(e){if(e.isA(Ie)){let t=this._aggregation(e.input),r=e.list.elems.map(e=>this._value(e)).filter(e=>null!==e);if(t&&r.length>0&&r.length===e.list.elems.length)return t.filters.push({in:r}),t}}_notIn(e){if(e.isA(De)){let t=this._aggregation(e.input),r=e.list.elems.map(e=>this._value(e)).filter(e=>null!==e);if(t&&r.length>0&&r.length===e.list.elems.length)return t.filters.push({not_in:r}),t}}_equals(e){return this._cmpOp(e,Xe,"equal")}_notEquals(e){return this._cmpOp(e,He,"not_equal")}_lessThan(e){return this._cmpOp(e,We,"less_than","greater_than")}_lessThanOrEqualTo(e){return this._cmpOp(e,Ye,"less_than_or_equal_to","greater_than_or_equal_to")}_greaterThan(e){return this._cmpOp(e,qe,"greater_than","less_than")}_greaterThanOrEqualTo(e){return this._cmpOp(e,je,"greater_than_or_equal_to","less_than_or_equal_to")}_aggregation(e){if((e=this._removeBlend(e)).isA(lt)||e.isA(dt)||e.isA(pt)||e.isA(mt)||e.isA(gt)){let t=this._property(e.property);if(t)return t.property=R.aggColumn(t.property,e.aggName),t}if(!this._onlyAggregateFilters)return this._property(e)}_property(e){if((e=this._removeBlend(e)).isA(ft))return{property:e.name,filters:[]}}_cmpOp(e,t,r,n){if(n=n||r,e.isA(t)){let t=this._aggregation(e.a),i=t&&this._value(e.b),a=r;if(i||(i=(t=this._aggregation(e.b))&&this._value(e.a),a=n),i){let e={};return e[a]=i,t.filters.push(e),t}}}_compatibleAndFilters(e,t){if(0===e.length||0===t.length)return!0;if(1===e.length&&1===t.length){const r=e[0],n=t[0];if(1===Object.keys(r).length&&1===Object.keys(n).length){const e=Object.keys(r)[0],t=Object.keys(n)[0],i=["less_than","less_than_or_equal_to"],a=["greater_than","greater_than_or_equal_to"];return i.includes(e)&&a.includes(t)||i.includes(t)&&a.includes(e)}}return!1}}class Eo{getFilter(e){return this._filter(e)}_filter(e){return this._and(e)||this._or(e)||this._in(e)||this._notIn(e)||this._between(e)||this._equals(e)||this._notEquals(e)||this._lessThan(e)||this._lessThanOrEqualTo(e)||this._greaterThan(e)||this._greaterThanOrEqualTo(e)||this._blend(e)||null}_and(e){if(e.isA(Qe)){const t=[this._filter(e.a),this._filter(e.b)].filter(Boolean).reduce((e,t)=>e.concat(t),[]);if(t.length)return 1===t.length?t[0]:{type:"and",left:t[0],right:t[1]}}}_or(e){if(e.isA(Ze)){let t=this._filter(e.a),r=this._filter(e.b);if(t&&r)return{type:"or",left:t,right:r}}}_lessThan(e){return this._cmpOp(e,We,"lessThan")}_lessThanOrEqualTo(e){return this._cmpOp(e,Ye,"lessThanOrEqualTo")}_greaterThan(e){return this._cmpOp(e,qe,"greaterThan")}_greaterThanOrEqualTo(e){return this._cmpOp(e,je,"greaterThanOrEqualTo")}_equals(e){return this._cmpOp(e,Xe,"equals")}_notEquals(e){return this._cmpOp(e,He,"notEquals")}_cmpOp(e,t,r){if(e.isA(t)){let t=this._property(e.a)||this._value(e.a),n=this._property(e.b)||this._value(e.b);if(t&&n)return{type:r,left:t,right:n}}}_blend(e){if(e.isA(et)&&e.originalMix.isA(Se))return this._filter(e.b)}_property(e){if(e.isA(ft))return{type:"property",property:e.name}}_value(e){if(e.isA(Rt)||e.isA(bt)||e.isA(ot))return{type:"value",value:e.expr}}_in(e){if(e.isA(Ie)){let t=this._property(e.input),r=e.list.elems.map(e=>this._value(e));if(t&&r.length>0&&r.length===e.list.elems.length)return{type:"in",property:t.property,values:r.map(e=>e.value)}}}_notIn(e){if(e.isA(De)){let t=this._property(e.input),r=e.list.elems.map(e=>this._value(e));if(t&&r.length>0&&r.length===e.list.elems.length)return{type:"notIn",property:t.property,values:r.map(e=>e.value)}}}_between(e){if(e.isA(Fe)){let t=this._property(e.input),r=this._value(e.lowerLimit),n=this._value(e.upperLimit);if(t&&r&&n)return{type:"between",property:t.property,lower:r.value,upper:n.value}}}}function Co(e){return e.type?`(${Do[e.type](e)})`:Ao(e)}function Ao(e){return isFinite(e)?String(e):`'${e.replace(/\'/g,"''")}'`}function So(e){return e.match(/^[a-z\d_]+$/)||(e=`"${e.replace(/\"/g,'""')}"`),e}function Io(e,...t){return t.map(e=>Co(e)).join(e)}const Do={and:e=>Io(" AND ",e.left,e.right),or:e=>Io(" OR ",e.left,e.right),between:e=>`${So(e.property)} BETWEEN ${Ao(e.lower)} AND ${Ao(e.upper)}`,in:e=>`${So(e.property)} IN (${Io(",",...e.values)})`,notIn:e=>`${So(e.property)} NOT IN (${Io(",",...e.values)})`,equals:e=>Io(" = ",e.left,e.right),notEquals:e=>Io(" <> ",e.left,e.right),lessThan:e=>Io(" < ",e.left,e.right),lessThanOrEqualTo:e=>Io(" <= ",e.left,e.right),greaterThan:e=>Io(" > ",e.left,e.right),greaterThanOrEqualTo:e=>Io(" >= ",e.left,e.right),property:e=>So(e.property),value:e=>Ao(e.input)};function Ro(e,t={}){const r=new To(t),n={preaggregation:new Eo(t).getFilter(e.filter),aggregation:r.getFilters(e.filter)};return n.preaggregation||n.aggregation?n:null}class Fo extends g{constructor(e){super({message:e}),this.name="CartoMapsAPIError"}}const Mo={NOT_SUPPORTED:"[Not supported]:",SECURITY:"[Security]:"},No=1e3,Oo=2e6,$o=2048;class Po{constructor(e){this._source=e,this._exclusive=!0,this._MNS=null,this._promiseMNS=null,this.inProgressInstantiations={}}bindLayer(e,t){this._addDataframe=e,this._dataLoadedCallback=t,this._mvtClient.bindLayer(e,t)}_getInstantiationID(e,t,r,n){return JSON.stringify({MNS:F.simplify(e),resolution:t,filtering:n.backendFilters?r:null,options:n})}async getMetadata(e){const t=e.getMinimumNeededSchema();this._checkAcceptableMNS(t);const r=e.resolution,n=Ro(e,{exclusive:this._exclusive});if(this._forceIncludeCartodbId(t),this._needToInstantiate(t,r,n)){const e=await this._repeatableInstantiate(t,r,n);this._updateStateAfterInstantiating(e)}return this.metadata}_forceIncludeCartodbId(e){e.cartodb_id||(e.cartodb_id=[{type:"unaggregated"}])}requiresNewMetadata(e){const t=e.getMinimumNeededSchema();this._checkAcceptableMNS(t);const r=e.resolution,n=Ro(e,{exclusive:this._exclusive});return this._forceIncludeCartodbId(t),this._needToInstantiate(t,r,n)}_checkAcceptableMNS(e){Object.keys(e).forEach(t=>{const r=e[t],n=r.some(e=>"aggregated"===e.type),i=r.some(e=>"unaggregated"===e.type);if(n&&i)throw new b(`${_.INCORRECT_VALUE} Incompatible combination of cluster aggregation usages (${JSON.stringify(r.filter(e=>"aggregated"===e.type))}) with unaggregated usage for property '${t}'`)})}getData(e,t){if(this._mvtClient)return this._mvtClient.requestData(e,t)}_needToInstantiate(e,t,r){return!F.equals(this._MNS,e)||t!==this.resolution||JSON.stringify(r)!==JSON.stringify(this.filtering)&&this.metadata.featureCount>Oo}_isInstantiated(){return!!this.metadata}_intantiationChoices(e){let t={backendFilters:!0};return e&&e.featureCount>=0&&(t.backendFilters=e.featureCount>Oo||!e.backendFiltersApplied),t}async _instantiateUncached(e,t,r,n={backendFilters:!0},i=null){const a=this._getConfig(),s=await this._generateAggregation(e,t);let o=this._buildSelectClause(e),c=this._buildQuery(o);const u=`(${c}) AS tmp`;let f=n.backendFilters?r:null,h=!1;if(f&&this._requiresAggregation(e)&&(s.filters=function(e){return e&&e.aggregation}(f),s.filters&&(h=!0),this._exclusive||(f=null)),f){const e=this._buildQuery(o,f);h=h||e!==c,c=e}let{urlTemplates:l,metadata:d}=await this._getInstantiationPromise(u,a,s,c,o,i);return d.backendFiltersApplied=h,{MNS:e,resolution:t,filters:r,metadata:d,urlTemplates:l}}_updateStateAfterInstantiating({MNS:e,resolution:t,filters:r,metadata:n,urlTemplates:i}){this._mvtClient&&this._mvtClient.free(),this._mvtClient=new wo(i),this._mvtClient._workerName="windshaft",this._mvtClient.bindLayer(this._addDataframe,this._dataLoadedCallback),this.urlTemplates=i,this.metadata=n,this._mvtClient._metadata=n,this._MNS=e,this.filtering=r,this.resolution=t,this._checkLayerMeta(e)}async _instantiate(e,t,r,n,i){const a=this._getInstantiationID(e,t,r,n);if(this.inProgressInstantiations[a])return this.inProgressInstantiations[a];const s=this._instantiateUncached(e,t,r,n,i);return this.inProgressInstantiations[a]=s,s}async _repeatableInstantiate(e,t,r){let n=null;return async function(e,t,r){let n=r(e),i=await n,a=t(i);return JSON.stringify(e)===JSON.stringify(a)?n:r(a)}(this._intantiationChoices(this.metadata),e=>(n=e.metadata,this._intantiationChoices(e.metadata)),i=>this._instantiate(e,t,r,i,n))}_checkLayerMeta(e){if(!this._isAggregated()&&this._requiresAggregation(e))throw new Fo(`${Mo.NOT_SUPPORTED} Aggregation not supported for this dataset`)}_isAggregated(){return this.metadata&&this.metadata.isAggregated}_requiresAggregation(e){return Object.values(e).some(e=>e.some(e=>"aggregated"===e.type))}_generateAggregation(e,t){let r={columns:{},dimensions:{},placement:"centroid",resolution:t,threshold:1};return Object.keys(e).forEach(t=>{if("cartodb_id"!==t){e[t].forEach(e=>{"aggregated"===e.type?r.columns[F.column.aggColumn(t,e.op)]={aggregate_function:e.op,aggregated_column:t}:r.dimensions[t]=t})}}),r}_buildSelectClause(e){const t=Object.keys(e).concat(["the_geom_webmercator","cartodb_id"]);return t.filter((e,r)=>t.indexOf(e)===r)}_buildQuery(e,t){return`SELECT ${e.map(e=>`"${e}"`).join()} FROM ${this._source._query?`(${this._source._query}) as _cdb_query_wrapper`:this._source._tableName} ${t?function(e){let t;return(e=e&&e.preaggregation)&&Object.keys(e).length>0&&(t=Co(e)),t?"WHERE "+t:""}(t):""}`}_getConfig(){return{apiKey:this._source._apiKey,username:this._source._username,serverURL:this._source._serverURL}}free(){this._mvtClient&&this._mvtClient.free()}async _getInstantiationPromise(e,t,r,n,i,a=null){const s={buffersize:{mvt:1},layers:[{type:"mapnik",options:{sql:n,aggregation:r,dates_as_numbers:!0}}]};if(!a){const e=["the_geom","the_geom_webmercator"],t=i.filter(t=>!e.includes(t));s.layers[0].options.metadata={geometryType:!0,columnStats:{topCategories:32768,includeNulls:!0},sample:{num_rows:No,include_columns:t}}}let o;try{o=await fetch(function(e,t){const r=JSON.stringify(t),n=Bo("api_key",e.apiKey),i=Bo("client",`vl-${Ps.a}`),a=[n,i,Bo("config",r)],s=Lo(ko(e),a);if(s.length<$o)return new Request(s,{method:"GET",headers:{Accept:"application/json"}});return new Request(Lo(ko(e),[n,i]),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:r})}(t,s))}catch(e){throw new Fo(`Failed to connect to Maps API with your user('${this._source._username}')`)}const c=await o.json();if(!o.ok){if(401===o.status)throw new Fo(`${Mo.SECURITY} Unauthorized access to Maps API: invalid combination of user('${this._source._username}') and apiKey('${this._source._apiKey}')`);if(403===o.status)throw new Fo(`${Mo.SECURITY} Unauthorized access to dataset: the provided apiKey('${this._source._apiKey}') doesn't provide access to the requested data`);throw new Fo(`SQL errors: ${JSON.stringify(c.errors)}`)}return{urlTemplates:c.metadata.tilejson.vector.tiles,metadata:a||this._adaptMetadata(c.metadata.layers[0].meta,r)}}_adaptMetadata(e,t){e.datesAsNumbers=e.dates_as_numbers;const{stats:r,aggregation:n,datesAsNumbers:i}=e,a=r.hasOwnProperty("featureCount")?r.featureCount:r.estimatedFeatureCount,s=function(e){switch(e){case"ST_MultiPolygon":case"ST_Polygon":return"polygon";case"ST_Point":return"point";case"ST_MultiLineString":case"ST_LineString":return"line";default:throw new Fo(`${Mo.NOT_SUPPORTED} Unimplemented geometry type '${e}'.`)}}(r.geometryType),o=r.columns;Object.keys(t.columns).forEach(e=>{const t=F.column.getBase(e),r=F.column.getAggFN(e);o[t].aggregations||(o[t].aggregations={}),o[t].aggregations[r]=e}),Object.values(o).map(e=>{e.type=function(e){if("string"===e)return"category";return e}(e.type)}),Object.keys(o).forEach(e=>{const t=o[e];"category"===t.type&&t.categories?t.categories.forEach(e=>{e.name=e.category,delete e.category}):i&&i.includes(e)&&(t.type="date",["min","max","avg"].map(e=>{t[e]&&(t[e]=new qr(1e3*t[e]).value)}))}),"point"===s&&(o[D]={type:"number"});return new go({properties:o,featureCount:a,sample:r.sample,geomType:s,isAggregated:n.mvt,idProperty:"cartodb_id"})}}function Bo(e,t){return`${e}=${encodeURIComponent(t)}`}function Lo(e,t=[]){return`${e}?${t.join("&")}`}function ko(e,t){let r=`${e.serverURL}/api/v1/map`;return t&&(r+=t),r}const Uo="https://{user}.carto.com";class zo extends xs{constructor(){super(),this._client=new Po(this)}initialize(e,t){this._auth=e||y,this._config=t||v,w(this._auth),E(this._config),this._apiKey=this._auth.apiKey,this._username=this._auth.username,this._serverURL=this._generateURL(this._auth,this._config)}bindLayer(...e){this._client.bindLayer(...e)}requiresNewMetadata(e){return this._client.requiresNewMetadata(e)}requestMetadata(e){return this._client.getMetadata(e)}requestData(e,t){return this._client.getData(e,t)}free(){this._client.free()}_generateURL(e,t){let r=t&&t.serverURL||Uo;return r=r.replace(/{user}/,e.username)}}class Vo extends zo{constructor(e,t,r){super(),this._checkTableName(e),this._tableName=e,this.initialize(t,r)}_clone(){return new Vo(this._tableName,this._auth,this._config)}_checkTableName(e){if(m.isUndefined(e))throw new b(`${_.MISSING_REQUIRED} 'tableName'`);if(!m.isString(e))throw new b(`${_.INCORRECT_TYPE} 'tableName' property must be a string.`);if(""===e)throw new b(`${_.INCORRECT_VALUE} 'tableName' property must be not empty.`)}}const Go=1e3;class qo extends xs{constructor(e,t={}){if(super(),this._checkData(e),this._type="",this._categoryStringToIDMap={},this._numCategories=0,this._numFields=new Set,this._catFields=new Set,this._dateFields=new Set,this._providedDateColumns=new Set(t.dateColumns),this._properties={},this._boundColumns=new Set,this._data=e,"FeatureCollection"===e.type)this._features=e.features;else{if("Feature"!==e.type)throw new b(`${_.INCORRECT_VALUE} 'data' property must be a GeoJSON object.`);this._features=[e]}this._features=this._initializeFeatureProperties(this._features),this._setCoordinatesCenter()}bindLayer(e,t){this._addDataframe=e,this._dataLoadedCallback=t}requestMetadata(e){return Promise.resolve(this._computeMetadata(e))}requestData(){if(this._dataframe){const e=this._decodeUnboundProperties();return this._dataframe.addProperties(e),void Object.keys(e).forEach(e=>{this._boundColumns.add(e)})}const e=new mo({active:!0,center:this._dataframeCenter,geom:this._decodeGeometry(),properties:this._decodeUnboundProperties(),scale:1,size:this._features.length,type:this._getDataframeType(this._type),metadata:this._metadata});this._boundColumns=new Set(Object.keys(e.properties)),this._dataframe=e,this._addDataframe(e),this._dataLoadedCallback()}requiresNewMetadata(){return!1}_clone(){return new qo(this._data,{dateColumns:Array.from(this._providedDateColumns)})}_checkData(e){if(m.isUndefined(e))throw new b(`${_.MISSING_REQUIRED} 'data'`);if(!m.isObject(e))throw new b(`${_.INCORRECT_TYPE} 'data' property must be an object.`)}_initializeFeatureProperties(e){for(let t=0;t<e.length;t++)e[t].properties=e[t].properties||{};return e}_computeMetadata(e){const t=[];this._addNumericColumnField("cartodb_id");const r=this._features.length,n=new Set(Object.keys(F.simplify(e.getMinimumNeededSchema())));for(let e=0;e<this._features.length;e++){const r=this._features[e].properties,i=Object.keys(r);for(let e=0,t=i.length;e<t;e++){const t=i[e];if(!n.has(t)||this._boundColumns.has(t))continue;const a=r[t];this._addPropertyToMetadata(t,a)}this._sampleFeatureOnMetadata(r,t,this._features.length)}this._numFields.forEach(e=>{const t=this._properties[e];t.avg=t.sum/t.count});let i="";r>0&&(i=this._getDataframeType(this._features[0].geometry.type));return this._metadata=new go({properties:this._properties,featureCount:r,sample:t,geomType:i,idProperty:"cartodb_id"}),this._metadata}_sampleFeatureOnMetadata(e,t,r){if(r>Go){const e=Go/r;if(Math.random()>e)return}t.push(e)}_addNumericPropertyToMetadata(e,t){if(this._catFields.has(e)||this._dateFields.has(e))throw new b(`${_.INCORRECT_TYPE} Unsupported GeoJSON: the property '${e}' has different types in different features.`);this._addNumericColumnField(e);const r=this._properties[e];r.min=Math.min(r.min,t),r.max=Math.max(r.max,t),r.sum+=t}_addNumericColumnField(e){this._numFields.has(e)||(this._numFields.add(e),this._properties[e]={type:"number",min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,avg:Number.NaN,sum:0,count:0})}_addDatePropertyToMetadata(e,t){if(this._catFields.has(e)||this._numFields.has(e))throw new N(`${O.NOT_SUPPORTED} Unsupported GeoJSON: the property '${e}' has different types in different features.`);this._addDateColumnField(e);const r=this._properties[e],n=m.castDate(t);r.min=r.min?m.castDate(Math.min(r.min,n)):n,r.max=r.max?m.castDate(Math.max(r.max,n)):n,r.sum+=t,r.count++}_addDateColumnField(e){this._dateFields.has(e)||(this._dateFields.add(e),this._properties[e]={type:"date",min:null,max:null,avg:null,sum:0,count:0})}_addPropertyToMetadata(e,t){return this._providedDateColumns.has(e)?this._addDatePropertyToMetadata(e,t):Number.isFinite(t)?this._addNumericPropertyToMetadata(e,t):void this._addCategoryPropertyToMetadata(e,t)}_addCategoryPropertyToMetadata(e,t){if(this._numFields.has(e)||this._dateFields.has(e))throw new N(`${O.NOT_SUPPORTED} Unsupported GeoJSON: the property '${e}' has different types in different features.`);this._catFields.has(e)||(this._catFields.add(e),this._properties[e]={type:"category",categories:[]});const r=this._properties[e],n=r.categories.find(e=>e.name===t);n?n.frequency++:r.categories.push({name:t,frequency:1})}_decodeUnboundProperties(){const e={};[...this._numFields].concat([...this._catFields]).concat([...this._dateFields]).map(t=>{this._boundColumns.has(t)||(e[t]=new Float32Array(this._features.length+1024))});const t=[...this._catFields].filter(e=>!this._boundColumns.has(e)),r=[...this._numFields].filter(e=>!this._boundColumns.has(e)),n=[...this._dateFields].filter(e=>!this._boundColumns.has(e));for(let i=0;i<this._features.length;i++){const a=this._features[i];t.forEach(t=>{e[t][i]=this._metadata.categorizeString(t,a.properties[t],!0)}),r.forEach(t=>{"cartodb_id"!==t||Number.isFinite(a.properties.cartodb_id)||(a.properties.cartodb_id=-i),e[t][i]=Number(a.properties[t])}),n.forEach(t=>{const r=this._properties[t],n=m.castDate(a.properties[t]).getTime(),s=r.min,o=r.max,c=(n-s.getTime())/(o.getTime()-s.getTime());e[t][i]=c})}return e}_getDataframeType(e){switch(e){case"Point":return"point";case"LineString":case"MultiLineString":return"line";case"Polygon":case"MultiPolygon":return"polygon";default:return""}}_fetchFeatureGeometry(e={},t){const r=this._features.length,n=e.sample?Math.max(1,Math.floor(r/e.sample)):1;for(let e=0;e<r;e+=n){const r=this._features[e];"Feature"===r.type&&t(e,r.geometry)}return null}_allocGeometry(){return"Point"===this._type?new Float32Array(6*this._features.length):[]}_decodeGeometry(){let e=this._allocGeometry();return this._fetchFeatureGeometry({},(t,r)=>{const n=r.type,i=r.coordinates;if(this._type!==n)throw new b(`${_.INCORRECT_TYPE} multiple geometry types not supported: found '${n}' instead of '${this._type}'.`);if("Point"===n){const r=this._computePointGeometry(i);e[6*t+0]=r.x,e[6*t+1]=r.y,e[6*t+2]=r.x,e[6*t+3]=r.y,e[6*t+4]=r.x,e[6*t+5]=r.y}else if("LineString"===n){const t=this._computeLineStringGeometry(i);e.push([t])}else if("MultiLineString"===n){const t=this._computeMultiLineStringGeometry(i);e.push(t)}else if("Polygon"===n){const t=this._computePolygonGeometry(i);e.push([t])}else if("MultiPolygon"===n){const t=this._computeMultiPolygonGeometry(i);e.push(t)}}),e}_computePointGeometry(e){const t=e[1],r=e[0],n=m.projectToWebMercator({lat:t,lng:r});return Fs(n.x,n.y,{scale:m.WM_R,center:this._center})}_computeLineStringGeometry(e,t){let r=[];for(let n=0;n<e.length;n++){const i=this._computePointGeometry(e[t?e.length-n-1:n]);r.push(i.x,i.y)}return r}_computeMultiLineStringGeometry(e){let t=[];for(let r=0;r<e.length;r++){let n=this._computeLineStringGeometry(e[r]);n.length>0&&t.push(n)}return t}_computePolygonGeometry(e){let t={flat:[],holes:[],clipped:[]},r=0,n=!1;if(e.length){n=this._isReversed(e[0]);const r=this._computeLineStringGeometry(e[0],n);t.flat=t.flat.concat(r)}for(let i=1;i<e.length;i++){n!==this._isReversed(e[i])&&(r+=e[i-1].length,t.holes.push(r));const a=this._computeLineStringGeometry(e[i],n);t.flat=t.flat.concat(a)}return t}_computeMultiPolygonGeometry(e){let t=[];for(let r=0;r<e.length;r++){let n=this._computePolygonGeometry(e[r]);n.flat.length>0&&t.push(n)}return t}_isReversed(e){let t,r=0,n=e[0];for(let i=0;i<e.length-1;i++)r+=((t=e[i+1])[1]-n[1])*(t[0]+n[0]),n=t;return r>=0}_samplePoint(e){const t=e.type,r=e.coordinates;return"Point"===t?r:"LineString"===t?r[0]:"MultiLineString"===t||"Polygon"===t?r[0][0]:"MultiPolygon"===t?r[0][0][0]:void 0}_setCoordinatesCenter(){let e=0,t=0,r=0;this._fetchFeatureGeometry({sample:10},(n,i)=>{this._type||(this._type=i.type);const a=this._samplePoint(i),s=m.projectToWebMercator({lng:a[0],lat:a[1]});e+=s.x,t+=s.y,r+=1}),r>1&&(e/=r,t/=r),this._center={x:e,y:t},this._dataframeCenter=Fs(this._center.x,this._center.y,{scale:m.WM_R,center:{x:0,y:0}})}free(){}}class jo extends zo{constructor(e,t,r){super(),this._checkQuery(e),this._query=e,this.initialize(t,r)}_clone(){return new jo(this._query,this._auth,this._config)}_checkQuery(e){if(m.isUndefined(e))throw new b(`${_.MISSING_REQUIRED} 'query'`);if(!m.isString(e))throw new b(`${_.INCORRECT_TYPE} 'query' property must be a string.`);if(""===e)throw new b(`${_.INCORRECT_VALUE} 'query' property must be not empty.`);if(!e.match(/\bSELECT\b/i))throw new b(`${_.INCORRECT_VALUE} 'query' property must be a SQL query.`)}}let Wo=[];function Yo(e,t,r){let n=[];if("loaded"===e){const e=new Set(t);t.forEach(t=>{const i=()=>{e.delete(t),0===e.size&&r()};t.on("loaded",i),n.push(i)})}else{if("updated"!==e)throw new b(`${_.INCORRECT_VALUE} Event name '${e}' is not supported by "carto.on". Supported event names are: 'loaded' and 'updated'.`);{let e=!1;t.forEach(t=>{const i=()=>{e||window.requestAnimationFrame(()=>{e=!1,r()})};t.on("updated",i),n.push(i)})}}Wo.push({eventName:e,layerList:t,callback:r,internalCallbacks:n})}function Xo(e,t,r){Wo.forEach(n=>{n.eventName===e&&n.layerList.every(e=>t.includes(e))&&n.callback===r&&n.layerList.forEach(t=>{n.internalCallbacks.forEach(r=>{t.off(e,r)})})}),Wo=Wo.filter(n=>!(n.eventName===e&&n.layerList.every(e=>t.includes(e))&&n.callback===r))}r.d(t,"source",function(){return Ho}),r.d(t,"version",function(){return Ps.a}),r.d(t,"on",function(){return Yo}),r.d(t,"off",function(){return Xo}),r.d(t,"setDefaultAuth",function(){return x}),r.d(t,"setDefaultConfig",function(){return T}),r.d(t,"expressions",function(){return a}),r.d(t,"Layer",function(){return Rs}),r.d(t,"Viz",function(){return gs}),r.d(t,"Map",function(){return ys}),r.d(t,"Interactivity",function(){return Os});const Ho={Dataset:Vo,SQL:jo,GeoJSON:qo,MVT:wo};t.default={version:Ps.a,on:Yo,off:Xo,setDefaultAuth:x,setDefaultConfig:T,source:Ho,expressions:a,Layer:Rs,Viz:gs,Map:ys,Interactivity:Os}}])});